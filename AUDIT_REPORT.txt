BASELINE_METRICS_JSON
{
  "audit_date": "2026-02-07",
  "npm_scripts_count": 67,
  "console_log_count": 13,
  "logger_count": 158,
  "structured_logging_ratio": "12:1",
  "service_worker": false,
  "firebase_persistence": false,
  "ci_workflow_count": 10,
  "test_count": 297
}

FINDINGS_JSONL
{"category": "GoldenPath", "title": "Missing setup automation script", "fingerprint": "engineering-productivity::package.json::missing-setup-script", "severity": "S3", "effort": "E0", "confidence": 100, "files": ["package.json"], "why_it_matters": "New developers must manually configure environment variables and hooks, increasing onboarding time and error risk.", "suggested_fix": "Add a 'setup' script to package.json that runs 'npm install', copies .env.example to .env.local, and initializes git hooks.", "acceptance_tests": ["Run 'npm run setup' in a clean clone and verify environment is ready."], "evidence": ["package.json scripts section missing 'setup' command"], "line": 1}
{"category": "Debugging", "title": "Logger lacks request correlation ID", "fingerprint": "engineering-productivity::lib/logger.ts::missing-correlation-id", "severity": "S2", "effort": "E1", "confidence": 100, "files": ["lib/logger.ts"], "why_it_matters": "Debugging issues across multiple log entries is difficult without a unique identifier linking related operations, especially in concurrent environments.", "suggested_fix": "Implement AsyncLocalStorage to store and inject a unique correlation ID into every log message.", "acceptance_tests": ["Verify that multiple log calls within the same request share the same correlation ID."], "evidence": ["lib/logger.ts does not import or use AsyncLocalStorage", "grep for 'correlationId' returns no results"], "line": 105}
{"category": "Offline", "title": "Firestore offline persistence disabled", "fingerprint": "engineering-productivity::lib/firebase.ts::missing-persistence", "severity": "S1", "effort": "E1", "confidence": 100, "files": ["lib/firebase.ts"], "why_it_matters": "Users lose access to their journal data immediately upon network loss, which is critical for a recovery support application.", "suggested_fix": "Enable offline persistence in Firestore initialization using enableIndexedDbPersistence() or enableMultiTabIndexedDbPersistence().", "acceptance_tests": ["Load app, disconnect network, verify data is still accessible."], "evidence": ["lib/firebase.ts initializes Firestore with getFirestore() but does not call enableIndexedDbPersistence()"], "line": 43}
{"category": "Offline", "title": "Missing Service Worker for PWA support", "fingerprint": "engineering-productivity::public/sw.js::missing-service-worker", "severity": "S2", "effort": "E2", "confidence": 100, "files": ["public/sw.js"], "why_it_matters": "The application cannot function as an installable PWA or cache assets for offline use, degrading user experience in poor network conditions.", "suggested_fix": "Add a Service Worker (e.g., using next-pwa) to cache static assets and handle offline fallback.", "acceptance_tests": ["Verify sw.js is registered and application is installable."], "evidence": ["public/sw.js does not exist", "next.config.mjs does not configure PWA plugin"], "line": 1}
{"category": "CI_CD", "title": "Serial execution of CI jobs", "fingerprint": "engineering-productivity::.github/workflows/ci.yml::serial-jobs", "severity": "S2", "effort": "E2", "confidence": 100, "files": [".github/workflows/ci.yml"], "why_it_matters": "Running linting, type checking, and testing sequentially in a single job slows down feedback loops for developers.", "suggested_fix": "Split 'lint-typecheck-test' into parallel jobs or use matrix strategy for tests to reduce total runtime.", "acceptance_tests": ["Verify CI pipeline runs stages in parallel where possible."], "evidence": ["ci.yml 'lint-typecheck-test' job runs steps sequentially"], "line": 11}
{"category": "Testing", "title": "Playwright installed but not configured", "fingerprint": "engineering-productivity::package.json::unused-playwright", "severity": "S1", "effort": "E2", "confidence": 100, "files": ["package.json"], "why_it_matters": "End-to-end tests are critical for verifying user flows, but the tooling is installed without configuration or tests, leaving a coverage gap.", "suggested_fix": "Create playwright.config.ts and add initial E2E tests for critical paths (e.g., login, journal entry).", "acceptance_tests": ["Run 'npx playwright test' and verify it executes tests."], "evidence": ["package.json has '@playwright/test'", "No playwright.config.ts found", "No e2e/ directory found"], "line": 1}

SUSPECTED_FINDINGS_JSONL
{"category": "Engineering", "title": "Potential unused dependencies", "fingerprint": "engineering-productivity::package.json::unused-deps", "severity": "S3", "effort": "E1", "confidence": 40, "files": ["package.json"], "why_it_matters": "Unused dependencies bloat the install size and increase security surface area.", "suggested_fix": "Run 'knip' and remove confirmed unused dependencies.", "acceptance_tests": ["Run 'npm run deps:unused' and verify clean output."], "evidence": ["'knip' is in scripts but I did not run it to confirm failures"], "line": 1}

HUMAN_SUMMARY
# Audit Summary: Sonash-v0

## Baseline Metrics
- **Audit Date**: 2026-02-07
- **Logging**: Good usage of structured logger (12:1 ratio), but missing correlation IDs.
- **Testing**: 297 unit/integration tests found, but **zero E2E tests** configured despite Playwright dependency.
- **CI/CD**: 10 workflows, but the main CI pipeline is serial and likely slow.
- **Offline**: **Critical Gap**. No Firestore persistence or Service Worker found.

## Top 5 Friction Points
1.  **Offline Support Missing (S1)**: For a recovery journal, lack of offline access is a major UX flaw. Data is only available while online.
2.  **Missing E2E Tests (S1)**: Playwright is installed but unused. Critical user flows are not verified end-to-end.
3.  **Serial CI Pipeline (S2)**: Lint, type-check, and tests run sequentially, slowing down developer feedback.
4.  **No Correlation IDs (S2)**: Debugging production issues will be difficult without request tracing.
5.  **Manual Setup (S3)**: No `npm run setup` script means new developers must manually configure environments.

## Quick Wins (E0-E1)
1.  **Add `setup` script**: Create a simple script to copy `.env.example` and run `npm install`. (E0)
2.  **Enable Firestore Persistence**: One-line change in `lib/firebase.ts`. (E1)
3.  **Add Correlation IDs**: Update `lib/logger.ts` to use `AsyncLocalStorage`. (E1)

## Improvement Roadmap
1.  **Immediate**: Fix offline support (enable persistence) and add `setup` script.
2.  **Short-term**: Configure Playwright and write a smoke test.
3.  **Medium-term**: Optimize CI pipeline to run jobs in parallel.
4.  **Long-term**: Implement full PWA support with Service Worker.

## Effort Estimate
-   **Critical Fixes**: ~1 day (Persistence + Setup)
-   **Infrastructure**: ~2-3 days (CI + Playwright Setup + Logger)
-   **Full Remediation**: ~1 week
