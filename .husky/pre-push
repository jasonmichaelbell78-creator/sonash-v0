#!/bin/sh
# Pre-push hook - Additional gate before pushing to remote
# This blocks pushes if checks fail

echo "ðŸš€ Running pre-push checks..."

# 1. Run tests
echo "  â–¶ Running tests..."
if ! npm test > /dev/null 2>&1; then
  echo "  âŒ Tests failed"
  npm test 2>&1 | tail -10
  echo ""
  echo "  Fix tests before pushing. Run: npm test"
  exit 1
fi
echo "  âœ… Tests passed"

# 2. Run pattern compliance check
# NOTE: Currently set to WARN (not block) because legacy code has violations
# TODO: Change back to blocking once violations are fixed (tracked in ROADMAP.md)
echo "  â–¶ Running pattern compliance check..."
if ! npm run patterns:check > /dev/null 2>&1; then
  echo "  âš ï¸  Pattern compliance warnings found"
  npm run patterns:check 2>&1 | grep -E "Found [0-9]+ potential" || true
  echo "  (Not blocking push - legacy violations exist. Run: npm run patterns:check)"
else
  echo "  âœ… Pattern compliance passed"
fi

# 3. Type check
echo "  â–¶ Running type check..."
if ! npx tsc --noEmit > /dev/null 2>&1; then
  echo "  âŒ Type check failed"
  npx tsc --noEmit 2>&1 | tail -10
  echo ""
  echo "  Fix type errors before pushing. Run: npx tsc --noEmit"
  exit 1
fi
echo "  âœ… Type check passed"

echo ""
echo "âœ… All pre-push checks passed - push allowed"
