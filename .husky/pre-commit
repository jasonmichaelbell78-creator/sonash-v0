#!/bin/sh
# Pre-commit hook - AUTOMATED GATE (not optional documentation)
# This blocks commits if checks fail

echo "üîç Running pre-commit checks..."

# 1. Run ESLint - rely on exit code, not output parsing
echo "  ‚ñ∂ Running ESLint..."
if ! npm run lint > /dev/null 2>&1; then
  echo "  ‚ùå ESLint has errors"
  npm run lint 2>&1 | tail -10
  echo ""
  echo "  Fix errors before committing. Run: npm run lint"
  exit 1
fi
echo "  ‚úÖ ESLint passed (0 errors)"

# 2. Run tests - stream output using temp file
echo "  ‚ñ∂ Running tests..."
TEST_TMPFILE=$(mktemp)
if ! npm test > "$TEST_TMPFILE" 2>&1; then
  echo "  ‚ùå Tests failed"
  tail -10 "$TEST_TMPFILE"
  rm -f "$TEST_TMPFILE"
  echo ""
  echo "  Fix tests before committing. Run: npm test"
  exit 1
fi
rm -f "$TEST_TMPFILE"
echo "  ‚úÖ Tests passed"

echo ""
echo "‚úÖ All pre-commit checks passed - commit allowed"
