{"id":"CANON-R-001","category":"Hygiene/Duplication","title":"Time-of-day rotation logic duplicated in quotes.ts and slogans.ts","severity":"S1","effort":"E1","confidence":98,"consensus":5,"audits":["copilot","sonnet","opus","codex","chatgpt"],"files":["lib/db/quotes.ts","lib/db/slogans.ts"],"symbols":["QuotesService.getTimeOfDay","QuotesService.getQuoteForNow","SlogansService.getTimeOfDay","SlogansService.getSloganForNow"],"instances":[{"file":"lib/db/quotes.ts:44-48","symbol":"getTimeOfDay"},{"file":"lib/db/quotes.ts:58-95","symbol":"getQuoteForNow"},{"file":"lib/db/slogans.ts:64-68","symbol":"getTimeOfDay"},{"file":"lib/db/slogans.ts:78-115","symbol":"getSloganForNow"}],"why_it_matters":"80+ lines of identical complex rotation algorithm (time windows + day-of-year seed). Bug fixes or enhancements must be applied twice. High drift risk.","suggested_fix":"Extract to lib/utils/content-rotation.ts with generic getTimeOfDay() and getRotatingContentForNow<T>() functions.","acceptance_tests":["npm run lint passes","npm test passes","Quotes and slogans rotate correctly"],"pr_bucket":"misc","dependencies":[],"status":"NEW"}
{"id":"CANON-R-002","category":"Hygiene/Duplication","title":"DailyQuoteCard component duplicated across 2-3 locations","severity":"S2","effort":"E1","confidence":96,"consensus":5,"audits":["copilot","sonnet","opus","codex","chatgpt"],"files":["components/notebook/features/daily-quote-card.tsx","components/widgets/daily-quote-card.tsx","components/widgets/compact-daily-quote.tsx"],"symbols":["DailyQuoteCard (named export)","DailyQuoteCard (default export)","CompactDailyQuote"],"instances":[{"file":"components/notebook/features/daily-quote-card.tsx","symbol":"DailyQuoteCard (sticky-note style)"},{"file":"components/widgets/daily-quote-card.tsx","symbol":"DailyQuoteCard (motion gradient style)"},{"file":"components/widgets/compact-daily-quote.tsx","symbol":"CompactDailyQuote"}],"why_it_matters":"Same fetch logic (QuotesService.getQuoteForToday) repeated with different styling. Feature changes must be applied 2-3 times.","suggested_fix":"Create useDailyQuote hook for fetch logic. Keep single DailyQuoteCard with variant prop. Delete features/ version.","acceptance_tests":["npm run build passes","Quote displays correctly in all contexts"],"pr_bucket":"ui-primitives","dependencies":[],"status":"NEW"}
{"id":"CANON-R-003","category":"Hygiene/Duplication","title":"CloudFunctionError interface defined twice in same file","severity":"S3","effort":"E0","confidence":100,"consensus":4,"audits":["copilot","sonnet","opus","codex"],"files":["lib/firestore-service.ts"],"symbols":["CloudFunctionError"],"instances":[{"file":"lib/firestore-service.ts:200-203","symbol":"interface CloudFunctionError"},{"file":"lib/firestore-service.ts:423-426","symbol":"interface CloudFunctionError"}],"why_it_matters":"Unnecessary duplication within same file. Easy quick win.","suggested_fix":"Define once at module level or extract to lib/types/errors.ts","acceptance_tests":["npm run lint passes","npm test passes"],"pr_bucket":"types-domain","dependencies":[],"status":"NEW"}
{"id":"CANON-R-004","category":"Hygiene/Duplication","title":"Cloud Function error handling pattern duplicated 4-6x across service and hooks","severity":"S1","effort":"E1","confidence":95,"consensus":5,"audits":["copilot","sonnet","opus","codex","chatgpt"],"files":["lib/firestore-service.ts","hooks/use-journal.ts"],"symbols":["saveDailyLog error handler","saveNotebookJournalEntry error handler","addEntry error handler","crumplePage error handler"],"instances":[{"file":"lib/firestore-service.ts:184-234","symbol":"saveDailyLog catch block"},{"file":"lib/firestore-service.ts:408-456","symbol":"saveNotebookJournalEntry catch block"},{"file":"hooks/use-journal.ts:305-324","symbol":"addEntry catch block"},{"file":"hooks/use-journal.ts:358-379","symbol":"crumplePage catch block"}],"why_it_matters":"Same error code switch (resource-exhausted, invalid-argument, unauthenticated, failed-precondition) with user-friendly messages. Error message changes require 4+ updates.","suggested_fix":"Create handleCloudFunctionError(error) utility in lib/utils/callable-errors.ts. Use in all 4+ locations.","acceptance_tests":["npm run lint passes","npm test passes","Error messages consistent across app"],"pr_bucket":"firebase-access","dependencies":["CANON-R-003"],"status":"NEW"}
{"id":"CANON-R-005","category":"Types/Correctness","title":"Journal entry type definitions diverge between client types and server schemas","severity":"S1","effort":"E2","confidence":88,"consensus":4,"audits":["copilot","sonnet","opus","chatgpt"],"files":["types/journal.ts","functions/src/schemas.ts","functions/src/index.ts","lib/firestore-service.ts"],"symbols":["JournalEntryType","journalEntrySchema","JournalEntryData"],"instances":[{"file":"types/journal.ts:1-11","symbol":"JournalEntryType union (includes step-1-worksheet)"},{"file":"functions/src/schemas.ts:17-40","symbol":"journalEntrySchema enum (may lack step-1-worksheet)"},{"file":"functions/src/index.ts:139-175","symbol":"JournalEntryData interface"}],"why_it_matters":"Type mismatch between client and server causes silent validation failures. Adding new entry types requires changes in 3 places.","suggested_fix":"Create shared source of truth in lib/types/journal-shared.ts. Generate types from Zod schemas where possible.","acceptance_tests":["npm run build passes","cd functions && npm run build passes","Type checking catches mismatches"],"pr_bucket":"types-domain","dependencies":[],"status":"NEW"}
{"id":"CANON-R-006","category":"Hygiene/Duplication","title":"Firebase collection access scattered across 22+ files without type safety","severity":"S2","effort":"E2","confidence":92,"consensus":3,"audits":["copilot","sonnet","codex"],"files":["lib/db/slogans.ts","lib/db/glossary.ts","lib/db/quotes.ts","lib/db/library.ts","lib/db/meetings.ts","lib/db/sober-living.ts","hooks/use-journal.ts","components/notebook/pages/today-page.tsx","components/admin/admin-crud-table.tsx","components/growth/DailySloganWidget.tsx"],"symbols":["collection(db, 'slogans')","collection(db, 'glossary')","collection(db, 'daily_quotes')","collection(db, 'meetings')"],"instances":[{"file":"lib/db/slogans.ts","symbol":"collection(db, COLLECTION_NAME)"},{"file":"lib/db/quotes.ts","symbol":"collection(db, COLLECTION)"},{"file":"hooks/use-journal.ts:191","symbol":"collection(db, `users/${uid}/journal`)"},{"file":"components/notebook/pages/today-page.tsx","symbol":"collection(db, `users/${uid}/daily_logs`)"}],"why_it_matters":"No type safety for collection names. Typo risk. Changes require grep-and-replace across codebase.","suggested_fix":"Create lib/firestore-collections.ts with typed collection helpers: collections.slogans(), collections.userJournal(uid), etc.","acceptance_tests":["npm run build passes","Type checking catches collection name typos"],"pr_bucket":"firebase-access","dependencies":[],"status":"NEW"}
{"id":"CANON-R-007","category":"Architecture/Boundaries","title":"Direct Firebase SDK usage in UI components bypasses service layer","severity":"S2","effort":"E2","confidence":87,"consensus":4,"audits":["copilot","sonnet","codex","chatgpt"],"files":["hooks/use-journal.ts","components/notebook/pages/today-page.tsx","components/admin/admin-crud-table.tsx","components/growth/DailySloganWidget.tsx","components/providers/profile-context.tsx"],"symbols":["collection","doc","onSnapshot","getDocs"],"instances":[{"file":"hooks/use-journal.ts:31-36","symbol":"import { collection, query, orderBy, onSnapshot } from firebase/firestore"},{"file":"components/notebook/pages/today-page.tsx:309","symbol":"dynamic import firebase/firestore"},{"file":"components/admin/admin-crud-table.tsx:47-54","symbol":"direct collection/getDocs"},{"file":"components/growth/DailySloganWidget.tsx:20-26","symbol":"direct collection/getDocs"}],"why_it_matters":"Bypasses service layer abstraction. SDK changes require touching 22+ files. Difficult to add cross-cutting concerns.","suggested_fix":"Route all Firebase access through lib/firestore-service.ts or dedicated services. Components only import from services.","acceptance_tests":["All Firebase SDK imports route through service layer","npm run build passes"],"pr_bucket":"boundaries","dependencies":["CANON-R-006"],"status":"NEW"}
{"id":"CANON-R-008","category":"Hygiene/Duplication","title":"47 CRITICAL cognitive complexity violations in scripts (19 functions)","severity":"S0","effort":"E3","confidence":100,"consensus":3,"audits":["copilot","sonnet","opus"],"files":["scripts/assign-review-tier.js","scripts/phase-complete-check.js","scripts/suggest-pattern-automation.js","scripts/check-pattern-compliance.js","scripts/validate-phase-completion.js","scripts/surface-lessons-learned.js","scripts/check-docs-light.js","scripts/check-review-needed.js"],"symbols":["assignReviewTier (complexity 38/15)","verifyDeliverable (complexity 27/15)","checkEscalationTriggers (complexity 27/15)"],"instances":[{"file":"scripts/assign-review-tier.js:289","symbol":"assignReviewTier (38/15 - HIGHEST)"},{"file":"scripts/phase-complete-check.js:131","symbol":"function (27/15)"},{"file":"scripts/phase-complete-check.js:227","symbol":"function (25/15)"},{"file":"scripts/suggest-pattern-automation.js:100","symbol":"function (27/15)"},{"file":"scripts/check-pattern-compliance.js:457","symbol":"function (26/15)"}],"why_it_matters":"SonarQube CRITICAL violations. Functions exceeding 15-point threshold are difficult to test, maintain, debug.","suggested_fix":"Extract nested conditionals into helper functions. Use early returns. Add test coverage before refactoring.","acceptance_tests":["SonarQube complexity < 15 for all functions","npm test passes"],"pr_bucket":"misc","dependencies":[],"status":"NEW"}
{"id":"CANON-R-009","category":"Hygiene/Duplication","title":"Growth card dialog/save pattern duplicated across 4 components","severity":"S2","effort":"E2","confidence":82,"consensus":2,"audits":["opus","codex"],"files":["components/growth/SpotCheckCard.tsx","components/growth/GratitudeCard.tsx","components/growth/NightReviewCard.tsx","components/growth/Step1WorksheetCard.tsx"],"symbols":["isOpen state","isSaving state","handleSave function"],"instances":[{"file":"components/growth/SpotCheckCard.tsx:24-88","symbol":"isOpen, isSaving, handleSave"},{"file":"components/growth/GratitudeCard.tsx:28-99","symbol":"isOpen, isSaving, handleSave"},{"file":"components/growth/NightReviewCard.tsx:75-165","symbol":"open, isSaving, handleSave"},{"file":"components/growth/Step1WorksheetCard.tsx:455-650","symbol":"isOpen, isSaving, handleSave"}],"why_it_matters":"Boilerplate state management repeated 4 times. Changes to save flow must be applied in all components.","suggested_fix":"Extract useGrowthCardDialog(saveConfig) hook that manages isOpen, isSaving, and provides handleSave.","acceptance_tests":["npm run build passes","All growth card save flows work correctly"],"pr_bucket":"hooks-standardization","dependencies":[],"status":"NEW"}
{"id":"CANON-R-010","category":"Security Hardening","title":"reCAPTCHA token fetch/include pattern repeated 5x across codebase","severity":"S2","effort":"E1","confidence":93,"consensus":3,"audits":["copilot","codex","chatgpt"],"files":["lib/firestore-service.ts","hooks/use-journal.ts","lib/auth/account-linking.ts"],"symbols":["getRecaptchaToken"],"instances":[{"file":"lib/firestore-service.ts:126-144","symbol":"saveDailyLog reCAPTCHA"},{"file":"lib/firestore-service.ts:332-346","symbol":"saveInventoryEntry reCAPTCHA"},{"file":"lib/firestore-service.ts:376-391","symbol":"saveNotebookJournalEntry reCAPTCHA"},{"file":"hooks/use-journal.ts:281-299","symbol":"addEntry reCAPTCHA"},{"file":"hooks/use-journal.ts:340-352","symbol":"crumplePage reCAPTCHA"}],"why_it_matters":"Every Cloud Function call repeats same reCAPTCHA boilerplate. Easy to forget when adding new calls.","suggested_fix":"Create callSecureFunction wrapper that auto-injects reCAPTCHA token. Centralize retry logic.","acceptance_tests":["npm run lint passes","npm test passes","All Cloud Function calls use wrapper"],"pr_bucket":"security-hardening","dependencies":["CANON-R-004"],"status":"NEW"}
{"id":"CANON-R-011","category":"Security Hardening","title":"reCAPTCHA action strings duplicated as literals (no shared constants)","severity":"S2","effort":"E1","confidence":93,"consensus":2,"audits":["codex","chatgpt"],"files":["functions/src/recaptcha-verify.ts","hooks/use-journal.ts","lib/firestore-service.ts","lib/auth/account-linking.ts"],"symbols":["RECAPTCHA_ACTIONS","getRecaptchaToken"],"instances":[{"file":"functions/src/recaptcha-verify.ts","symbol":"RECAPTCHA_ACTIONS (server)"},{"file":"hooks/use-journal.ts","symbol":"getRecaptchaToken('save_journal_entry')"},{"file":"lib/firestore-service.ts","symbol":"getRecaptchaToken('save_daily_log')"},{"file":"lib/auth/account-linking.ts","symbol":"getRecaptchaToken('migrate_user_data')"}],"why_it_matters":"Action mismatch between client and server breaks verification. Hard to debug 'failed-precondition' errors.","suggested_fix":"Create lib/security/recaptcha-actions.ts with shared constants. Update all call sites.","acceptance_tests":["npm run lint passes","npm test passes"],"pr_bucket":"security-hardening","dependencies":[],"status":"NEW"}
{"id":"CANON-R-012","category":"Security Hardening","title":"App Check temporarily disabled across all Cloud Functions","severity":"S1","effort":"E1","confidence":100,"consensus":2,"audits":["copilot","opus"],"files":["functions/src/index.ts"],"symbols":["requireAppCheck: false"],"instances":[{"file":"functions/src/index.ts:78","symbol":"saveDailyLog"},{"file":"functions/src/index.ts:170","symbol":"saveJournalEntry"},{"file":"functions/src/index.ts:265","symbol":"softDeleteJournalEntry"},{"file":"functions/src/index.ts:363","symbol":"saveInventoryEntry"}],"why_it_matters":"Security feature disabled. Should be tracked and re-enabled when throttle clears.","suggested_fix":"Create tracking issue. Re-enable when throttle verified clear. Add monitoring.","acceptance_tests":["GitHub issue exists","Functions work correctly when re-enabled"],"pr_bucket":"security-hardening","dependencies":[],"status":"TRACKED_ELSEWHERE"}
{"id":"CANON-R-013","category":"Architecture/Boundaries","title":"Deprecated saveNotebookJournalEntry still used in 6+ UI components","severity":"S1","effort":"E2","confidence":82,"consensus":2,"audits":["codex","chatgpt"],"files":["lib/firestore-service.ts","components/growth/GratitudeCard.tsx","components/growth/SpotCheckCard.tsx","components/growth/NightReviewCard.tsx","components/growth/Step1WorksheetCard.tsx","components/notebook/pages/today-page.tsx"],"symbols":["saveNotebookJournalEntry"],"instances":[{"file":"lib/firestore-service.ts:365-457","symbol":"saveNotebookJournalEntry (DEPRECATED)"},{"file":"components/growth/GratitudeCard.tsx:83-90","symbol":"saveNotebookJournalEntry usage"},{"file":"components/growth/SpotCheckCard.tsx:71-79","symbol":"saveNotebookJournalEntry usage"},{"file":"components/growth/NightReviewCard.tsx:155-165","symbol":"saveNotebookJournalEntry usage"},{"file":"components/growth/Step1WorksheetCard.tsx:629-635","symbol":"saveNotebookJournalEntry usage"}],"why_it_matters":"Two write paths create inconsistent metadata (tags/searchableText). Audit burden.","suggested_fix":"Migrate callers to useJournal.addEntry. Remove deprecated method.","acceptance_tests":["No imports of saveNotebookJournalEntry","npm test passes"],"pr_bucket":"hooks-standardization","dependencies":["CANON-R-005"],"status":"NEW"}
{"id":"CANON-R-014","category":"Architecture/Boundaries","title":"Dual-write pattern to inventory AND journal collections","severity":"S2","effort":"E2","confidence":77,"consensus":2,"audits":["opus","codex"],"files":["components/growth/SpotCheckCard.tsx","components/growth/GratitudeCard.tsx","components/growth/NightReviewCard.tsx"],"symbols":["saveInventoryEntry","saveNotebookJournalEntry"],"instances":[{"file":"components/growth/SpotCheckCard.tsx:61-79","symbol":"handleSave dual-write"},{"file":"components/growth/GratitudeCard.tsx:75-90","symbol":"handleSave dual-write"},{"file":"components/growth/NightReviewCard.tsx","symbol":"handleSave dual-write"}],"why_it_matters":"Dual writes increase storage costs, create potential inconsistency if one fails. Inventory collection may be legacy.","suggested_fix":"Audit whether inventory_entries collection is still needed. Remove dual-write or consolidate via Cloud Function.","acceptance_tests":["Growth entries appear in journal timeline","Any analytics using inventory_entries still works"],"pr_bucket":"firebase-access","dependencies":[],"status":"NEW"}
{"id":"CANON-R-015","category":"Hygiene/Duplication","title":"Admin Cloud Function wiring duplicated across 5 admin tabs","severity":"S2","effort":"E1","confidence":77,"consensus":2,"audits":["codex","chatgpt"],"files":["components/admin/dashboard-tab.tsx","components/admin/users-tab.tsx","components/admin/errors-tab.tsx","components/admin/jobs-tab.tsx","components/admin/admin-crud-table.tsx"],"symbols":["DashboardTab","UsersTab","ErrorsTab","JobsTab","AdminCrudTable"],"instances":[{"file":"components/admin/dashboard-tab.tsx:57-67","symbol":"httpsCallable setup"},{"file":"components/admin/users-tab.tsx:74-129","symbol":"httpsCallable usage"},{"file":"components/admin/errors-tab.tsx:63-67","symbol":"httpsCallable usage"},{"file":"components/admin/jobs-tab.tsx:34-59","symbol":"httpsCallable usage"},{"file":"components/admin/admin-crud-table.tsx:123-171","symbol":"httpsCallable usage"}],"why_it_matters":"Duplicated Cloud Function wiring. Error handling, retries, auth assumptions can drift.","suggested_fix":"Create lib/admin/admin-functions.ts with typed wrappers (adminGetDashboardStats, adminSearchUsers, etc.)","acceptance_tests":["npm run lint passes","npm test passes","Admin functions work correctly"],"pr_bucket":"firebase-access","dependencies":["CANON-R-010"],"status":"NEW"}
{"id":"CANON-R-016","category":"Hygiene/Duplication","title":"CRUD service patterns repeated across lib/db modules","severity":"S2","effort":"E2","confidence":80,"consensus":2,"audits":["sonnet","codex"],"files":["lib/db/quotes.ts","lib/db/slogans.ts","lib/db/glossary.ts","lib/db/sober-living.ts","lib/db/library.ts","lib/db/meetings.ts"],"symbols":["QuotesService","SlogansService","GlossaryService","SoberLivingService","getAllQuickLinks","getAllPrayers"],"instances":[{"file":"lib/db/quotes.ts:18-38","symbol":"QuotesService CRUD"},{"file":"lib/db/slogans.ts:22-58","symbol":"SlogansService CRUD"},{"file":"lib/db/glossary.ts:15-36","symbol":"GlossaryService CRUD"},{"file":"lib/db/sober-living.ts:20-37","symbol":"SoberLivingService CRUD"},{"file":"lib/db/library.ts:46-136","symbol":"QuickLink/Prayer CRUD"}],"why_it_matters":"Same Firestore CRUD pattern (getAll/add/update/delete) repeated with only collection names changing.","suggested_fix":"Create lib/db/firestore-crud.ts with generic CRUD factory. Refactor services to use it.","acceptance_tests":["npm run build passes","All services work correctly"],"pr_bucket":"firebase-access","dependencies":["CANON-R-006"],"status":"NEW"}
{"id":"CANON-R-017","category":"Testing Infrastructure","title":"Critical paths have low test coverage (firestore-service 35.6%, account-linking 17.29%)","severity":"S2","effort":"E2","confidence":90,"consensus":4,"audits":["copilot","sonnet","opus","chatgpt"],"files":["lib/firestore-service.ts","lib/auth/account-linking.ts","lib/db/users.ts","lib/firebase.ts"],"symbols":["saveDailyLog","saveNotebookJournalEntry","linkAnonymousToEmailPassword","linkAnonymousToGoogle"],"instances":[{"file":"lib/firestore-service.ts","symbol":"35.6% coverage"},{"file":"lib/auth/account-linking.ts","symbol":"17.29% coverage"},{"file":"lib/db/users.ts","symbol":"33.64% coverage"},{"file":"lib/firebase.ts","symbol":"41.91% coverage"}],"why_it_matters":"Security-critical paths with low coverage. Refactors risky without tests.","suggested_fix":"Add integration tests for Cloud Function callers. Add unit tests for account linking. Target 70%+ coverage.","acceptance_tests":["npm run test:coverage shows >70% for target files"],"pr_bucket":"tests-hardening","dependencies":["CANON-R-004"],"status":"NEW"}
{"id":"CANON-R-018","category":"Testing Infrastructure","title":"No test coverage for high-complexity scripts","severity":"S1","effort":"E2","confidence":100,"consensus":3,"audits":["sonnet","opus","chatgpt"],"files":["scripts/assign-review-tier.js","scripts/phase-complete-check.js","scripts/check-pattern-compliance.js"],"symbols":["assignReviewTier","verifyDeliverable"],"instances":[{"file":"scripts/assign-review-tier.js","symbol":"complexity 38, 0% coverage"},{"file":"scripts/phase-complete-check.js","symbol":"complexity 27, minimal coverage"},{"file":"scripts/check-pattern-compliance.js","symbol":"complexity 26, minimal coverage"}],"why_it_matters":"Scripts with complexity 20-38 have no test coverage. High regression risk when refactoring.","suggested_fix":"Add tests/scripts/ test files for each high-complexity script. Use test-driven refactoring.","acceptance_tests":["Test coverage for scripts/ >70%","All high-complexity functions have tests"],"pr_bucket":"tests-hardening","dependencies":[],"status":"NEW"}
{"id":"CANON-R-019","category":"Security Hardening","title":"Searchable-text generation duplicated with inconsistent sanitization","severity":"S2","effort":"E1","confidence":72,"consensus":1,"audits":["codex"],"files":["hooks/use-journal.ts","scripts/migrate-to-journal.ts"],"symbols":["generateSearchableText"],"instances":[{"file":"hooks/use-journal.ts:69-130","symbol":"generateSearchableText (client)"},{"file":"scripts/migrate-to-journal.ts:174-202","symbol":"generateSearchableText (migration)"}],"why_it_matters":"Different sanitization rules can produce divergent search indexes or reintroduce stored XSS risks.","suggested_fix":"Extract shared searchable-text utility to lib/journal/searchable-text.ts. Ensure sanitization is consistent.","acceptance_tests":["npm run lint passes","npm test passes","Search indexes consistent"],"pr_bucket":"security-hardening","dependencies":[],"status":"NEW"}
{"id":"CANON-R-020","category":"Hygiene/Duplication","title":"parseTime() meeting helper duplicated in two pages","severity":"S3","effort":"E0","confidence":95,"consensus":1,"audits":["chatgpt"],"files":["app/meetings/all/page.tsx","components/notebook/pages/resources-page.tsx"],"symbols":["parseTime"],"instances":[{"file":"app/meetings/all/page.tsx","symbol":"parseTime (12h/24h support)"},{"file":"components/notebook/pages/resources-page.tsx","symbol":"parseTime (12h/24h support)"}],"why_it_matters":"Small helper duplication is a drift vector (edge cases like 'Noon', locale formats).","suggested_fix":"Extract to lib/utils/time.ts as parseMeetingTimeToMinutes(). Unit test it.","acceptance_tests":["npm run lint passes","npm test passes"],"pr_bucket":"misc","dependencies":[],"status":"NEW"}
{"id":"CANON-R-021","category":"Hygiene/Duplication","title":"safeReadFile/safeWriteFile utilities duplicated across 3 scripts","severity":"S2","effort":"E1","confidence":90,"consensus":1,"audits":["chatgpt"],"files":["scripts/archive-doc.js","scripts/check-review-needed.js","scripts/update-readme-status.js"],"symbols":["safeReadFile","safeWriteFile"],"instances":[{"file":"scripts/archive-doc.js","symbol":"safeReadFile, safeWriteFile"},{"file":"scripts/check-review-needed.js","symbol":"safeReadFile"},{"file":"scripts/update-readme-status.js","symbol":"safeReadFile, safeWriteFile"}],"why_it_matters":"Scripts are highest complexity area. Shared utilities reduce per-script branching.","suggested_fix":"Create scripts/lib/fs-safe.js. Update 3 scripts to import from it.","acceptance_tests":["npm test passes","npm run lint passes"],"pr_bucket":"misc","dependencies":[],"status":"NEW"}
{"id":"CANON-R-022","category":"Architecture/Boundaries","title":"TodayPage is a god component mixing 4+ responsibilities","severity":"S1","effort":"E3","confidence":85,"consensus":1,"audits":["chatgpt"],"files":["components/notebook/pages/today-page.tsx","lib/firestore-service.ts"],"symbols":["TodayPage","calculateWeeklyStats"],"instances":[{"file":"components/notebook/pages/today-page.tsx","symbol":"persistence + realtime sync + analytics + UI state + localStorage recovery"}],"why_it_matters":"Large mixed-responsibility component. Small changes require deep context. Cognitive complexity hotspot.","suggested_fix":"Split into hooks: useDailyLogState, useDailyLogRealtime, useWeeklyStats. Move Firestore queries to service.","acceptance_tests":["npm run lint passes","npm test passes"],"pr_bucket":"boundaries","dependencies":["CANON-R-007","CANON-R-010"],"status":"NEW"}
{"id":"CANON-R-023","category":"Architecture/Boundaries","title":"useJournal mixes domain logic with transport (httpsCallable + retry + recaptcha)","severity":"S1","effort":"E2","confidence":88,"consensus":1,"audits":["chatgpt"],"files":["hooks/use-journal.ts","lib/firestore-service.ts"],"symbols":["useJournal","addEntry","crumplePage","generateSearchableText"],"instances":[{"file":"hooks/use-journal.ts:249-324","symbol":"addEntry (transport + domain)"},{"file":"hooks/use-journal.ts:325-390","symbol":"crumplePage (transport + domain)"}],"why_it_matters":"Hook owns transport and domain shaping. Same responsibilities will be re-implemented in other features.","suggested_fix":"Create lib/services/journal-service.ts with saveEntry()/softDeleteEntry() using callSecureFunction. Keep hook focused on UI state.","acceptance_tests":["npm run lint passes","npm test passes"],"pr_bucket":"hooks-standardization","dependencies":["CANON-R-010","CANON-R-004"],"status":"NEW"}
{"id":"CANON-R-024","category":"Architecture/Boundaries","title":"FirestoreAdapter exists but is unused (realtime boundary unclear)","severity":"S2","effort":"E2","confidence":85,"consensus":1,"audits":["chatgpt"],"files":["lib/database/firestore-adapter.ts","lib/database/database-interface.ts","components/notebook/pages/today-page.tsx","hooks/use-journal.ts","components/providers/profile-context.tsx"],"symbols":["FirestoreAdapter.subscribeToDailyLog"],"instances":[{"file":"lib/database/firestore-adapter.ts","symbol":"subscribeToDailyLog (unused)"},{"file":"components/notebook/pages/today-page.tsx","symbol":"ad-hoc onSnapshot"},{"file":"hooks/use-journal.ts","symbol":"ad-hoc onSnapshot"},{"file":"components/providers/profile-context.tsx","symbol":"ad-hoc onSnapshot"}],"why_it_matters":"Unclear boundaries. Some features use adapter, others embed Firestore details. Future migrations harder.","suggested_fix":"Decide boundary: expand FirestoreAdapter and use it everywhere, OR remove adapter and standardize subscription helpers.","acceptance_tests":["Consistent realtime subscription pattern"],"pr_bucket":"boundaries","dependencies":["CANON-R-007"],"status":"NEW"}
{"id":"CANON-R-025","category":"Hygiene/Duplication","title":"Batch fix opportunities: 200+ ESLint auto-fixable issues","severity":"S3","effort":"E0","confidence":100,"consensus":2,"audits":["sonnet","chatgpt"],"files":["multiple"],"symbols":["unused imports","optional chaining","Array.includes"],"instances":[{"file":"multiple","symbol":"S6759 (62 unused imports)"},{"file":"multiple","symbol":"S7764 (46 optional chaining)"},{"file":"multiple","symbol":"S7780 (33 Array.includes)"}],"why_it_matters":"Low-hanging fruit that reduces SonarQube noise instantly.","suggested_fix":"Run npm run lint:fix. Commit auto-fixed changes before manual refactoring.","acceptance_tests":["npm run lint shows reduced violations","npm run build passes"],"pr_bucket":"misc","dependencies":[],"status":"NEW"}
{"id":"CANON-R-026","category":"Hygiene/Duplication","title":"Batch fix opportunities: 79 replaceAll() + 71 node: prefix modernizations","severity":"S3","effort":"E1","confidence":100,"consensus":2,"audits":["sonnet","chatgpt"],"files":["multiple","scripts/*","functions/src/*"],"symbols":["replace(/x/g, y)","require('fs')"],"instances":[{"file":"multiple","symbol":"S7781 (79 replaceAll)"},{"file":"multiple","symbol":"S7772 (71 node: prefix)"}],"why_it_matters":"ES2021+ provides cleaner methods. Modernization reduces lint noise.","suggested_fix":"Find/replace: replace(/pattern/g) to replaceAll(). require('fs') to require('node:fs').","acceptance_tests":["npm run build passes","All scripts run correctly"],"pr_bucket":"misc","dependencies":[],"status":"NEW"}
{"id":"CANON-R-027","category":"Hygiene/Duplication","title":"Deprecated API usage (31 instances) + Nested ternaries (41 instances)","severity":"S2","effort":"E2","confidence":100,"consensus":1,"audits":["sonnet"],"files":["multiple"],"symbols":["deprecated APIs","nested ternary operators"],"instances":[{"file":"multiple","symbol":"S1874 (31 deprecated APIs)"},{"file":"multiple","symbol":"S3358 (41 nested ternaries)"}],"why_it_matters":"Deprecated APIs risk future breaking changes. Nested ternaries reduce readability.","suggested_fix":"Audit S1874 violations. Replace nested ternaries with if/else or early returns.","acceptance_tests":["No deprecation warnings","Code readability improved"],"pr_bucket":"misc","dependencies":[],"status":"NEW"}
