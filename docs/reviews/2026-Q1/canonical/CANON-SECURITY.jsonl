{"canonical_id":"F-001","vulnerability_type":{"custom":"Legacy Firestore direct writes bypass server-side controls","owasp":["A01","A05"]},"title":"Legacy journalEntries collection allows direct client writes (bypasses Functions validation/rate limits)","severity":"S0","effort":"E2","confidence":100,"files":["firestore.rules"],"merged_from":[{"model":"Claude Opus 4.5","severity":"S0","confidence":100},{"model":"ChatGPT 5.2","severity":"S1","confidence":100}],"evidence":["firestore.rules allows owner create/update on /users/{userId}/journalEntries/{entryId} (both models)."],"impact":"Owners can write unvalidated/untethered payloads directly to Firestore, bypassing any server-side schema/rate-limit/bot controls used elsewhere.","remediation":{"steps":["Migrate off /users/{userId}/journalEntries/* to the validated path (or Functions-only write path).","Update firestore.rules to deny create/update on legacy path (align with newer collections).","Add emulator/rules tests to prevent regression."],"verification":["Attempt direct client create/update to legacy path → denied.","All journal writes succeed only via the intended secured path."]}}
{"canonical_id":"F-002","vulnerability_type":{"custom":"Systemic rate limiting gaps across callable endpoints","owasp":["A04","A07"]},"title":"Rate limiting is incomplete (no IP throttling, admin endpoints unthrottled, inconsistent 429-equivalent handling)","severity":"S1","effort":"E2","confidence":100,"files":["functions/src/security-wrapper.ts","functions/src/firestore-rate-limiter.ts","functions/src/admin.ts"],"merged_from":[{"model":"Claude Opus 4.5","severity":"S1","confidence":100},{"model":"ChatGPT 5.2","severity":"S1","confidence":100}],"evidence":["Admin callables have no limiter (both models).","Limiter keyed by userId only; no IP-based throttling (ChatGPT 5.2).","Limiter/wrapper mismatch can surface internal errors instead of stable resource-exhausted/429-equivalent (ChatGPT 5.2)."],"impact":"Higher abuse/DoS and cost risk; weaker resilience due to unstable backoff signaling.","remediation":{"steps":["Add a secondary limiter keyed by IP (and/or App Check token/device) in addition to userId.","Wrap admin callables with the same centralized limiter policy (admin-tier limits).","Standardize limiter error mapping so rate-limit exceed always returns resource-exhausted (429-equivalent) with retry guidance."],"verification":["Burst calls produce consistent resource-exhausted responses.","Account cycling no longer trivially bypasses throttles (IP limiter triggers).","Admin callables throttle under burst."]}}
{"canonical_id":"F-003","vulnerability_type":{"custom":"reCAPTCHA enforcement fail-open","owasp":["A07"]},"title":"reCAPTCHA token missing does not block requests (logs but continues)","severity":"S1","effort":"E1","confidence":100,"files":["functions/src/security-wrapper.ts"],"merged_from":[{"model":"Claude Opus 4.5","severity":"S1","confidence":100}],"evidence":["Wrapper logs missing token but continues processing (Claude Opus evidence)."],"impact":"Bot protection ineffective; automated abuse easier—especially when combined with incomplete throttling.","remediation":{"steps":["If recaptchaAction is configured for an endpoint, require a non-empty token and fail closed.","Allow bypass only in explicit dev/test modes via env flag (not implicit)."],"verification":["Requests without token are rejected with a stable error.","Valid tokens succeed; low-score tokens are rejected per policy."]}}
{"canonical_id":"F-004","vulnerability_type":{"custom":"Non-strict request validation allows unknown fields","owasp":["A03","A08"]},"title":"Zod schemas missing .strict() (unknown fields accepted)","severity":"S2","effort":"E0","confidence":100,"files":["functions/src/schemas.ts"],"merged_from":[{"model":"Claude Opus 4.5","severity":"S2","confidence":100},{"model":"ChatGPT 5.2","severity":"S2","confidence":95}],"evidence":["No .strict() usage reported by both models; unknown fields accepted."],"impact":"Data pollution and unexpected fields stored; increases bug surface and potential stored-content issues.","remediation":{"steps":["Add .strict() to request schemas.","Add tests asserting unknown fields are rejected."],"verification":["Payload with extra fields fails validation; normal payloads succeed."]}}
{"canonical_id":"F-005","vulnerability_type":{"custom":"Untyped arbitrary nested payloads accepted for entry data","owasp":["A03","A08"]},"title":"Permissive z.record(..., z.unknown()) allows arbitrary nested data in journal/inventory entries","severity":"S2","effort":"E2","confidence":95,"files":["functions/src/schemas.ts"],"merged_from":[{"model":"Claude Opus 4.5","severity":"S2","confidence":95},{"model":"ChatGPT 5.2","severity":"S2","confidence":95}],"evidence":["Schemas use permissive z.record(..., z.unknown()) for data fields (both models)."],"impact":"Enables oversized/odd payloads, storage abuse within Firestore limits, and higher risk of downstream rendering/logic edge cases.","remediation":{"steps":["Move to discriminated unions by entry type with per-type data schemas and size limits.","Add limits on string lengths/array sizes/nesting depth as appropriate."],"verification":["Invalid per-type data rejected.","Oversized payloads rejected at validation."]}}
{"canonical_id":"F-006","vulnerability_type":{"custom":"Client/server contract drift for journal entry types","owasp":["A08"]},"title":"Server-side journal entry type enum missing 'step-1-worksheet' (validation drift)","severity":"S2","effort":"E1","confidence":95,"files":["functions/src/schemas.ts"],"merged_from":[{"model":"ChatGPT 5.2","severity":"S2","confidence":95}],"evidence":["ChatGPT 5.2 reports server enum omits 'step-1-worksheet' while client emits it."],"impact":"Valid client writes fail; can amplify retries and degrade availability/UX.","remediation":{"steps":["Establish a single source of truth for allowed types (shared package or generated types).","Add contract tests to ensure client/server types stay in sync."],"verification":["'step-1-worksheet' saves succeed and validate correctly."]}}
{"canonical_id":"F-007","vulnerability_type":{"custom":"Console logging in production code paths","owasp":["A09"]},"title":"Console statements present; replace with structured logger and enforce no-console in production","severity":"S2","effort":"E1","confidence":85,"files":[],"file_globs":["components/**","functions/src/**","lib/**"],"merged_from":[{"model":"Claude Opus 4.5","severity":"S2","confidence":80},{"model":"ChatGPT 5.2","severity":"S3","confidence":90}],"evidence":["Claude Opus counted 59 console statements across components; ChatGPT 5.2 identifies console usage in security-sensitive paths."],"impact":"Potential info disclosure and inconsistent redaction/audit formatting; browser console exposure for end users.","remediation":{"steps":["Replace console.* with centralized logger (with redaction).","Add ESLint no-console (error) and Next production removeConsole where applicable.","Require PR checks to fail on console usage outside logger module(s)."],"verification":["Repo grep for console.* in production paths returns 0.","Production builds emit no console logs from app code."]}}
{"canonical_id":"F-008","vulnerability_type":{"custom":"Admin data writes bypass server-side schema validation (direct Firestore writes)","owasp":["A04","A05"]},"title":"Some admin-managed collections allow direct client writes without centralized schema/rate-limit protections","severity":"S2","effort":"E1","confidence":90,"files":["firestore.rules","lib/db/library.ts"],"merged_from":[{"model":"ChatGPT 5.2","severity":"S2","confidence":90},{"model":"Claude Opus 4.5","severity":"S2","confidence":30}],"evidence":["ChatGPT 5.2: rules permit admin writes to some collections and client code writes directly (e.g., prayers)."],"impact":"If admin session is compromised, attacker can write malformed/oversized content directly; bypasses centralized validation pattern.","remediation":{"steps":["Prefer routing admin writes through callable/admin Functions that enforce schemas + throttles.","If direct writes remain, add strict client-side validation and tighten rules where feasible (field allowlists/length limits)."],"verification":["Admin UI writes flow through validated Functions (preferred) or are schema-validated before Firestore writes."]}}
{"canonical_id":"F-009","vulnerability_type":{"custom":"Hardcoded reCAPTCHA site key fallback (config integrity)","owasp":["A05"]},"title":"Hardcoded fallback reCAPTCHA site key in server verification code (config integrity/rotation risk)","severity":"S2","effort":"E1","confidence":100,"files":["functions/src/recaptcha-verify.ts"],"merged_from":[{"model":"ChatGPT 5.2","severity":"S2","confidence":100}],"evidence":["ChatGPT 5.2 reports a hardcoded fallback site key path in recaptcha verification."],"impact":"Silent misconfiguration risk and harder key rotation/environment isolation (not treated here as a secret leak).","remediation":{"steps":["Remove hardcoded fallback; require env vars to be set.","Fail closed with a clear failed-precondition error if required config is missing."],"verification":["Unset env var → function refuses to proceed with clear error; set env var → verification succeeds."]}}
{"canonical_id":"F-010","vulnerability_type":{"custom":"App Check disabled (risk accepted / hardening)","owasp":["A04","A05"]},"title":"App Check disabled on Functions and client init disabled (tracked as risk-accepted hardening item)","severity":"S3","severity_normalization":{"canonical":"S3","reported":["S0","S0"],"reason":"Risk accepted due to public API intent; tracked as optional hardening provided compensating controls exist."},"effort":"E1","confidence":100,"files":["functions/src/index.ts","lib/firebase.ts"],"merged_from":[{"model":"Claude Opus 4.5","severity":"S0","confidence":100},{"model":"ChatGPT 5.2","severity":"S0","confidence":100}],"evidence":["Both models: requireAppCheck:false on callables; client App Check initialization commented out."],"impact":"Reduces device-attestation defense-in-depth and increases automated abuse feasibility.","remediation":{"steps":["(If you later choose to enforce) enable App Check on server wrappers + restore client init.","Add monitoring for App Check failures and volume anomalies."],"verification":["Calls without App Check token are rejected (if enabled); legit clients succeed."],"notes":"Explicitly stated NOT a violation because the API is intended to be public-facing. Included as optional hardening / risk-tracked item, not as a compliance blocker."}}
