{
  "prs": [
    {
      "pr_id": "PR1",
      "title": "S0 security: restore App Check end-to-end (client + functions)",
      "goal": "Re-enable App Check in client initialization and require it in all callable Cloud Functions.",
      "bucket": "security-hardening",
      "included_canonical_ids": ["CANON-0003", "CANON-0001"],
      "staging": [
        "PR1a (client init)",
        "PR1b (functions requireAppCheck)",
        "PR1c (monitoring/docs)"
      ],
      "risk_level": "high",
      "estimated_effort": "E2",
      "acceptance_tests": [
        {
          "area": "client",
          "assertion": "App Check instance is created with no warnings",
          "how_to_verify": "Enable App Check site key in env, load client, confirm _appCheck instance exists and console has no warnings"
        },
        {
          "area": "functions",
          "assertion": "All callable functions require App Check",
          "how_to_verify": "Verify all 4 functions set requireAppCheck=true and reject calls without valid token"
        },
        {
          "area": "e2e",
          "assertion": "App Check tokens validated end-to-end",
          "how_to_verify": "Manual test confirms App Check token is sent and verified for calls"
        }
      ],
      "notes": "Do client init first to avoid breaking production callers when functions enforcement flips."
    },
    {
      "pr_id": "PR2",
      "title": "S0 security: lock down legacy journalEntries direct writes",
      "goal": "Remove direct client writes for legacy journalEntries and restore function-only posture.",
      "bucket": "security-hardening",
      "included_canonical_ids": ["CANON-0002"],
      "staging": ["PR2a (audit usage + migration plan)", "PR2b (rules change + deploy)"],
      "risk_level": "high",
      "estimated_effort": "E2",
      "acceptance_tests": [
        {
          "area": "code-audit",
          "assertion": "No active code writes to journalEntries directly",
          "how_to_verify": "Search codebase for direct journalEntries writes; confirm none exist in active paths"
        },
        {
          "area": "rules",
          "assertion": "Rules block direct writes",
          "how_to_verify": "Deploy rules and test that direct client writes to journalEntries fail with permission denied"
        }
      ],
      "notes": "Coordinate rollout with any deployed clients still writing the legacy path."
    },
    {
      "pr_id": "PR3",
      "title": "Bot mitigation enforcement: reCAPTCHA behavior",
      "goal": "Ensure reCAPTCHA is actually enforced when configured and aligned with App Check posture.",
      "bucket": "security-hardening",
      "included_canonical_ids": ["CANON-0004", "CANON-0038"],
      "staging": [
        "PR3a (enforce missing-token failure path)",
        "PR3b (verify end-to-end validation)"
      ],
      "risk_level": "medium",
      "estimated_effort": "E1",
      "acceptance_tests": [
        {
          "area": "functions",
          "assertion": "Missing token causes failure",
          "how_to_verify": "Call a function wrapped with recaptchaAction and no token; expect failed-precondition error"
        },
        {
          "area": "e2e",
          "assertion": "Valid token allows success",
          "how_to_verify": "Call same function with valid token; expect success path to execute"
        }
      ],
      "notes": "Keep PR scoped to wrapper enforcement to reduce risk of incidental function behavior changes."
    },
    {
      "pr_id": "PR4",
      "title": "Data integrity: fix Step 1 journal save path + schema support",
      "goal": "Unbreak Step 1 worksheet saves and ensure entries include searchable metadata.",
      "bucket": "hooks-standardization",
      "included_canonical_ids": ["CANON-0007", "CANON-0006"],
      "staging": ["PR4a (schema enum fix)", "PR4b (refactor callers to use useJournal)"],
      "risk_level": "medium",
      "estimated_effort": "E2",
      "acceptance_tests": [
        {
          "area": "functions",
          "assertion": "Step 1 worksheet saves successfully",
          "how_to_verify": "Test saving a step-1-worksheet entry via Cloud Function; confirm no validation errors"
        },
        {
          "area": "data",
          "assertion": "Metadata fields are populated",
          "how_to_verify": "Verify in Firestore console that searchableText and tags fields are populated on saved entries"
        }
      ],
      "notes": "Ship the enum fix first (E0) so users stop hitting server-side validation failures even before the larger refactor lands."
    },
    {
      "pr_id": "PR5",
      "title": "Standardize Cloud Function error handling + logging",
      "goal": "Deduplicate CF error mapping and eliminate console logging in production components in favor of logger.",
      "bucket": "security-hardening",
      "included_canonical_ids": ["CANON-0041", "CANON-0005"],
      "staging": ["PR5a (shared CF error helper)", "PR5b (logger migration by directory)"],
      "risk_level": "medium",
      "estimated_effort": "E2",
      "acceptance_tests": [
        {
          "area": "code",
          "assertion": "Single helper used in all error-handling locations",
          "how_to_verify": "Search codebase and confirm handleCloudFunctionError() is used consistently"
        },
        {
          "area": "security",
          "assertion": "Zero console.* in components/ (except logger)",
          "how_to_verify": "Run lint or grep; confirm no direct console usage in components directory"
        },
        {
          "area": "security",
          "assertion": "Errors do not leak sensitive data",
          "how_to_verify": "Review logged errors and confirm they do not contain file paths, tokens, or UIDs"
        }
      ],
      "notes": "Keep helper extraction separate from large logger migration if reviewers prefer smaller diffs."
    },
    {
      "pr_id": "PR6",
      "title": "Testing hardening: functions/rules + coverage for critical auth/data paths",
      "goal": "Raise confidence in security and auth/data flows via tests and coverage improvements.",
      "bucket": "tests-hardening",
      "included_canonical_ids": ["CANON-0010", "CANON-0011", "CANON-0024", "CANON-0043"],
      "staging": [
        "PR6a (rules emulator tests)",
        "PR6b (functions security tests)",
        "PR6c (coverage targets for critical libs)"
      ],
      "risk_level": "high",
      "estimated_effort": "E3",
      "acceptance_tests": [
        {
          "area": "ci",
          "assertion": "Rules emulator tests pass in CI",
          "how_to_verify": "Run CI pipeline; confirm rules tests execute and pass"
        },
        {
          "area": "coverage",
          "assertion": "Functions security paths are covered",
          "how_to_verify": "Run coverage report; confirm security wrapper and auth paths have tests"
        },
        {
          "area": "tests",
          "assertion": "Skipped integration test is addressed",
          "how_to_verify": "Confirm test is either implemented or removed with documented rationale"
        },
        {
          "area": "coverage",
          "assertion": "Coverage for critical files improves",
          "how_to_verify": "Compare coverage before/after for listed critical files"
        }
      ],
      "notes": "Start from the existing skipped test as a concrete harness entry point."
    },
    {
      "pr_id": "PR7",
      "title": "Duplication cleanup: quotes/slogans rotation + DailyQuoteCard consolidation",
      "goal": "Reduce duplicated logic/components to prevent drift and simplify maintenance.",
      "bucket": "ui-primitives",
      "included_canonical_ids": ["CANON-0014", "CANON-0013"],
      "staging": ["PR7a (rotation utility + tests)", "PR7b (DailyQuoteCard consolidation)"],
      "risk_level": "low",
      "estimated_effort": "E2",
      "acceptance_tests": [
        {
          "area": "tests",
          "assertion": "Rotation unit tests cover schedule and fallback paths",
          "how_to_verify": "Run tests and confirm coverage for time-of-day rotation and fallback scenarios"
        },
        {
          "area": "ui",
          "assertion": "Quote displays correctly wherever used",
          "how_to_verify": "Manual test all locations where quotes are displayed; confirm no broken imports"
        }
      ],
      "notes": "Do after the S0/S1 security items so UI refactors don't mix with production security changes."
    },
    {
      "pr_id": "PR8",
      "title": "Types cleanup: unsafe casts, schema validation, and suppression removal",
      "goal": "Reduce runtime failures by tightening types and removing suppressions.",
      "bucket": "types-domain",
      "included_canonical_ids": [
        "CANON-0018",
        "CANON-0022",
        "CANON-0044",
        "CANON-0045",
        "CANON-0019",
        "CANON-0026",
        "CANON-0016"
      ],
      "staging": [
        "PR8a (remove ts-expect-error + quick safety fixes)",
        "PR8b (add runtime validation where casting occurs)",
        "PR8c (schema tightening)"
      ],
      "risk_level": "medium",
      "estimated_effort": "E3",
      "acceptance_tests": [
        {
          "area": "code",
          "assertion": "No @ts-expect-error in production code",
          "how_to_verify": "Search codebase for @ts-expect-error; confirm none in production files"
        },
        {
          "area": "code",
          "assertion": "Unsafe casts are paired with runtime validation",
          "how_to_verify": "Review remaining 'as' casts; confirm Zod parse or type guard precedes them"
        },
        {
          "area": "validation",
          "assertion": "Invalid entry payloads are rejected by schema",
          "how_to_verify": "Test submitting malformed entries; confirm schema validation rejects them"
        }
      ],
      "notes": "Sequence: quick wins first, then introduce schema tightening to avoid breaking payload compatibility unexpectedly."
    },
    {
      "pr_id": "PR9",
      "title": "Scripts lint-security cleanup",
      "goal": "Reduce ESLint security warnings in scripts/ by addressing the highest-risk patterns.",
      "bucket": "security-hardening",
      "included_canonical_ids": ["CANON-0021"],
      "staging": ["PR9a"],
      "risk_level": "low",
      "estimated_effort": "E2",
      "acceptance_tests": [
        {
          "area": "lint",
          "assertion": "Materially fewer security warnings",
          "how_to_verify": "Run npm run lint; compare warning count before/after"
        },
        {
          "area": "security",
          "assertion": "Non-literal fs paths validated against allowlist",
          "how_to_verify": "Review scripts; confirm dynamic paths are checked against allowlist before use"
        }
      ],
      "notes": "Keep changes isolated to scripts/ to reduce review surface."
    }
  ]
}
