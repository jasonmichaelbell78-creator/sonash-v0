{"canonical_id":"PERF-001","category":"Memory Management","issue_type":"Firestore listener lifecycle is unsafe (possible leak vs fragile cleanup)","title":"useJournal snapshot unsubscribe handling is unsafe; may leak listeners depending on current hook structure","severity":"S0","effort":"E1","confidence":85,"files":["hooks/use-journal.ts"],"recommendation":"Own onSnapshot unsubscribe in the useEffect scope and invoke it on unmount and user switch; do not rely on returning cleanup from inside onAuthStateChanged callbacks.","evidence_sources":["ChatGPT 5.2 Thinking","Claude Sonnet 4.5"],"notes":"ChatGPT asserts a real leak (unsubscribe returned inside onAuthStateChanged is ignored). Sonnet flags the existing pattern as fragile. Codex/Opus indicated cleanup exists—verify current HEAD, but fix is still warranted as S0 hardening."}
{"canonical_id":"PERF-002","category":"Data Fetching & Caching","issue_type":"Redundant auth listener duplicates subscriptions/churn","title":"useJournal registers its own auth listener despite AuthProvider already subscribing","severity":"S2","effort":"E1","confidence":86,"files":["hooks/use-journal.ts","components/providers/auth-provider.tsx","components/providers/auth-context.tsx"],"recommendation":"Remove auth.onAuthStateChanged from useJournal and consume user/uid from AuthProvider context; subscribe to Firestore keyed by uid only.","evidence_sources":["Copilot","Claude Sonnet 4.5","Codex","Claude Code Opus 4.5"]}
{"canonical_id":"PERF-003","category":"Rendering Performance","issue_type":"Realtime listener resubscribes due to unstable effect deps","title":"TodayPage real-time listener re-subscribes on every keystroke due to useEffect dependency on journalEntry","severity":"S1","effort":"E1","confidence":90,"files":["components/notebook/pages/today-page.tsx"],"recommendation":"Key the listener effect only by (user, referenceDate); remove journalEntry from deps and use refs/split effects for edit-safety.","evidence_sources":["ChatGPT 5.2 Thinking"]}
{"canonical_id":"PERF-004","category":"Bundle Size & Loading","issue_type":"Landing page forced client-side blocks SSR and pulls heavy deps early","title":"Landing page is client-only and eagerly imports NotebookShell + framer-motion, inflating initial JS","severity":"S1","effort":"E2","confidence":85,"files":["app/page.tsx","components/notebook/notebook-shell.tsx","components/notebook/roadmap-modules.tsx"],"recommendation":"Use a server shell where possible; move state/AnimatePresence into a client island; dynamically import NotebookShell; split notebook pages per tab.","evidence_sources":["Copilot","Claude Sonnet 4.5","Codex","Claude Code Opus 4.5","ChatGPT 5.2 Thinking"]}
{"canonical_id":"PERF-005","category":"Bundle Size & Loading","issue_type":"Large bundle + insufficient code splitting of heavy libraries","title":"Large bundle size without code splitting for Firebase/Framer/Leaflet and non-critical features","severity":"S1","effort":"E2","confidence":94,"files":["package.json","next.config.mjs",".next/static/chunks","components/**","lib/firebase.ts","components/maps/meeting-map.tsx"],"recommendation":"Enforce route-level code splitting: Leaflet only on map routes; Framer only where needed; avoid pulling Firebase init into routes that don't require it; validate via chunk reports/bundle analyzer.","evidence_sources":["Copilot","Claude Sonnet 4.5","Claude Code Opus 4.5"]}
{"canonical_id":"PERF-006","category":"Core Web Vitals","issue_type":"LCP hero background image not optimized (CSS bg)","title":"Hero background (wood-table.jpg) likely harms LCP due to CSS background-image without responsive variants/preload","severity":"S2","effort":"E1","confidence":76,"files":["app/page.tsx","public/images/wood-table.jpg","next.config.mjs"],"recommendation":"In static export mode: generate responsive WebP/AVIF sizes and use CSS image-set() + preload; if moving off export/unoptimized, use next/image fill+priority.","evidence_sources":["Copilot","Claude Sonnet 4.5","Codex","Claude Code Opus 4.5"]}
{"canonical_id":"PERF-007","category":"Bundle Size & Loading","issue_type":"Static export disables Next image optimization","title":"Images are unoptimized in static export mode (images.unoptimized=true)","severity":"S1","effort":"E1","confidence":100,"files":["next.config.mjs","app/**","components/**"],"recommendation":"Either implement a static-friendly responsive image pipeline (pre-generated sizes + srcset/image-set) OR change deployment strategy to regain next/image optimization.","evidence_sources":["Claude Code Opus 4.5"]}
{"canonical_id":"PERF-008","category":"Bundle Size & Loading","issue_type":"Excessive 'use client' usage increases client JS footprint","title":"Excessive client components ('use client') inflate client bundle and reduce SSR benefits","severity":"S1","effort":"E3","confidence":90,"files":["app/**","components/**"],"recommendation":"Audit 'use client' directives; convert eligible components to Server Components; isolate client-only logic into small leaf components.","evidence_sources":["Claude Code Opus 4.5"]}
{"canonical_id":"PERF-009","category":"Rendering Performance","issue_type":"Large complex component lacks memoization/splitting","title":"Step1WorksheetCard is very large with minimal memoization, likely causing excessive re-renders","severity":"S1","effort":"E2","confidence":85,"files":["components/growth/Step1WorksheetCard.tsx"],"recommendation":"Split into smaller memoized subcomponents; remove inline handlers via useCallback; memoize derived computations.","evidence_sources":["Claude Sonnet 4.5"]}
{"canonical_id":"PERF-010","category":"Rendering Performance","issue_type":"Entry list renders without virtualization; expensive filtering/grouping","title":"EntryFeed renders up to 100 entries without virtualization; filter/group/sort costs remain high","severity":"S2","effort":"E2","confidence":87,"files":["components/journal/entry-feed.tsx"],"recommendation":"Add virtualization (react-window/@tanstack/react-virtual) and debounce search; reduce per-render filter/sort/group work.","evidence_sources":["Claude Sonnet 4.5","Codex","Claude Code Opus 4.5"]}
{"canonical_id":"PERF-011","category":"Data Fetching & Caching","issue_type":"Journal loads 100 entries upfront without pagination","title":"useJournal loads 100 entries upfront; add pagination or incremental loading","severity":"S2","effort":"E2","confidence":89,"files":["hooks/use-journal.ts","components/journal/entry-feed.tsx"],"recommendation":"Paginate journal entries (20–30 initial, load more on scroll) using startAfter(); consider realtime only for the newest window.","evidence_sources":["Copilot","Claude Sonnet 4.5","Claude Code Opus 4.5"]}
{"canonical_id":"PERF-012","category":"Data Fetching & Caching","issue_type":"Unbounded client reads of Firestore collections (quotes)","title":"Daily quote fetch loads the entire quotes collection on the client (duplicated components)","severity":"S2","effort":"E1","confidence":85,"files":["lib/db/quotes.ts","components/notebook/features/daily-quote-card.tsx","components/widgets/daily-quote-card.tsx"],"recommendation":"Select the daily quote server-side (route/function) or query only needed doc(s); cache per-day selection; dedupe components.","evidence_sources":["Codex","ChatGPT 5.2 Thinking"]}
{"canonical_id":"PERF-013","category":"Data Fetching & Caching","issue_type":"Admin CRUD loads full collections without pagination/limits","title":"Admin CRUD table pulls full collections via getDocs without pagination","severity":"S2","effort":"E2","confidence":72,"files":["components/admin/admin-crud-table.tsx"],"recommendation":"Add pagination/limits (orderBy+limit+startAfter) and avoid full refetch after mutations (patch state/revalidate).","evidence_sources":["Codex","Claude Sonnet 4.5 (suspected)","Claude Code Opus 4.5 (reviewed file)"]}
{"canonical_id":"PERF-014","category":"Rendering Performance","issue_type":"Meetings map scale risks (clustering/fitBounds stability)","title":"Meetings map may jank at scale without marker clustering and stable fitBounds behavior","severity":"S2","effort":"E2","confidence":70,"files":["components/maps/meeting-map.tsx","app/meetings/all/page.tsx"],"recommendation":"Add marker clustering for large sets; stabilize/debounce fitBounds; consider bounding-box queries.","evidence_sources":["Copilot","Claude Sonnet 4.5","Codex (suspected)"]}
{"canonical_id":"PERF-015","category":"Rendering Performance","issue_type":"Animation DOM explosion","title":"High-intensity confetti spawns up to 150 animated DOM nodes","severity":"S2","effort":"E2","confidence":73,"files":["components/celebrations/confetti-burst.tsx","components/celebrations/types.ts"],"recommendation":"Cap particles on low-end devices and/or move confetti to canvas/WebGL; respect prefers-reduced-motion.","evidence_sources":["Codex"]}
{"canonical_id":"PERF-016","category":"Bundle Size & Loading","issue_type":"Console statements in production code paths","title":"Console statements exist in production code; should be gated/removed or routed to logger/Sentry","severity":"S2","effort":"E0","confidence":95,"files":["components/**","hooks/**","app/**"],"recommendation":"Remove or guard console.* behind dev-only checks; route errors to logger/Sentry.","evidence_sources":["Copilot","Claude Sonnet 4.5","Claude Code Opus 4.5"]}
{"canonical_id":"PERF-017","category":"Core Web Vitals","issue_type":"Global third-party script loaded when unnecessary","title":"reCAPTCHA Enterprise script injected on every route (even when not needed)","severity":"S2","effort":"E1","confidence":82,"files":["app/layout.tsx"],"recommendation":"Load reCAPTCHA only on flows/routes/actions that require it (or inject on-demand when token is needed).","evidence_sources":["Claude Sonnet 4.5","ChatGPT 5.2 Thinking"]}
{"canonical_id":"PERF-018","category":"Observability & Monitoring","issue_type":"Client Sentry init not wired into app shell","title":"Sentry client initialization exists but is not invoked automatically","severity":"S3","effort":"E1","confidence":83,"files":["lib/sentry.client.ts","app/layout.tsx"],"recommendation":"Call initSentryClient in a client bootstrap included by RootLayout; verify traces/errors arrive in prod.","evidence_sources":["Codex","Claude Code Opus 4.5"]}
{"canonical_id":"PERF-019","category":"Observability & Monitoring","issue_type":"Missing Core Web Vitals instrumentation","title":"No Core Web Vitals tracking configured (LCP/CLS/INP)","severity":"S2","effort":"E1","confidence":95,"files":["app/layout.tsx"],"recommendation":"Add Web Vitals collection and send to Sentry/analytics so you can measure regressions and before/after gains.","evidence_sources":["Claude Code Opus 4.5"]}
{"canonical_id":"PERF-020","category":"Observability & Monitoring","issue_type":"Client bundle risk from Node crypto import in browser code","title":"Client Sentry config imports Node crypto, risking polyfills/larger client chunks","severity":"S2","effort":"E1","confidence":70,"files":["lib/sentry.client.ts"],"recommendation":"Use Web Crypto (crypto.subtle) or hash server-side; confirm bundle impact after change.","evidence_sources":["Copilot"]}
{"canonical_id":"PERF-021","category":"Core Web Vitals","issue_type":"CLS risk from animation swaps without reserved layout bounds","title":"AnimatePresence transitions may cause CLS without explicit size reservation","severity":"S2","effort":"E1","confidence":70,"files":["app/page.tsx","components/celebrations/celebration-overlay.tsx"],"recommendation":"Reserve layout space (min-height/explicit bounds) for animated swaps; validate CLS via Lighthouse/layout shift regions.","evidence_sources":["Claude Sonnet 4.5","Claude Code Opus 4.5"]}
{"canonical_id":"PERF-022","category":"Data Fetching & Caching","issue_type":"No query caching/dedup layer for Firestore reads","title":"No caching strategy for Firestore queries; mounts trigger repeated reads","severity":"S2","effort":"E2","confidence":95,"files":["hooks/use-journal.ts","lib/db/meetings.ts","lib/db/quotes.ts","components/providers/profile-context.tsx"],"recommendation":"Introduce React Query/SWR for non-realtime reads; define staleTime and deduplicate concurrent requests.","evidence_sources":["Claude Code Opus 4.5"]}
{"canonical_id":"PERF-023","category":"Data Fetching & Caching","issue_type":"Client-side filtering of soft-deletes increases cost","title":"useJournal filters soft-deleted entries client-side instead of using where(isSoftDeleted==false) despite available index","severity":"S2","effort":"E1","confidence":80,"files":["hooks/use-journal.ts","ARCHITECTURE.md"],"recommendation":"Add where('isSoftDeleted','==',false) + orderBy('createdAt','desc') (confirm composite index) to reduce transferred docs and processing.","evidence_sources":["ChatGPT 5.2 Thinking"]}
{"canonical_id":"PERF-024","category":"Bundle Size & Loading","issue_type":"Notebook pages likely pulled into NotebookShell chunk due to static imports (needs build confirmation)","title":"NotebookShell likely bundles most notebook pages because roadmap-modules statically imports pages at module scope","severity":"S2","effort":"E2","confidence":50,"files":["components/notebook/roadmap-modules.tsx","components/notebook/notebook-shell.tsx"],"recommendation":"Convert notebook module pages to dynamic imports per tab with Suspense boundaries; confirm via chunk report after build.","evidence_sources":["ChatGPT 5.2 Thinking"]}
{"canonical_id":"PERF-025","category":"Rendering Performance","issue_type":"Redundant grouping/sorting between Timeline and useJournal (suspected)","title":"Timeline may re-group/re-sort even though useJournal already groups entries","severity":"S3","effort":"E1","confidence":35,"files":["components/journal/timeline.tsx","hooks/use-journal.ts"],"recommendation":"Avoid double grouping: consume groupedEntries from the hook or memoize grouping at a shared selector layer.","evidence_sources":["Codex (suspected)"]}
{"canonical_id":"PERF-026","category":"Memory Management","issue_type":"Event listener/timer cleanup coverage not fully verified","title":"Event listener/timer cleanup verification needed across multiple components","severity":"S3","effort":"E1","confidence":60,"files":["components/**"],"recommendation":"Audit addEventListener/setInterval/setTimeout usage and ensure consistent cleanup; consider lint rules/tests.","evidence_sources":["Claude Code Opus 4.5"]}
{"canonical_id":"PERF-027","category":"Observability & Monitoring","issue_type":"Sentry tracing sample rate may be too low for debugging","title":"Sentry tracesSampleRate is low in production; may miss performance problems","severity":"S3","effort":"E0","confidence":80,"files":["lib/sentry.client.ts"],"recommendation":"Temporarily increase tracesSampleRate (cost-aware) until enough data exists to diagnose regressions.","evidence_sources":["Claude Code Opus 4.5"]}
{"canonical_id":"PERF-028","category":"Bundle Size & Loading","issue_type":"Unused deps risk install/resolve bloat and bundle creep","title":"Unused dependencies remain in runtime dependencies (tool-reported)","severity":"S3","effort":"E1","confidence":60,"files":["package.json"],"recommendation":"Remove unused deps or move dev-only modules to devDependencies; re-run unused-deps tooling in CI.","evidence_sources":["Codex"]}
