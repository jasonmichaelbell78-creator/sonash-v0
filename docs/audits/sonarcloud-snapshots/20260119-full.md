# SonarCloud Full Analysis Snapshot

**Date**: 2026-01-19 **Project**: jasonmichaelbell78-creator_sonash-v0 **Quality
Gate**: ERROR

---

## Summary

| Category              | Count     |
| --------------------- | --------- |
| **Code Issues**       | 1,116     |
| **Security Hotspots** | 97        |
| **Grand Total**       | **1,213** |

### Issues by Severity

| Severity | Count | %     |
| -------- | ----- | ----- |
| CRITICAL | 93    | 8.3%  |
| MAJOR    | 304   | 27.2% |
| MINOR    | 716   | 64.2% |
| INFO     | 3     | 0.3%  |

### Issues by Directory

| Directory         | Total | CRITICAL | MAJOR | MINOR |
| ----------------- | ----- | -------- | ----- | ----- |
| scripts           | 512   | 51       | 84    | 376   |
| components        | 352   | 24       | 140   | 187   |
| lib               | 76    | 5        | 11    | 59    |
| .claude           | 55    | 1        | 51    | 3     |
| functions         | 41    | 10       | 11    | 20    |
| hooks             | 34    | 1        | 0     | 33    |
| tests             | 21    | 0        | 1     | 20    |
| app               | 21    | 1        | 5     | 15    |
| next.config.mjs   | 2     | 0        | 0     | 2     |
| eslint.config.mjs | 1     | 0        | 0     | 1     |
| styles            | 1     | 0        | 1     | 0     |

### Security Hotspots by Probability

| Probability | Count | Categories                                                                                      |
| ----------- | ----- | ----------------------------------------------------------------------------------------------- |
| HIGH        | 14    | Command injection (10), Hard-coded passwords (4)                                                |
| MEDIUM      | 48    | Regex DoS (33), Weak crypto/Math.random (15)                                                    |
| LOW         | 35    | PATH variable (27), GitHub SHA (2), Secrets (1), Geolocation (1), HTTP (1), Eval (1), Other (2) |

---

## Issues by Rule (Top 30)

| Rule             | Count | Severity | Type       | Primary Dirs               |
| ---------------- | ----- | -------- | ---------- | -------------------------- |
| javascript:S7781 | 87    | MINOR    | CODE_SMELL | scripts                    |
| javascript:S7778 | 86    | MINOR    | CODE_SMELL | scripts                    |
| typescript:S6759 | 68    | MINOR    | CODE_SMELL | lib, components, app       |
| typescript:S7764 | 56    | MINOR    | CODE_SMELL | components, lib, app       |
| javascript:S7772 | 56    | MINOR    | CODE_SMELL | scripts                    |
| typescript:S3358 | 52    | MAJOR    | CODE_SMELL | components, functions, app |
| shelldre:S7688   | 51    | MAJOR    | CODE_SMELL | .claude, scripts           |
| javascript:S3776 | 46    | CRITICAL | CODE_SMELL | scripts                    |
| javascript:S7780 | 44    | MINOR    | CODE_SMELL | scripts                    |
| typescript:S7781 | 39    | MINOR    | CODE_SMELL | components, functions, lib |
| typescript:S7772 | 37    | MINOR    | CODE_SMELL | tests, scripts, functions  |
| typescript:S1874 | 36    | MINOR    | CODE_SMELL | lib, components, app       |
| typescript:S6853 | 35    | MAJOR    | CODE_SMELL | components                 |
| typescript:S7773 | 33    | MINOR    | CODE_SMELL | tests, functions, app      |
| typescript:S3776 | 29    | CRITICAL | CODE_SMELL | functions, components, lib |
| typescript:S7735 | 22    | MINOR    | CODE_SMELL | lib, components, scripts   |
| typescript:S6479 | 20    | MAJOR    | CODE_SMELL | components                 |
| javascript:S3358 | 19    | MAJOR    | CODE_SMELL | scripts                    |
| javascript:S7773 | 17    | MINOR    | CODE_SMELL | scripts                    |
| typescript:S6819 | 15    | MAJOR    | CODE_SMELL | components                 |
| typescript:S6551 | 13    | MINOR    | CODE_SMELL | hooks                      |
| typescript:S3735 | 12    | CRITICAL | CODE_SMELL | components, lib            |
| typescript:S3863 | 12    | MINOR    | CODE_SMELL | components, app            |
| javascript:S7735 | 12    | MINOR    | CODE_SMELL | scripts                    |
| typescript:S7785 | 12    | MAJOR    | CODE_SMELL | scripts                    |
| javascript:S7776 | 9     | MINOR    | CODE_SMELL | scripts                    |
| typescript:S7763 | 8     | MINOR    | CODE_SMELL | lib, components            |
| typescript:S6582 | 7     | MAJOR    | CODE_SMELL | functions, components, lib |
| javascript:S7785 | 7     | MAJOR    | CODE_SMELL | scripts                    |
| typescript:S7778 | 7     | MINOR    | CODE_SMELL | hooks, scripts             |

---

## Cleanup Plan (5 PRs - One Per Phase)

> **Note**: This snapshot uses a consolidated 5-PR structure (one PR per phase)
> as defined in `docs/archive/completed-plans/sonarcloud-cleanup-sprint.md`.

### PR 1: Mechanical Fixes (~290 issues, ~5hr)

**Branch**: `cleanup/phase-1-mechanical`

#### Part A: Node Protocol Imports (~230 issues, MINOR)

**Rules**: S7772, S7781, S7778 - Prefer `node:*` prefix for Node.js built-ins

| Rule  | JS Count | TS Count | Fix Pattern                            |
| ----- | -------- | -------- | -------------------------------------- |
| S7772 | 56       | 37       | `require('fs')` â†’ `require('node:fs')` |
| S7781 | 87       | 39       | Similar import preference              |
| S7778 | 86       | 7        | Similar import preference              |

**Directories**: scripts/, tests/, functions/

#### Part B: Shell Script Fixes (~60 issues, MAJOR)

**Rules**: S7688, S7682, S7677, S7679, S131, S1192

| Rule  | Count | Fix Pattern                        |
| ----- | ----- | ---------------------------------- |
| S7688 | 51    | Shell script best practices        |
| S7682 | 6     | Double-quoted variables            |
| S7677 | 5     | Condition bracketing               |
| S7679 | 1     | Shell quoting                      |
| S131  | 1     | Add default case to case statement |
| S1192 | 4     | String duplication                 |

**Directories**: .claude/, scripts/

---

### PR 2: Critical Complexity (75 issues, ~14hr)

**Branch**: `cleanup/phase-2-complexity`

#### Part A: Scripts Complexity (46 issues, CRITICAL)

**Rule**: javascript:S3776 - Reduce cognitive complexity below 15

| File                                    | Complexity | Target |
| --------------------------------------- | ---------- | ------ |
| scripts/aggregate-audit-findings.js     | 87         | 15     |
| scripts/generate-documentation-index.js | 56         | 15     |
| scripts/check-docs-light.js             | 55         | 15     |
| scripts/check-backlog-health.js         | 39         | 15     |
| scripts/validate-canon-schema.js        | 37         | 15     |
| scripts/security-check.js               | 35         | 15     |
| scripts/run-consolidation.js            | 34         | 15     |
| scripts/validate-audit.js               | 34         | 15     |
| + 38 more...                            | 16-32      | 15     |

**Approach**: Extract helper functions, reduce nesting, simplify conditionals

#### Part B: App Code Complexity (29 issues, CRITICAL)

**Rule**: typescript:S3776

| File                                         | Complexity | Target |
| -------------------------------------------- | ---------- | ------ |
| functions/src/jobs.ts:653                    | 42         | 15     |
| functions/src/security-wrapper.ts:106        | 39         | 15     |
| components/notebook/pages/resources-page.tsx | 48         | 15     |
| components/admin/users-tab.tsx               | 41         | 15     |
| components/settings/settings-page.tsx        | 41         | 15     |
| + 24 more...                                 | 16-35      | 15     |

**Approach**: Split components, extract hooks, simplify logic

---

### PR 3: Major Code Quality (~175 issues, ~11hr)

**Branch**: `cleanup/phase-3-major-quality`

#### Part A: Ternary Expression Complexity (71 issues, MAJOR)

**Rule**: S3358 - Avoid nested ternaries

| Language   | Count | Dirs                       |
| ---------- | ----- | -------------------------- |
| TypeScript | 52    | components, functions, app |
| JavaScript | 19    | scripts                    |

**Fix Pattern**: Extract to if/else or separate variables

#### Part B: Critical Code Smells (17 issues, CRITICAL)

| Rule  | Count | Description                | Fix                       |
| ----- | ----- | -------------------------- | ------------------------- |
| S3735 | 12    | Void operator usage        | Remove void, use .catch() |
| S2004 | 2     | Nested functions >4 levels | Extract inner functions   |
| S6861 | 3     | Other critical             | Case-by-case              |

#### Part C: React-Specific Issues (~90 issues, MAJOR)

| Rule   | Count | Description           |
| ------ | ----- | --------------------- |
| S6853  | 35    | React component rules |
| S6479  | 20    | Array index as key    |
| S6819  | 15    | JSX accessibility     |
| S6772  | 5     | Component structure   |
| S6848  | 5     | Hook dependencies     |
| S6481  | 5     | Object in JSX         |
| Others | 5     | Misc React issues     |

---

### PR 4: Medium Priority (~480 issues, ~13hr)

**Branch**: `cleanup/phase-4-medium-priority`

#### Part A: Deprecation Warnings (~100 issues, MINOR)

| Rule  | Count | Description          |
| ----- | ----- | -------------------- |
| S6759 | 68    | Various deprecations |
| S1874 | 36    | Deprecated API usage |

#### Part B: Remaining MAJOR Issues (~50 issues)

| Rule              | Count | Description                      |
| ----------------- | ----- | -------------------------------- |
| S7785             | 19    | Various issues                   |
| S1854             | 8     | Dead stores (unused assignments) |
| S6582             | 7     | Use optional chaining            |
| S5869/S4624/S5843 | 18    | Regex and logic issues           |
| Others            | ~10   | Miscellaneous                    |

#### Part C: Remaining MINOR Issues (~330 issues)

| Rule   | Count |
| ------ | ----- |
| S7780  | 44    |
| S7773  | 50    |
| S7735  | 34    |
| S6551  | 13    |
| S3863  | 12    |
| Others | ~180  |

---

### PR 5: Security Hotspots (97 hotspots, ~9hr)

**Branch**: `cleanup/phase-5-security`

#### Part A: HIGH Priority - Command Injection (10 hotspots)

**Rule**: S4721 - OS command execution

| File                                | Lines    |
| ----------------------------------- | -------- |
| scripts/ai-review.js                | 222, 227 |
| scripts/check-pattern-compliance.js | 463 (x2) |
| scripts/check-review-needed.js      | 234      |
| scripts/phase-complete-check.js     | 437      |
| scripts/security-check.js           | 189 (x3) |
| scripts/retry-failures.ts           | 113      |

**Fix**: Use `execFileSync` with array args instead of `execSync` with string

#### Part B: HIGH Priority - Hard-coded Passwords (4 hotspots)

**Rule**: S2068

| File                       | Lines   | Action                                          |
| -------------------------- | ------- | ----------------------------------------------- |
| lib/utils/errors.ts        | 69, 71  | Review - likely false positive (error patterns) |
| tests/utils/logger.test.ts | 96, 130 | Review - test data                              |

#### Part C: MEDIUM Priority - Regex DoS (33 hotspots)

**Rule**: S5852 - Potential catastrophic backtracking

**Affected Files**: 15 scripts, 5 app files

**Fix Options**:

1. Limit input length before regex
2. Use linear-time regex patterns
3. Add timeouts for untrusted input

#### Part D: MEDIUM Priority - Math.random (15 hotspots)

**Rule**: S2245 - Weak PRNG

| File                                       | Count | Action                          |
| ------------------------------------------ | ----- | ------------------------------- |
| components/celebrations/confetti-burst.tsx | 10    | Mark SAFE - visual effects only |
| components/celebrations/firework-burst.tsx | 5     | Mark SAFE - visual effects only |

#### Part E: LOW Priority Hotspots (35 hotspots)

| Rule  | Count | Description                | Action             |
| ----- | ----- | -------------------------- | ------------------ |
| S4036 | 27    | PATH variable concerns     | Review dev scripts |
| S7637 | 2     | GitHub Actions SHA pinning | Pin to full SHA    |
| S7636 | 1     | Secrets in run block       | Review workflow    |
| S5604 | 1     | Geolocation                | Document usage     |
| S5332 | 1     | HTTP in tests              | Mark SAFE          |
| S1523 | 1     | javascript: eval           | Review test        |

---

## Execution Summary

| Phase               | PR    | Issues    | Effort    |
| ------------------- | ----- | --------- | --------- |
| Phase 1: Mechanical | 1     | 290       | 5hr       |
| Phase 2: Critical   | 2     | 75        | 14hr      |
| Phase 3: Major      | 3     | 175       | 11hr      |
| Phase 4: Medium     | 4     | 480       | 13hr      |
| Phase 5: Security   | 5     | 97        | 9hr       |
| **TOTAL**           | **5** | **1,117** | **~52hr** |

---

## Verification Checklist

After each PR:

- [ ] `npm run lint` passes
- [ ] `npm run type-check` passes
- [ ] `npm test` passes
- [ ] SonarCloud PR analysis shows issue reduction
- [ ] No new issues introduced

After all PRs:

- [ ] Quality Gate: PASSED
- [ ] All security hotspots reviewed
- [ ] Post-sprint snapshot created
- [ ] ROADMAP.md blocker resolved

---

## Related Documents

- [Cleanup Plan](../../archive/completed-plans/sonarcloud-cleanup-sprint.md)
- [Runbook](../../SONARCLOUD_CLEANUP_RUNBOOK.md)
- [SonarCloud Dashboard](https://sonarcloud.io/project/overview?id=jasonmichaelbell78-creator_sonash-v0)
