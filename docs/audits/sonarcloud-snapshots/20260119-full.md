# SonarCloud Full Analysis Snapshot

**Date**: 2026-01-19 **Project**: jasonmichaelbell78-creator_sonash-v0 **Quality
Gate**: ERROR

---

## Summary

| Category              | Count     |
| --------------------- | --------- |
| **Code Issues**       | 1,116     |
| **Security Hotspots** | 97        |
| **Grand Total**       | **1,213** |

### Issues by Severity

| Severity | Count | %     |
| -------- | ----- | ----- |
| CRITICAL | 93    | 8.3%  |
| MAJOR    | 304   | 27.2% |
| MINOR    | 716   | 64.2% |
| INFO     | 3     | 0.3%  |

### Issues by Directory

| Directory         | Total | CRITICAL | MAJOR | MINOR |
| ----------------- | ----- | -------- | ----- | ----- |
| scripts           | 512   | 51       | 84    | 376   |
| components        | 352   | 24       | 140   | 187   |
| lib               | 76    | 5        | 11    | 59    |
| .claude           | 55    | 1        | 51    | 3     |
| functions         | 41    | 10       | 11    | 20    |
| hooks             | 34    | 1        | 0     | 33    |
| tests             | 21    | 0        | 1     | 20    |
| app               | 21    | 1        | 5     | 15    |
| next.config.mjs   | 2     | 0        | 0     | 2     |
| eslint.config.mjs | 1     | 0        | 0     | 1     |
| styles            | 1     | 0        | 1     | 0     |

### Security Hotspots by Probability

| Probability | Count | Categories                                                                                      |
| ----------- | ----- | ----------------------------------------------------------------------------------------------- |
| HIGH        | 14    | Command injection (10), Hard-coded passwords (4)                                                |
| MEDIUM      | 48    | Regex DoS (33), Weak crypto/Math.random (15)                                                    |
| LOW         | 35    | PATH variable (27), GitHub SHA (2), Secrets (1), Geolocation (1), HTTP (1), Eval (1), Other (2) |

---

## Issues by Rule (Top 30)

| Rule             | Count | Severity | Type       | Primary Dirs               |
| ---------------- | ----- | -------- | ---------- | -------------------------- |
| javascript:S7781 | 87    | MINOR    | CODE_SMELL | scripts                    |
| javascript:S7778 | 86    | MINOR    | CODE_SMELL | scripts                    |
| typescript:S6759 | 68    | MINOR    | CODE_SMELL | lib, components, app       |
| typescript:S7764 | 56    | MINOR    | CODE_SMELL | components, lib, app       |
| javascript:S7772 | 56    | MINOR    | CODE_SMELL | scripts                    |
| typescript:S3358 | 52    | MAJOR    | CODE_SMELL | components, functions, app |
| shelldre:S7688   | 51    | MAJOR    | CODE_SMELL | .claude, scripts           |
| javascript:S3776 | 46    | CRITICAL | CODE_SMELL | scripts                    |
| javascript:S7780 | 44    | MINOR    | CODE_SMELL | scripts                    |
| typescript:S7781 | 39    | MINOR    | CODE_SMELL | components, functions, lib |
| typescript:S7772 | 37    | MINOR    | CODE_SMELL | tests, scripts, functions  |
| typescript:S1874 | 36    | MINOR    | CODE_SMELL | lib, components, app       |
| typescript:S6853 | 35    | MAJOR    | CODE_SMELL | components                 |
| typescript:S7773 | 33    | MINOR    | CODE_SMELL | tests, functions, app      |
| typescript:S3776 | 29    | CRITICAL | CODE_SMELL | functions, components, lib |
| typescript:S7735 | 22    | MINOR    | CODE_SMELL | lib, components, scripts   |
| typescript:S6479 | 20    | MAJOR    | CODE_SMELL | components                 |
| javascript:S3358 | 19    | MAJOR    | CODE_SMELL | scripts                    |
| javascript:S7773 | 17    | MINOR    | CODE_SMELL | scripts                    |
| typescript:S6819 | 15    | MAJOR    | CODE_SMELL | components                 |
| typescript:S6551 | 13    | MINOR    | CODE_SMELL | hooks                      |
| typescript:S3735 | 12    | CRITICAL | CODE_SMELL | components, lib            |
| typescript:S3863 | 12    | MINOR    | CODE_SMELL | components, app            |
| javascript:S7735 | 12    | MINOR    | CODE_SMELL | scripts                    |
| typescript:S7785 | 12    | MAJOR    | CODE_SMELL | scripts                    |
| javascript:S7776 | 9     | MINOR    | CODE_SMELL | scripts                    |
| typescript:S7763 | 8     | MINOR    | CODE_SMELL | lib, components            |
| typescript:S6582 | 7     | MAJOR    | CODE_SMELL | functions, components, lib |
| javascript:S7785 | 7     | MAJOR    | CODE_SMELL | scripts                    |
| typescript:S7778 | 7     | MINOR    | CODE_SMELL | hooks, scripts             |

---

## PR-Organized Cleanup Plan

### Phase 1: Mechanical Fixes (PRs 1-2) - ~290 issues

#### PR 1: Node Protocol Imports (~230 issues, MINOR)

**Rules**: S7772, S7781, S7778 - Prefer `node:*` prefix for Node.js built-ins

| Rule  | JS Count | TS Count | Fix Pattern                            |
| ----- | -------- | -------- | -------------------------------------- |
| S7772 | 56       | 37       | `require('fs')` â†’ `require('node:fs')` |
| S7781 | 87       | 39       | Similar import preference              |
| S7778 | 86       | 7        | Similar import preference              |

**Directories**: scripts/, tests/, functions/ **Effort**: ~2 hours (mostly
find-replace with verification)

#### PR 2: Shell Script Fixes (~60 issues, MAJOR)

**Rules**: S7688, S7682, S7677, S7679, S131, S1192

| Rule  | Count | Fix Pattern                        |
| ----- | ----- | ---------------------------------- |
| S7688 | 51    | Shell script best practices        |
| S7682 | 6     | Double-quoted variables            |
| S7677 | 5     | Condition bracketing               |
| S7679 | 1     | Shell quoting                      |
| S131  | 1     | Add default case to case statement |
| S1192 | 4     | String duplication                 |

**Directories**: .claude/, scripts/ **Effort**: ~3 hours

---

### Phase 2: Critical Complexity (PRs 3-4) - 75 issues

#### PR 3: Cognitive Complexity - Scripts (46 issues, CRITICAL)

**Rule**: javascript:S3776 - Reduce cognitive complexity below 15

**Top Files by Complexity**: | File | Complexity | Target |
|------|------------|--------| | scripts/aggregate-audit-findings.js | 87 | 15 |
| scripts/generate-documentation-index.js | 56 | 15 | |
scripts/check-docs-light.js | 55 | 15 | | scripts/check-backlog-health.js | 39 |
15 | | scripts/validate-canon-schema.js | 37 | 15 | | scripts/security-check.js
| 35 | 15 | | scripts/run-consolidation.js | 34 | 15 | |
scripts/validate-audit.js | 34 | 15 | | + 38 more... | 16-32 | 15 |

**Approach**: Extract helper functions, reduce nesting, simplify conditionals
**Effort**: ~8 hours

#### PR 4: Cognitive Complexity - App Code (29 issues, CRITICAL)

**Rule**: typescript:S3776

**Top Files**: | File | Complexity | Target | |------|------------|--------| |
functions/src/jobs.ts:653 | 42 | 15 | | functions/src/security-wrapper.ts:106 |
39 | 15 | | components/notebook/pages/resources-page.tsx:40 | 48 | 15 | |
components/admin/users-tab.tsx:96 | 41 | 15 | |
components/settings/settings-page.tsx:103 | 41 | 15 | | + 24 more... | 16-35 |
15 |

**Approach**: Split components, extract hooks, simplify logic **Effort**: ~6
hours

---

### Phase 3: Major Code Quality (PRs 5-7) - ~175 issues

#### PR 5: Ternary Expression Complexity (71 issues, MAJOR)

**Rule**: S3358 - Avoid nested ternaries

| Language   | Count | Dirs                       |
| ---------- | ----- | -------------------------- |
| TypeScript | 52    | components, functions, app |
| JavaScript | 19    | scripts                    |

**Fix Pattern**: Extract to if/else or separate variables **Effort**: ~4 hours

#### PR 6: Critical Code Smells (17 issues, CRITICAL)

**Rules**: | Rule | Count | Description | Fix |
|------|-------|-------------|-----| | S3735 | 12 | Void operator usage | Remove
void, use .catch() | | S2004 | 2 | Nested functions >4 levels | Extract inner
functions | | S6861 | 3 | Other critical | Case-by-case |

**Effort**: ~2 hours

#### PR 7: React-Specific Issues (~90 issues, MAJOR)

**Rules**: | Rule | Count | Description | |------|-------|-------------| | S6853
| 35 | React component rules | | S6479 | 20 | Array index as key | | S6819 | 15
| JSX accessibility | | S6772 | 5 | Component structure | | S6848 | 5 | Hook
dependencies | | S6481 | 5 | Object in JSX | | Others | 5 | Misc React issues |

**Effort**: ~5 hours

---

### Phase 4: Medium Priority (PRs 8-10) - ~180 issues

#### PR 8: Deprecation Warnings (~100 issues, MINOR)

**Rules**: | Rule | Count | Description | |------|-------|-------------| | S6759
| 68 | Various deprecations | | S1874 | 36 | Deprecated API usage |

**Effort**: ~3 hours

#### PR 9: Remaining MAJOR Issues (~50 issues)

**Rules**: | Rule | Count | Description | |------|-------|-------------| | S7785
| 19 | Various | | S1854 | 8 | Dead stores | | S6582 | 7 | Optional chaining | |
S5869/S4624/S5843 | 18 | Regex/logic issues | | Others | ~10 | Misc |

**Effort**: ~4 hours

#### PR 10: Remaining MINOR Issues (~300 issues)

**Rules**: | Rule | Count | |------|-------| | S7780 | 44 | | S7773 | 50 | |
S7735 | 34 | | S6551 | 13 | | S3863 | 12 | | S7763 | 8 | | Others | ~140 |

**Effort**: ~6 hours

---

### Phase 5: Security Hotspots (PRs 11-15) - 97 hotspots

#### PR 11: HIGH - Command Injection (10 hotspots)

**Rule**: S4721 - OS command execution

| File                                | Lines    |
| ----------------------------------- | -------- |
| scripts/ai-review.js                | 222, 227 |
| scripts/check-pattern-compliance.js | 463 (x2) |
| scripts/check-review-needed.js      | 234      |
| scripts/phase-complete-check.js     | 437      |
| scripts/security-check.js           | 189 (x3) |
| scripts/retry-failures.ts           | 113      |

**Fix**: Use `execFileSync` with array args instead of `execSync` with string
**Effort**: ~2 hours

#### PR 12: HIGH - Hard-coded Passwords (4 hotspots)

**Rule**: S2068

| File                       | Lines   | Action                                          |
| -------------------------- | ------- | ----------------------------------------------- |
| lib/utils/errors.ts        | 69, 71  | Review - likely false positive (error patterns) |
| tests/utils/logger.test.ts | 96, 130 | Review - test data                              |

**Effort**: ~30 min (mostly review/document)

#### PR 13: MEDIUM - Regex DoS (33 hotspots)

**Rule**: S5852 - Potential catastrophic backtracking

**Affected Files**: 15 scripts, 5 app files **Fix Options**:

1. Limit input length before regex
2. Use linear-time regex patterns
3. Add timeouts for untrusted input

**Effort**: ~4 hours

#### PR 14: MEDIUM - Math.random (15 hotspots)

**Rule**: S2245 - Weak PRNG

| File                                       | Count | Action                          |
| ------------------------------------------ | ----- | ------------------------------- |
| components/celebrations/confetti-burst.tsx | 10    | Mark SAFE - visual effects only |
| components/celebrations/firework-burst.tsx | 5     | Mark SAFE - visual effects only |

**Effort**: ~30 min (document as SAFE)

#### PR 15: LOW Priority Hotspots (35 hotspots)

| Rule  | Count | Description                | Action             |
| ----- | ----- | -------------------------- | ------------------ |
| S4036 | 27    | PATH variable concerns     | Review dev scripts |
| S7637 | 2     | GitHub Actions SHA pinning | Pin to full SHA    |
| S7636 | 1     | Secrets in run block       | Review workflow    |
| S5604 | 1     | Geolocation                | Document usage     |
| S5332 | 1     | HTTP in tests              | Mark SAFE          |
| S1523 | 1     | javascript: eval           | Review test        |

**Effort**: ~2 hours

---

## Execution Summary

| Phase               | PRs    | Issues    | Effort    |
| ------------------- | ------ | --------- | --------- |
| Phase 1: Mechanical | 1-2    | 290       | 5hr       |
| Phase 2: Critical   | 3-4    | 75        | 14hr      |
| Phase 3: Major      | 5-7    | 175       | 11hr      |
| Phase 4: Medium     | 8-10   | 480       | 13hr      |
| Phase 5: Security   | 11-15  | 97        | 9hr       |
| **TOTAL**           | **15** | **1,117** | **~52hr** |

---

## Verification Checklist

After each PR:

- [ ] `npm run lint` passes
- [ ] `npm run type-check` passes
- [ ] `npm test` passes
- [ ] SonarCloud PR analysis shows issue reduction
- [ ] No new issues introduced

After all PRs:

- [ ] Quality Gate: PASSED
- [ ] All security hotspots reviewed
- [ ] Post-sprint snapshot created
- [ ] ROADMAP.md blocker resolved

---

## Related Documents

- [Cleanup Plan](.claude/plans/sonarcloud-cleanup-sprint.md)
- [Runbook](docs/SONARCLOUD_CLEANUP_RUNBOOK.md)
- [SonarCloud Dashboard](https://sonarcloud.io/project/overview?id=jasonmichaelbell78-creator_sonash-v0)
