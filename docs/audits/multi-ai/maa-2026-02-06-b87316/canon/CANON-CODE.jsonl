{"category":"Hygiene","title":"God Object: functions/src/admin.ts (4108 lines)","fingerprint":"Hygiene::functions/src/admin.ts::admin.ts::god-object","severity":"S1","effort":"E3","confidence":100,"files":["functions/src/admin.ts"],"symbols":["admin.ts"],"duplication_cluster":{"is_cluster":false,"cluster_summary":"","instances":[]},"why_it_matters":"4108-line file violates single responsibility principle. Contains 30+ Cloud Functions in one file, making it difficult to navigate, test, and maintain. Changes require understanding entire file context.","suggested_fix":"Split into domain-specific modules: admin/users.ts, admin/privileges.ts, admin/analytics.ts, admin/errors.ts, admin/logs.ts, admin/jobs.ts. Each module exports 3-5 related functions. Use barrel export from admin/index.ts.","acceptance_tests":["Verify all Cloud Functions still callable after split","Run integration tests for admin endpoints","Verify no circular dependencies with: npm run deps:circular","Check test coverage maintained or improved"],"pr_bucket_suggestion":"misc","dependencies":[],"evidence":["wc -l shows 4108 lines","File contains adminGetUsers, adminSetUserPrivilege, adminGetErrorsWithUsers, adminGetUserAnalytics, adminGetJobRunHistory, and 20+ more functions","DEBT-0012 confirms cognitive complexity 22 at line 576"],"notes":"TDMS already tracks this - references DEBT-0012, DEBT-0035, DEBT-0045, DEBT-0046. Roadmap placement: M2.2 (Functions refactoring).","sources":[{"source":"claude-code","file":"code-claude-code.jsonl","original_fingerprint":"Hygiene::functions/src/admin.ts::admin.ts::god-object"},{"source":"claude","file":"code-claude.jsonl","original_fingerprint":"Hygiene::functions/src/admin.ts::admin.ts::god-object"}],"merged_from":["Hygiene::functions/src/admin.ts::admin.ts::god-object","Hygiene::functions/src/admin.ts::admin.ts::god-object"],"verified":true,"consensus_score":3,"canonical_id":"CANON-0001","status":"CONFIRMED"}
{"category":"Testing","title":"firestore-service test skips the primary saveDailyLog test","fingerprint":"Testing::tests/firestore-service.test.ts::saveDailyLog::skipped-test","severity":"S1","effort":"E1","confidence":100,"files":["tests/firestore-service.test.ts"],"symbols":["createFirestoreService","saveDailyLog"],"duplication_cluster":{"is_cluster":false},"why_it_matters":"The saveDailyLog test has skip: 'Requires Firebase Cloud Functions - integration test'. The primary write path for the application has no unit test coverage.","suggested_fix":"Mock httpsCallable to test the client-side flow: rate limiting checks, reCAPTCHA token handling, error message extraction, retry logic.","acceptance_tests":["saveDailyLog test runs and passes without skip","Mock verifies httpsCallable is called with correct parameters","Error paths are covered"],"pr_bucket_suggestion":"tests-hardening","dependencies":[],"evidence":["tests/firestore-service.test.ts:57-68 — test with skip annotation"],"notes":"","sources":[{"source":"copilot","file":"code-copilot.jsonl","original_fingerprint":"Testing::tests/firestore-service.test.ts::saveDailyLog::skipped-test"},{"source":"jules","file":"code-jules.jsonl","original_fingerprint":"Testing::tests/firestore-service.test.ts::saveDailyLog::skipped-test"}],"merged_from":["Testing::tests/firestore-service.test.ts::saveDailyLog::skipped-test","Testing::tests/firestore-service.test.ts::saveDailyLog::skipped-test"],"verified":true,"consensus_score":3,"canonical_id":"CANON-0002","status":"CONFIRMED"}
{"category":"Hygiene","title":"God Object: components/admin/users-tab.tsx (2092 lines)","fingerprint":"Hygiene::components/admin/users-tab.tsx::UsersTab::god-component","severity":"S1","effort":"E2","confidence":100,"files":["components/admin/users-tab.tsx"],"symbols":["UsersTab"],"duplication_cluster":{"is_cluster":false,"cluster_summary":"","instances":[]},"why_it_matters":"2092-line component violates React best practices. Single component handles user search, pagination, profile viewing, editing, privilege management, soft-delete, and hard-delete. Difficult to test and maintain.","suggested_fix":"Extract sub-components: UserSearchPanel, UserProfileCard, UserEditDialog, PrivilegeManager, UserDeleteControls. Move data fetching to custom hooks: useUserSearch, useUserProfile, useUserPrivileges. Target: main component <200 lines.","acceptance_tests":["Component renders without errors","User search functionality unchanged","Privilege updates work end-to-end","Soft-delete and hard-delete workflows functional","No console errors during interactions"],"pr_bucket_suggestion":"ui-primitives","dependencies":[],"evidence":["wc -l shows 2092 lines","Component imports 20+ icons from lucide-react","Contains inline helper functions at lines 97-200","Multiple useState calls (10+) managing complex state"],"notes":"Part of admin panel complexity. See also errors-tab.tsx (1095 lines) and dashboard-tab.tsx (1031 lines). Total admin components: 13,159 lines.","sources":[{"source":"claude-code","file":"code-claude-code.jsonl","original_fingerprint":"Hygiene::components/admin/users-tab.tsx::UsersTab::god-component"}],"verified":true,"consensus_score":2,"canonical_id":"CANON-0003","status":"CONFIRMED"}
{"category":"Types","title":"Type Divergence: Client types vs Server schemas","fingerprint":"Types::types/journal.ts::JournalEntry::client-server-divergence","severity":"S1","effort":"E2","confidence":85,"files":["types/journal.ts","functions/src/schemas.ts"],"symbols":["JournalEntry","journalEntrySchema"],"duplication_cluster":{"is_cluster":false,"cluster_summary":"","instances":[]},"why_it_matters":"Client TypeScript types and server Zod schemas define journal entries independently, leading to silent validation failures. Adding new entry types requires coordinated changes in 2+ places with no automated consistency check.","suggested_fix":"Create single source of truth: lib/types/journal-shared.ts with Zod schemas. Generate TypeScript types using zod's z.infer<typeof schema>. Export both schema (for validation) and type (for TypeScript). Import in both client and server.","acceptance_tests":["Schemas validate expected journal entry structures","TypeScript types match Zod schema shapes","Client-side validation catches same errors as server","No breaking changes to existing journal entries"],"pr_bucket_suggestion":"types-domain","dependencies":[],"evidence":["DEBT-0049 confirms this issue","grep shows 142 Zod schema definitions across codebase","Types defined separately in types/ directory"],"notes":"Already tracked as DEBT-0049 with roadmap placement M2.1. Affects data integrity.","sources":[{"source":"claude-code","file":"code-claude-code.jsonl","original_fingerprint":"Types::types/journal.ts::JournalEntry::client-server-divergence"}],"verified":true,"consensus_score":2,"canonical_id":"CANON-0004","status":"CONFIRMED"}
{"category":"Security","title":"reCAPTCHA Token Bypass (Existing DEBT-0045)","fingerprint":"Security::functions/src/security-wrapper.ts::security-wrapper::recaptcha-bypass","severity":"S1","effort":"E1","confidence":100,"files":["functions/src/security-wrapper.ts"],"symbols":["security-wrapper"],"duplication_cluster":{"is_cluster":false,"cluster_summary":"","instances":[]},"why_it_matters":"If recaptchaAction is configured for an endpoint, missing token logs warning but continues processing. Should fail closed to prevent automated abuse. Currently allows requests without reCAPTCHA validation.","suggested_fix":"Require non-empty recaptchaToken when recaptchaAction is set. Throw HttpsError('failed-precondition', 'reCAPTCHA required') if missing. Allow bypass only in explicit dev/test mode via ALLOW_RECAPTCHA_BYPASS env flag.","acceptance_tests":["Requests without token are rejected with 400 error","Dev/test mode explicitly enabled via env flag","Production mode requires valid tokens","Integration tests pass with proper token handling"],"pr_bucket_suggestion":"security-hardening","dependencies":[],"evidence":["DEBT-0045 from MASTER_DEBT.jsonl","Wrapper logs missing token but continues processing (Claude Opus evidence)","Currently deployed in production with this behavior"],"notes":"Already tracked in TDMS. Roadmap: Track-S (Security). Fix before public launch.","sources":[{"source":"claude-code","file":"code-claude-code.jsonl","original_fingerprint":"Security::functions/src/security-wrapper.ts::security-wrapper::recaptcha-bypass"}],"verified":true,"consensus_score":2,"canonical_id":"CANON-0005","status":"CONFIRMED"}
{"category":"Security","title":"Incomplete Rate Limiting (Existing DEBT-0046)","fingerprint":"Security::functions/src/security-wrapper.ts::security-wrapper::rate-limit-gaps","severity":"S1","effort":"E2","confidence":100,"files":["functions/src/security-wrapper.ts"],"symbols":["security-wrapper","FirestoreRateLimiter"],"duplication_cluster":{"is_cluster":false,"cluster_summary":"","instances":[]},"why_it_matters":"Rate limiting has 3 gaps: (1) No IP-based throttling (user can create multiple accounts), (2) Admin endpoints unprotected, (3) Inconsistent 429-equivalent error codes. Allows abuse via account creation spam.","suggested_fix":"Add secondary limiter keyed by IP address (req.rawRequest.ip). Wrap admin callables with rate limiter using admin-tier limits. Standardize all rate-limit errors to return 'resource-exhausted' code with retry-after guidance.","acceptance_tests":["IP-based rate limiting blocks multiple accounts from same IP","Admin endpoints respect rate limits","All rate-limit responses return consistent error code","Load test confirms limits are enforced"],"pr_bucket_suggestion":"security-hardening","dependencies":[],"evidence":["DEBT-0046 from MASTER_DEBT.jsonl","Admin callables have no limiter (both models)","Limiter keyed by userId only; no IP-based throttling (ChatGPT 5.2)"],"notes":"Already tracked in TDMS. Roadmap: Track-S (Security). Higher effort due to IP extraction and testing complexity.","sources":[{"source":"claude-code","file":"code-claude-code.jsonl","original_fingerprint":"Security::functions/src/security-wrapper.ts::security-wrapper::rate-limit-gaps"}],"verified":true,"consensus_score":2,"canonical_id":"CANON-0006","status":"CONFIRMED"}
{"category":"Testing","title":"Zero Component Test Coverage","fingerprint":"Testing::components::all-components::no-component-tests","severity":"S1","effort":"E3","confidence":100,"files":["components/"],"symbols":["*"],"duplication_cluster":{"is_cluster":false,"cluster_summary":"","instances":[]},"why_it_matters":"20+ component directories with 150+ React components have zero test coverage. No automated verification of UI behavior, accessibility, or user interactions. High regression risk when refactoring large components.","suggested_fix":"Start with critical paths: (1) auth-context provider, (2) admin CRUD operations, (3) journal entry creation. Use @testing-library/react with MSW for API mocking. Target 50% coverage for Phase 1. Document testing patterns in TESTING.md.","acceptance_tests":["npm test runs component tests successfully","Critical user flows have test coverage","Tests catch at least one real bug during implementation","CI runs tests on every PR"],"pr_bucket_suggestion":"tests-hardening","dependencies":[],"evidence":["find components -name '*.test.tsx' returns 0 results","package.json shows testing infrastructure exists (node:test, cross-env)","tests/ directory contains 20 files but none for components"],"notes":"Major gap. Aligns with DEBT-0050 (script test coverage). Track A Testing Plan exists in docs/plans/TRACK_A_TESTING_PLAN.md.","sources":[{"source":"claude-code","file":"code-claude-code.jsonl","original_fingerprint":"Testing::components::all-components::no-component-tests"}],"verified":true,"consensus_score":2,"canonical_id":"CANON-0007","status":"CONFIRMED"}
{"category":"AICode","title":"Excessive Cognitive Complexity (40+ files)","fingerprint":"AICode::scripts::multiple-files::cognitive-complexity-pattern","severity":"S1","effort":"E3","confidence":100,"files":["scripts/check-docs-light.js","scripts/validate-audit.js","scripts/phase-complete-check.js","scripts/archive-doc.js","functions/src/security-wrapper.ts","components/notebook/pages/history-page.tsx","components/notebook/pages/resources-page.tsx"],"symbols":["checkDocument","validateS0S1Strict","checkPhaseComplete","archiveDocument","createSecurityWrapper","HistoryPage","ResourcesPage"],"duplication_cluster":{"is_cluster":true,"cluster_summary":"Pattern of deeply nested conditional logic without helper function extraction. 40+ files exceed SonarCloud's cognitive complexity threshold of 15.","instances":[{"file":"scripts/check-docs-light.js","symbol":"checkDocument","complexity":51},{"file":"scripts/validate-audit.js","symbol":"validateS0S1Strict","complexity":34},{"file":"scripts/phase-complete-check.js","symbol":"checkPhaseComplete","complexity":27},{"file":"functions/src/security-wrapper.ts","symbol":"createSecurityWrapper","complexity":39},{"file":"components/notebook/pages/history-page.tsx","symbol":"HistoryPage","complexity":35},{"file":"components/notebook/pages/resources-page.tsx","symbol":"ResourcesPage","complexity":48}]},"why_it_matters":"High cognitive complexity (15+) makes code difficult to understand, test, and debug. Pattern suggests AI-generated code without human refactoring. Increases bug density and maintenance burden.","suggested_fix":"Extract helper functions to reduce nesting. Pattern: (1) Extract validation helpers, (2) Extract conditional branches into named functions, (3) Use early returns to flatten logic. Apply SonarCloud refactoring suggestions already documented in TDMS DEBT-0010 through DEBT-0044.","acceptance_tests":["All affected files reduce complexity to <=15","Functionality unchanged (regression tests pass)","Helper functions have descriptive names","Code coverage maintained or improved"],"pr_bucket_suggestion":"misc","dependencies":[],"evidence":["MASTER_DEBT.jsonl entries DEBT-0010 to DEBT-0044 document 35 cognitive complexity violations","SonarCloud rule typescript:S3776 and javascript:S3776","Grep shows helper function extraction pattern already used in some files (line 97 comment in users-tab.tsx)"],"notes":"This is a cross-cutting pattern, not isolated instances. Shows good intent (helper comment exists) but incomplete application. Roadmap: M2.1 (components), M2.2 (functions), Track-E (scripts).","sources":[{"source":"claude-code","file":"code-claude-code.jsonl","original_fingerprint":"AICode::scripts::multiple-files::cognitive-complexity-pattern"}],"verified":true,"consensus_score":2,"canonical_id":"CANON-0008","status":"CONFIRMED"}
{"category":"Testing","title":"Critical Paths Lack Test Coverage","fingerprint":"Testing::hooks/use-journal.ts::useJournal::critical-path-no-tests","severity":"S1","effort":"E2","confidence":100,"files":["hooks/use-journal.ts","components/providers/auth-context.tsx","components/providers/profile-context.tsx","components/providers/daily-log-context.tsx","lib/auth/account-linking.ts","lib/recaptcha.ts","lib/sentry.client.ts"],"symbols":["useJournal","AuthProvider","ProfileProvider","DailyLogProvider","accountLinking","recaptcha"],"duplication_cluster":{"is_cluster":false,"cluster_summary":null,"instances":[]},"why_it_matters":"Core hooks and providers are untested. use-journal.ts: Core data management hook for all journal CRUD. auth-context.tsx: Anonymous session creation, retry logic, lastActive updates. account-linking.ts: Complex migration logic with data loss risk.","suggested_fix":"Add test files for: use-journal, auth-context, profile-context, daily-log-context, account-linking, recaptcha. Use mocks, not real Firebase. Target >80% coverage for critical paths.","acceptance_tests":["Test files exist for all critical paths","Coverage >80% for hooks and providers","Tests use mocks, not real Firebase","CI runs tests on every PR"],"pr_bucket_suggestion":"tests-hardening","sources":[{"source":"claude","file":"code-claude.jsonl","original_fingerprint":"Testing::hooks/use-journal.ts::useJournal::critical-path-no-tests"}],"verified":true,"consensus_score":2,"canonical_id":"CANON-0009","status":"CONFIRMED"}
{"category":"Hygiene","title":"Oversized UI Components (1,000-2,000+ Lines Each)","fingerprint":"Hygiene::components/admin/users-tab.tsx::UsersTab::oversized-components","severity":"S1","effort":"E2","confidence":100,"files":["components/admin/users-tab.tsx","components/notebook/pages/today-page.tsx","components/admin/errors-tab.tsx","components/admin/dashboard-tab.tsx"],"symbols":["UsersTab","TodayPage","ErrorsTab","DashboardTab"],"duplication_cluster":{"is_cluster":false,"cluster_summary":null,"instances":[]},"why_it_matters":"Four files exceed 1,000 lines each. users-tab.tsx (2,092 lines) contains 10 getFunctions() calls, multiple state variables, complex filtering logic. Hard to understand, modify, and test.","suggested_fix":"Extract sub-components and hooks. users-tab.tsx -> UserFilters, UserTable, UserDetailModal, UserEditForm, useUserManagement hook. today-page.tsx -> JournalTextarea, MoodSelector, CravingsToggle, useTodayLog hook.","acceptance_tests":["Components render without errors","Functionality unchanged","Main components <200 lines each","No console errors during interactions"],"pr_bucket_suggestion":"misc","sources":[{"source":"claude","file":"code-claude.jsonl","original_fingerprint":"Hygiene::components/admin/users-tab.tsx::UsersTab::oversized-components"}],"verified":true,"consensus_score":2,"canonical_id":"CANON-0010","status":"CONFIRMED"}
{"category":"Security","title":"Inconsistent Admin Write Patterns (Cloud Functions vs Direct Writes)","fingerprint":"Security::components/admin/admin-crud-table.tsx::AdminCrudTable::inconsistent-write-patterns","severity":"S1","effort":"E1","confidence":100,"files":["components/admin/meetings-tab.tsx","components/admin/sober-living-tab.tsx","components/admin/quotes-tab.tsx","components/admin/glossary-tab.tsx","components/admin/slogans-tab.tsx","components/admin/admin-crud-table.tsx"],"symbols":["AdminCrudTable","cloudFunctions","service"],"duplication_cluster":{"is_cluster":false,"cluster_summary":null,"instances":[]},"why_it_matters":"AdminCrudTable accepts either cloudFunctions or service config. Meetings use Cloud Functions, others use direct client writes. Firestore rules allow admin writes for quotes/glossary/slogans but not sober_living. Inconsistent security model.","suggested_fix":"Standardize on Cloud Functions for all admin writes. Create Cloud Functions for quotes, glossary, slogans (or document why direct writes are acceptable). Update all admin tabs to use cloudFunctions config.","acceptance_tests":["All admin tabs use consistent write pattern","Firestore rules match code behavior","Security model documented and enforced"],"pr_bucket_suggestion":"security-hardening","sources":[{"source":"claude","file":"code-claude.jsonl","original_fingerprint":"Security::components/admin/admin-crud-table.tsx::AdminCrudTable::inconsistent-write-patterns"}],"verified":true,"consensus_score":2,"canonical_id":"CANON-0011","status":"CONFIRMED"}
{"category":"Security","title":"Firebase App Check is disabled in client initialization path","fingerprint":"Security::lib/firebase.ts::initializeFirebase::appcheck_disabled","severity":"S1","effort":"E1","confidence":96,"files":["lib/firebase.ts"],"symbols":["initializeFirebase","getFirebase"],"duplication_cluster":{"is_cluster":false,"cluster_summary":"","instances":[]},"why_it_matters":"Cloud Functions and Firestore rely on layered abuse controls; shipping with App Check disabled weakens bot/automation resistance.","suggested_fix":"Re-enable App Check initialization with environment-gated debug behavior and sanitized logging for failures.","acceptance_tests":["npm test","npm run lint","Verify Cloud Function requests include App Check token in production-like run"],"pr_bucket_suggestion":"security-hardening","dependencies":[],"evidence":["App Check initialization is commented out while appCheck remains part of firebase surface."],"sources":[{"source":"codex","file":"code-codex.jsonl","original_fingerprint":"Security::lib/firebase.ts::initializeFirebase::appcheck_disabled"}],"verified":true,"consensus_score":2,"canonical_id":"CANON-0012","status":"CONFIRMED"}
{"category":"Framework","title":"Client Sentry module imports Node crypto API","fingerprint":"Framework::lib/sentry.client.ts::hashUserId::node_crypto_in_client","severity":"S1","effort":"E1","confidence":94,"files":["lib/sentry.client.ts","components/providers/auth-context.tsx","components/providers/sentry-initializer.tsx"],"symbols":["hashUserId","setSentryUser","SentryInitializer"],"duplication_cluster":{"is_cluster":false,"cluster_summary":"","instances":[]},"why_it_matters":"A browser-executed module importing node:crypto can break client bundling/runtime compatibility.","suggested_fix":"Replace createHash with Web Crypto (crypto.subtle.digest) or another browser-safe hashing utility.","acceptance_tests":["npm run build","npm test","Manual browser verification of Sentry user tagging"],"pr_bucket_suggestion":"boundaries","dependencies":[],"evidence":["lib/sentry.client.ts imports createHash from node:crypto; client providers import and call this module."],"sources":[{"source":"codex","file":"code-codex.jsonl","original_fingerprint":"Framework::lib/sentry.client.ts::hashUserId::node_crypto_in_client"}],"verified":true,"consensus_score":2,"canonical_id":"CANON-0013","status":"CONFIRMED"}
{"category":"Security","title":"Sentry DSN, Firebase API key, and reCAPTCHA site key committed in .env.production","fingerprint":"Security::.env.production::NEXT_PUBLIC_SENTRY_DSN::secrets-in-env-production","severity":"S1","effort":"E1","confidence":100,"files":[".env.production"],"symbols":["NEXT_PUBLIC_SENTRY_DSN","NEXT_PUBLIC_FIREBASE_API_KEY","NEXT_PUBLIC_FIREBASE_APP_ID","NEXT_PUBLIC_FIREBASE_APPCHECK_RECAPTCHA_SITE_KEY"],"duplication_cluster":{"is_cluster":false},"why_it_matters":"The .env.production file is checked into Git and contains the Sentry DSN (which allows sending arbitrary error data to your Sentry project), Firebase API key, App ID, reCAPTCHA site key, and messaging sender ID. While Firebase API keys are designed to be public and restricted via App Check/rules, the Sentry DSN allows anyone to send events to your Sentry project, consuming quota or polluting data. All these values are in version history permanently.","suggested_fix":"Move secrets to CI environment variables or GitHub Actions secrets. For Sentry DSN specifically, restrict the DSN via Sentry's inbound filter settings. Consider adding .env.production to .gitignore and using GitHub secrets for build-time injection.","acceptance_tests":["Verify .env.production is not committed in future pushes","Verify build still works with env vars injected at build time","Verify Sentry DSN is restricted via Sentry project settings"],"pr_bucket_suggestion":"security-hardening","dependencies":[],"evidence":[".env.production lines 5-21: contains NEXT_PUBLIC_FIREBASE_API_KEY=AIzaSyDGvM5kFwkgSTUS..., NEXT_PUBLIC_SENTRY_DSN=https://f585a8353ec50d104e5484fedca6c2f2@..."],"notes":"Firebase API keys are restricted by App Check/Firestore rules, so exposure is low-risk. Sentry DSN is higher risk.","sources":[{"source":"copilot","file":"code-copilot.jsonl","original_fingerprint":"Security::.env.production::NEXT_PUBLIC_SENTRY_DSN::secrets-in-env-production"}],"verified":true,"consensus_score":2,"canonical_id":"CANON-0014","status":"CONFIRMED"}
{"category":"Security","title":"App Check is entirely disabled on client and server","fingerprint":"Security::lib/firebase.ts::initializeFirebase::appcheck-disabled","severity":"S1","effort":"E2","confidence":100,"files":["lib/firebase.ts","functions/src/index.ts"],"symbols":["initializeFirebase","_appCheck","saveDailyLog"],"duplication_cluster":{"is_cluster":false},"why_it_matters":"The entire App Check initialization block in lib/firebase.ts is commented out (lines 57-90), and server-side requireAppCheck is set to false. This means there is NO attestation layer verifying that requests come from your legitimate app. Any attacker can call your Cloud Functions directly using the public Firebase config. Disabled since Dec 31, 2025 — 5+ weeks past stated re-enable date.","suggested_fix":"Re-enable App Check on both client (lib/firebase.ts) and server (requireAppCheck: true in functions/src/index.ts). Test with debug token in development.","acceptance_tests":["App Check tokens are attached to Cloud Function calls","Requests without valid App Check tokens are rejected","Legitimate app usage still works"],"pr_bucket_suggestion":"security-hardening","dependencies":[],"evidence":["lib/firebase.ts:57-90 — entire App Check block is /* commented out */","functions/src/index.ts — requireAppCheck: false"],"notes":"","sources":[{"source":"copilot","file":"code-copilot.jsonl","original_fingerprint":"Security::lib/firebase.ts::initializeFirebase::appcheck-disabled"}],"verified":true,"consensus_score":2,"canonical_id":"CANON-0015","status":"CONFIRMED"}
{"category":"Framework","title":"OfflineIndicator uses navigator.onLine in useState initializer without SSR guard","fingerprint":"Framework::components/status/offline-indicator.tsx::OfflineIndicator::ssr-navigator-access","severity":"S1","effort":"E0","confidence":100,"files":["components/status/offline-indicator.tsx"],"symbols":["OfflineIndicator"],"duplication_cluster":{"is_cluster":false},"why_it_matters":"Line 7: useState(() => navigator.onLine) — navigator is not available during SSR. This will throw ReferenceError: navigator is not defined.","suggested_fix":"Use a safe default: useState(true) and update in useEffect.","acceptance_tests":["Component renders without error during SSR","Online/offline detection works correctly in browser"],"pr_bucket_suggestion":"boundaries","dependencies":[],"evidence":["components/status/offline-indicator.tsx:7 — const [isOnline, setIsOnline] = useState(() => navigator.onLine);"],"notes":"","sources":[{"source":"copilot","file":"code-copilot.jsonl","original_fingerprint":"Framework::components/status/offline-indicator.tsx::OfflineIndicator::ssr-navigator-access"}],"verified":true,"consensus_score":2,"canonical_id":"CANON-0016","status":"CONFIRMED"}
{"category":"Security","title":"Firestore rules may not cover worksheets subcollection","fingerprint":"Security::firestore.rules::worksheets::missing-rules","severity":"S1","effort":"E0","confidence":35,"files":["firestore.rules","lib/db/collections.ts"],"symbols":["COLLECTIONS","userWorksheets"],"duplication_cluster":{"is_cluster":false},"why_it_matters":"COLLECTIONS.userWorksheets generates paths like 'users/{uid}/worksheets' but the visible portion of firestore.rules only explicitly covers journal, daily_logs, inventoryEntries, and journalEntries subcollections. If worksheets is not covered, it may be either fully open or fully closed by default.","suggested_fix":"Verify worksheets collection has explicit rules. Add rules if missing.","acceptance_tests":["Firestore rules explicitly cover worksheets subcollection"],"pr_bucket_suggestion":"security-hardening","dependencies":[],"evidence":["firestore.rules visible portion: only 4 subcollections explicitly listed"],"notes":"Could not see full firestore.rules file — may have wildcard catch-all.","sources":[{"source":"copilot-suspected","file":"code-copilot-suspected.jsonl","original_fingerprint":"Security::firestore.rules::worksheets::missing-rules"}],"verified":true,"consensus_score":1.5,"canonical_id":"CANON-0017","status":"SUSPECTED"}
{"category":"AICode","title":"AI Health Score Analysis","fingerprint":"AICode::project::sonash-v0::ai-health-metrics","severity":"S1","effort":"E0","confidence":75,"files":[],"symbols":[],"duplication_cluster":{"is_cluster":false,"cluster_summary":"","instances":[]},"why_it_matters":"Assessing codebase AI generation quality to identify systematic improvements needed in AI-assisted development workflow. Low score indicates need for human refactoring pass after AI generation.","suggested_fix":"Document AI code review checklist: (1) Refactor functions >50 lines, (2) Extract helpers for cognitive complexity >15, (3) Add tests for new components, (4) Verify types (no any), (5) Check boundaries (use client placement). Apply before committing AI-generated code.","acceptance_tests":["AI Health Score improves to >75 in next audit","God objects (>500 lines) reduced by 50%","Cognitive complexity violations reduced by 30%","Component test coverage >30%"],"pr_bucket_suggestion":"misc","dependencies":["FINDING-001","FINDING-002","FINDING-010"],"evidence":["Hallucination Rate: 0% (no node_modules imports found, all imports valid)","Test Validity: 0% component tests (20 test files but none for components)","Error Handling: ~70% (logger used, try/catch present, but some gaps)","Consistency Score: 60% (patterns exist but incomplete application)","Documentation Drift: Unknown (requires separate audit)"],"notes":"AI Health Score (weighted): ~45/100. Breakdown: Hallucination (30% weight) = 30/30, Test Validity (25% weight) = 0/25, Error Handling (20% weight) = 14/20, Consistency (15% weight) = 9/15, Docs (10% weight) = 0/10 (not assessed). Score indicates good AI foundations but needs human review pass.","sources":[{"source":"claude-code","file":"code-claude-code.jsonl","original_fingerprint":"AICode::project::sonash-v0::ai-health-metrics"}],"consensus_score":1,"canonical_id":"CANON-0018","status":"SUSPECTED"}
{"category":"Types","title":"Type Safety: `any` type in today-page.tsx","fingerprint":"Types::components/notebook/pages/today-page.tsx::handleSnapshotUpdate::any-type","severity":"S2","effort":"E0","confidence":100,"files":["components/notebook/pages/today-page.tsx"],"symbols":["handleSnapshotUpdate"],"duplication_cluster":{"is_cluster":false,"cluster_summary":"","instances":[]},"why_it_matters":"Using `any` defeats TypeScript's type checking. Function receives Firestore DocumentSnapshot but types it as `any`, allowing unsafe property access without compile-time validation.","suggested_fix":"Replace `(docSnap: any, isMounted: boolean)` with proper Firestore type: `(docSnap: DocumentSnapshot<JournalEntryData>, isMounted: boolean)`. Import DocumentSnapshot from firebase/firestore and define JournalEntryData interface.","acceptance_tests":["TypeScript compiles without errors","IDE autocomplete works for docSnap properties","Runtime behavior unchanged"],"pr_bucket_suggestion":"types-domain","dependencies":[],"evidence":["Line 507: `(docSnap: any, isMounted: boolean) => {`","Function accesses docSnap.exists() and docSnap.data() without type safety"],"notes":"Low-hanging fruit. Quick fix with immediate safety improvement.","sources":[{"source":"claude-code","file":"code-claude-code.jsonl","original_fingerprint":"Types::components/notebook/pages/today-page.tsx::handleSnapshotUpdate::any-type"},{"source":"claude","file":"code-claude.jsonl","original_fingerprint":"Types::components/notebook/pages/today-page.tsx::handleSnapshotUpdate::any-type"}],"merged_from":["Types::components/notebook/pages/today-page.tsx::handleSnapshotUpdate::any-type","Types::components/notebook/pages/today-page.tsx::handleSnapshotUpdate::any-type"],"verified":true,"consensus_score":3,"canonical_id":"CANON-0019","status":"CONFIRMED"}
{"category":"Security","title":"Direct Firestore Write in auth-context.tsx","fingerprint":"Security::components/providers/auth-context.tsx::AuthProvider::direct-firestore-write","severity":"S2","effort":"E1","confidence":95,"files":["components/providers/auth-context.tsx"],"symbols":["AuthProvider","updateDoc"],"duplication_cluster":{"is_cluster":false,"cluster_summary":"","instances":[]},"why_it_matters":"Direct updateDoc call in client code (line 103) updates users collection, bypassing Cloud Function security layer. While lastActive timestamp is low-risk, it sets a precedent for direct writes and could bypass future validation logic.","suggested_fix":"Create Cloud Function `updateUserActivity` that verifies user identity and updates lastActive. Call via httpsCallable from auth-context. Alternatively, document explicit exception in SECURITY.md if this pattern is intentionally allowed for performance.","acceptance_tests":["lastActive timestamp still updates on user activity","Firestore rules still block unauthorized updates","No performance regression (measure with console.time)","Security audit passes with documented exception if keeping direct write"],"pr_bucket_suggestion":"firebase-access","dependencies":[],"evidence":["Line 103-105: await updateDoc(doc(db, 'users', currentUser.uid), { lastActive: serverTimestamp() })","claude.md Section 2 states: 'NO DIRECT WRITES to journal, daily_logs, inventoryEntries'","Pattern differs from established httpsCallable approach used elsewhere"],"notes":"Low severity because lastActive is non-sensitive and user-scoped. However, inconsistent with stated architecture pattern.","sources":[{"source":"claude-code","file":"code-claude-code.jsonl","original_fingerprint":"Security::components/providers/auth-context.tsx::AuthProvider::direct-firestore-write"},{"source":"claude","file":"code-claude.jsonl","original_fingerprint":"Security::components/providers/auth-context.tsx::updateDoc::direct-firestore-write"}],"merged_from":["Security::components/providers/auth-context.tsx::AuthProvider::direct-firestore-write","Security::components/providers/auth-context.tsx::updateDoc::direct-firestore-write"],"verified":true,"consensus_score":3,"canonical_id":"CANON-0020","status":"CONFIRMED"}
{"category":"Framework","title":"Boundary Violation: 'use client' in lib/contexts","fingerprint":"Framework::lib/contexts/admin-tab-context.tsx::admin-tab-context::misplaced-use-client","severity":"S2","effort":"E0","confidence":100,"files":["lib/contexts/admin-tab-context.tsx"],"symbols":["admin-tab-context"],"duplication_cluster":{"is_cluster":false,"cluster_summary":"","instances":[]},"why_it_matters":"'use client' directive in lib/ violates Next.js 13+ architecture. Contexts should live in components/providers/ to maintain clear Server/Client boundary. Makes it harder to understand what code runs where.","suggested_fix":"Move lib/contexts/admin-tab-context.tsx to components/providers/admin-tab-provider.tsx. Update imports across codebase. Follow established pattern used by components/providers/auth-context.tsx.","acceptance_tests":["Admin tabs render correctly","State persists across tab switches","No hydration errors in console","grep confirms no remaining lib/contexts/ files with 'use client'"],"pr_bucket_suggestion":"boundaries","dependencies":[],"evidence":["lib/contexts/admin-tab-context.tsx:1 contains 'use client'","grep shows this is the only lib/ file with 'use client'","components/providers/ exists with proper client boundary files"],"notes":"Architectural hygiene. Prevents future confusion about Server vs Client components.","sources":[{"source":"claude-code","file":"code-claude-code.jsonl","original_fingerprint":"Framework::lib/contexts/admin-tab-context.tsx::admin-tab-context::misplaced-use-client"}],"verified":true,"consensus_score":2,"canonical_id":"CANON-0021","status":"CONFIRMED"}
{"category":"Security","title":"App Check Completely Disabled Across Entire Stack","fingerprint":"Security::functions/src/index.ts::requireAppCheck::app-check-disabled","severity":"S0","effort":"E1","confidence":100,"files":["functions/src/index.ts","lib/firebase.ts"],"symbols":["requireAppCheck","initializeAppCheck"],"duplication_cluster":{"is_cluster":false,"cluster_summary":null,"instances":[]},"why_it_matters":"All Cloud Functions have requireAppCheck: false with comment 'TEMPORARILY DISABLED'. Client-side initialization also commented out. This disables bot protection across all user data writes (journal, daily logs, inventory).","suggested_fix":"Re-enable App Check in lib/firebase.ts (uncomment initialization). Set requireAppCheck: true in all Cloud Functions. Verify reCAPTCHA site key is configured. Test with debug token in development.","acceptance_tests":["App Check enforced on all Cloud Functions","reCAPTCHA site key configured in production","Debug token works in development","Automated requests without App Check token are rejected"],"pr_bucket_suggestion":"security-hardening","sources":[{"source":"claude","file":"code-claude.jsonl","original_fingerprint":"Security::functions/src/index.ts::requireAppCheck::app-check-disabled"}],"verified":true,"consensus_score":2,"canonical_id":"CANON-0022","status":"CONFIRMED"}
{"category":"Security","title":"Sober Living Admin Tab Silently Fails All Writes","fingerprint":"Security::components/admin/sober-living-tab.tsx::SoberLivingService::silent-write-failure","severity":"S0","effort":"E0","confidence":100,"files":["components/admin/sober-living-tab.tsx","lib/db/sober-living.ts"],"symbols":["soberLivingConfig","SoberLivingService"],"duplication_cluster":{"is_cluster":false,"cluster_summary":null,"instances":[]},"why_it_matters":"Admin tab uses direct client-side writes via SoberLivingService, but Firestore rules block ALL writes: 'allow write: if false'. Cloud Functions adminSaveSoberLiving and adminDeleteSoberLiving exist but are not wired to the UI.","suggested_fix":"Update soberLivingConfig in sober-living-tab.tsx to use cloudFunctions config with saveFunctionName: 'adminSaveSoberLiving' and deleteFunctionName: 'adminDeleteSoberLiving'. Remove service: soberLivingServiceAdapter line.","acceptance_tests":["Sober living CRUD operations succeed in admin panel","Firestore rules remain restrictive (allow write: if false)","Cloud Functions used for all sober-living writes"],"pr_bucket_suggestion":"security-hardening","sources":[{"source":"claude","file":"code-claude.jsonl","original_fingerprint":"Security::components/admin/sober-living-tab.tsx::SoberLivingService::silent-write-failure"}],"verified":true,"consensus_score":2,"canonical_id":"CANON-0023","status":"CONFIRMED"}
{"category":"Hygiene","title":"Duplicate Quote Widget Components (3 Variants)","fingerprint":"Hygiene::components/widgets/daily-quote-card.tsx::DailyQuoteCard::duplicate-quote-widgets","severity":"S2","effort":"E1","confidence":100,"files":["components/widgets/daily-quote-card.tsx","components/widgets/compact-daily-quote.tsx","components/notebook/features/daily-quote-card.tsx"],"symbols":["DailyQuoteCard","CompactDailyQuote"],"duplication_cluster":{"is_cluster":true,"cluster_summary":"Three separate components for displaying daily quotes with different styling","instances":[{"file":"components/widgets/daily-quote-card.tsx","symbol":"DailyQuoteCard"},{"file":"components/widgets/compact-daily-quote.tsx","symbol":"CompactDailyQuote"},{"file":"components/notebook/features/daily-quote-card.tsx","symbol":"DailyQuoteCard"}]},"why_it_matters":"Three separate components for displaying daily quotes. All use useDailyQuote() hook but have different styling. daily-quote-card.tsx exists in two locations with different implementations.","suggested_fix":"Consolidate into single DailyQuoteCard component with variant prop ('default' | 'compact' | 'sticky-note'). Keep in components/widgets/daily-quote-card.tsx, delete duplicates.","acceptance_tests":["Single quote component with variant prop","All quote display contexts use unified component","No duplicate implementations"],"pr_bucket_suggestion":"ui-primitives","sources":[{"source":"claude","file":"code-claude.jsonl","original_fingerprint":"Hygiene::components/widgets/daily-quote-card.tsx::DailyQuoteCard::duplicate-quote-widgets"}],"verified":true,"consensus_score":2,"canonical_id":"CANON-0024","status":"CONFIRMED"}
{"category":"Hygiene","title":"Duplicate Mood Selector Components (2 Variants)","fingerprint":"Hygiene::components/notebook/features/mood-selector.tsx::MoodSelector::duplicate-mood-selectors","severity":"S2","effort":"E1","confidence":100,"files":["components/notebook/features/mood-selector.tsx","components/notebook/features/enhanced-mood-selector.tsx"],"symbols":["MoodSelector","EnhancedMoodSelector"],"duplication_cluster":{"is_cluster":true,"cluster_summary":"Two mood selector implementations with different feature sets","instances":[{"file":"components/notebook/features/mood-selector.tsx","symbol":"MoodSelector"},{"file":"components/notebook/features/enhanced-mood-selector.tsx","symbol":"EnhancedMoodSelector"}]},"why_it_matters":"Two mood selector implementations. enhanced-mood-selector.tsx has additional features but both are actively used in different contexts. Inconsistent mood selection UX.","suggested_fix":"Merge into single component with feature flags or consolidate on enhanced version.","acceptance_tests":["Single mood selector component","Consistent UX across all contexts","No duplicate implementations"],"pr_bucket_suggestion":"ui-primitives","sources":[{"source":"claude","file":"code-claude.jsonl","original_fingerprint":"Hygiene::components/notebook/features/mood-selector.tsx::MoodSelector::duplicate-mood-selectors"}],"verified":true,"consensus_score":2,"canonical_id":"CANON-0025","status":"CONFIRMED"}
{"category":"Hygiene","title":"Duplicate Meeting Countdown Widgets (2 Variants)","fingerprint":"Hygiene::components/widgets/meeting-countdown.tsx::MeetingCountdown::duplicate-countdown-widgets","severity":"S2","effort":"E1","confidence":100,"files":["components/widgets/meeting-countdown.tsx","components/widgets/compact-meeting-countdown.tsx"],"symbols":["MeetingCountdown","CompactMeetingCountdown"],"duplication_cluster":{"is_cluster":true,"cluster_summary":"Two meeting countdown implementations with misleading naming (compact is larger)","instances":[{"file":"components/widgets/meeting-countdown.tsx","symbol":"MeetingCountdown"},{"file":"components/widgets/compact-meeting-countdown.tsx","symbol":"CompactMeetingCountdown"}]},"why_it_matters":"Two meeting countdown implementations. 'Compact' version is actually larger (316 vs 90 lines), suggesting feature creep. Code duplication and confusing naming.","suggested_fix":"Consolidate with variant prop or rename to reflect actual complexity.","acceptance_tests":["Single countdown component with variant prop","Naming matches actual complexity","No duplicate implementations"],"pr_bucket_suggestion":"ui-primitives","sources":[{"source":"claude","file":"code-claude.jsonl","original_fingerprint":"Hygiene::components/widgets/meeting-countdown.tsx::MeetingCountdown::duplicate-countdown-widgets"}],"verified":true,"consensus_score":2,"canonical_id":"CANON-0026","status":"CONFIRMED"}
{"category":"Hygiene","title":"Redundant getFunctions() Calls (28+ Across Admin Components)","fingerprint":"Hygiene::components/admin::getFunctions::redundant-getfunctions-calls","severity":"S2","effort":"E0","confidence":100,"files":["components/admin/users-tab.tsx","components/admin/dashboard-tab.tsx","components/admin/jobs-tab.tsx","components/admin/errors-tab.tsx","components/admin/admin-crud-table.tsx"],"symbols":["getFunctions"],"duplication_cluster":{"is_cluster":false,"cluster_summary":null,"instances":[]},"why_it_matters":"28+ getFunctions() calls across admin components. Each call creates a new Functions instance unnecessarily. Harder to mock in tests.","suggested_fix":"Create lib/admin-functions.ts exporting a singleton: export const adminFunctions = getFunctions(). Import and use throughout admin components.","acceptance_tests":["Single getFunctions() call via singleton","All admin components import from lib/admin-functions.ts","Tests can mock single import"],"pr_bucket_suggestion":"misc","sources":[{"source":"claude","file":"code-claude.jsonl","original_fingerprint":"Hygiene::components/admin::getFunctions::redundant-getfunctions-calls"}],"verified":true,"consensus_score":2,"canonical_id":"CANON-0027","status":"CONFIRMED"}
{"category":"Debugging","title":"Network Status Not Captured in Error Logs","fingerprint":"Debugging::lib/logger.ts::logger::no-network-status-in-errors","severity":"S2","effort":"E0","confidence":100,"files":["components/status/offline-indicator.tsx","lib/logger.ts","lib/utils/errors.ts"],"symbols":["OfflineIndicator","logger"],"duplication_cluster":{"is_cluster":false,"cluster_summary":null,"instances":[]},"why_it_matters":"OfflineIndicator component tracks navigator.onLine, but error logs don't capture network status. When errors occur, offline vs online context is unknown. Cannot distinguish network errors from application errors.","suggested_fix":"Add networkStatus: navigator.onLine to all error logs in lib/logger.ts.","acceptance_tests":["Error logs include network status","Offline errors distinguishable from application errors","Logger enriches all error entries with navigator.onLine"],"pr_bucket_suggestion":"debugging","sources":[{"source":"claude","file":"code-claude.jsonl","original_fingerprint":"Debugging::lib/logger.ts::logger::no-network-status-in-errors"}],"verified":true,"consensus_score":2,"canonical_id":"CANON-0028","status":"CONFIRMED"}
{"category":"Hygiene","title":"Inconsistent lib/db/ Write Patterns","fingerprint":"Hygiene::lib/db::write-methods::inconsistent-write-patterns","severity":"S2","effort":"E1","confidence":100,"files":["lib/db/sober-living.ts","lib/db/glossary.ts","lib/db/quotes.ts","lib/db/slogans.ts","lib/db/library.ts","lib/db/users.ts"],"symbols":["SoberLivingService","GlossaryService","QuotesService","SlogansService"],"duplication_cluster":{"is_cluster":false,"cluster_summary":null,"instances":[]},"why_it_matters":"Some lib/db/ modules have write operations that Firestore rules block (sober-living), others are allowed (quotes, glossary). Creates confusion about which writes are permitted.","suggested_fix":"Document which lib/db/ writes are permitted and why. Mark blocked methods with @deprecated JSDoc. Consider removing write methods from lib/db/sober-living.ts.","acceptance_tests":["Write patterns documented","Blocked methods marked @deprecated","Developers can determine permitted writes from code"],"pr_bucket_suggestion":"misc","sources":[{"source":"claude","file":"code-claude.jsonl","original_fingerprint":"Hygiene::lib/db::write-methods::inconsistent-write-patterns"}],"verified":true,"consensus_score":2,"canonical_id":"CANON-0029","status":"CONFIRMED"}
{"category":"AICode","title":"Anonymous-data migration flow duplicated across email and Google linking","fingerprint":"AICode::lib/auth/account-linking.ts::linkWithEmail::duplicated_migration_flow","severity":"S2","effort":"E2","confidence":91,"files":["lib/auth/account-linking.ts"],"symbols":["linkWithEmail","linkWithGoogle"],"duplication_cluster":{"is_cluster":true,"cluster_summary":"Both account-link flows repeat recaptcha + callable + retry + migration logging steps.","instances":[{"file":"lib/auth/account-linking.ts","symbol":"linkWithEmail"},{"file":"lib/auth/account-linking.ts","symbol":"linkWithGoogle"}]},"why_it_matters":"Security-sensitive duplicated logic tends to diverge, increasing migration regressions.","suggested_fix":"Extract a shared migration helper with typed input/output and centralized error mapping.","acceptance_tests":["npm test","Add unit tests for migration helper success/failure","Verify both linking paths route through helper"],"pr_bucket_suggestion":"hooks-standardization","dependencies":[],"evidence":["Near-identical migration blocks in both link flows."],"sources":[{"source":"codex","file":"code-codex.jsonl","original_fingerprint":"AICode::lib/auth/account-linking.ts::linkWithEmail::duplicated_migration_flow"}],"verified":true,"consensus_score":2,"canonical_id":"CANON-0030","status":"CONFIRMED"}
{"category":"Hygiene","title":"Repeated stale-request guard pattern in admin async panels","fingerprint":"Hygiene::components/admin/errors-tab.tsx::UserActivityModal::stale_request_guard_duplication","severity":"S2","effort":"E1","confidence":89,"files":["components/admin/errors-tab.tsx","components/admin/jobs-tab.tsx"],"symbols":["UserActivityModal","JobRunHistoryPanel"],"duplication_cluster":{"is_cluster":true,"cluster_summary":"Both components implement requestIdRef + mounted checks + guarded finally loading updates.","instances":[{"file":"components/admin/errors-tab.tsx","symbol":"UserActivityModal"},{"file":"components/admin/jobs-tab.tsx","symbol":"JobRunHistoryPanel"}]},"why_it_matters":"Copy/paste async race logic is easy to drift and harder to prove correct in all panels.","suggested_fix":"Introduce a reusable hook for stale-response suppression and mounted-state safe updates.","acceptance_tests":["npm test","Manual rapid filter/switch testing in both panels"],"pr_bucket_suggestion":"hooks-standardization","dependencies":[],"evidence":["Matching async request guard structures across both admin components."],"sources":[{"source":"codex","file":"code-codex.jsonl","original_fingerprint":"Hygiene::components/admin/errors-tab.tsx::UserActivityModal::stale_request_guard_duplication"}],"verified":true,"consensus_score":2,"canonical_id":"CANON-0031","status":"CONFIRMED"}
{"category":"Framework","title":"Today page bypasses service/repository boundary with direct Firestore querying","fingerprint":"Framework::components/notebook/pages/today-page.tsx::calculateWeeklyStats::service_boundary_bypass","severity":"S2","effort":"E1","confidence":93,"files":["components/notebook/pages/today-page.tsx","lib/firestore-service.ts"],"symbols":["calculateWeeklyStats","FirestoreService"],"duplication_cluster":{"is_cluster":false,"cluster_summary":"","instances":[]},"why_it_matters":"Mixing direct DB reads in UI with service-layer access elsewhere creates architecture drift and harder security/consistency updates.","suggested_fix":"Move weekly stats query into FirestoreService (or dedicated stats service) and consume typed results in component.","acceptance_tests":["npm test","Add tests for new stats service method","Verify component no longer imports Firestore query helpers"],"pr_bucket_suggestion":"boundaries","dependencies":[],"evidence":["calculateWeeklyStats dynamically imports and executes Firestore collection/query/getDocs logic directly."],"sources":[{"source":"codex","file":"code-codex.jsonl","original_fingerprint":"Framework::components/notebook/pages/today-page.tsx::calculateWeeklyStats::service_boundary_bypass"}],"verified":true,"consensus_score":2,"canonical_id":"CANON-0032","status":"CONFIRMED"}
{"category":"Debugging","title":"High-volume console logging in journal save/stats paths","fingerprint":"Debugging::components/notebook/pages/today-page.tsx::performSave::console_log_spam_sensitive_context","severity":"S2","effort":"E0","confidence":90,"files":["components/notebook/pages/today-page.tsx","lib/firestore-service.ts"],"symbols":["performSave","calculateWeeklyStats","saveDailyLog"],"duplication_cluster":{"is_cluster":true,"cluster_summary":"Multiple development-only console.log/debug blocks in critical journaling flows.","instances":[{"file":"components/notebook/pages/today-page.tsx","symbol":"performSave"},{"file":"components/notebook/pages/today-page.tsx","symbol":"calculateWeeklyStats"},{"file":"lib/firestore-service.ts","symbol":"saveDailyLog"}]},"why_it_matters":"Debug signal gets noisy and sensitive journaling metadata may leak in shared consoles/screenshots.","suggested_fix":"Route debug traces through structured logger with one feature flag and default redaction.","acceptance_tests":["npm run lint","Verify target symbols no longer use direct console.log","Manual save/stats debug validation through logger"],"pr_bucket_suggestion":"misc","dependencies":[],"evidence":["Scoped grep found 19 console.log occurrences; several are in these symbols."],"sources":[{"source":"codex","file":"code-codex.jsonl","original_fingerprint":"Debugging::components/notebook/pages/today-page.tsx::performSave::console_log_spam_sensitive_context"}],"verified":true,"consensus_score":2,"canonical_id":"CANON-0033","status":"CONFIRMED"}
{"category":"Debugging","title":"Sentry initializer swallows initialization errors","fingerprint":"Debugging::components/providers/sentry-initializer.tsx::SentryInitializer::swallowed_init_error","severity":"S2","effort":"E0","confidence":95,"files":["components/providers/sentry-initializer.tsx"],"symbols":["SentryInitializer"],"duplication_cluster":{"is_cluster":false,"cluster_summary":"","instances":[]},"why_it_matters":"If monitoring boot fails silently, you lose observability and root-cause context.","suggested_fix":"Log sanitized error context or emit fallback breadcrumb before reset/retry behavior.","acceptance_tests":["npm test","Simulate init failure and confirm sanitized diagnostics are emitted"],"pr_bucket_suggestion":"misc","dependencies":[],"evidence":["catch block resets flag but provides no logging or rethrow."],"sources":[{"source":"codex","file":"code-codex.jsonl","original_fingerprint":"Debugging::components/providers/sentry-initializer.tsx::SentryInitializer::swallowed_init_error"}],"verified":true,"consensus_score":2,"canonical_id":"CANON-0034","status":"CONFIRMED"}
{"category":"Types","title":"Firestore documents are cast to domain type without runtime validation","fingerprint":"Types::lib/firestore-service.ts::getTodayLog::unsafe_firestore_cast","severity":"S2","effort":"E1","confidence":88,"files":["lib/firestore-service.ts"],"symbols":["getTodayLog","getHistory"],"duplication_cluster":{"is_cluster":false,"cluster_summary":"","instances":[]},"why_it_matters":"Unsafe casts can pass malformed DB payloads downstream and fail in less obvious places.","suggested_fix":"Validate doc payloads with schema/type guards before returning typed domain objects.","acceptance_tests":["npm test","Add tests for malformed docs handling"],"pr_bucket_suggestion":"types-domain","dependencies":[],"evidence":["docSnap.data() and history doc.data() are cast to DailyLog without validation."],"sources":[{"source":"codex","file":"code-codex.jsonl","original_fingerprint":"Types::lib/firestore-service.ts::getTodayLog::unsafe_firestore_cast"}],"verified":true,"consensus_score":2,"canonical_id":"CANON-0035","status":"CONFIRMED"}
{"category":"Testing","title":"Coverage gaps remain in critical firebase/auth/firestore paths","fingerprint":"Testing::lib/firestore-service.ts::saveDailyLog::critical_path_coverage_gap","severity":"S2","effort":"E2","confidence":86,"files":["lib/firestore-service.ts","lib/firebase.ts","lib/auth/account-linking.ts"],"symbols":["saveDailyLog","initializeFirebase","linkWithEmail"],"duplication_cluster":{"is_cluster":false,"cluster_summary":"","instances":[]},"why_it_matters":"Low coverage in security-sensitive and data-write paths increases regression risk.","suggested_fix":"Add targeted tests for firebase init guard behavior, callable write flows, and migration edge cases.","acceptance_tests":["npm run test:coverage","Introduce per-file threshold ratcheting"],"pr_bucket_suggestion":"tests-hardening","dependencies":[],"evidence":["Coverage run reports low line coverage for firebase and firestore-service outputs."],"sources":[{"source":"codex","file":"code-codex.jsonl","original_fingerprint":"Testing::lib/firestore-service.ts::saveDailyLog::critical_path_coverage_gap"}],"verified":true,"consensus_score":2,"canonical_id":"CANON-0036","status":"CONFIRMED"}
{"category":"AICode","title":"Functions code imports type from undeclared direct dependency","fingerprint":"AICode::functions/src/jobs.ts::isFileOlderThan::transitive_dependency_reliance","severity":"S2","effort":"E0","confidence":84,"files":["functions/src/jobs.ts","functions/package.json"],"symbols":["isFileOlderThan","cleanupOrphanedStorageFiles"],"duplication_cluster":{"is_cluster":false,"cluster_summary":"","instances":[]},"why_it_matters":"Relying on transitive dependencies makes builds fragile during lockfile or upstream dependency changes.","suggested_fix":"Declare @google-cloud/storage explicitly in functions/package.json or switch to types exposed via existing declared dependencies.","acceptance_tests":["npm --prefix functions run build","npm --prefix functions ls @google-cloud/storage"],"pr_bucket_suggestion":"misc","dependencies":[],"evidence":["jobs.ts imports @google-cloud/storage type symbols; dependency is not directly declared in functions/package.json."],"sources":[{"source":"codex","file":"code-codex.jsonl","original_fingerprint":"AICode::functions/src/jobs.ts::isFileOlderThan::transitive_dependency_reliance"}],"verified":true,"consensus_score":2,"canonical_id":"CANON-0037","status":"CONFIRMED"}
{"category":"Security","title":"Hardcoded reCAPTCHA site key fallback in Cloud Functions","fingerprint":"Security::functions/src/recaptcha-verify.ts::verifyRecaptchaToken::hardcoded-recaptcha-key","severity":"S2","effort":"E0","confidence":100,"files":["functions/src/recaptcha-verify.ts"],"symbols":["verifyRecaptchaToken","RECAPTCHA_ACTIONS"],"duplication_cluster":{"is_cluster":false},"why_it_matters":"Line 66 has a hardcoded fallback: process.env.RECAPTCHA_SITE_KEY || '6LdeazosAAAAA...'. This makes key rotation difficult and creates environment confusion. If the env var is unset, the function silently uses the hardcoded key rather than failing closed.","suggested_fix":"Remove the hardcoded fallback. Fail closed with a clear error if RECAPTCHA_SITE_KEY is not set.","acceptance_tests":["Unset RECAPTCHA_SITE_KEY → function throws failed-precondition","Set RECAPTCHA_SITE_KEY → verification works normally"],"pr_bucket_suggestion":"security-hardening","dependencies":[],"evidence":["functions/src/recaptcha-verify.ts:66 — const siteKey = process.env.RECAPTCHA_SITE_KEY || '6LdeazosAAAAAMDNCh1hTUDKh_UeS6xWY1-85B2O';"],"notes":"Previously identified in SEC-003/SEC-108 audits, still open.","sources":[{"source":"copilot","file":"code-copilot.jsonl","original_fingerprint":"Security::functions/src/recaptcha-verify.ts::verifyRecaptchaToken::hardcoded-recaptcha-key"}],"verified":true,"consensus_score":2,"canonical_id":"CANON-0038","status":"CONFIRMED"}
{"category":"Hygiene","title":"Dual hooks directories: hooks/ and lib/hooks/","fingerprint":"Hygiene::hooks/::lib/hooks/::dual-hooks-directories","severity":"S2","effort":"E1","confidence":95,"files":["hooks/use-journal.ts","hooks/use-daily-quote.ts","hooks/use-geolocation.ts","hooks/use-speech-recognition.ts"],"symbols":["useJournal","useDailyQuote","useGeolocation","useSpeechRecognition"],"duplication_cluster":{"is_cluster":false},"why_it_matters":"Hooks exist in both hooks/ (top-level) and lib/hooks/. This creates ambiguity about where to place new hooks and fragments the import paths.","suggested_fix":"Consolidate all hooks into hooks/ at top level. Update all imports.","acceptance_tests":["All hooks live in one directory","All imports compile correctly"],"pr_bucket_suggestion":"hooks-standardization","dependencies":[],"evidence":["hooks/ contains: use-daily-quote.ts, use-geolocation.ts, use-journal.ts, use-speech-recognition.ts","lib/hooks/ exists as a separate directory"],"notes":"","sources":[{"source":"copilot","file":"code-copilot.jsonl","original_fingerprint":"Hygiene::hooks/::lib/hooks/::dual-hooks-directories"}],"verified":true,"consensus_score":2,"canonical_id":"CANON-0039","status":"CONFIRMED"}
{"category":"Hygiene","title":"Dual database directories: lib/database/ and lib/db/","fingerprint":"Hygiene::lib/database/::lib/db/::dual-db-directories","severity":"S2","effort":"E1","confidence":95,"files":["lib/database/","lib/db/"],"symbols":["COLLECTIONS","buildUserPath"],"duplication_cluster":{"is_cluster":false},"why_it_matters":"Two directories handle database-related utilities. Creates confusion about where to add new DB helpers.","suggested_fix":"Consolidate into a single lib/db/ directory.","acceptance_tests":["All DB helpers in one directory","No broken imports","Tests still pass"],"pr_bucket_suggestion":"firebase-access","dependencies":[],"evidence":["lib/database/ and lib/db/ both exist"],"notes":"","sources":[{"source":"copilot","file":"code-copilot.jsonl","original_fingerprint":"Hygiene::lib/database/::lib/db/::dual-db-directories"}],"verified":true,"consensus_score":2,"canonical_id":"CANON-0040","status":"CONFIRMED"}
{"category":"Testing","title":"useDailyQuote test only checks module structure, not actual behavior","fingerprint":"Testing::tests/use-daily-quote.test.ts::useDailyQuote::weak-hook-test","severity":"S2","effort":"E1","confidence":100,"files":["tests/use-daily-quote.test.ts"],"symbols":["useDailyQuote","UseDailyQuoteResult"],"duplication_cluster":{"is_cluster":false},"why_it_matters":"The test only verifies typeof useDailyQuote === 'function'. It never invokes the hook or tests its fetch/rotation/caching logic. Provides false confidence in test coverage.","suggested_fix":"Use React Testing Library to test: loading state, successful quote fetch, error handling, and quote rotation logic.","acceptance_tests":["Tests invoke the hook with mocked Firestore","Tests verify loading → loaded transitions","Tests verify error state handling"],"pr_bucket_suggestion":"tests-hardening","dependencies":[],"evidence":["tests/use-daily-quote.test.ts — it('exports useDailyQuote hook function', () => { assert.strictEqual(typeof useDailyQuote, 'function'); })"],"notes":"","sources":[{"source":"copilot","file":"code-copilot.jsonl","original_fingerprint":"Testing::tests/use-daily-quote.test.ts::useDailyQuote::weak-hook-test"}],"verified":true,"consensus_score":2,"canonical_id":"CANON-0041","status":"CONFIRMED"}
{"category":"Testing","title":"secure-caller test only checks constants and types, not callSecureFunction behavior","fingerprint":"Testing::tests/secure-caller.test.ts::callSecureFunction::weak-type-only-test","severity":"S2","effort":"E1","confidence":100,"files":["tests/secure-caller.test.ts"],"symbols":["RECAPTCHA_ACTIONS","CallSecureFunctionOptions","SecureFunctionResult"],"duplication_cluster":{"is_cluster":false},"why_it_matters":"Tests only verify that constants equal expected string values and that TypeScript types can be instantiated. The actual callSecureFunction logic is never tested. This is a security-critical path with zero behavioral test coverage.","suggested_fix":"Add tests that mock reCAPTCHA token generation and httpsCallable to verify: successful call, rate limit handling, auth error handling, retry logic.","acceptance_tests":["callSecureFunction success path is tested","Error handling paths are tested","Rate limit errors produce correct user-facing messages"],"pr_bucket_suggestion":"tests-hardening","dependencies":[],"evidence":["tests/secure-caller.test.ts: all describe blocks test constants and type shapes, never call the actual function"],"notes":"","sources":[{"source":"copilot","file":"code-copilot.jsonl","original_fingerprint":"Testing::tests/secure-caller.test.ts::callSecureFunction::weak-type-only-test"}],"verified":true,"consensus_score":2,"canonical_id":"CANON-0042","status":"CONFIRMED"}
{"category":"Debugging","title":"Production logger only sends errors to Sentry, drops warn and info","fingerprint":"Debugging::lib/logger.ts::log::production-warn-dropped","severity":"S2","effort":"E1","confidence":100,"files":["lib/logger.ts"],"symbols":["log","logger"],"duplication_cluster":{"is_cluster":false},"why_it_matters":"In production, only level='error' is logged to console and Sentry. Warnings are completely silenced — rate limit warnings, deprecation notices, and degraded operation signals are invisible in production.","suggested_fix":"Send warn-level events to Sentry as breadcrumbs or to a structured log sink. At minimum, log warnings to production console.","acceptance_tests":["logger.warn() produces output in production","Sentry receives warning breadcrumbs","No sensitive data leaked in production logs"],"pr_bucket_suggestion":"misc","dependencies":[],"evidence":["lib/logger.ts:108-117 — dev/test only console","lib/logger.ts:120 — if (isProduction && level === 'error')"],"notes":"","sources":[{"source":"copilot","file":"code-copilot.jsonl","original_fingerprint":"Debugging::lib/logger.ts::log::production-warn-dropped"}],"verified":true,"consensus_score":2,"canonical_id":"CANON-0043","status":"CONFIRMED"}
{"category":"Debugging","title":"No correlation IDs for request tracing across client and Cloud Functions","fingerprint":"Debugging::lib/firestore-service.ts::handleCloudFunctionCallError::no-correlation-id","severity":"S2","effort":"E2","confidence":85,"files":["lib/firestore-service.ts","functions/src/security-wrapper.ts","functions/src/security-logger.ts"],"symbols":["handleCloudFunctionCallError","withSecurityChecks","logSecurityEvent"],"duplication_cluster":{"is_cluster":false},"why_it_matters":"When a Cloud Function call fails, there is no correlation ID linking the client-side error to the server-side security log. Debugging requires manual timestamp correlation.","suggested_fix":"Generate a requestId on the client (crypto.randomUUID()) and pass it in the Cloud Function data. Log the same ID on both sides.","acceptance_tests":["Client attaches requestId to Cloud Function calls","Server logs include the same requestId","Sentry events include requestId as a tag"],"pr_bucket_suggestion":"misc","dependencies":[],"evidence":["lib/firestore-service.ts: handleCloudFunctionCallError logs userId + error code but no requestId"],"notes":"","sources":[{"source":"copilot","file":"code-copilot.jsonl","original_fingerprint":"Debugging::lib/firestore-service.ts::handleCloudFunctionCallError::no-correlation-id"}],"verified":true,"consensus_score":2,"canonical_id":"CANON-0044","status":"CONFIRMED"}
{"category":"AICode","title":"Duplicate generateSearchableText implementations","fingerprint":"AICode::hooks/use-journal.ts::scripts/migrate-to-journal.ts::generateSearchableText::duplicate-implementation","severity":"S2","effort":"E1","confidence":100,"files":["hooks/use-journal.ts","scripts/migrate-to-journal.ts"],"symbols":["generateSearchableText"],"duplication_cluster":{"is_cluster":true,"cluster_summary":"generateSearchableText is implemented in both hooks/use-journal.ts (client) and scripts/migrate-to-journal.ts (migration script) with similar but not identical switch/case logic","instances":[{"file":"hooks/use-journal.ts","symbol":"generateSearchableText"},{"file":"scripts/migrate-to-journal.ts","symbol":"generateSearchableText"}]},"why_it_matters":"Two separate implementations with different array handling. If a new entry type is added, both must be updated.","suggested_fix":"Extract generateSearchableText into lib/utils/searchable-text.ts and import in both locations.","acceptance_tests":["Single source of truth for generateSearchableText","Both consumers produce identical output for same inputs"],"pr_bucket_suggestion":"hooks-standardization","dependencies":[],"evidence":["hooks/use-journal.ts:89-138 uses sanitizeForSearch","scripts/migrate-to-journal.ts:195-230 uses isPrimitive filter"],"notes":"Classic AI code drift.","sources":[{"source":"copilot","file":"code-copilot.jsonl","original_fingerprint":"AICode::hooks/use-journal.ts::scripts/migrate-to-journal.ts::generateSearchableText::duplicate-implementation"}],"verified":true,"consensus_score":2,"canonical_id":"CANON-0045","status":"CONFIRMED"}
{"category":"Framework","title":"Massive use-journal.ts hook (438 lines) handling too many concerns","fingerprint":"Framework::hooks/use-journal.ts::useJournal::god-hook","severity":"S2","effort":"E2","confidence":90,"files":["hooks/use-journal.ts"],"symbols":["useJournal","generateSearchableText","generateTags","sanitizeForSearch","getRelativeDateLabel"],"duplication_cluster":{"is_cluster":false},"why_it_matters":"At 438 lines, use-journal.ts combines 7+ concerns: date formatting, XSS sanitization, searchable text generation, tag generation, real-time Firestore subscription, Cloud Function calls, error handling, and retry logic. Violates single-responsibility.","suggested_fix":"Extract into focused modules: lib/utils/searchable-text.ts, lib/utils/date-label.ts, lib/utils/sanitize.ts. Keep the hook thin.","acceptance_tests":["Hook under 200 lines","Utility functions independently testable","Existing functionality unchanged"],"pr_bucket_suggestion":"hooks-standardization","dependencies":["AICode::hooks/use-journal.ts::scripts/migrate-to-journal.ts::generateSearchableText::duplicate-implementation"],"evidence":["hooks/use-journal.ts: 438 lines, 16608 bytes"],"notes":"","sources":[{"source":"copilot","file":"code-copilot.jsonl","original_fingerprint":"Framework::hooks/use-journal.ts::useJournal::god-hook"}],"verified":true,"consensus_score":2,"canonical_id":"CANON-0046","status":"CONFIRMED"}
{"category":"Hygiene","title":"Duplicated Firestore Logic","fingerprint":"Hygiene::lib/db/users.ts::db::duplicate-firestore-logic","severity":"S2","effort":"E2","confidence":100,"files":["lib/db/users.ts","lib/db/quotes.ts","lib/firestore-service.ts"],"symbols":["db","getDoc","setDoc"],"duplication_cluster":{"is_cluster":true,"cluster_summary":"Direct Firestore SDK usage bypassing FirestoreService","instances":[{"file":"lib/db/users.ts","symbol":"createUserProfile"},{"file":"lib/db/quotes.ts","symbol":"QuotesService"}]},"why_it_matters":"Bypassing the centralized service fragments data access logic, making it harder to enforce security policies, rate limiting, and logging uniformly.","suggested_fix":"Refactor lib/db modules to use FirestoreService methods or merge them into FirestoreService.","acceptance_tests":["Verify all Firestore calls go through FirestoreService mocks in tests"],"pr_bucket_suggestion":"hooks-standardization","sources":[{"source":"jules","file":"code-jules.jsonl","original_fingerprint":"Hygiene::lib/db/users.ts::db::duplicate-firestore-logic"}],"verified":true,"consensus_score":2,"canonical_id":"CANON-0047","status":"CONFIRMED"}
{"category":"Hygiene","title":"Complex Logic in UI Component","fingerprint":"Hygiene::components/notebook/pages/today-page.tsx::onSnapshot::ui-logic-bloat","severity":"S2","effort":"E1","confidence":100,"files":["components/notebook/pages/today-page.tsx"],"symbols":["onSnapshot"],"duplication_cluster":{"is_cluster":false,"cluster_summary":null,"instances":[]},"why_it_matters":"Complex Firestore subscription logic inside a UI component makes it hard to test and reuse. It also mixes concerns (data fetching vs presentation).","suggested_fix":"Extract the subscription logic into a custom hook (e.g., useDailyLogSubscription).","acceptance_tests":["Refactor to use hook","Verify UI behaves same"],"pr_bucket_suggestion":"ui-primitives","sources":[{"source":"jules","file":"code-jules.jsonl","original_fingerprint":"Hygiene::components/notebook/pages/today-page.tsx::onSnapshot::ui-logic-bloat"}],"verified":true,"consensus_score":2,"canonical_id":"CANON-0048","status":"CONFIRMED"}
{"category":"Debugging","title":"Missing Correlation IDs","fingerprint":"Debugging::lib/logger.ts::logger::no-correlation-id","severity":"S2","effort":"E2","confidence":90,"files":["lib/logger.ts","functions/src/index.ts"],"symbols":["logger","logSecurityEvent"],"duplication_cluster":{"is_cluster":false,"cluster_summary":null,"instances":[]},"why_it_matters":"Without correlation IDs, it is impossible to trace a specific user action from the frontend client to the backend Cloud Function execution, hindering debugging of production issues.","suggested_fix":"Generate a unique Request ID in the client, pass it in Cloud Function calls, and include it in all logs.","acceptance_tests":["Verify logs contain correlationId"],"pr_bucket_suggestion":"misc","sources":[{"source":"jules","file":"code-jules.jsonl","original_fingerprint":"Debugging::lib/logger.ts::logger::no-correlation-id"}],"verified":true,"consensus_score":2,"canonical_id":"CANON-0049","status":"CONFIRMED"}
{"category":"Security","title":"Inconsistent Write Patterns","fingerprint":"Security::lib/db/users.ts::setDoc::direct-write","severity":"S2","effort":"E2","confidence":100,"files":["lib/db/users.ts"],"symbols":["setDoc"],"duplication_cluster":{"is_cluster":false,"cluster_summary":null,"instances":[]},"why_it_matters":"While 'users' collection allows writes in rules, the application pattern is to use Cloud Functions for writes to ensure validation and rate limiting. Direct writes here create an inconsistency.","suggested_fix":"Migrate user profile creation/updates to a Cloud Function (e.g., saveUserProfile).","acceptance_tests":["Verify no direct setDoc calls in client bundles"],"pr_bucket_suggestion":"security-hardening","sources":[{"source":"jules","file":"code-jules.jsonl","original_fingerprint":"Security::lib/db/users.ts::setDoc::direct-write"}],"verified":true,"consensus_score":2,"canonical_id":"CANON-0050","status":"CONFIRMED"}
{"category":"AICode","title":"Happy Path Testing Only","fingerprint":"AICode::tests/firestore-service.test.ts::getTodayLog::happy-path","severity":"S2","effort":"E1","confidence":80,"files":["tests/firestore-service.test.ts"],"symbols":["getTodayLog"],"duplication_cluster":{"is_cluster":false,"cluster_summary":null,"instances":[]},"why_it_matters":"Tests only cover the success scenario. Failure modes (network error, permission denied) are not tested, which are common in distributed systems.","suggested_fix":"Add test cases for error scenarios and edge cases.","acceptance_tests":["Coverage report shows error handling branches covered"],"pr_bucket_suggestion":"tests-hardening","sources":[{"source":"jules","file":"code-jules.jsonl","original_fingerprint":"AICode::tests/firestore-service.test.ts::getTodayLog::happy-path"}],"verified":true,"consensus_score":2,"canonical_id":"CANON-0051","status":"CONFIRMED"}
{"category":"Debugging","title":"Missing Correlation IDs for Request Tracing","fingerprint":"Debugging::lib::all-files::missing-correlation-ids","severity":"S2","effort":"E1","confidence":100,"files":[],"symbols":["correlationId"],"duplication_cluster":{"is_cluster":false,"cluster_summary":null,"instances":[]},"why_it_matters":"Only 10 references to correlation/request IDs found, all in jobs-tab.tsx for local deduplication. No frontend to backend correlation IDs for tracing requests through the system.","suggested_fix":"Generate correlation ID in client before Cloud Function call. Pass as metadata in request. Log in Cloud Function with the same ID. Include in Sentry breadcrumbs.","acceptance_tests":["Correlation IDs generated for all Cloud Function calls","IDs logged both client-side and server-side","Sentry breadcrumbs include correlation ID"],"pr_bucket_suggestion":"debugging","sources":[{"source":"claude","file":"code-claude.jsonl","original_fingerprint":"Debugging::lib::all-files::missing-correlation-ids"}],"consensus_score":1.5,"canonical_id":"CANON-0052","status":"SUSPECTED"}
{"category":"Debugging","title":"Console.log Statements in Production Code (13 Instances)","fingerprint":"Debugging::generic::console-log::production-console-logs","severity":"S2","effort":"E0","confidence":100,"files":[],"symbols":["console.log"],"duplication_cluster":{"is_cluster":false,"cluster_summary":null,"instances":[]},"why_it_matters":"Thirteen console.log statements remain in production source code rather than using the structured logger. May leak sensitive data in production.","suggested_fix":"Replace with logger.info() or remove if debugging code. Add ESLint rule to prevent future console.log in production.","acceptance_tests":["Zero console.log in production code (or documented exceptions)","ESLint rule enforces no-console","All logging uses structured logger"],"pr_bucket_suggestion":"misc","sources":[{"source":"claude","file":"code-claude.jsonl","original_fingerprint":"Debugging::generic::console-log::production-console-logs"}],"consensus_score":1.5,"canonical_id":"CANON-0053","status":"SUSPECTED"}
{"category":"Security","title":"Potential Firestore-rules alignment risk for direct weekly log reads","fingerprint":"Security::components/notebook/pages/today-page.tsx::calculateWeeklyStats::rules_alignment_uncertain","severity":"S2","effort":"E1","confidence":35,"files":["components/notebook/pages/today-page.tsx","storage.rules"],"symbols":["calculateWeeklyStats"],"duplication_cluster":{"is_cluster":false,"cluster_summary":"","instances":[]},"why_it_matters":"If rules evolve, direct query behavior may diverge from service-backed behavior and fail unexpectedly.","suggested_fix":"Consolidate to service layer and add emulator-based rules tests for weekly-read path.","acceptance_tests":["Firestore emulator integration tests for daily_logs weekly query"],"pr_bucket_suggestion":"security-hardening","dependencies":[],"evidence":["Rules-to-query alignment was not fully validated in this pass."],"sources":[{"source":"codex-suspected","file":"code-codex-suspected.jsonl","original_fingerprint":"Security::components/notebook/pages/today-page.tsx::calculateWeeklyStats::rules_alignment_uncertain"}],"verified":true,"consensus_score":1.5,"canonical_id":"CANON-0054","status":"SUSPECTED"}
{"category":"Debugging","title":"Potential empty catch blocks in scripts","fingerprint":"Debugging::scripts/::catch::empty-catch-blocks","severity":"S2","effort":"E0","confidence":30,"files":["scripts/seed-real-data.ts","scripts/sync-geocache.ts"],"symbols":[],"duplication_cluster":{"is_cluster":false},"why_it_matters":"Scripts use try/catch patterns where some catch blocks only log minimal info. In script contexts, swallowed errors can cause silent data corruption.","suggested_fix":"Ensure all script catch blocks log full error context and either re-throw or exit with non-zero code.","acceptance_tests":["No empty catch blocks in scripts"],"pr_bucket_suggestion":"misc","dependencies":[],"evidence":["scripts/seed-real-data.ts: bare catch { console.error('Error...'); process.exit(1); }"],"notes":"Limited visibility.","sources":[{"source":"copilot-suspected","file":"code-copilot-suspected.jsonl","original_fingerprint":"Debugging::scripts/::catch::empty-catch-blocks"}],"verified":true,"consensus_score":1.5,"canonical_id":"CANON-0055","status":"SUSPECTED"}
{"category":"Debugging","title":"Limited Structured Logging","fingerprint":"Debugging::lib::all-files::console-logging-prevalence","severity":"S3","effort":"E1","confidence":80,"files":["lib/logger.ts"],"symbols":["logger"],"duplication_cluster":{"is_cluster":false,"cluster_summary":"","instances":[]},"why_it_matters":"29 console.log/warn/error statements across codebase. While lib/logger.ts exists, adoption is incomplete. No correlation IDs for request tracing. Debugging production issues requires log aggregation without structured context.","suggested_fix":"Migrate remaining console statements to logger. Add correlation ID to logger context (generate on request entry, pass through all layers). Ensure Sentry integration captures logger calls with full context.","acceptance_tests":["grep 'console\\.(log|warn|error)' returns <5 results (intentional CLI output only)","All logger calls include correlation ID when available","Sentry events show correlation ID in breadcrumbs","Production logs can trace full request lifecycle"],"pr_bucket_suggestion":"misc","dependencies":[],"evidence":["grep count: 29 console statements","lib/logger.ts exists with winston-style interface","lib/sentry.client.ts shows Sentry integration exists","No correlation ID pattern found in grep"],"notes":"Low severity - logger exists and is partially adopted. Mostly needs completion, not new infrastructure. Good foundation already in place.","sources":[{"source":"claude-code","file":"code-claude-code.jsonl","original_fingerprint":"Debugging::lib::all-files::console-logging-prevalence"}],"verified":true,"consensus_score":2,"canonical_id":"CANON-0056","status":"CONFIRMED"}
{"category":"Hygiene","title":"Lingering TODO Comments (2 Instances)","fingerprint":"Hygiene::generic::TODO::lingering-todos","severity":"S3","effort":"E0","confidence":100,"files":["components/notebook/features/quick-actions-fab.tsx","lib/database/firestore-adapter.ts"],"symbols":["TODO"],"duplication_cluster":{"is_cluster":false,"cluster_summary":null,"instances":[]},"why_it_matters":"Two TODO comments: 'Make action buttons customizable by user' and 'Pass limit to FirestoreService when it supports configurable limits'. Should be tracked as issues or implemented.","suggested_fix":"Implement or convert to GitHub issues and remove comments.","acceptance_tests":["No TODO comments in codebase (or tracked as GitHub issues)"],"pr_bucket_suggestion":"misc","sources":[{"source":"claude","file":"code-claude.jsonl","original_fingerprint":"Hygiene::generic::TODO::lingering-todos"}],"verified":true,"consensus_score":2,"canonical_id":"CANON-0057","status":"CONFIRMED"}
{"category":"Types","title":"Dual type locations: types/ and lib/types/","fingerprint":"Types::types/::lib/types/::dual-type-directories","severity":"S3","effort":"E1","confidence":90,"files":["types/journal.ts","lib/types/"],"symbols":["JournalEntry","JournalEntryType","DailyLog"],"duplication_cluster":{"is_cluster":false},"why_it_matters":"Types are split between types/journal.ts at root and lib/types/ with additional type definitions like daily-log.ts. Fragmentation makes it hard to discover canonical type definitions.","suggested_fix":"Consolidate all client-side types into types/ directory.","acceptance_tests":["All client types in types/","No duplicate type definitions","TypeScript compilation succeeds"],"pr_bucket_suggestion":"types-domain","dependencies":[],"evidence":["types/journal.ts exports JournalEntry, JournalEntryType","lib/types/ directory exists with additional type files"],"notes":"","sources":[{"source":"copilot","file":"code-copilot.jsonl","original_fingerprint":"Types::types/::lib/types/::dual-type-directories"}],"verified":true,"consensus_score":2,"canonical_id":"CANON-0058","status":"CONFIRMED"}
{"category":"AICode","title":"color-sampler.tsx appears to be a dev/debugging tool committed to main","fingerprint":"AICode::components/color-sampler.tsx::ColorSampler::dev-tool-in-main","severity":"S3","effort":"E0","confidence":85,"files":["components/color-sampler.tsx","app/colors/"],"symbols":["ColorSampler"],"duplication_cluster":{"is_cluster":false},"why_it_matters":"A 6.5KB color sampling/preview component with no user-facing purpose in the production app.","suggested_fix":"Move to a dev-only route guard or remove from production build.","acceptance_tests":["Component not accessible in production or explicitly marked as dev-only"],"pr_bucket_suggestion":"misc","dependencies":[],"evidence":["components/color-sampler.tsx: 6577 bytes"],"notes":"","sources":[{"source":"copilot","file":"code-copilot.jsonl","original_fingerprint":"AICode::components/color-sampler.tsx::ColorSampler::dev-tool-in-main"}],"verified":true,"consensus_score":2,"canonical_id":"CANON-0059","status":"CONFIRMED"}
{"category":"Types","title":"Explicit Any Type","fingerprint":"Types::components/notebook/pages/today-page.tsx::docSnap::explicit-any","severity":"S3","effort":"E0","confidence":100,"files":["components/notebook/pages/today-page.tsx"],"symbols":["docSnap"],"duplication_cluster":{"is_cluster":false,"cluster_summary":null,"instances":[]},"why_it_matters":"Using 'any' defeats the purpose of TypeScript and hides potential runtime errors.","suggested_fix":"Type the docSnap correctly using DocumentSnapshot<DailyLog>.","acceptance_tests":["Run tsc and ensure no errors"],"pr_bucket_suggestion":"types-domain","sources":[{"source":"jules","file":"code-jules.jsonl","original_fingerprint":"Types::components/notebook/pages/today-page.tsx::docSnap::explicit-any"}],"verified":true,"consensus_score":2,"canonical_id":"CANON-0060","status":"CONFIRMED"}
{"category":"AICode","title":"Confusing Auth Hook Layering","fingerprint":"AICode::components/providers/auth-provider.tsx::useAuth::hook-layering","severity":"S3","effort":"E0","confidence":90,"files":["components/providers/auth-provider.tsx"],"symbols":["useAuth","useAuthCore"],"duplication_cluster":{"is_cluster":false,"cluster_summary":null,"instances":[]},"why_it_matters":"Having useAuth wrap useAuthCore with slightly different semantics can confuse AI agents and developers, leading to incorrect imports.","suggested_fix":"Consolidate into a single clear hook or explicitly document why the layering exists.","acceptance_tests":["Code review"],"pr_bucket_suggestion":"hooks-standardization","sources":[{"source":"jules","file":"code-jules.jsonl","original_fingerprint":"AICode::components/providers/auth-provider.tsx::useAuth::hook-layering"}],"verified":true,"consensus_score":2,"canonical_id":"CANON-0061","status":"CONFIRMED"}
{"category":"AICode","title":"Potential unused @dataconnect/generated dependency","fingerprint":"AICode::package.json::@dataconnect/generated::phantom-dependency","severity":"S3","effort":"E0","confidence":35,"files":["package.json"],"symbols":["@dataconnect/generated"],"duplication_cluster":{"is_cluster":false},"why_it_matters":"package.json lists @dataconnect/generated: file:src/dataconnect-generated as a dependency. Firebase Data Connect is a separate product from Firestore. If this is unused generated code from an abandoned feature, it adds unnecessary complexity.","suggested_fix":"Verify if src/dataconnect-generated exists and is actually imported. If not, remove the dependency.","acceptance_tests":["Dependency is either used or removed"],"pr_bucket_suggestion":"misc","dependencies":[],"evidence":["package.json — @dataconnect/generated: file:src/dataconnect-generated"],"notes":"Cannot verify directory existence or import usage.","sources":[{"source":"copilot-suspected","file":"code-copilot-suspected.jsonl","original_fingerprint":"AICode::package.json::@dataconnect/generated::phantom-dependency"}],"verified":true,"consensus_score":1.5,"canonical_id":"CANON-0062","status":"SUSPECTED"}
{"category":"Debugging","title":"High Console Log Volume","fingerprint":"Debugging::generic::console-log::volume","severity":"S3","effort":"E0","confidence":40,"files":[],"symbols":["console.log"],"duplication_cluster":{"is_cluster":false,"cluster_summary":null,"instances":[]},"why_it_matters":"156 console logs found. While many might be wrapped or dev-only, excessive logging can noise up the console and impact performance.","suggested_fix":"Audit console.log usage and replace with logger or remove.","acceptance_tests":["Reduce log count"],"pr_bucket_suggestion":"misc","sources":[{"source":"jules-suspected","file":"code-jules-suspected.jsonl","original_fingerprint":"Debugging::generic::console-log::volume"}],"consensus_score":1,"canonical_id":"CANON-0063","status":"SUSPECTED"}