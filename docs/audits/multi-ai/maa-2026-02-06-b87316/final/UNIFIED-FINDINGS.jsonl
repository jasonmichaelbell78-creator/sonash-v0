{"category":"engineering-productivity","title":"DEVELOPMENT.md references npm script type-check that does not exist","fingerprint":"engineering-productivity::DEVELOPMENT.md::missing-npm-script-type-check","severity":"S1","effort":"E0","confidence":100,"files":["DEVELOPMENT.md","package.json"],"why_it_matters":"Onboarding instructions point to a command that fails immediately, creating trust erosion and wasted time during setup and troubleshooting.","suggested_fix":"Either add \"type-check\": \"tsc --noEmit\" to package.json or update DEVELOPMENT.md to reference the existing command (npx tsc --noEmit) consistently.","acceptance_tests":["npm run --list | grep type-check","npm run type-check (if added)"],"evidence":["DEVELOPMENT.md:848 - Check TypeScript errors: npm run type-check","package.json scripts: no type-check entry"],"line":848,"sources":[{"source":"copilot-suspected","file":"code-copilot-suspected.jsonl","original_fingerprint":"AICode::package.json::@dataconnect/generated::phantom-dependency"},{"source":"chatgpt","file":"refactoring-chatgpt.jsonl","original_fingerprint":"Testing Infrastructure::package.json::scripts.test::missing-quality-gate-hooks"},{"source":"copilot","file":"performance-copilot.jsonl","original_fingerprint":"Bundle::package.json::framer_motion_size"},{"source":"jules","file":"process-jules.jsonl","original_fingerprint":"process::package.json::broken_script"},{"source":"claude-code","file":"security-claude-code.jsonl","original_fingerprint":"OWASP::package.json::npm_audit_high"}],"verified":true,"consensus_score":2,"canonical_id":"CANON-0004","status":"CONFIRMED","cross_cutting":true,"categories":["code","engineering-productivity","performance","process","refactoring","security"],"related_findings":[{"id":"CANON-0062","category":"code","title":"Potential unused @dataconnect/generated dependency"},{"id":"CANON-0004","category":"engineering-productivity","title":"DEVELOPMENT.md references npm script type-check th"},{"id":"CANON-0005","category":"performance","title":"Framer Motion Overuse - Heavy Animation Library"},{"id":"CANON-0004","category":"process","title":"Broken Circular Dependency Check"},{"id":"CANON-0022","category":"refactoring","title":"Quality gates don't include patterns:check and dep"},{"id":"CANON-0010","category":"security","title":"3 high-severity npm audit dependency vulnerabiliti"}],"file_hotspot":"package.json","priority_score":360,"unified_id":"UNIFIED-0001"}
{"category":"code","title":"OfflineIndicator uses navigator.onLine in useState initializer without SSR guard","fingerprint":"Framework::components/status/offline-indicator.tsx::OfflineIndicator::ssr-navigator-access","severity":"S1","effort":"E0","confidence":100,"files":["components/status/offline-indicator.tsx"],"symbols":["OfflineIndicator"],"duplication_cluster":{"is_cluster":false},"why_it_matters":"Line 7: useState(() => navigator.onLine) — navigator is not available during SSR. This will throw ReferenceError: navigator is not defined.","suggested_fix":"Use a safe default: useState(true) and update in useEffect.","acceptance_tests":["Component renders without error during SSR","Online/offline detection works correctly in browser"],"pr_bucket_suggestion":"boundaries","dependencies":[],"evidence":["components/status/offline-indicator.tsx:7 — const [isOnline, setIsOnline] = useState(() => navigator.onLine);"],"notes":"","sources":[{"source":"copilot","file":"code-copilot.jsonl","original_fingerprint":"Framework::components/status/offline-indicator.tsx::OfflineIndicator::ssr-navigator-access"},{"source":"chatgpt","file":"performance-chatgpt.jsonl","original_fingerprint":"Offline Support::components/status/offline-indicator.tsx::sync_claim_without_queue"}],"verified":true,"consensus_score":2,"canonical_id":"CANON-0016","status":"CONFIRMED","cross_cutting":true,"categories":["code","engineering-productivity","performance"],"related_findings":[{"id":"CANON-0016","category":"code","title":"OfflineIndicator uses navigator.onLine in useState"},{"id":"CANON-0006","category":"engineering-productivity","title":"Offline UI promises changes will sync, but no serv"},{"id":"CANON-0017","category":"performance","title":"UI claims offline writes will sync, but no persist"}],"file_hotspot":"components/status/offline-indicator.tsx","priority_score":210,"unified_id":"UNIFIED-0002"}
{"category":"process","title":"Firebase Functions use Node 20 but CI uses Node 22 — version mismatch","fingerprint":"ci::ci.yml::node_version_mismatch","severity":"S1","effort":"E0","confidence":100,"files":[".github/workflows/ci.yml","functions/package.json"],"line":21,"description":"CI uses Node 22 (ci.yml:21) but functions/package.json specifies engines.node: '20'. CI tests run on different Node version than Firebase Functions deploy runtime. Could mask Node 20-specific issues.","evidence":["ci.yml:21 — node-version: '22'","functions/package.json:14 — engines.node: '20'"],"remediation":{"steps":["Upgrade functions to Node 22 if Firebase supports it","Or add separate CI job for functions/ using Node 20","Or change CI to Node 20"],"verification":["functions/package.json engines.node matches CI node-version"]},"sources":[{"source":"codex","file":"code-codex.jsonl","original_fingerprint":"AICode::functions/src/jobs.ts::isFileOlderThan::transitive_dependency_reliance"},{"source":"copilot","file":"process-copilot.jsonl","original_fingerprint":"ci::ci.yml::node_version_mismatch"},{"source":"claude-code","file":"security-claude-code.jsonl","original_fingerprint":"OWASP::package.json::npm_audit_high"}],"verified":true,"consensus_score":2,"canonical_id":"CANON-0003","status":"CONFIRMED","cross_cutting":true,"categories":["code","process","security"],"related_findings":[{"id":"CANON-0037","category":"code","title":"Functions code imports type from undeclared direct"},{"id":"CANON-0003","category":"process","title":"Firebase Functions use Node 20 but CI uses Node 22"},{"id":"CANON-0010","category":"security","title":"3 high-severity npm audit dependency vulnerabiliti"}],"file_hotspot":"functions/package.json","priority_score":210,"unified_id":"UNIFIED-0003"}
{"category":"code","title":"Firebase App Check is disabled in client initialization path","fingerprint":"Security::lib/firebase.ts::initializeFirebase::appcheck_disabled","severity":"S1","effort":"E1","confidence":96,"files":["lib/firebase.ts"],"symbols":["initializeFirebase","getFirebase"],"duplication_cluster":{"is_cluster":false,"cluster_summary":"","instances":[]},"why_it_matters":"Cloud Functions and Firestore rely on layered abuse controls; shipping with App Check disabled weakens bot/automation resistance.","suggested_fix":"Re-enable App Check initialization with environment-gated debug behavior and sanitized logging for failures.","acceptance_tests":["npm test","npm run lint","Verify Cloud Function requests include App Check token in production-like run"],"pr_bucket_suggestion":"security-hardening","dependencies":[],"evidence":["App Check initialization is commented out while appCheck remains part of firebase surface."],"sources":[{"source":"codex","file":"security-codex.jsonl","original_fingerprint":"Firebase::functions/src/index.ts::app-check-disabled"},{"source":"copilot","file":"refactoring-copilot.jsonl","original_fingerprint":"Security Hardening::lib/firebase.ts::initializeFirebase::appcheck-disabled"},{"source":"claude","file":"engineering-productivity-claude.jsonl","original_fingerprint":"engineering-productivity::lib/firebase.ts::persistence"},{"source":"chatgpt","file":"security-chatgpt.jsonl","original_fingerprint":"Firebase::functions/src/index.ts::appcheck_disabled"}],"verified":true,"consensus_score":2,"canonical_id":"CANON-0012","status":"CONFIRMED","cross_cutting":true,"categories":["code","documentation","engineering-productivity","performance","refactoring","security"],"related_findings":[{"id":"CANON-0012","category":"code","title":"Firebase App Check is disabled in client initializ"},{"id":"CANON-0033","category":"documentation","title":"APPCHECK_SETUP.md contradicts current code — App C"},{"id":"CANON-0002","category":"engineering-productivity","title":"Firebase IndexedDB persistence not enabled"},{"id":"CANON-0008","category":"performance","title":"No Offline Detection or Sync Queue"},{"id":"CANON-0015","category":"refactoring","title":"App Check still disabled since Dec 2025"},{"id":"CANON-0002","category":"security","title":"App Check enforcement disabled on callable write e"}],"file_hotspot":"lib/firebase.ts","priority_score":181.5,"unified_id":"UNIFIED-0004"}
{"category":"process","title":"Firebase Functions use Node 20 but CI uses Node 22 — version mismatch","fingerprint":"ci::ci.yml::node_version_mismatch","severity":"S1","effort":"E0","confidence":100,"files":[".github/workflows/ci.yml","functions/package.json"],"line":21,"description":"CI uses Node 22 (ci.yml:21) but functions/package.json specifies engines.node: '20'. CI tests run on different Node version than Firebase Functions deploy runtime. Could mask Node 20-specific issues.","evidence":["ci.yml:21 — node-version: '22'","functions/package.json:14 — engines.node: '20'"],"remediation":{"steps":["Upgrade functions to Node 22 if Firebase supports it","Or add separate CI job for functions/ using Node 20","Or change CI to Node 20"],"verification":["functions/package.json engines.node matches CI node-version"]},"sources":[{"source":"chatgpt","file":"engineering-productivity-chatgpt.jsonl","original_fingerprint":"engineering-productivity::package.json::jest-mismatch"},{"source":"copilot","file":"process-copilot.jsonl","original_fingerprint":"ci::ci.yml::node_version_mismatch"}],"verified":true,"consensus_score":2,"canonical_id":"CANON-0003","status":"CONFIRMED","cross_cutting":true,"categories":["engineering-productivity","process"],"related_findings":[{"id":"CANON-0022","category":"engineering-productivity","title":"Repo context expects Jest but project uses Node's "},{"id":"CANON-0003","category":"process","title":"Firebase Functions use Node 20 but CI uses Node 22"}],"file_hotspot":".github/workflows/ci.yml","priority_score":160,"unified_id":"UNIFIED-0005"}
{"category":"code","title":"reCAPTCHA Token Bypass (Existing DEBT-0045)","fingerprint":"Security::functions/src/security-wrapper.ts::security-wrapper::recaptcha-bypass","severity":"S1","effort":"E1","confidence":100,"files":["functions/src/security-wrapper.ts"],"symbols":["security-wrapper"],"duplication_cluster":{"is_cluster":false,"cluster_summary":"","instances":[]},"why_it_matters":"If recaptchaAction is configured for an endpoint, missing token logs warning but continues processing. Should fail closed to prevent automated abuse. Currently allows requests without reCAPTCHA validation.","suggested_fix":"Require non-empty recaptchaToken when recaptchaAction is set. Throw HttpsError('failed-precondition', 'reCAPTCHA required') if missing. Allow bypass only in explicit dev/test mode via ALLOW_RECAPTCHA_BYPASS env flag.","acceptance_tests":["Requests without token are rejected with 400 error","Dev/test mode explicitly enabled via env flag","Production mode requires valid tokens","Integration tests pass with proper token handling"],"pr_bucket_suggestion":"security-hardening","dependencies":[],"evidence":["DEBT-0045 from MASTER_DEBT.jsonl","Wrapper logs missing token but continues processing (Claude Opus evidence)","Currently deployed in production with this behavior"],"notes":"Already tracked in TDMS. Roadmap: Track-S (Security). Fix before public launch.","sources":[{"source":"claude-code","file":"security-claude-code.jsonl","original_fingerprint":"Firebase::lib/firebase.ts::app_check_disabled"},{"source":"claude","file":"refactoring-claude.jsonl","original_fingerprint":"Duplication::functions/src/admin.ts::mega_file_boilerplate"},{"source":"copilot","file":"security-copilot.jsonl","original_fingerprint":"Firebase::lib/firebase.ts::app_check_disabled"}],"verified":true,"consensus_score":2,"canonical_id":"CANON-0005","status":"CONFIRMED","cross_cutting":true,"categories":["code","refactoring","security"],"related_findings":[{"id":"CANON-0005","category":"code","title":"reCAPTCHA Token Bypass (Existing DEBT-0045)"},{"id":"CANON-0008","category":"refactoring","title":"admin.ts Mega-File: 33 Cloud Functions with identi"},{"id":"CANON-0003","category":"security","title":"App Check disabled on all Cloud Functions"}],"file_hotspot":"functions/src/security-wrapper.ts","priority_score":110,"unified_id":"UNIFIED-0006"}
{"category":"code","title":"Inconsistent Admin Write Patterns (Cloud Functions vs Direct Writes)","fingerprint":"Security::components/admin/admin-crud-table.tsx::AdminCrudTable::inconsistent-write-patterns","severity":"S1","effort":"E1","confidence":100,"files":["components/admin/meetings-tab.tsx","components/admin/sober-living-tab.tsx","components/admin/quotes-tab.tsx","components/admin/glossary-tab.tsx","components/admin/slogans-tab.tsx","components/admin/admin-crud-table.tsx"],"symbols":["AdminCrudTable","cloudFunctions","service"],"duplication_cluster":{"is_cluster":false,"cluster_summary":null,"instances":[]},"why_it_matters":"AdminCrudTable accepts either cloudFunctions or service config. Meetings use Cloud Functions, others use direct client writes. Firestore rules allow admin writes for quotes/glossary/slogans but not sober_living. Inconsistent security model.","suggested_fix":"Standardize on Cloud Functions for all admin writes. Create Cloud Functions for quotes, glossary, slogans (or document why direct writes are acceptable). Update all admin tabs to use cloudFunctions config.","acceptance_tests":["All admin tabs use consistent write pattern","Firestore rules match code behavior","Security model documented and enforced"],"pr_bucket_suggestion":"security-hardening","sources":[{"source":"claude","file":"code-claude.jsonl","original_fingerprint":"Security::components/admin/admin-crud-table.tsx::AdminCrudTable::inconsistent-write-patterns"},{"source":"chatgpt","file":"refactoring-chatgpt.jsonl","original_fingerprint":"Hygiene/Duplication::components/admin/admin-crud-table.tsx::AdminCrudTable::direct-firestore-reads-in-ui"}],"verified":true,"consensus_score":2,"canonical_id":"CANON-0011","status":"CONFIRMED","cross_cutting":true,"categories":["code","performance","refactoring"],"related_findings":[{"id":"CANON-0011","category":"code","title":"Inconsistent Admin Write Patterns (Cloud Functions"},{"id":"CANON-0001","category":"performance","title":"Excessive client-component surface (\"use client\" a"},{"id":"CANON-0001","category":"refactoring","title":"Direct Firestore SDK reads in UI/components bypass"}],"file_hotspot":"components/admin/admin-crud-table.tsx","priority_score":110,"unified_id":"UNIFIED-0007"}
{"category":"documentation","title":"DEVELOPMENT.md references missing npm script type-check","fingerprint":"Documentation::DEVELOPMENT.md::unknown_npm_script","severity":"S1","effort":"E1","confidence":100,"files":["DEVELOPMENT.md"],"line":848,"description":"DEVELOPMENT.md instructs contributors to run npm run type-check, but type-check is not defined in package.json. This breaks onboarding and standard QA workflows.","evidence":["Line 848: 'Check TypeScript errors: npm run type-check'","Line 986: '[ ] Type check passes (npm run type-check)'","package.json scripts do not include 'type-check' (validated via scripts/check-content-accuracy.js)"],"remediation":{"steps":["Either add a type-check script to package.json (e.g., tsc --noEmit) OR update documentation to reference the existing equivalent command.","Re-run docs accuracy tooling to confirm it passes."],"verification":["node scripts/check-content-accuracy.js","grep -n 'type-check' DEVELOPMENT.md"]},"sources":[{"source":"chatgpt","file":"process-chatgpt.jsonl","original_fingerprint":"husky::DEVELOPMENT.md::pre-push-docs-out-of-sync"}],"verified":true,"consensus_score":2,"canonical_id":"CANON-0001","status":"CONFIRMED","cross_cutting":true,"categories":["documentation","engineering-productivity","process"],"related_findings":[{"id":"CANON-0001","category":"documentation","title":"DEVELOPMENT.md references missing npm script type-"},{"id":"CANON-0004","category":"engineering-productivity","title":"DEVELOPMENT.md references npm script type-check th"},{"id":"CANON-0009","category":"process","title":"DEVELOPMENT.md is stale vs actual pre-push gate (d"}],"file_hotspot":"DEVELOPMENT.md","priority_score":110,"unified_id":"UNIFIED-0008"}
{"category":"code","title":"Firestore rules may not cover worksheets subcollection","fingerprint":"Security::firestore.rules::worksheets::missing-rules","severity":"S1","effort":"E0","confidence":35,"files":["firestore.rules","lib/db/collections.ts"],"symbols":["COLLECTIONS","userWorksheets"],"duplication_cluster":{"is_cluster":false},"why_it_matters":"COLLECTIONS.userWorksheets generates paths like 'users/{uid}/worksheets' but the visible portion of firestore.rules only explicitly covers journal, daily_logs, inventoryEntries, and journalEntries subcollections. If worksheets is not covered, it may be either fully open or fully closed by default.","suggested_fix":"Verify worksheets collection has explicit rules. Add rules if missing.","acceptance_tests":["Firestore rules explicitly cover worksheets subcollection"],"pr_bucket_suggestion":"security-hardening","dependencies":[],"evidence":["firestore.rules visible portion: only 4 subcollections explicitly listed"],"notes":"Could not see full firestore.rules file — may have wildcard catch-all.","sources":[{"source":"copilot-suspected","file":"code-copilot-suspected.jsonl","original_fingerprint":"Security::firestore.rules::worksheets::missing-rules"},{"source":"codex","file":"security-codex.jsonl","original_fingerprint":"Firebase::lib/db/quotes.ts::client-admin-writes"}],"verified":true,"consensus_score":1.5,"canonical_id":"CANON-0017","status":"SUSPECTED","cross_cutting":true,"categories":["code","security"],"related_findings":[{"id":"CANON-0017","category":"code","title":"Firestore rules may not cover worksheets subcollec"},{"id":"CANON-0011","category":"security","title":"Admin CRUD uses client Firestore writes, bypassing"}],"file_hotspot":"firestore.rules","priority_score":108.8,"unified_id":"UNIFIED-0009"}
{"category":"code","title":"Firestore rules may not cover worksheets subcollection","fingerprint":"Security::firestore.rules::worksheets::missing-rules","severity":"S1","effort":"E0","confidence":35,"files":["firestore.rules","lib/db/collections.ts"],"symbols":["COLLECTIONS","userWorksheets"],"duplication_cluster":{"is_cluster":false},"why_it_matters":"COLLECTIONS.userWorksheets generates paths like 'users/{uid}/worksheets' but the visible portion of firestore.rules only explicitly covers journal, daily_logs, inventoryEntries, and journalEntries subcollections. If worksheets is not covered, it may be either fully open or fully closed by default.","suggested_fix":"Verify worksheets collection has explicit rules. Add rules if missing.","acceptance_tests":["Firestore rules explicitly cover worksheets subcollection"],"pr_bucket_suggestion":"security-hardening","dependencies":[],"evidence":["firestore.rules visible portion: only 4 subcollections explicitly listed"],"notes":"Could not see full firestore.rules file — may have wildcard catch-all.","sources":[{"source":"copilot-suspected","file":"code-copilot-suspected.jsonl","original_fingerprint":"Security::firestore.rules::worksheets::missing-rules"},{"source":"chatgpt","file":"refactoring-chatgpt.jsonl","original_fingerprint":"Hygiene/Duplication::components/admin/admin-crud-table.tsx::AdminCrudTable::direct-firestore-reads-in-ui"}],"verified":true,"consensus_score":1.5,"canonical_id":"CANON-0017","status":"SUSPECTED","cross_cutting":true,"categories":["code","refactoring"],"related_findings":[{"id":"CANON-0017","category":"code","title":"Firestore rules may not cover worksheets subcollec"},{"id":"CANON-0001","category":"refactoring","title":"Direct Firestore SDK reads in UI/components bypass"}],"file_hotspot":"lib/db/collections.ts","priority_score":108.8,"unified_id":"UNIFIED-0010"}
{"category":"code","title":"Hardcoded reCAPTCHA site key fallback in Cloud Functions","fingerprint":"Security::functions/src/recaptcha-verify.ts::verifyRecaptchaToken::hardcoded-recaptcha-key","severity":"S2","effort":"E0","confidence":100,"files":["functions/src/recaptcha-verify.ts"],"symbols":["verifyRecaptchaToken","RECAPTCHA_ACTIONS"],"duplication_cluster":{"is_cluster":false},"why_it_matters":"Line 66 has a hardcoded fallback: process.env.RECAPTCHA_SITE_KEY || '6LdeazosAAAAA...'. This makes key rotation difficult and creates environment confusion. If the env var is unset, the function silently uses the hardcoded key rather than failing closed.","suggested_fix":"Remove the hardcoded fallback. Fail closed with a clear error if RECAPTCHA_SITE_KEY is not set.","acceptance_tests":["Unset RECAPTCHA_SITE_KEY → function throws failed-precondition","Set RECAPTCHA_SITE_KEY → verification works normally"],"pr_bucket_suggestion":"security-hardening","dependencies":[],"evidence":["functions/src/recaptcha-verify.ts:66 — const siteKey = process.env.RECAPTCHA_SITE_KEY || '6LdeazosAAAAAMDNCh1hTUDKh_UeS6xWY1-85B2O';"],"notes":"Previously identified in SEC-003/SEC-108 audits, still open.","sources":[{"source":"copilot","file":"security-copilot.jsonl","original_fingerprint":"SecretsManagement::functions/src/recaptcha-verify.ts::hardcoded_site_key"},{"source":"chatgpt","file":"refactoring-chatgpt.jsonl","original_fingerprint":"Security/Hardening::lib/utils/secure-caller.ts::RECAPTCHA_ACTIONS::recaptcha-action-drift"},{"source":"kimi","file":"security-kimi.jsonl","original_fingerprint":"SecretsManagement::functions/src/recaptcha-verify.ts::hardcoded_key"}],"verified":true,"consensus_score":2,"canonical_id":"CANON-0038","status":"CONFIRMED","cross_cutting":true,"categories":["code","refactoring","security"],"related_findings":[{"id":"CANON-0038","category":"code","title":"Hardcoded reCAPTCHA site key fallback in Cloud Fun"},{"id":"CANON-0020","category":"refactoring","title":"reCAPTCHA action strings/constants duplicated acro"},{"id":"CANON-0020","category":"security","title":"Hardcoded reCAPTCHA Site Key Fallback"}],"file_hotspot":"functions/src/recaptcha-verify.ts","priority_score":90,"unified_id":"UNIFIED-0011"}
{"category":"code","title":"Inconsistent Admin Write Patterns (Cloud Functions vs Direct Writes)","fingerprint":"Security::components/admin/admin-crud-table.tsx::AdminCrudTable::inconsistent-write-patterns","severity":"S1","effort":"E1","confidence":100,"files":["components/admin/meetings-tab.tsx","components/admin/sober-living-tab.tsx","components/admin/quotes-tab.tsx","components/admin/glossary-tab.tsx","components/admin/slogans-tab.tsx","components/admin/admin-crud-table.tsx"],"symbols":["AdminCrudTable","cloudFunctions","service"],"duplication_cluster":{"is_cluster":false,"cluster_summary":null,"instances":[]},"why_it_matters":"AdminCrudTable accepts either cloudFunctions or service config. Meetings use Cloud Functions, others use direct client writes. Firestore rules allow admin writes for quotes/glossary/slogans but not sober_living. Inconsistent security model.","suggested_fix":"Standardize on Cloud Functions for all admin writes. Create Cloud Functions for quotes, glossary, slogans (or document why direct writes are acceptable). Update all admin tabs to use cloudFunctions config.","acceptance_tests":["All admin tabs use consistent write pattern","Firestore rules match code behavior","Security model documented and enforced"],"pr_bucket_suggestion":"security-hardening","sources":[{"source":"claude","file":"code-claude.jsonl","original_fingerprint":"Security::components/admin/admin-crud-table.tsx::AdminCrudTable::inconsistent-write-patterns"},{"source":"claude-code","file":"refactoring-claude-code.jsonl","original_fingerprint":"Duplication::components/admin::admin_api_service_missing"}],"verified":true,"consensus_score":2,"canonical_id":"CANON-0011","status":"CONFIRMED","cross_cutting":true,"categories":["code","refactoring"],"related_findings":[{"id":"CANON-0011","category":"code","title":"Inconsistent Admin Write Patterns (Cloud Functions"},{"id":"CANON-0005","category":"refactoring","title":"Admin API service missing: 30+ getFunctions()/http"}],"file_hotspot":"components/admin/meetings-tab.tsx","priority_score":85,"unified_id":"UNIFIED-0012"}
{"category":"code","title":"Inconsistent Admin Write Patterns (Cloud Functions vs Direct Writes)","fingerprint":"Security::components/admin/admin-crud-table.tsx::AdminCrudTable::inconsistent-write-patterns","severity":"S1","effort":"E1","confidence":100,"files":["components/admin/meetings-tab.tsx","components/admin/sober-living-tab.tsx","components/admin/quotes-tab.tsx","components/admin/glossary-tab.tsx","components/admin/slogans-tab.tsx","components/admin/admin-crud-table.tsx"],"symbols":["AdminCrudTable","cloudFunctions","service"],"duplication_cluster":{"is_cluster":false,"cluster_summary":null,"instances":[]},"why_it_matters":"AdminCrudTable accepts either cloudFunctions or service config. Meetings use Cloud Functions, others use direct client writes. Firestore rules allow admin writes for quotes/glossary/slogans but not sober_living. Inconsistent security model.","suggested_fix":"Standardize on Cloud Functions for all admin writes. Create Cloud Functions for quotes, glossary, slogans (or document why direct writes are acceptable). Update all admin tabs to use cloudFunctions config.","acceptance_tests":["All admin tabs use consistent write pattern","Firestore rules match code behavior","Security model documented and enforced"],"pr_bucket_suggestion":"security-hardening","sources":[{"source":"claude","file":"code-claude.jsonl","original_fingerprint":"Security::components/admin/admin-crud-table.tsx::AdminCrudTable::inconsistent-write-patterns"},{"source":"codex","file":"security-codex.jsonl","original_fingerprint":"Firebase::lib/db/quotes.ts::client-admin-writes"}],"verified":true,"consensus_score":2,"canonical_id":"CANON-0011","status":"CONFIRMED","cross_cutting":true,"categories":["code","security"],"related_findings":[{"id":"CANON-0011","category":"code","title":"Inconsistent Admin Write Patterns (Cloud Functions"},{"id":"CANON-0011","category":"security","title":"Admin CRUD uses client Firestore writes, bypassing"}],"file_hotspot":"components/admin/quotes-tab.tsx","priority_score":85,"unified_id":"UNIFIED-0013"}
{"category":"code","title":"Inconsistent Admin Write Patterns (Cloud Functions vs Direct Writes)","fingerprint":"Security::components/admin/admin-crud-table.tsx::AdminCrudTable::inconsistent-write-patterns","severity":"S1","effort":"E1","confidence":100,"files":["components/admin/meetings-tab.tsx","components/admin/sober-living-tab.tsx","components/admin/quotes-tab.tsx","components/admin/glossary-tab.tsx","components/admin/slogans-tab.tsx","components/admin/admin-crud-table.tsx"],"symbols":["AdminCrudTable","cloudFunctions","service"],"duplication_cluster":{"is_cluster":false,"cluster_summary":null,"instances":[]},"why_it_matters":"AdminCrudTable accepts either cloudFunctions or service config. Meetings use Cloud Functions, others use direct client writes. Firestore rules allow admin writes for quotes/glossary/slogans but not sober_living. Inconsistent security model.","suggested_fix":"Standardize on Cloud Functions for all admin writes. Create Cloud Functions for quotes, glossary, slogans (or document why direct writes are acceptable). Update all admin tabs to use cloudFunctions config.","acceptance_tests":["All admin tabs use consistent write pattern","Firestore rules match code behavior","Security model documented and enforced"],"pr_bucket_suggestion":"security-hardening","sources":[{"source":"claude","file":"code-claude.jsonl","original_fingerprint":"Security::components/admin/admin-crud-table.tsx::AdminCrudTable::inconsistent-write-patterns"},{"source":"codex","file":"security-codex.jsonl","original_fingerprint":"Firebase::lib/db/quotes.ts::client-admin-writes"}],"verified":true,"consensus_score":2,"canonical_id":"CANON-0011","status":"CONFIRMED","cross_cutting":true,"categories":["code","security"],"related_findings":[{"id":"CANON-0011","category":"code","title":"Inconsistent Admin Write Patterns (Cloud Functions"},{"id":"CANON-0011","category":"security","title":"Admin CRUD uses client Firestore writes, bypassing"}],"file_hotspot":"components/admin/slogans-tab.tsx","priority_score":85,"unified_id":"UNIFIED-0014"}
{"category":"code","title":"Sentry DSN, Firebase API key, and reCAPTCHA site key committed in .env.production","fingerprint":"Security::.env.production::NEXT_PUBLIC_SENTRY_DSN::secrets-in-env-production","severity":"S1","effort":"E1","confidence":100,"files":[".env.production"],"symbols":["NEXT_PUBLIC_SENTRY_DSN","NEXT_PUBLIC_FIREBASE_API_KEY","NEXT_PUBLIC_FIREBASE_APP_ID","NEXT_PUBLIC_FIREBASE_APPCHECK_RECAPTCHA_SITE_KEY"],"duplication_cluster":{"is_cluster":false},"why_it_matters":"The .env.production file is checked into Git and contains the Sentry DSN (which allows sending arbitrary error data to your Sentry project), Firebase API key, App ID, reCAPTCHA site key, and messaging sender ID. While Firebase API keys are designed to be public and restricted via App Check/rules, the Sentry DSN allows anyone to send events to your Sentry project, consuming quota or polluting data. All these values are in version history permanently.","suggested_fix":"Move secrets to CI environment variables or GitHub Actions secrets. For Sentry DSN specifically, restrict the DSN via Sentry's inbound filter settings. Consider adding .env.production to .gitignore and using GitHub secrets for build-time injection.","acceptance_tests":["Verify .env.production is not committed in future pushes","Verify build still works with env vars injected at build time","Verify Sentry DSN is restricted via Sentry project settings"],"pr_bucket_suggestion":"security-hardening","dependencies":[],"evidence":[".env.production lines 5-21: contains NEXT_PUBLIC_FIREBASE_API_KEY=AIzaSyDGvM5kFwkgSTUS..., NEXT_PUBLIC_SENTRY_DSN=https://f585a8353ec50d104e5484fedca6c2f2@..."],"notes":"Firebase API keys are restricted by App Check/Firestore rules, so exposure is low-risk. Sentry DSN is higher risk.","sources":[{"source":"copilot","file":"code-copilot.jsonl","original_fingerprint":"Security::.env.production::NEXT_PUBLIC_SENTRY_DSN::secrets-in-env-production"},{"source":"chatgpt","file":"security-chatgpt.jsonl","original_fingerprint":"SecretsManagement::.env.production::env_committed"}],"verified":true,"consensus_score":2,"canonical_id":"CANON-0014","status":"CONFIRMED","cross_cutting":true,"categories":["code","security"],"related_findings":[{"id":"CANON-0014","category":"code","title":"Sentry DSN, Firebase API key, and reCAPTCHA site k"},{"id":"CANON-0005","category":"security","title":"Committed .env.production and insufficient .gitign"}],"file_hotspot":".env.production","priority_score":85,"unified_id":"UNIFIED-0015"}
{"category":"documentation","title":"DOCUMENTATION_INDEX.md contains broken links to missing src/dataconnect-generated docs","fingerprint":"Documentation::DOCUMENTATION_INDEX.md::broken_internal_link","severity":"S1","effort":"E1","confidence":100,"files":["DOCUMENTATION_INDEX.md"],"line":464,"description":"DOCUMENTATION_INDEX.md links to generated documentation paths under src/dataconnect-generated/... that do not exist in the repository. This makes the main index misleading and creates dead navigation.","evidence":["Line 464: link to src/dataconnect-generated/README.md (file missing)","Line 472: link to src/dataconnect-generated/.guides/usage.md (file missing)","Line 473: link to src/dataconnect-generated/.guides/setup.md (file missing)","Line 481: link to src/dataconnect-generated/react/README.md (file missing)","Confirmed: no src/ directory exists in repo root"],"remediation":{"steps":["Remove these entries from DOCUMENTATION_INDEX.md OR update them to correct existing location."],"verification":["node scripts/check-docs-light.js"]},"sources":[{"source":"chatgpt","file":"engineering-productivity-chatgpt.jsonl","original_fingerprint":"engineering-productivity::package.json::missing-local-file-dependency"}],"verified":true,"consensus_score":2,"canonical_id":"CANON-0003","status":"CONFIRMED","cross_cutting":true,"categories":["documentation","engineering-productivity"],"related_findings":[{"id":"CANON-0003","category":"documentation","title":"DOCUMENTATION_INDEX.md contains broken links to mi"},{"id":"CANON-0020","category":"engineering-productivity","title":"Install/build can fail due to missing local file d"}],"file_hotspot":"DOCUMENTATION_INDEX.md","priority_score":85,"unified_id":"UNIFIED-0016"}
{"category":"code","title":"Functions code imports type from undeclared direct dependency","fingerprint":"AICode::functions/src/jobs.ts::isFileOlderThan::transitive_dependency_reliance","severity":"S2","effort":"E0","confidence":84,"files":["functions/src/jobs.ts","functions/package.json"],"symbols":["isFileOlderThan","cleanupOrphanedStorageFiles"],"duplication_cluster":{"is_cluster":false,"cluster_summary":"","instances":[]},"why_it_matters":"Relying on transitive dependencies makes builds fragile during lockfile or upstream dependency changes.","suggested_fix":"Declare @google-cloud/storage explicitly in functions/package.json or switch to types exposed via existing declared dependencies.","acceptance_tests":["npm --prefix functions run build","npm --prefix functions ls @google-cloud/storage"],"pr_bucket_suggestion":"misc","dependencies":[],"evidence":["jobs.ts imports @google-cloud/storage type symbols; dependency is not directly declared in functions/package.json."],"sources":[{"source":"codex","file":"code-codex.jsonl","original_fingerprint":"AICode::functions/src/jobs.ts::isFileOlderThan::transitive_dependency_reliance"},{"source":"jules","file":"security-jules.jsonl","original_fingerprint":"Crypto::functions/src/jobs.ts::math_random"}],"verified":true,"consensus_score":2,"canonical_id":"CANON-0037","status":"CONFIRMED","cross_cutting":true,"categories":["code","refactoring","security"],"related_findings":[{"id":"CANON-0037","category":"code","title":"Functions code imports type from undeclared direct"},{"id":"CANON-0042","category":"refactoring","title":"Direct Firestore collection access bypasses Reposi"},{"id":"CANON-0024","category":"security","title":"Insecure Randomness in jobs.ts"}],"file_hotspot":"functions/src/jobs.ts","priority_score":83.6,"unified_id":"UNIFIED-0017"}
{"category":"documentation","title":"498 external URLs need validation (expected 60-100 failures)","fingerprint":"Documentation::docs/*::external-urls-unvalidated","severity":"S1","effort":"E1","confidence":90,"files":["docs/resources/recovery-resources.md","docs/resources/treatment-centers.md","ROADMAP.md","ARCHITECTURE.md"],"line":1,"description":"498 external URLs across 100+ files haven't been validated recently. Script exists (npm run docs:external-links) but needs execution. Expected 20-30% failure rate based on domain analysis.","evidence":["498 total external URLs identified","100+ files contain external links","Script exists: scripts/check-external-links.js with SSRF protection","Expected failures: 60-100 broken links","High-risk domains: recovery-resources.md (85+ community URLs)"],"remediation":{"steps":["1. Run: npm run docs:external-links","2. Triage results for S0/S1 severity broken links","3. Fix or remove broken links in critical docs","4. Set up monthly automated validation"],"verification":["Execute script and capture results","Count failures by severity"]},"sources":[{"source":"claude-code","file":"refactoring-claude-code.jsonl","original_fingerprint":"Consistency::docs::timestamp_pattern_undocumented"}],"verified":true,"consensus_score":2,"canonical_id":"CANON-0005","status":"CONFIRMED","cross_cutting":true,"categories":["documentation","refactoring"],"related_findings":[{"id":"CANON-0005","category":"documentation","title":"498 external URLs need validation (expected 60-100"},{"id":"CANON-0054","category":"refactoring","title":"Timestamp pattern undocumented in ARCHITECTURE.md"}],"file_hotspot":"ARCHITECTURE.md","priority_score":81.3,"unified_id":"UNIFIED-0018"}
{"category":"performance","title":"Notebook Animation Delays Interactivity","fingerprint":"CoreWebVitals::notebook-shell.tsx::animation_blocking","severity":"S1","effort":"E1","confidence":80,"files":["components/notebook/notebook-shell.tsx"],"line":189,"symbols":["NotebookShell"],"performance_details":{"current_metric":"500ms animation blocks First Input Delay","expected_improvement":"Immediate interactivity with progressive enhancement","affected_metric":"INP"},"optimization":{"description":"Make animation non-blocking by using CSS transforms and will-change","verification":["Measure INP with Lighthouse","Test interactivity during animation"]},"evidence":["notebook-shell.tsx:189-195 - motion.div with 500ms duration transition"],"sources":[{"source":"copilot","file":"performance-copilot.jsonl","original_fingerprint":"CoreWebVitals::notebook-shell.tsx::animation_blocking"},{"source":"chatgpt","file":"refactoring-chatgpt.jsonl","original_fingerprint":"Security/Hardening::components/growth/DailySloganWidget.tsx::DailySloganWidget::raw-error-logging-drift"}],"verified":true,"consensus_score":2,"canonical_id":"CANON-0007","status":"CONFIRMED","cross_cutting":true,"categories":["performance","refactoring"],"related_findings":[{"id":"CANON-0007","category":"performance","title":"Notebook Animation Delays Interactivity"},{"id":"CANON-0003","category":"refactoring","title":"Error logging inconsistent: many call sites log ra"}],"file_hotspot":"components/notebook/notebook-shell.tsx","priority_score":77.5,"unified_id":"UNIFIED-0019"}
{"category":"code","title":"Critical Paths Lack Test Coverage","fingerprint":"Testing::hooks/use-journal.ts::useJournal::critical-path-no-tests","severity":"S1","effort":"E2","confidence":100,"files":["hooks/use-journal.ts","components/providers/auth-context.tsx","components/providers/profile-context.tsx","components/providers/daily-log-context.tsx","lib/auth/account-linking.ts","lib/recaptcha.ts","lib/sentry.client.ts"],"symbols":["useJournal","AuthProvider","ProfileProvider","DailyLogProvider","accountLinking","recaptcha"],"duplication_cluster":{"is_cluster":false,"cluster_summary":null,"instances":[]},"why_it_matters":"Core hooks and providers are untested. use-journal.ts: Core data management hook for all journal CRUD. auth-context.tsx: Anonymous session creation, retry logic, lastActive updates. account-linking.ts: Complex migration logic with data loss risk.","suggested_fix":"Add test files for: use-journal, auth-context, profile-context, daily-log-context, account-linking, recaptcha. Use mocks, not real Firebase. Target >80% coverage for critical paths.","acceptance_tests":["Test files exist for all critical paths","Coverage >80% for hooks and providers","Tests use mocks, not real Firebase","CI runs tests on every PR"],"pr_bucket_suggestion":"tests-hardening","sources":[{"source":"claude","file":"code-claude.jsonl","original_fingerprint":"Testing::hooks/use-journal.ts::useJournal::critical-path-no-tests"},{"source":"copilot","file":"performance-copilot.jsonl","original_fingerprint":"Offline::global::no_offline_support"},{"source":"chatgpt","file":"refactoring-chatgpt.jsonl","original_fingerprint":"Hygiene/Duplication::components/admin/admin-crud-table.tsx::AdminCrudTable::direct-firestore-reads-in-ui"}],"verified":true,"consensus_score":2,"canonical_id":"CANON-0009","status":"CONFIRMED","cross_cutting":true,"categories":["code","engineering-productivity","performance","refactoring"],"related_findings":[{"id":"CANON-0009","category":"code","title":"Critical Paths Lack Test Coverage"},{"id":"CANON-0011","category":"engineering-productivity","title":"No offline write queue — journal writes fail silen"},{"id":"CANON-0008","category":"performance","title":"No Offline Detection or Sync Queue"},{"id":"CANON-0001","category":"refactoring","title":"Direct Firestore SDK reads in UI/components bypass"}],"file_hotspot":"hooks/use-journal.ts","priority_score":72.5,"unified_id":"UNIFIED-0020"}
{"category":"code","title":"Oversized UI Components (1,000-2,000+ Lines Each)","fingerprint":"Hygiene::components/admin/users-tab.tsx::UsersTab::oversized-components","severity":"S1","effort":"E2","confidence":100,"files":["components/admin/users-tab.tsx","components/notebook/pages/today-page.tsx","components/admin/errors-tab.tsx","components/admin/dashboard-tab.tsx"],"symbols":["UsersTab","TodayPage","ErrorsTab","DashboardTab"],"duplication_cluster":{"is_cluster":false,"cluster_summary":null,"instances":[]},"why_it_matters":"Four files exceed 1,000 lines each. users-tab.tsx (2,092 lines) contains 10 getFunctions() calls, multiple state variables, complex filtering logic. Hard to understand, modify, and test.","suggested_fix":"Extract sub-components and hooks. users-tab.tsx -> UserFilters, UserTable, UserDetailModal, UserEditForm, useUserManagement hook. today-page.tsx -> JournalTextarea, MoodSelector, CravingsToggle, useTodayLog hook.","acceptance_tests":["Components render without errors","Functionality unchanged","Main components <200 lines each","No console errors during interactions"],"pr_bucket_suggestion":"misc","sources":[{"source":"claude","file":"code-claude.jsonl","original_fingerprint":"Hygiene::components/admin/users-tab.tsx::UsersTab::oversized-components"},{"source":"chatgpt","file":"refactoring-chatgpt.jsonl","original_fingerprint":"Hygiene/Duplication::components/admin/admin-crud-table.tsx::AdminCrudTable::direct-firestore-reads-in-ui"}],"verified":true,"consensus_score":2,"canonical_id":"CANON-0010","status":"CONFIRMED","cross_cutting":true,"categories":["code","engineering-productivity","performance","refactoring"],"related_findings":[{"id":"CANON-0010","category":"code","title":"Oversized UI Components (1,000-2,000+ Lines Each)"},{"id":"CANON-0023","category":"engineering-productivity","title":"Console.log used in production paths (firestore-se"},{"id":"CANON-0003","category":"performance","title":"Today page re-subscribes Firestore onSnapshot when"},{"id":"CANON-0001","category":"refactoring","title":"Direct Firestore SDK reads in UI/components bypass"}],"file_hotspot":"components/notebook/pages/today-page.tsx","priority_score":72.5,"unified_id":"UNIFIED-0021"}
{"category":"engineering-productivity","title":"No correlation ID system for distributed tracing","fingerprint":"engineering-productivity::lib/logger.ts::correlation-ids","severity":"S1","effort":"E2","confidence":100,"files":["lib/logger.ts","lib/firestore-service.ts"],"line":99,"why_it_matters":"Without correlation IDs, tracking a single user request across Cloud Functions, Firestore queries, and client-side operations is nearly impossible. Significantly increases MTTR for production incidents.","suggested_fix":"Add correlationId field to LogContext type. Create lib/correlation.ts with generateCorrelationId(). Pass correlationId to all httpsCallable functions. Update Firebase Functions to log correlationId.","acceptance_tests":["Logger interface includes correlationId in LogContext type","All Cloud Function calls include correlationId in payload","Sentry events include correlation_id tag","Can trace a single user action end-to-end using correlation ID"],"evidence":["grep -r correlationId lib/ returned 0 results","No X-Request-ID or similar tracing headers in secure-caller.ts"],"sources":[{"source":"codex","file":"code-codex.jsonl","original_fingerprint":"Framework::components/notebook/pages/today-page.tsx::calculateWeeklyStats::service_boundary_bypass"},{"source":"claude","file":"engineering-productivity-claude.jsonl","original_fingerprint":"engineering-productivity::lib/logger.ts::correlation-ids"},{"source":"jules","file":"performance-jules.jsonl","original_fingerprint":"Offline Support::lib/firestore-service.ts::cloud_function_write"},{"source":"chatgpt","file":"refactoring-chatgpt.jsonl","original_fingerprint":"Hygiene/Duplication::lib/utils/secure-caller.ts::createSecureFunctionCaller::bypass-secure-caller"}],"verified":true,"consensus_score":2,"canonical_id":"CANON-0007","status":"CONFIRMED","cross_cutting":true,"categories":["code","engineering-productivity","performance","refactoring"],"related_findings":[{"id":"CANON-0032","category":"code","title":"Today page bypasses service/repository boundary wi"},{"id":"CANON-0007","category":"engineering-productivity","title":"No correlation ID system for distributed tracing"},{"id":"CANON-0011","category":"performance","title":"Writes rely on Cloud Functions, failing when offli"},{"id":"CANON-0004","category":"refactoring","title":"Cloud Function calling patterns duplicated despite"}],"file_hotspot":"lib/firestore-service.ts","priority_score":72.5,"unified_id":"UNIFIED-0022"}
{"category":"documentation","title":"External URL dead: refugerecovery.org/meetings/ returns 404","fingerprint":"Documentation::README.md::dead_external_url_refugerecovery","severity":"S2","effort":"E0","confidence":90,"files":["README.md"],"line":1,"description":"External URL https://refugerecovery.org/meetings/ returns 404 (confirmed dead via curl spot-check). This is a user-facing link in README.md.","evidence":["curl spot-check: https://refugerecovery.org/meetings/ → 404","URL appears in README.md"],"remediation":{"steps":["Find current URL for Refuge Recovery meetings or remove/replace the link","Run npm run docs:external-links for full external link validation"],"verification":["npm run docs:external-links shows 0 dead links in README.md"]},"sources":[{"source":"claude","file":"documentation-claude.jsonl","original_fingerprint":"Documentation::README.md::dead_external_url_refugerecovery"},{"source":"chatgpt","file":"engineering-productivity-chatgpt.jsonl","original_fingerprint":"engineering-productivity::README.md::missing-quick-start-commands"}],"verified":true,"consensus_score":2,"canonical_id":"CANON-0031","status":"CONFIRMED","cross_cutting":true,"categories":["documentation","engineering-productivity"],"related_findings":[{"id":"CANON-0031","category":"documentation","title":"External URL dead: refugerecovery.org/meetings/ re"},{"id":"CANON-0021","category":"engineering-productivity","title":"README lacks runnable Quick Start commands (no npm"}],"file_hotspot":"README.md","priority_score":67,"unified_id":"UNIFIED-0023"}
{"category":"code","title":"App Check is entirely disabled on client and server","fingerprint":"Security::lib/firebase.ts::initializeFirebase::appcheck-disabled","severity":"S1","effort":"E2","confidence":100,"files":["lib/firebase.ts","functions/src/index.ts"],"symbols":["initializeFirebase","_appCheck","saveDailyLog"],"duplication_cluster":{"is_cluster":false},"why_it_matters":"The entire App Check initialization block in lib/firebase.ts is commented out (lines 57-90), and server-side requireAppCheck is set to false. This means there is NO attestation layer verifying that requests come from your legitimate app. Any attacker can call your Cloud Functions directly using the public Firebase config. Disabled since Dec 31, 2025 — 5+ weeks past stated re-enable date.","suggested_fix":"Re-enable App Check on both client (lib/firebase.ts) and server (requireAppCheck: true in functions/src/index.ts). Test with debug token in development.","acceptance_tests":["App Check tokens are attached to Cloud Function calls","Requests without valid App Check tokens are rejected","Legitimate app usage still works"],"pr_bucket_suggestion":"security-hardening","dependencies":[],"evidence":["lib/firebase.ts:57-90 — entire App Check block is /* commented out */","functions/src/index.ts — requireAppCheck: false"],"notes":"","sources":[{"source":"copilot","file":"code-copilot.jsonl","original_fingerprint":"Security::lib/firebase.ts::initializeFirebase::appcheck-disabled"},{"source":"claude","file":"refactoring-claude.jsonl","original_fingerprint":"Security::functions/src/admin.ts::weak_admin_checks"},{"source":"chatgpt","file":"security-chatgpt.jsonl","original_fingerprint":"Firebase::functions/src/index.ts::appcheck_disabled"},{"source":"codex","file":"security-codex.jsonl","original_fingerprint":"Firebase::functions/src/index.ts::app-check-disabled"}],"verified":true,"consensus_score":2,"canonical_id":"CANON-0015","status":"CONFIRMED","cross_cutting":true,"categories":["code","refactoring","security"],"related_findings":[{"id":"CANON-0015","category":"code","title":"App Check is entirely disabled on client and serve"},{"id":"CANON-0011","category":"refactoring","title":"admin functions use weaker security checks than us"},{"id":"CANON-0002","category":"security","title":"App Check enforcement disabled on callable write e"}],"file_hotspot":"functions/src/index.ts","priority_score":60,"unified_id":"UNIFIED-0024"}
{"category":"performance","title":"Framer Motion Overuse - Heavy Animation Library","fingerprint":"Bundle::package.json::framer_motion_size","severity":"S1","effort":"E2","confidence":90,"files":["package.json","components/notebook/sticky-note.tsx","components/celebrations/success-pulse.tsx","components/ui/empty-state.tsx","components/journal/entry-menu.tsx","components/journal/floating-pen.tsx","components/notebook/bookmark-ribbon.tsx","components/widgets/daily-quote-card.tsx"],"line":92,"symbols":["framer-motion"],"performance_details":{"current_metric":"~45KB gzipped for simple animations","expected_improvement":"Reduce bundle by 30-40KB using CSS animations","affected_metric":"bundle"},"optimization":{"description":"Replace framer-motion with CSS transitions for simple fade/scale animations. Keep for complex 3D transforms in notebook-shell.","code_example":"// Before (framer-motion):\n<motion.div initial={{ opacity: 0 }} animate={{ opacity: 1 }} />\n\n// After (CSS):\n<div className=\"animate-fade-in\" /> // with @keyframes in CSS","verification":["Run npx @next/bundle-analyzer","Measure bundle size before/after","Test animation smoothness"]},"evidence":["10+ components import framer-motion for simple animations","sticky-note.tsx:15 - simple scale animation","floating-pen.tsx:14 - scale/rotate on hover","daily-quote-card.tsx:3 - fade-in animation"],"sources":[{"source":"claude","file":"code-claude.jsonl","original_fingerprint":"Hygiene::components/widgets/daily-quote-card.tsx::DailyQuoteCard::duplicate-quote-widgets"},{"source":"copilot","file":"refactoring-copilot.jsonl","original_fingerprint":"Hygiene/Duplication::components/widgets/daily-quote-card.tsx::DailyQuoteCard::quote-card-dup"}],"verified":true,"consensus_score":2,"canonical_id":"CANON-0005","status":"CONFIRMED","cross_cutting":true,"categories":["code","performance","refactoring"],"related_findings":[{"id":"CANON-0024","category":"code","title":"Duplicate Quote Widget Components (3 Variants)"},{"id":"CANON-0005","category":"performance","title":"Framer Motion Overuse - Heavy Animation Library"},{"id":"CANON-0052","category":"refactoring","title":"DailyQuoteCard component may be duplicated in 2-3 "}],"file_hotspot":"components/widgets/daily-quote-card.tsx","priority_score":57.5,"unified_id":"UNIFIED-0025"}
{"category":"code","title":"Type Divergence: Client types vs Server schemas","fingerprint":"Types::types/journal.ts::JournalEntry::client-server-divergence","severity":"S1","effort":"E2","confidence":85,"files":["types/journal.ts","functions/src/schemas.ts"],"symbols":["JournalEntry","journalEntrySchema"],"duplication_cluster":{"is_cluster":false,"cluster_summary":"","instances":[]},"why_it_matters":"Client TypeScript types and server Zod schemas define journal entries independently, leading to silent validation failures. Adding new entry types requires coordinated changes in 2+ places with no automated consistency check.","suggested_fix":"Create single source of truth: lib/types/journal-shared.ts with Zod schemas. Generate TypeScript types using zod's z.infer<typeof schema>. Export both schema (for validation) and type (for TypeScript). Import in both client and server.","acceptance_tests":["Schemas validate expected journal entry structures","TypeScript types match Zod schema shapes","Client-side validation catches same errors as server","No breaking changes to existing journal entries"],"pr_bucket_suggestion":"types-domain","dependencies":[],"evidence":["DEBT-0049 confirms this issue","grep shows 142 Zod schema definitions across codebase","Types defined separately in types/ directory"],"notes":"Already tracked as DEBT-0049 with roadmap placement M2.1. Affects data integrity.","sources":[{"source":"claude-code","file":"code-claude-code.jsonl","original_fingerprint":"Types::types/journal.ts::JournalEntry::client-server-divergence"},{"source":"copilot","file":"security-copilot.jsonl","original_fingerprint":"InputValidation::functions/src/schemas.ts::missing_strict"},{"source":"chatgpt","file":"security-chatgpt.jsonl","original_fingerprint":"InputValidation::functions/src/schemas.ts::missing_strict"}],"verified":true,"consensus_score":2,"canonical_id":"CANON-0004","status":"CONFIRMED","cross_cutting":true,"categories":["code","refactoring","security"],"related_findings":[{"id":"CANON-0004","category":"code","title":"Type Divergence: Client types vs Server schemas"},{"id":"CANON-0013","category":"refactoring","title":"JournalEntryType string literals defined in 4+ loc"},{"id":"CANON-0006","category":"security","title":"Cloud Function Zod schemas are not strict; unknown"}],"file_hotspot":"functions/src/schemas.ts","priority_score":56.3,"unified_id":"UNIFIED-0026"}
{"category":"code","title":"God Object: components/admin/users-tab.tsx (2092 lines)","fingerprint":"Hygiene::components/admin/users-tab.tsx::UsersTab::god-component","severity":"S1","effort":"E2","confidence":100,"files":["components/admin/users-tab.tsx"],"symbols":["UsersTab"],"duplication_cluster":{"is_cluster":false,"cluster_summary":"","instances":[]},"why_it_matters":"2092-line component violates React best practices. Single component handles user search, pagination, profile viewing, editing, privilege management, soft-delete, and hard-delete. Difficult to test and maintain.","suggested_fix":"Extract sub-components: UserSearchPanel, UserProfileCard, UserEditDialog, PrivilegeManager, UserDeleteControls. Move data fetching to custom hooks: useUserSearch, useUserProfile, useUserPrivileges. Target: main component <200 lines.","acceptance_tests":["Component renders without errors","User search functionality unchanged","Privilege updates work end-to-end","Soft-delete and hard-delete workflows functional","No console errors during interactions"],"pr_bucket_suggestion":"ui-primitives","dependencies":[],"evidence":["wc -l shows 2092 lines","Component imports 20+ icons from lucide-react","Contains inline helper functions at lines 97-200","Multiple useState calls (10+) managing complex state"],"notes":"Part of admin panel complexity. See also errors-tab.tsx (1095 lines) and dashboard-tab.tsx (1031 lines). Total admin components: 13,159 lines.","sources":[{"source":"claude-code","file":"code-claude-code.jsonl","original_fingerprint":"Hygiene::components/admin/users-tab.tsx::UsersTab::god-component"},{"source":"chatgpt","file":"refactoring-chatgpt.jsonl","original_fingerprint":"Hygiene/Duplication::lib/utils/secure-caller.ts::createSecureFunctionCaller::bypass-secure-caller"}],"verified":true,"consensus_score":2,"canonical_id":"CANON-0003","status":"CONFIRMED","cross_cutting":true,"categories":["code","refactoring"],"related_findings":[{"id":"CANON-0003","category":"code","title":"God Object: components/admin/users-tab.tsx (2092 l"},{"id":"CANON-0004","category":"refactoring","title":"Cloud Function calling patterns duplicated despite"}],"file_hotspot":"components/admin/users-tab.tsx","priority_score":47.5,"unified_id":"UNIFIED-0027"}
{"category":"code","title":"Critical Paths Lack Test Coverage","fingerprint":"Testing::hooks/use-journal.ts::useJournal::critical-path-no-tests","severity":"S1","effort":"E2","confidence":100,"files":["hooks/use-journal.ts","components/providers/auth-context.tsx","components/providers/profile-context.tsx","components/providers/daily-log-context.tsx","lib/auth/account-linking.ts","lib/recaptcha.ts","lib/sentry.client.ts"],"symbols":["useJournal","AuthProvider","ProfileProvider","DailyLogProvider","accountLinking","recaptcha"],"duplication_cluster":{"is_cluster":false,"cluster_summary":null,"instances":[]},"why_it_matters":"Core hooks and providers are untested. use-journal.ts: Core data management hook for all journal CRUD. auth-context.tsx: Anonymous session creation, retry logic, lastActive updates. account-linking.ts: Complex migration logic with data loss risk.","suggested_fix":"Add test files for: use-journal, auth-context, profile-context, daily-log-context, account-linking, recaptcha. Use mocks, not real Firebase. Target >80% coverage for critical paths.","acceptance_tests":["Test files exist for all critical paths","Coverage >80% for hooks and providers","Tests use mocks, not real Firebase","CI runs tests on every PR"],"pr_bucket_suggestion":"tests-hardening","sources":[{"source":"claude","file":"code-claude.jsonl","original_fingerprint":"Testing::hooks/use-journal.ts::useJournal::critical-path-no-tests"},{"source":"claude-code","file":"performance-claude-code.jsonl","original_fingerprint":"Memory::hooks::multiple_onSnapshot"}],"verified":true,"consensus_score":2,"canonical_id":"CANON-0009","status":"CONFIRMED","cross_cutting":true,"categories":["code","performance"],"related_findings":[{"id":"CANON-0009","category":"code","title":"Critical Paths Lack Test Coverage"},{"id":"CANON-0053","category":"performance","title":"4 real-time onSnapshot listeners active simultaneo"}],"file_hotspot":"components/providers/profile-context.tsx","priority_score":47.5,"unified_id":"UNIFIED-0028"}
{"category":"code","title":"Critical Paths Lack Test Coverage","fingerprint":"Testing::hooks/use-journal.ts::useJournal::critical-path-no-tests","severity":"S1","effort":"E2","confidence":100,"files":["hooks/use-journal.ts","components/providers/auth-context.tsx","components/providers/profile-context.tsx","components/providers/daily-log-context.tsx","lib/auth/account-linking.ts","lib/recaptcha.ts","lib/sentry.client.ts"],"symbols":["useJournal","AuthProvider","ProfileProvider","DailyLogProvider","accountLinking","recaptcha"],"duplication_cluster":{"is_cluster":false,"cluster_summary":null,"instances":[]},"why_it_matters":"Core hooks and providers are untested. use-journal.ts: Core data management hook for all journal CRUD. auth-context.tsx: Anonymous session creation, retry logic, lastActive updates. account-linking.ts: Complex migration logic with data loss risk.","suggested_fix":"Add test files for: use-journal, auth-context, profile-context, daily-log-context, account-linking, recaptcha. Use mocks, not real Firebase. Target >80% coverage for critical paths.","acceptance_tests":["Test files exist for all critical paths","Coverage >80% for hooks and providers","Tests use mocks, not real Firebase","CI runs tests on every PR"],"pr_bucket_suggestion":"tests-hardening","sources":[{"source":"claude","file":"code-claude.jsonl","original_fingerprint":"Testing::hooks/use-journal.ts::useJournal::critical-path-no-tests"},{"source":"chatgpt","file":"refactoring-chatgpt.jsonl","original_fingerprint":"Hygiene/Duplication::lib/utils/secure-caller.ts::createSecureFunctionCaller::bypass-secure-caller"}],"verified":true,"consensus_score":2,"canonical_id":"CANON-0009","status":"CONFIRMED","cross_cutting":true,"categories":["code","refactoring"],"related_findings":[{"id":"CANON-0009","category":"code","title":"Critical Paths Lack Test Coverage"},{"id":"CANON-0004","category":"refactoring","title":"Cloud Function calling patterns duplicated despite"}],"file_hotspot":"lib/auth/account-linking.ts","priority_score":47.5,"unified_id":"UNIFIED-0029"}
{"category":"code","title":"Critical Paths Lack Test Coverage","fingerprint":"Testing::hooks/use-journal.ts::useJournal::critical-path-no-tests","severity":"S1","effort":"E2","confidence":100,"files":["hooks/use-journal.ts","components/providers/auth-context.tsx","components/providers/profile-context.tsx","components/providers/daily-log-context.tsx","lib/auth/account-linking.ts","lib/recaptcha.ts","lib/sentry.client.ts"],"symbols":["useJournal","AuthProvider","ProfileProvider","DailyLogProvider","accountLinking","recaptcha"],"duplication_cluster":{"is_cluster":false,"cluster_summary":null,"instances":[]},"why_it_matters":"Core hooks and providers are untested. use-journal.ts: Core data management hook for all journal CRUD. auth-context.tsx: Anonymous session creation, retry logic, lastActive updates. account-linking.ts: Complex migration logic with data loss risk.","suggested_fix":"Add test files for: use-journal, auth-context, profile-context, daily-log-context, account-linking, recaptcha. Use mocks, not real Firebase. Target >80% coverage for critical paths.","acceptance_tests":["Test files exist for all critical paths","Coverage >80% for hooks and providers","Tests use mocks, not real Firebase","CI runs tests on every PR"],"pr_bucket_suggestion":"tests-hardening","sources":[{"source":"claude","file":"code-claude.jsonl","original_fingerprint":"Testing::hooks/use-journal.ts::useJournal::critical-path-no-tests"},{"source":"copilot","file":"refactoring-copilot.jsonl","original_fingerprint":"Testing Infrastructure::hooks/use-journal.ts::useJournal::missing-critical-tests"}],"verified":true,"consensus_score":2,"canonical_id":"CANON-0009","status":"CONFIRMED","cross_cutting":true,"categories":["code","refactoring"],"related_findings":[{"id":"CANON-0009","category":"code","title":"Critical Paths Lack Test Coverage"},{"id":"CANON-0041","category":"refactoring","title":"Critical auth and journal paths have minimal/no te"}],"file_hotspot":"lib/recaptcha.ts","priority_score":47.5,"unified_id":"UNIFIED-0030"}
{"category":"code","title":"Oversized UI Components (1,000-2,000+ Lines Each)","fingerprint":"Hygiene::components/admin/users-tab.tsx::UsersTab::oversized-components","severity":"S1","effort":"E2","confidence":100,"files":["components/admin/users-tab.tsx","components/notebook/pages/today-page.tsx","components/admin/errors-tab.tsx","components/admin/dashboard-tab.tsx"],"symbols":["UsersTab","TodayPage","ErrorsTab","DashboardTab"],"duplication_cluster":{"is_cluster":false,"cluster_summary":null,"instances":[]},"why_it_matters":"Four files exceed 1,000 lines each. users-tab.tsx (2,092 lines) contains 10 getFunctions() calls, multiple state variables, complex filtering logic. Hard to understand, modify, and test.","suggested_fix":"Extract sub-components and hooks. users-tab.tsx -> UserFilters, UserTable, UserDetailModal, UserEditForm, useUserManagement hook. today-page.tsx -> JournalTextarea, MoodSelector, CravingsToggle, useTodayLog hook.","acceptance_tests":["Components render without errors","Functionality unchanged","Main components <200 lines each","No console errors during interactions"],"pr_bucket_suggestion":"misc","sources":[{"source":"claude","file":"code-claude.jsonl","original_fingerprint":"Hygiene::components/admin/users-tab.tsx::UsersTab::oversized-components"},{"source":"chatgpt","file":"refactoring-chatgpt.jsonl","original_fingerprint":"Security/Hardening::components/growth/DailySloganWidget.tsx::DailySloganWidget::raw-error-logging-drift"}],"verified":true,"consensus_score":2,"canonical_id":"CANON-0010","status":"CONFIRMED","cross_cutting":true,"categories":["code","refactoring"],"related_findings":[{"id":"CANON-0010","category":"code","title":"Oversized UI Components (1,000-2,000+ Lines Each)"},{"id":"CANON-0003","category":"refactoring","title":"Error logging inconsistent: many call sites log ra"}],"file_hotspot":"components/admin/errors-tab.tsx","priority_score":47.5,"unified_id":"UNIFIED-0031"}
{"category":"code","title":"Oversized UI Components (1,000-2,000+ Lines Each)","fingerprint":"Hygiene::components/admin/users-tab.tsx::UsersTab::oversized-components","severity":"S1","effort":"E2","confidence":100,"files":["components/admin/users-tab.tsx","components/notebook/pages/today-page.tsx","components/admin/errors-tab.tsx","components/admin/dashboard-tab.tsx"],"symbols":["UsersTab","TodayPage","ErrorsTab","DashboardTab"],"duplication_cluster":{"is_cluster":false,"cluster_summary":null,"instances":[]},"why_it_matters":"Four files exceed 1,000 lines each. users-tab.tsx (2,092 lines) contains 10 getFunctions() calls, multiple state variables, complex filtering logic. Hard to understand, modify, and test.","suggested_fix":"Extract sub-components and hooks. users-tab.tsx -> UserFilters, UserTable, UserDetailModal, UserEditForm, useUserManagement hook. today-page.tsx -> JournalTextarea, MoodSelector, CravingsToggle, useTodayLog hook.","acceptance_tests":["Components render without errors","Functionality unchanged","Main components <200 lines each","No console errors during interactions"],"pr_bucket_suggestion":"misc","sources":[{"source":"claude","file":"code-claude.jsonl","original_fingerprint":"Hygiene::components/admin/users-tab.tsx::UsersTab::oversized-components"},{"source":"chatgpt","file":"refactoring-chatgpt.jsonl","original_fingerprint":"Security/Hardening::components/growth/DailySloganWidget.tsx::DailySloganWidget::raw-error-logging-drift"}],"verified":true,"consensus_score":2,"canonical_id":"CANON-0010","status":"CONFIRMED","cross_cutting":true,"categories":["code","refactoring"],"related_findings":[{"id":"CANON-0010","category":"code","title":"Oversized UI Components (1,000-2,000+ Lines Each)"},{"id":"CANON-0003","category":"refactoring","title":"Error logging inconsistent: many call sites log ra"}],"file_hotspot":"components/admin/dashboard-tab.tsx","priority_score":47.5,"unified_id":"UNIFIED-0032"}
{"category":"engineering-productivity","title":"No correlation ID system for distributed tracing","fingerprint":"engineering-productivity::lib/logger.ts::correlation-ids","severity":"S1","effort":"E2","confidence":100,"files":["lib/logger.ts","lib/firestore-service.ts"],"line":99,"why_it_matters":"Without correlation IDs, tracking a single user request across Cloud Functions, Firestore queries, and client-side operations is nearly impossible. Significantly increases MTTR for production incidents.","suggested_fix":"Add correlationId field to LogContext type. Create lib/correlation.ts with generateCorrelationId(). Pass correlationId to all httpsCallable functions. Update Firebase Functions to log correlationId.","acceptance_tests":["Logger interface includes correlationId in LogContext type","All Cloud Function calls include correlationId in payload","Sentry events include correlation_id tag","Can trace a single user action end-to-end using correlation ID"],"evidence":["grep -r correlationId lib/ returned 0 results","No X-Request-ID or similar tracing headers in secure-caller.ts"],"sources":[{"source":"claude","file":"engineering-productivity-claude.jsonl","original_fingerprint":"engineering-productivity::lib/logger.ts::correlation-ids"}],"verified":true,"consensus_score":2,"canonical_id":"CANON-0007","status":"CONFIRMED","cross_cutting":true,"categories":["code","engineering-productivity"],"related_findings":[{"id":"CANON-0028","category":"code","title":"Network Status Not Captured in Error Logs"},{"id":"CANON-0007","category":"engineering-productivity","title":"No correlation ID system for distributed tracing"}],"file_hotspot":"lib/logger.ts","priority_score":47.5,"unified_id":"UNIFIED-0033"}
{"category":"engineering-productivity","title":"No service worker — app cannot load at all when offline","fingerprint":"engineering-productivity::public/sw.js::no-service-worker","severity":"S1","effort":"E2","confidence":95,"files":["public/","next.config.mjs"],"why_it_matters":"Without a service worker, the app shows a blank page/browser error when offline. Users in poor-connectivity scenarios cannot access any functionality. PWA manifest exists but is incomplete without SW.","suggested_fix":"Implement service worker using next-pwa or workbox. Cache app shell, static assets, and runtime API responses.","acceptance_tests":["App loads cached shell when offline","Service worker registered and active","Network-first with cache fallback for APIs"],"evidence":["No public/sw.js file exists","manifest.json exists but no SW to activate it","components/pwa/install-prompt.tsx exists but is non-functional without SW"],"line":1,"sources":[{"source":"copilot","file":"engineering-productivity-copilot.jsonl","original_fingerprint":"engineering-productivity::public/sw.js::no-service-worker"},{"source":"claude-code","file":"performance-claude-code.jsonl","original_fingerprint":"Bundle Size::next.config.mjs::images_unoptimized"}],"verified":true,"consensus_score":2,"canonical_id":"CANON-0010","status":"CONFIRMED","cross_cutting":true,"categories":["engineering-productivity","performance"],"related_findings":[{"id":"CANON-0010","category":"engineering-productivity","title":"No service worker — app cannot load at all when of"},{"id":"CANON-0004","category":"performance","title":"images.unoptimized: true disables all Next.js imag"}],"file_hotspot":"next.config.mjs","priority_score":46.6,"unified_id":"UNIFIED-0034"}
{"category":"code","title":"Potential empty catch blocks in scripts","fingerprint":"Debugging::scripts/::catch::empty-catch-blocks","severity":"S2","effort":"E0","confidence":30,"files":["scripts/seed-real-data.ts","scripts/sync-geocache.ts"],"symbols":[],"duplication_cluster":{"is_cluster":false},"why_it_matters":"Scripts use try/catch patterns where some catch blocks only log minimal info. In script contexts, swallowed errors can cause silent data corruption.","suggested_fix":"Ensure all script catch blocks log full error context and either re-throw or exit with non-zero code.","acceptance_tests":["No empty catch blocks in scripts"],"pr_bucket_suggestion":"misc","dependencies":[],"evidence":["scripts/seed-real-data.ts: bare catch { console.error('Error...'); process.exit(1); }"],"notes":"Limited visibility.","sources":[{"source":"copilot-suspected","file":"code-copilot-suspected.jsonl","original_fingerprint":"Debugging::scripts/::catch::empty-catch-blocks"},{"source":"chatgpt","file":"process-chatgpt.jsonl","original_fingerprint":"standalone-scripts::scripts/*.ts::unreachable-ts-scripts"}],"verified":true,"consensus_score":1.5,"canonical_id":"CANON-0055","status":"SUSPECTED","cross_cutting":true,"categories":["code","process"],"related_findings":[{"id":"CANON-0055","category":"code","title":"Potential empty catch blocks in scripts"},{"id":"CANON-0011","category":"process","title":"Multiple TypeScript scripts in scripts/ are not wi"}],"file_hotspot":"scripts/seed-real-data.ts","priority_score":46.5,"unified_id":"UNIFIED-0035"}
{"category":"refactoring","title":"Direct Firestore SDK reads in UI/components bypass typed db/services","fingerprint":"Hygiene/Duplication::components/admin/admin-crud-table.tsx::AdminCrudTable::direct-firestore-reads-in-ui","severity":"S1","effort":"E2","confidence":92,"files":["components/admin/admin-crud-table.tsx","components/dev/lighthouse-tab.tsx","components/growth/DailySloganWidget.tsx","components/notebook/pages/today-page.tsx","hooks/use-journal.ts","lib/db/collections.ts"],"symbols":["AdminCrudTable","LighthouseTab","DailySloganWidget","TodayPage","useJournal","collectionRef"],"duplication_cluster":{"is_cluster":true,"cluster_summary":"Multiple UI modules directly call Firestore SDK (collection/query/getDocs/onSnapshot) and manually map docs, despite having typed collection helpers (lib/db/collections.ts) and db service modules. This creates drift in query patterns, error handling, and type safety.","instances":[{"file":"components/admin/admin-crud-table.tsx","symbol":"AdminCrudTable"},{"file":"components/dev/lighthouse-tab.tsx","symbol":"LighthouseTab"},{"file":"components/growth/DailySloganWidget.tsx","symbol":"DailySloganWidget"},{"file":"components/notebook/pages/today-page.tsx","symbol":"TodayPage"},{"file":"hooks/use-journal.ts","symbol":"useJournal"}],"consolidation_target":"lib/db/* services + lib/db/collections.ts (create small repo-layer functions per feature and have UI call those)"},"why_it_matters":"Firestore access scattered across UI increases duplication and makes behavior inconsistent (query limits, mapping, validation, error logging). It also makes refactors (schema/paths/security) harder and riskier.","suggested_fix":"Introduce feature-scoped repo/service functions (e.g., lib/db/dev-lighthouse.ts, lib/db/slogans.ts usage from widgets) that encapsulate Firestore reads, mapping, and validation. UI components should consume services/hooks only and stop importing firebase/firestore directly.","acceptance_tests":["npm run lint","npm run test","npm run test:coverage"],"pr_bucket_suggestion":"firebase-access","dependencies":[],"evidence":["components/admin/admin-crud-table.tsx:60-66 uses collection(db, config.collectionName) + getDocs","components/dev/lighthouse-tab.tsx:63-72 uses collection(db,'dev','lighthouse','history') + getDocs","components/growth/DailySloganWidget.tsx:23-29 uses collection(db,'slogans') + getDocs","components/notebook/pages/today-page.tsx:710+ dynamic import firebase/firestore then collection(db, users/${user.uid}/daily_logs)","hooks/use-journal.ts:270-305 uses collection(db, users/${user.uid}/journal) + onSnapshot"],"notes":"This is a cross-cutting boundary issue too (UI vs data layer).","sources":[{"source":"chatgpt","file":"refactoring-chatgpt.jsonl","original_fingerprint":"Hygiene/Duplication::components/admin/admin-crud-table.tsx::AdminCrudTable::direct-firestore-reads-in-ui"}],"verified":true,"consensus_score":2,"canonical_id":"CANON-0001","status":"CONFIRMED","cross_cutting":true,"categories":["performance","refactoring"],"related_findings":[{"id":"CANON-0016","category":"performance","title":"DailySloganWidget fetches entire slogans collectio"},{"id":"CANON-0001","category":"refactoring","title":"Direct Firestore SDK reads in UI/components bypass"}],"file_hotspot":"components/growth/DailySloganWidget.tsx","priority_score":46,"unified_id":"UNIFIED-0036"}
{"category":"refactoring","title":"Cloud Function calling patterns duplicated despite existing secure-caller abstraction","fingerprint":"Hygiene/Duplication::lib/utils/secure-caller.ts::createSecureFunctionCaller::bypass-secure-caller","severity":"S1","effort":"E2","confidence":89,"files":["components/admin/admin-crud-table.tsx","components/admin/analytics-tab.tsx","components/admin/dashboard-tab.tsx","components/admin/errors-tab.tsx","components/admin/jobs-tab.tsx","components/admin/logs-tab.tsx","components/admin/privileges-tab.tsx","components/admin/users-tab.tsx","hooks/use-journal.ts","lib/auth/account-linking.ts","lib/firestore-service.ts","lib/utils/secure-caller.ts"],"symbols":["AdminCrudTable","AnalyticsTab","DashboardTab","ErrorsTab","JobsTab","LogsTab","PrivilegesTab","UsersTab","useJournal","linkWithEmail","linkWithGoogle","createFirestoreService","createSecureFunctionCaller"],"duplication_cluster":{"is_cluster":true,"cluster_summary":"Many call sites directly use getFunctions()+httpsCallable() even though lib/utils/secure-caller.ts exists to standardize retries, recaptcha, and result shaping.","instances":[{"file":"components/admin/users-tab.tsx","symbol":"UsersTab"},{"file":"hooks/use-journal.ts","symbol":"useJournal"},{"file":"lib/auth/account-linking.ts","symbol":"linkWithEmail"},{"file":"lib/firestore-service.ts","symbol":"createFirestoreService"}],"consolidation_target":"lib/utils/secure-caller.ts (wrap all callable usage)"},"why_it_matters":"Duplicated callable wiring increases inconsistency in retries, error normalization, auth/context, and security. It also bloats UI components and makes changes expensive.","suggested_fix":"Adopt secure-caller as the only supported path: create per-function typed wrappers built from createSecureFunctionCaller. Migrate admin tabs and hooks to call wrappers rather than httpsCallable directly.","acceptance_tests":["npm run lint","npm run test","npm run test:coverage"],"pr_bucket_suggestion":"firebase-access","dependencies":[],"evidence":["grep httpsCallable hits include components/admin/, hooks/use-journal.ts, lib/auth/account-linking.ts, lib/firestore-service.ts","lib/utils/secure-caller.ts defines createSecureFunctionCaller and documents standardized usage"],"notes":"Admin-only screens may keep custom behavior, but should still reuse the shared caller.","sources":[{"source":"claude","file":"engineering-productivity-claude.jsonl","original_fingerprint":"engineering-productivity::lib/firestore-service.ts::console-logging"},{"source":"chatgpt","file":"refactoring-chatgpt.jsonl","original_fingerprint":"Hygiene/Duplication::lib/utils/secure-caller.ts::createSecureFunctionCaller::bypass-secure-caller"}],"verified":true,"consensus_score":2,"canonical_id":"CANON-0004","status":"CONFIRMED","cross_cutting":true,"categories":["engineering-productivity","refactoring"],"related_findings":[{"id":"CANON-0027","category":"engineering-productivity","title":"46 console.log statements remain in production cod"},{"id":"CANON-0004","category":"refactoring","title":"Cloud Function calling patterns duplicated despite"}],"file_hotspot":"lib/utils/secure-caller.ts","priority_score":45.4,"unified_id":"UNIFIED-0037"}
{"category":"refactoring","title":"Error logging inconsistent: many call sites log raw error objects instead of sanitized errorType/errorCode","fingerprint":"Security/Hardening::components/growth/DailySloganWidget.tsx::DailySloganWidget::raw-error-logging-drift","severity":"S1","effort":"E2","confidence":88,"files":["app/admin/page.tsx","app/meetings/all/page.tsx","components/admin/analytics-tab.tsx","components/admin/dashboard-tab.tsx","components/admin/errors-tab.tsx","components/admin/jobs-tab.tsx","components/admin/links-tab.tsx","components/admin/logs-tab.tsx","components/admin/prayers-tab.tsx","components/auth/sign-in-modal.tsx","components/growth/DailySloganWidget.tsx","components/growth/GratitudeCard.tsx","components/growth/NightReviewCard.tsx","components/growth/SpotCheckCard.tsx","components/growth/Step1WorksheetCard.tsx","components/journal/entry-forms/daily-log-form.tsx","components/journal/entry-forms/free-write-form.tsx","components/journal/entry-forms/gratitude-form.tsx","components/journal/entry-forms/inventory-form.tsx","components/journal/entry-forms/mood-form.tsx","components/journal/entry-wizard.tsx","components/journal/journal-hub.tsx","components/notebook/journal-modal.tsx","components/notebook/notebook-shell.tsx","components/notebook/pages/library-page.tsx","components/notebook/pages/resources-page.tsx","components/widgets/compact-meeting-countdown.tsx","hooks/use-speech-recognition.ts","lib/db/library.ts","lib/db/meetings.ts","lib/utils/retry.ts"],"symbols":["AdminPage","AllMeetingsPage","AnalyticsTab","DashboardTab","ErrorsTab","JobsTab","LinksTab","LogsTab","PrayersTab","SignInModal","DailySloganWidget","GratitudeCard","NightReviewCard","SpotCheckCard","Step1WorksheetCard","DailyLogForm","FreeWriteForm","GratitudeForm","InventoryForm","MoodForm","EntryWizard","JournalHub","JournalModal","NotebookShell","LibraryPage","ResourcesPage","CompactMeetingCountdown","useSpeechRecognition","getAllQuickLinks","MeetingsService","retryWithBackoff"],"duplication_cluster":{"is_cluster":true,"cluster_summary":"Many modules call logger.error(..., { error }) or logger.error(..., { error: err }) which can leak raw error objects (PII/stack traces/SDK internals), while other code follows a sanitized pattern (errorType/errorCode).","instances":[{"file":"app/admin/page.tsx","symbol":"AdminPage"},{"file":"components/growth/DailySloganWidget.tsx","symbol":"DailySloganWidget"},{"file":"components/admin/dashboard-tab.tsx","symbol":"DashboardTab"}],"consolidation_target":"lib/logger.ts (add logger.safeError / helper to normalize errorType+errorCode and forbid raw error payloads)"},"why_it_matters":"Raw error objects can contain sensitive metadata and are inconsistent with the repo's own CANON guidance. Consolidation reduces security/PII risk and keeps observability consistent.","suggested_fix":"Create a single helper (e.g., logErrorSafe(message, err, context)) that extracts errorType/errorCode and optionally masks identifiers. Replace all {error}/{error:err} callsites via codemod/grep-driven edits.","acceptance_tests":["npm run lint","npm run test","npm run test:coverage"],"pr_bucket_suggestion":"security-hardening","dependencies":[],"evidence":["components/growth/DailySloganWidget.tsx:38 logger.error('Error fetching daily slogan', { error })","components/admin/dashboard-tab.tsx multiple logger.error(...,{ error: err })","components/journal/* forms logger.error(...,{ error })"],"notes":"Some admin/dev logs may be acceptable internally, but consolidating still improves predictability.","sources":[{"source":"claude","file":"code-claude.jsonl","original_fingerprint":"Hygiene::components/widgets/meeting-countdown.tsx::MeetingCountdown::duplicate-countdown-widgets"},{"source":"chatgpt","file":"refactoring-chatgpt.jsonl","original_fingerprint":"Security/Hardening::components/growth/DailySloganWidget.tsx::DailySloganWidget::raw-error-logging-drift"}],"verified":true,"consensus_score":2,"canonical_id":"CANON-0003","status":"CONFIRMED","cross_cutting":true,"categories":["code","refactoring"],"related_findings":[{"id":"CANON-0026","category":"code","title":"Duplicate Meeting Countdown Widgets (2 Variants)"},{"id":"CANON-0003","category":"refactoring","title":"Error logging inconsistent: many call sites log ra"}],"file_hotspot":"components/widgets/compact-meeting-countdown.tsx","priority_score":45.3,"unified_id":"UNIFIED-0038"}
{"category":"refactoring","title":"Error logging inconsistent: many call sites log raw error objects instead of sanitized errorType/errorCode","fingerprint":"Security/Hardening::components/growth/DailySloganWidget.tsx::DailySloganWidget::raw-error-logging-drift","severity":"S1","effort":"E2","confidence":88,"files":["app/admin/page.tsx","app/meetings/all/page.tsx","components/admin/analytics-tab.tsx","components/admin/dashboard-tab.tsx","components/admin/errors-tab.tsx","components/admin/jobs-tab.tsx","components/admin/links-tab.tsx","components/admin/logs-tab.tsx","components/admin/prayers-tab.tsx","components/auth/sign-in-modal.tsx","components/growth/DailySloganWidget.tsx","components/growth/GratitudeCard.tsx","components/growth/NightReviewCard.tsx","components/growth/SpotCheckCard.tsx","components/growth/Step1WorksheetCard.tsx","components/journal/entry-forms/daily-log-form.tsx","components/journal/entry-forms/free-write-form.tsx","components/journal/entry-forms/gratitude-form.tsx","components/journal/entry-forms/inventory-form.tsx","components/journal/entry-forms/mood-form.tsx","components/journal/entry-wizard.tsx","components/journal/journal-hub.tsx","components/notebook/journal-modal.tsx","components/notebook/notebook-shell.tsx","components/notebook/pages/library-page.tsx","components/notebook/pages/resources-page.tsx","components/widgets/compact-meeting-countdown.tsx","hooks/use-speech-recognition.ts","lib/db/library.ts","lib/db/meetings.ts","lib/utils/retry.ts"],"symbols":["AdminPage","AllMeetingsPage","AnalyticsTab","DashboardTab","ErrorsTab","JobsTab","LinksTab","LogsTab","PrayersTab","SignInModal","DailySloganWidget","GratitudeCard","NightReviewCard","SpotCheckCard","Step1WorksheetCard","DailyLogForm","FreeWriteForm","GratitudeForm","InventoryForm","MoodForm","EntryWizard","JournalHub","JournalModal","NotebookShell","LibraryPage","ResourcesPage","CompactMeetingCountdown","useSpeechRecognition","getAllQuickLinks","MeetingsService","retryWithBackoff"],"duplication_cluster":{"is_cluster":true,"cluster_summary":"Many modules call logger.error(..., { error }) or logger.error(..., { error: err }) which can leak raw error objects (PII/stack traces/SDK internals), while other code follows a sanitized pattern (errorType/errorCode).","instances":[{"file":"app/admin/page.tsx","symbol":"AdminPage"},{"file":"components/growth/DailySloganWidget.tsx","symbol":"DailySloganWidget"},{"file":"components/admin/dashboard-tab.tsx","symbol":"DashboardTab"}],"consolidation_target":"lib/logger.ts (add logger.safeError / helper to normalize errorType+errorCode and forbid raw error payloads)"},"why_it_matters":"Raw error objects can contain sensitive metadata and are inconsistent with the repo's own CANON guidance. Consolidation reduces security/PII risk and keeps observability consistent.","suggested_fix":"Create a single helper (e.g., logErrorSafe(message, err, context)) that extracts errorType/errorCode and optionally masks identifiers. Replace all {error}/{error:err} callsites via codemod/grep-driven edits.","acceptance_tests":["npm run lint","npm run test","npm run test:coverage"],"pr_bucket_suggestion":"security-hardening","dependencies":[],"evidence":["components/growth/DailySloganWidget.tsx:38 logger.error('Error fetching daily slogan', { error })","components/admin/dashboard-tab.tsx multiple logger.error(...,{ error: err })","components/journal/* forms logger.error(...,{ error })"],"notes":"Some admin/dev logs may be acceptable internally, but consolidating still improves predictability.","sources":[{"source":"claude","file":"code-claude.jsonl","original_fingerprint":"Hygiene::components/admin::getFunctions::redundant-getfunctions-calls"},{"source":"chatgpt","file":"refactoring-chatgpt.jsonl","original_fingerprint":"Security/Hardening::components/growth/DailySloganWidget.tsx::DailySloganWidget::raw-error-logging-drift"}],"verified":true,"consensus_score":2,"canonical_id":"CANON-0003","status":"CONFIRMED","cross_cutting":true,"categories":["code","refactoring"],"related_findings":[{"id":"CANON-0027","category":"code","title":"Redundant getFunctions() Calls (28+ Across Admin C"},{"id":"CANON-0003","category":"refactoring","title":"Error logging inconsistent: many call sites log ra"}],"file_hotspot":"components/admin/jobs-tab.tsx","priority_score":45.3,"unified_id":"UNIFIED-0039"}
{"category":"refactoring","title":"Error logging inconsistent: many call sites log raw error objects instead of sanitized errorType/errorCode","fingerprint":"Security/Hardening::components/growth/DailySloganWidget.tsx::DailySloganWidget::raw-error-logging-drift","severity":"S1","effort":"E2","confidence":88,"files":["app/admin/page.tsx","app/meetings/all/page.tsx","components/admin/analytics-tab.tsx","components/admin/dashboard-tab.tsx","components/admin/errors-tab.tsx","components/admin/jobs-tab.tsx","components/admin/links-tab.tsx","components/admin/logs-tab.tsx","components/admin/prayers-tab.tsx","components/auth/sign-in-modal.tsx","components/growth/DailySloganWidget.tsx","components/growth/GratitudeCard.tsx","components/growth/NightReviewCard.tsx","components/growth/SpotCheckCard.tsx","components/growth/Step1WorksheetCard.tsx","components/journal/entry-forms/daily-log-form.tsx","components/journal/entry-forms/free-write-form.tsx","components/journal/entry-forms/gratitude-form.tsx","components/journal/entry-forms/inventory-form.tsx","components/journal/entry-forms/mood-form.tsx","components/journal/entry-wizard.tsx","components/journal/journal-hub.tsx","components/notebook/journal-modal.tsx","components/notebook/notebook-shell.tsx","components/notebook/pages/library-page.tsx","components/notebook/pages/resources-page.tsx","components/widgets/compact-meeting-countdown.tsx","hooks/use-speech-recognition.ts","lib/db/library.ts","lib/db/meetings.ts","lib/utils/retry.ts"],"symbols":["AdminPage","AllMeetingsPage","AnalyticsTab","DashboardTab","ErrorsTab","JobsTab","LinksTab","LogsTab","PrayersTab","SignInModal","DailySloganWidget","GratitudeCard","NightReviewCard","SpotCheckCard","Step1WorksheetCard","DailyLogForm","FreeWriteForm","GratitudeForm","InventoryForm","MoodForm","EntryWizard","JournalHub","JournalModal","NotebookShell","LibraryPage","ResourcesPage","CompactMeetingCountdown","useSpeechRecognition","getAllQuickLinks","MeetingsService","retryWithBackoff"],"duplication_cluster":{"is_cluster":true,"cluster_summary":"Many modules call logger.error(..., { error }) or logger.error(..., { error: err }) which can leak raw error objects (PII/stack traces/SDK internals), while other code follows a sanitized pattern (errorType/errorCode).","instances":[{"file":"app/admin/page.tsx","symbol":"AdminPage"},{"file":"components/growth/DailySloganWidget.tsx","symbol":"DailySloganWidget"},{"file":"components/admin/dashboard-tab.tsx","symbol":"DashboardTab"}],"consolidation_target":"lib/logger.ts (add logger.safeError / helper to normalize errorType+errorCode and forbid raw error payloads)"},"why_it_matters":"Raw error objects can contain sensitive metadata and are inconsistent with the repo's own CANON guidance. Consolidation reduces security/PII risk and keeps observability consistent.","suggested_fix":"Create a single helper (e.g., logErrorSafe(message, err, context)) that extracts errorType/errorCode and optionally masks identifiers. Replace all {error}/{error:err} callsites via codemod/grep-driven edits.","acceptance_tests":["npm run lint","npm run test","npm run test:coverage"],"pr_bucket_suggestion":"security-hardening","dependencies":[],"evidence":["components/growth/DailySloganWidget.tsx:38 logger.error('Error fetching daily slogan', { error })","components/admin/dashboard-tab.tsx multiple logger.error(...,{ error: err })","components/journal/* forms logger.error(...,{ error })"],"notes":"Some admin/dev logs may be acceptable internally, but consolidating still improves predictability.","sources":[{"source":"claude","file":"code-claude.jsonl","original_fingerprint":"Hygiene::lib/db::write-methods::inconsistent-write-patterns"},{"source":"chatgpt","file":"refactoring-chatgpt.jsonl","original_fingerprint":"Security/Hardening::components/growth/DailySloganWidget.tsx::DailySloganWidget::raw-error-logging-drift"}],"verified":true,"consensus_score":2,"canonical_id":"CANON-0003","status":"CONFIRMED","cross_cutting":true,"categories":["code","refactoring"],"related_findings":[{"id":"CANON-0029","category":"code","title":"Inconsistent lib/db/ Write Patterns"},{"id":"CANON-0003","category":"refactoring","title":"Error logging inconsistent: many call sites log ra"}],"file_hotspot":"lib/db/library.ts","priority_score":45.3,"unified_id":"UNIFIED-0040"}
{"category":"refactoring","title":"Error logging inconsistent: many call sites log raw error objects instead of sanitized errorType/errorCode","fingerprint":"Security/Hardening::components/growth/DailySloganWidget.tsx::DailySloganWidget::raw-error-logging-drift","severity":"S1","effort":"E2","confidence":88,"files":["app/admin/page.tsx","app/meetings/all/page.tsx","components/admin/analytics-tab.tsx","components/admin/dashboard-tab.tsx","components/admin/errors-tab.tsx","components/admin/jobs-tab.tsx","components/admin/links-tab.tsx","components/admin/logs-tab.tsx","components/admin/prayers-tab.tsx","components/auth/sign-in-modal.tsx","components/growth/DailySloganWidget.tsx","components/growth/GratitudeCard.tsx","components/growth/NightReviewCard.tsx","components/growth/SpotCheckCard.tsx","components/growth/Step1WorksheetCard.tsx","components/journal/entry-forms/daily-log-form.tsx","components/journal/entry-forms/free-write-form.tsx","components/journal/entry-forms/gratitude-form.tsx","components/journal/entry-forms/inventory-form.tsx","components/journal/entry-forms/mood-form.tsx","components/journal/entry-wizard.tsx","components/journal/journal-hub.tsx","components/notebook/journal-modal.tsx","components/notebook/notebook-shell.tsx","components/notebook/pages/library-page.tsx","components/notebook/pages/resources-page.tsx","components/widgets/compact-meeting-countdown.tsx","hooks/use-speech-recognition.ts","lib/db/library.ts","lib/db/meetings.ts","lib/utils/retry.ts"],"symbols":["AdminPage","AllMeetingsPage","AnalyticsTab","DashboardTab","ErrorsTab","JobsTab","LinksTab","LogsTab","PrayersTab","SignInModal","DailySloganWidget","GratitudeCard","NightReviewCard","SpotCheckCard","Step1WorksheetCard","DailyLogForm","FreeWriteForm","GratitudeForm","InventoryForm","MoodForm","EntryWizard","JournalHub","JournalModal","NotebookShell","LibraryPage","ResourcesPage","CompactMeetingCountdown","useSpeechRecognition","getAllQuickLinks","MeetingsService","retryWithBackoff"],"duplication_cluster":{"is_cluster":true,"cluster_summary":"Many modules call logger.error(..., { error }) or logger.error(..., { error: err }) which can leak raw error objects (PII/stack traces/SDK internals), while other code follows a sanitized pattern (errorType/errorCode).","instances":[{"file":"app/admin/page.tsx","symbol":"AdminPage"},{"file":"components/growth/DailySloganWidget.tsx","symbol":"DailySloganWidget"},{"file":"components/admin/dashboard-tab.tsx","symbol":"DashboardTab"}],"consolidation_target":"lib/logger.ts (add logger.safeError / helper to normalize errorType+errorCode and forbid raw error payloads)"},"why_it_matters":"Raw error objects can contain sensitive metadata and are inconsistent with the repo's own CANON guidance. Consolidation reduces security/PII risk and keeps observability consistent.","suggested_fix":"Create a single helper (e.g., logErrorSafe(message, err, context)) that extracts errorType/errorCode and optionally masks identifiers. Replace all {error}/{error:err} callsites via codemod/grep-driven edits.","acceptance_tests":["npm run lint","npm run test","npm run test:coverage"],"pr_bucket_suggestion":"security-hardening","dependencies":[],"evidence":["components/growth/DailySloganWidget.tsx:38 logger.error('Error fetching daily slogan', { error })","components/admin/dashboard-tab.tsx multiple logger.error(...,{ error: err })","components/journal/* forms logger.error(...,{ error })"],"notes":"Some admin/dev logs may be acceptable internally, but consolidating still improves predictability.","sources":[{"source":"copilot","file":"code-copilot.jsonl","original_fingerprint":"Hygiene::hooks/::lib/hooks/::dual-hooks-directories"},{"source":"chatgpt","file":"refactoring-chatgpt.jsonl","original_fingerprint":"Security/Hardening::components/growth/DailySloganWidget.tsx::DailySloganWidget::raw-error-logging-drift"}],"verified":true,"consensus_score":2,"canonical_id":"CANON-0003","status":"CONFIRMED","cross_cutting":true,"categories":["code","refactoring"],"related_findings":[{"id":"CANON-0039","category":"code","title":"Dual hooks directories: hooks/ and lib/hooks/"},{"id":"CANON-0003","category":"refactoring","title":"Error logging inconsistent: many call sites log ra"}],"file_hotspot":"hooks/use-speech-recognition.ts","priority_score":45.3,"unified_id":"UNIFIED-0041"}
{"category":"refactoring","title":"Error logging inconsistent: many call sites log raw error objects instead of sanitized errorType/errorCode","fingerprint":"Security/Hardening::components/growth/DailySloganWidget.tsx::DailySloganWidget::raw-error-logging-drift","severity":"S1","effort":"E2","confidence":88,"files":["app/admin/page.tsx","app/meetings/all/page.tsx","components/admin/analytics-tab.tsx","components/admin/dashboard-tab.tsx","components/admin/errors-tab.tsx","components/admin/jobs-tab.tsx","components/admin/links-tab.tsx","components/admin/logs-tab.tsx","components/admin/prayers-tab.tsx","components/auth/sign-in-modal.tsx","components/growth/DailySloganWidget.tsx","components/growth/GratitudeCard.tsx","components/growth/NightReviewCard.tsx","components/growth/SpotCheckCard.tsx","components/growth/Step1WorksheetCard.tsx","components/journal/entry-forms/daily-log-form.tsx","components/journal/entry-forms/free-write-form.tsx","components/journal/entry-forms/gratitude-form.tsx","components/journal/entry-forms/inventory-form.tsx","components/journal/entry-forms/mood-form.tsx","components/journal/entry-wizard.tsx","components/journal/journal-hub.tsx","components/notebook/journal-modal.tsx","components/notebook/notebook-shell.tsx","components/notebook/pages/library-page.tsx","components/notebook/pages/resources-page.tsx","components/widgets/compact-meeting-countdown.tsx","hooks/use-speech-recognition.ts","lib/db/library.ts","lib/db/meetings.ts","lib/utils/retry.ts"],"symbols":["AdminPage","AllMeetingsPage","AnalyticsTab","DashboardTab","ErrorsTab","JobsTab","LinksTab","LogsTab","PrayersTab","SignInModal","DailySloganWidget","GratitudeCard","NightReviewCard","SpotCheckCard","Step1WorksheetCard","DailyLogForm","FreeWriteForm","GratitudeForm","InventoryForm","MoodForm","EntryWizard","JournalHub","JournalModal","NotebookShell","LibraryPage","ResourcesPage","CompactMeetingCountdown","useSpeechRecognition","getAllQuickLinks","MeetingsService","retryWithBackoff"],"duplication_cluster":{"is_cluster":true,"cluster_summary":"Many modules call logger.error(..., { error }) or logger.error(..., { error: err }) which can leak raw error objects (PII/stack traces/SDK internals), while other code follows a sanitized pattern (errorType/errorCode).","instances":[{"file":"app/admin/page.tsx","symbol":"AdminPage"},{"file":"components/growth/DailySloganWidget.tsx","symbol":"DailySloganWidget"},{"file":"components/admin/dashboard-tab.tsx","symbol":"DashboardTab"}],"consolidation_target":"lib/logger.ts (add logger.safeError / helper to normalize errorType+errorCode and forbid raw error payloads)"},"why_it_matters":"Raw error objects can contain sensitive metadata and are inconsistent with the repo's own CANON guidance. Consolidation reduces security/PII risk and keeps observability consistent.","suggested_fix":"Create a single helper (e.g., logErrorSafe(message, err, context)) that extracts errorType/errorCode and optionally masks identifiers. Replace all {error}/{error:err} callsites via codemod/grep-driven edits.","acceptance_tests":["npm run lint","npm run test","npm run test:coverage"],"pr_bucket_suggestion":"security-hardening","dependencies":[],"evidence":["components/growth/DailySloganWidget.tsx:38 logger.error('Error fetching daily slogan', { error })","components/admin/dashboard-tab.tsx multiple logger.error(...,{ error: err })","components/journal/* forms logger.error(...,{ error })"],"notes":"Some admin/dev logs may be acceptable internally, but consolidating still improves predictability.","sources":[{"source":"claude-code","file":"performance-claude-code.jsonl","original_fingerprint":"Rendering::components::framer_motion_widespread"},{"source":"chatgpt","file":"refactoring-chatgpt.jsonl","original_fingerprint":"Security/Hardening::components/growth/DailySloganWidget.tsx::DailySloganWidget::raw-error-logging-drift"}],"verified":true,"consensus_score":2,"canonical_id":"CANON-0003","status":"CONFIRMED","cross_cutting":true,"categories":["performance","refactoring"],"related_findings":[{"id":"CANON-0019","category":"performance","title":"37 components import framer-motion without code sp"},{"id":"CANON-0003","category":"refactoring","title":"Error logging inconsistent: many call sites log ra"}],"file_hotspot":"components/journal/entry-forms/mood-form.tsx","priority_score":45.3,"unified_id":"UNIFIED-0042"}
{"category":"refactoring","title":"Error logging inconsistent: many call sites log raw error objects instead of sanitized errorType/errorCode","fingerprint":"Security/Hardening::components/growth/DailySloganWidget.tsx::DailySloganWidget::raw-error-logging-drift","severity":"S1","effort":"E2","confidence":88,"files":["app/admin/page.tsx","app/meetings/all/page.tsx","components/admin/analytics-tab.tsx","components/admin/dashboard-tab.tsx","components/admin/errors-tab.tsx","components/admin/jobs-tab.tsx","components/admin/links-tab.tsx","components/admin/logs-tab.tsx","components/admin/prayers-tab.tsx","components/auth/sign-in-modal.tsx","components/growth/DailySloganWidget.tsx","components/growth/GratitudeCard.tsx","components/growth/NightReviewCard.tsx","components/growth/SpotCheckCard.tsx","components/growth/Step1WorksheetCard.tsx","components/journal/entry-forms/daily-log-form.tsx","components/journal/entry-forms/free-write-form.tsx","components/journal/entry-forms/gratitude-form.tsx","components/journal/entry-forms/inventory-form.tsx","components/journal/entry-forms/mood-form.tsx","components/journal/entry-wizard.tsx","components/journal/journal-hub.tsx","components/notebook/journal-modal.tsx","components/notebook/notebook-shell.tsx","components/notebook/pages/library-page.tsx","components/notebook/pages/resources-page.tsx","components/widgets/compact-meeting-countdown.tsx","hooks/use-speech-recognition.ts","lib/db/library.ts","lib/db/meetings.ts","lib/utils/retry.ts"],"symbols":["AdminPage","AllMeetingsPage","AnalyticsTab","DashboardTab","ErrorsTab","JobsTab","LinksTab","LogsTab","PrayersTab","SignInModal","DailySloganWidget","GratitudeCard","NightReviewCard","SpotCheckCard","Step1WorksheetCard","DailyLogForm","FreeWriteForm","GratitudeForm","InventoryForm","MoodForm","EntryWizard","JournalHub","JournalModal","NotebookShell","LibraryPage","ResourcesPage","CompactMeetingCountdown","useSpeechRecognition","getAllQuickLinks","MeetingsService","retryWithBackoff"],"duplication_cluster":{"is_cluster":true,"cluster_summary":"Many modules call logger.error(..., { error }) or logger.error(..., { error: err }) which can leak raw error objects (PII/stack traces/SDK internals), while other code follows a sanitized pattern (errorType/errorCode).","instances":[{"file":"app/admin/page.tsx","symbol":"AdminPage"},{"file":"components/growth/DailySloganWidget.tsx","symbol":"DailySloganWidget"},{"file":"components/admin/dashboard-tab.tsx","symbol":"DashboardTab"}],"consolidation_target":"lib/logger.ts (add logger.safeError / helper to normalize errorType+errorCode and forbid raw error payloads)"},"why_it_matters":"Raw error objects can contain sensitive metadata and are inconsistent with the repo's own CANON guidance. Consolidation reduces security/PII risk and keeps observability consistent.","suggested_fix":"Create a single helper (e.g., logErrorSafe(message, err, context)) that extracts errorType/errorCode and optionally masks identifiers. Replace all {error}/{error:err} callsites via codemod/grep-driven edits.","acceptance_tests":["npm run lint","npm run test","npm run test:coverage"],"pr_bucket_suggestion":"security-hardening","dependencies":[],"evidence":["components/growth/DailySloganWidget.tsx:38 logger.error('Error fetching daily slogan', { error })","components/admin/dashboard-tab.tsx multiple logger.error(...,{ error: err })","components/journal/* forms logger.error(...,{ error })"],"notes":"Some admin/dev logs may be acceptable internally, but consolidating still improves predictability.","sources":[{"source":"codex","file":"performance-codex.jsonl","original_fingerprint":"Data Fetching::lib/db/meetings.ts::unbounded-query"},{"source":"chatgpt","file":"refactoring-chatgpt.jsonl","original_fingerprint":"Security/Hardening::components/growth/DailySloganWidget.tsx::DailySloganWidget::raw-error-logging-drift"}],"verified":true,"consensus_score":2,"canonical_id":"CANON-0003","status":"CONFIRMED","cross_cutting":true,"categories":["performance","refactoring"],"related_findings":[{"id":"CANON-0021","category":"performance","title":"Meetings-by-day query fetches entire day without l"},{"id":"CANON-0003","category":"refactoring","title":"Error logging inconsistent: many call sites log ra"}],"file_hotspot":"lib/db/meetings.ts","priority_score":45.3,"unified_id":"UNIFIED-0043"}
{"category":"refactoring","title":"Error logging inconsistent: many call sites log raw error objects instead of sanitized errorType/errorCode","fingerprint":"Security/Hardening::components/growth/DailySloganWidget.tsx::DailySloganWidget::raw-error-logging-drift","severity":"S1","effort":"E2","confidence":88,"files":["app/admin/page.tsx","app/meetings/all/page.tsx","components/admin/analytics-tab.tsx","components/admin/dashboard-tab.tsx","components/admin/errors-tab.tsx","components/admin/jobs-tab.tsx","components/admin/links-tab.tsx","components/admin/logs-tab.tsx","components/admin/prayers-tab.tsx","components/auth/sign-in-modal.tsx","components/growth/DailySloganWidget.tsx","components/growth/GratitudeCard.tsx","components/growth/NightReviewCard.tsx","components/growth/SpotCheckCard.tsx","components/growth/Step1WorksheetCard.tsx","components/journal/entry-forms/daily-log-form.tsx","components/journal/entry-forms/free-write-form.tsx","components/journal/entry-forms/gratitude-form.tsx","components/journal/entry-forms/inventory-form.tsx","components/journal/entry-forms/mood-form.tsx","components/journal/entry-wizard.tsx","components/journal/journal-hub.tsx","components/notebook/journal-modal.tsx","components/notebook/notebook-shell.tsx","components/notebook/pages/library-page.tsx","components/notebook/pages/resources-page.tsx","components/widgets/compact-meeting-countdown.tsx","hooks/use-speech-recognition.ts","lib/db/library.ts","lib/db/meetings.ts","lib/utils/retry.ts"],"symbols":["AdminPage","AllMeetingsPage","AnalyticsTab","DashboardTab","ErrorsTab","JobsTab","LinksTab","LogsTab","PrayersTab","SignInModal","DailySloganWidget","GratitudeCard","NightReviewCard","SpotCheckCard","Step1WorksheetCard","DailyLogForm","FreeWriteForm","GratitudeForm","InventoryForm","MoodForm","EntryWizard","JournalHub","JournalModal","NotebookShell","LibraryPage","ResourcesPage","CompactMeetingCountdown","useSpeechRecognition","getAllQuickLinks","MeetingsService","retryWithBackoff"],"duplication_cluster":{"is_cluster":true,"cluster_summary":"Many modules call logger.error(..., { error }) or logger.error(..., { error: err }) which can leak raw error objects (PII/stack traces/SDK internals), while other code follows a sanitized pattern (errorType/errorCode).","instances":[{"file":"app/admin/page.tsx","symbol":"AdminPage"},{"file":"components/growth/DailySloganWidget.tsx","symbol":"DailySloganWidget"},{"file":"components/admin/dashboard-tab.tsx","symbol":"DashboardTab"}],"consolidation_target":"lib/logger.ts (add logger.safeError / helper to normalize errorType+errorCode and forbid raw error payloads)"},"why_it_matters":"Raw error objects can contain sensitive metadata and are inconsistent with the repo's own CANON guidance. Consolidation reduces security/PII risk and keeps observability consistent.","suggested_fix":"Create a single helper (e.g., logErrorSafe(message, err, context)) that extracts errorType/errorCode and optionally masks identifiers. Replace all {error}/{error:err} callsites via codemod/grep-driven edits.","acceptance_tests":["npm run lint","npm run test","npm run test:coverage"],"pr_bucket_suggestion":"security-hardening","dependencies":[],"evidence":["components/growth/DailySloganWidget.tsx:38 logger.error('Error fetching daily slogan', { error })","components/admin/dashboard-tab.tsx multiple logger.error(...,{ error: err })","components/journal/* forms logger.error(...,{ error })"],"notes":"Some admin/dev logs may be acceptable internally, but consolidating still improves predictability.","sources":[{"source":"claude-code","file":"performance-claude-code.jsonl","original_fingerprint":"Rendering::components/journal/journal-hub.tsx::eager_forms"},{"source":"chatgpt","file":"refactoring-chatgpt.jsonl","original_fingerprint":"Security/Hardening::components/growth/DailySloganWidget.tsx::DailySloganWidget::raw-error-logging-drift"}],"verified":true,"consensus_score":2,"canonical_id":"CANON-0003","status":"CONFIRMED","cross_cutting":true,"categories":["performance","refactoring"],"related_findings":[{"id":"CANON-0051","category":"performance","title":"Journal entry forms eagerly rendered in JournalHub"},{"id":"CANON-0003","category":"refactoring","title":"Error logging inconsistent: many call sites log ra"}],"file_hotspot":"components/journal/journal-hub.tsx","priority_score":45.3,"unified_id":"UNIFIED-0044"}
{"category":"code","title":"Type Divergence: Client types vs Server schemas","fingerprint":"Types::types/journal.ts::JournalEntry::client-server-divergence","severity":"S1","effort":"E2","confidence":85,"files":["types/journal.ts","functions/src/schemas.ts"],"symbols":["JournalEntry","journalEntrySchema"],"duplication_cluster":{"is_cluster":false,"cluster_summary":"","instances":[]},"why_it_matters":"Client TypeScript types and server Zod schemas define journal entries independently, leading to silent validation failures. Adding new entry types requires coordinated changes in 2+ places with no automated consistency check.","suggested_fix":"Create single source of truth: lib/types/journal-shared.ts with Zod schemas. Generate TypeScript types using zod's z.infer<typeof schema>. Export both schema (for validation) and type (for TypeScript). Import in both client and server.","acceptance_tests":["Schemas validate expected journal entry structures","TypeScript types match Zod schema shapes","Client-side validation catches same errors as server","No breaking changes to existing journal entries"],"pr_bucket_suggestion":"types-domain","dependencies":[],"evidence":["DEBT-0049 confirms this issue","grep shows 142 Zod schema definitions across codebase","Types defined separately in types/ directory"],"notes":"Already tracked as DEBT-0049 with roadmap placement M2.1. Affects data integrity.","sources":[{"source":"claude-code","file":"code-claude-code.jsonl","original_fingerprint":"Types::types/journal.ts::JournalEntry::client-server-divergence"},{"source":"copilot","file":"refactoring-copilot.jsonl","original_fingerprint":"Types/Correctness::types/journal.ts::JournalEntryType::entry-type-scattered"}],"verified":true,"consensus_score":2,"canonical_id":"CANON-0004","status":"CONFIRMED","cross_cutting":true,"categories":["code","refactoring"],"related_findings":[{"id":"CANON-0004","category":"code","title":"Type Divergence: Client types vs Server schemas"},{"id":"CANON-0013","category":"refactoring","title":"JournalEntryType string literals defined in 4+ loc"}],"file_hotspot":"types/journal.ts","priority_score":44.7,"unified_id":"UNIFIED-0045"}
{"category":"code","title":"Duplicate Quote Widget Components (3 Variants)","fingerprint":"Hygiene::components/widgets/daily-quote-card.tsx::DailyQuoteCard::duplicate-quote-widgets","severity":"S2","effort":"E1","confidence":100,"files":["components/widgets/daily-quote-card.tsx","components/widgets/compact-daily-quote.tsx","components/notebook/features/daily-quote-card.tsx"],"symbols":["DailyQuoteCard","CompactDailyQuote"],"duplication_cluster":{"is_cluster":true,"cluster_summary":"Three separate components for displaying daily quotes with different styling","instances":[{"file":"components/widgets/daily-quote-card.tsx","symbol":"DailyQuoteCard"},{"file":"components/widgets/compact-daily-quote.tsx","symbol":"CompactDailyQuote"},{"file":"components/notebook/features/daily-quote-card.tsx","symbol":"DailyQuoteCard"}]},"why_it_matters":"Three separate components for displaying daily quotes. All use useDailyQuote() hook but have different styling. daily-quote-card.tsx exists in two locations with different implementations.","suggested_fix":"Consolidate into single DailyQuoteCard component with variant prop ('default' | 'compact' | 'sticky-note'). Keep in components/widgets/daily-quote-card.tsx, delete duplicates.","acceptance_tests":["Single quote component with variant prop","All quote display contexts use unified component","No duplicate implementations"],"pr_bucket_suggestion":"ui-primitives","sources":[{"source":"claude","file":"code-claude.jsonl","original_fingerprint":"Hygiene::components/widgets/daily-quote-card.tsx::DailyQuoteCard::duplicate-quote-widgets"},{"source":"copilot","file":"refactoring-copilot.jsonl","original_fingerprint":"Hygiene/Duplication::components/widgets/daily-quote-card.tsx::DailyQuoteCard::quote-card-dup"}],"verified":true,"consensus_score":2,"canonical_id":"CANON-0024","status":"CONFIRMED","cross_cutting":true,"categories":["code","refactoring"],"related_findings":[{"id":"CANON-0024","category":"code","title":"Duplicate Quote Widget Components (3 Variants)"},{"id":"CANON-0052","category":"refactoring","title":"DailyQuoteCard component may be duplicated in 2-3 "}],"file_hotspot":"components/widgets/compact-daily-quote.tsx","priority_score":40,"unified_id":"UNIFIED-0046"}
{"category":"code","title":"Duplicate Quote Widget Components (3 Variants)","fingerprint":"Hygiene::components/widgets/daily-quote-card.tsx::DailyQuoteCard::duplicate-quote-widgets","severity":"S2","effort":"E1","confidence":100,"files":["components/widgets/daily-quote-card.tsx","components/widgets/compact-daily-quote.tsx","components/notebook/features/daily-quote-card.tsx"],"symbols":["DailyQuoteCard","CompactDailyQuote"],"duplication_cluster":{"is_cluster":true,"cluster_summary":"Three separate components for displaying daily quotes with different styling","instances":[{"file":"components/widgets/daily-quote-card.tsx","symbol":"DailyQuoteCard"},{"file":"components/widgets/compact-daily-quote.tsx","symbol":"CompactDailyQuote"},{"file":"components/notebook/features/daily-quote-card.tsx","symbol":"DailyQuoteCard"}]},"why_it_matters":"Three separate components for displaying daily quotes. All use useDailyQuote() hook but have different styling. daily-quote-card.tsx exists in two locations with different implementations.","suggested_fix":"Consolidate into single DailyQuoteCard component with variant prop ('default' | 'compact' | 'sticky-note'). Keep in components/widgets/daily-quote-card.tsx, delete duplicates.","acceptance_tests":["Single quote component with variant prop","All quote display contexts use unified component","No duplicate implementations"],"pr_bucket_suggestion":"ui-primitives","sources":[{"source":"claude","file":"code-claude.jsonl","original_fingerprint":"Hygiene::components/widgets/daily-quote-card.tsx::DailyQuoteCard::duplicate-quote-widgets"},{"source":"copilot","file":"refactoring-copilot.jsonl","original_fingerprint":"Hygiene/Duplication::components/widgets/daily-quote-card.tsx::DailyQuoteCard::quote-card-dup"}],"verified":true,"consensus_score":2,"canonical_id":"CANON-0024","status":"CONFIRMED","cross_cutting":true,"categories":["code","refactoring"],"related_findings":[{"id":"CANON-0024","category":"code","title":"Duplicate Quote Widget Components (3 Variants)"},{"id":"CANON-0052","category":"refactoring","title":"DailyQuoteCard component may be duplicated in 2-3 "}],"file_hotspot":"components/notebook/features/daily-quote-card.tsx","priority_score":40,"unified_id":"UNIFIED-0047"}
{"category":"code","title":"Inconsistent lib/db/ Write Patterns","fingerprint":"Hygiene::lib/db::write-methods::inconsistent-write-patterns","severity":"S2","effort":"E1","confidence":100,"files":["lib/db/sober-living.ts","lib/db/glossary.ts","lib/db/quotes.ts","lib/db/slogans.ts","lib/db/library.ts","lib/db/users.ts"],"symbols":["SoberLivingService","GlossaryService","QuotesService","SlogansService"],"duplication_cluster":{"is_cluster":false,"cluster_summary":null,"instances":[]},"why_it_matters":"Some lib/db/ modules have write operations that Firestore rules block (sober-living), others are allowed (quotes, glossary). Creates confusion about which writes are permitted.","suggested_fix":"Document which lib/db/ writes are permitted and why. Mark blocked methods with @deprecated JSDoc. Consider removing write methods from lib/db/sober-living.ts.","acceptance_tests":["Write patterns documented","Blocked methods marked @deprecated","Developers can determine permitted writes from code"],"pr_bucket_suggestion":"misc","sources":[{"source":"claude","file":"code-claude.jsonl","original_fingerprint":"Hygiene::lib/db::write-methods::inconsistent-write-patterns"},{"source":"claude-code","file":"refactoring-claude-code.jsonl","original_fingerprint":"Consistency::lib/db::timestamp_inconsistency"}],"verified":true,"consensus_score":2,"canonical_id":"CANON-0029","status":"CONFIRMED","cross_cutting":true,"categories":["code","refactoring"],"related_findings":[{"id":"CANON-0029","category":"code","title":"Inconsistent lib/db/ Write Patterns"},{"id":"CANON-0024","category":"refactoring","title":"Timestamp inconsistency: Timestamp.now() vs server"}],"file_hotspot":"lib/db/users.ts","priority_score":40,"unified_id":"UNIFIED-0048"}
{"category":"code","title":"Duplicate generateSearchableText implementations","fingerprint":"AICode::hooks/use-journal.ts::scripts/migrate-to-journal.ts::generateSearchableText::duplicate-implementation","severity":"S2","effort":"E1","confidence":100,"files":["hooks/use-journal.ts","scripts/migrate-to-journal.ts"],"symbols":["generateSearchableText"],"duplication_cluster":{"is_cluster":true,"cluster_summary":"generateSearchableText is implemented in both hooks/use-journal.ts (client) and scripts/migrate-to-journal.ts (migration script) with similar but not identical switch/case logic","instances":[{"file":"hooks/use-journal.ts","symbol":"generateSearchableText"},{"file":"scripts/migrate-to-journal.ts","symbol":"generateSearchableText"}]},"why_it_matters":"Two separate implementations with different array handling. If a new entry type is added, both must be updated.","suggested_fix":"Extract generateSearchableText into lib/utils/searchable-text.ts and import in both locations.","acceptance_tests":["Single source of truth for generateSearchableText","Both consumers produce identical output for same inputs"],"pr_bucket_suggestion":"hooks-standardization","dependencies":[],"evidence":["hooks/use-journal.ts:89-138 uses sanitizeForSearch","scripts/migrate-to-journal.ts:195-230 uses isPrimitive filter"],"notes":"Classic AI code drift.","sources":[{"source":"copilot","file":"process-copilot.jsonl","original_fingerprint":"scripts::migrate-*.ts::dead_migration_scripts"}],"verified":true,"consensus_score":2,"canonical_id":"CANON-0045","status":"CONFIRMED","cross_cutting":true,"categories":["code","process"],"related_findings":[{"id":"CANON-0045","category":"code","title":"Duplicate generateSearchableText implementations"},{"id":"CANON-0041","category":"process","title":"Multiple one-time migration scripts still in scrip"}],"file_hotspot":"scripts/migrate-to-journal.ts","priority_score":40,"unified_id":"UNIFIED-0049"}
{"category":"engineering-productivity","title":"No environment validation/doctor script","fingerprint":"engineering-productivity::scripts/::no-doctor-script","severity":"S2","effort":"E1","confidence":100,"files":["scripts/","package.json"],"why_it_matters":"No automated way to verify development environment is correctly configured. Developers discover issues only when things fail.","suggested_fix":"Create scripts/doctor.js that checks: Node 22+, Firebase CLI installed, .env.local exists with required vars, functions/node_modules exists, functions/lib/ built.","acceptance_tests":["npm run doctor reports all prerequisites","Clear error messages for missing items","Exit code 1 if any check fails"],"evidence":["No scripts/doctor.js in scripts/ directory","package.json has no doctor script"],"line":1,"sources":[{"source":"copilot","file":"engineering-productivity-copilot.jsonl","original_fingerprint":"engineering-productivity::scripts/::no-doctor-script"},{"source":"claude-code","file":"process-claude-code.jsonl","original_fingerprint":"process::scripts::missing-doctor-script"}],"verified":true,"consensus_score":2,"canonical_id":"CANON-0037","status":"CONFIRMED","cross_cutting":true,"categories":["engineering-productivity","process"],"related_findings":[{"id":"CANON-0037","category":"engineering-productivity","title":"No environment validation/doctor script"},{"id":"CANON-0047","category":"process","title":"No doctor/diagnostic script for quick health check"}],"file_hotspot":"scripts/","priority_score":40,"unified_id":"UNIFIED-0050"}
{"category":"code","title":"Dual hooks directories: hooks/ and lib/hooks/","fingerprint":"Hygiene::hooks/::lib/hooks/::dual-hooks-directories","severity":"S2","effort":"E1","confidence":95,"files":["hooks/use-journal.ts","hooks/use-daily-quote.ts","hooks/use-geolocation.ts","hooks/use-speech-recognition.ts"],"symbols":["useJournal","useDailyQuote","useGeolocation","useSpeechRecognition"],"duplication_cluster":{"is_cluster":false},"why_it_matters":"Hooks exist in both hooks/ (top-level) and lib/hooks/. This creates ambiguity about where to place new hooks and fragments the import paths.","suggested_fix":"Consolidate all hooks into hooks/ at top level. Update all imports.","acceptance_tests":["All hooks live in one directory","All imports compile correctly"],"pr_bucket_suggestion":"hooks-standardization","dependencies":[],"evidence":["hooks/ contains: use-daily-quote.ts, use-geolocation.ts, use-journal.ts, use-speech-recognition.ts","lib/hooks/ exists as a separate directory"],"notes":"","sources":[{"source":"copilot","file":"refactoring-copilot.jsonl","original_fingerprint":"Architecture/Boundaries::hooks/::use-journal::hooks-split-directories"}],"verified":true,"consensus_score":2,"canonical_id":"CANON-0039","status":"CONFIRMED","cross_cutting":true,"categories":["code","refactoring"],"related_findings":[{"id":"CANON-0039","category":"code","title":"Dual hooks directories: hooks/ and lib/hooks/"},{"id":"CANON-0039","category":"refactoring","title":"Hooks split across hooks/ and lib/hooks/ directori"}],"file_hotspot":"hooks/use-daily-quote.ts","priority_score":39.3,"unified_id":"UNIFIED-0051"}
{"category":"code","title":"Dual hooks directories: hooks/ and lib/hooks/","fingerprint":"Hygiene::hooks/::lib/hooks/::dual-hooks-directories","severity":"S2","effort":"E1","confidence":95,"files":["hooks/use-journal.ts","hooks/use-daily-quote.ts","hooks/use-geolocation.ts","hooks/use-speech-recognition.ts"],"symbols":["useJournal","useDailyQuote","useGeolocation","useSpeechRecognition"],"duplication_cluster":{"is_cluster":false},"why_it_matters":"Hooks exist in both hooks/ (top-level) and lib/hooks/. This creates ambiguity about where to place new hooks and fragments the import paths.","suggested_fix":"Consolidate all hooks into hooks/ at top level. Update all imports.","acceptance_tests":["All hooks live in one directory","All imports compile correctly"],"pr_bucket_suggestion":"hooks-standardization","dependencies":[],"evidence":["hooks/ contains: use-daily-quote.ts, use-geolocation.ts, use-journal.ts, use-speech-recognition.ts","lib/hooks/ exists as a separate directory"],"notes":"","sources":[{"source":"copilot","file":"refactoring-copilot.jsonl","original_fingerprint":"Architecture/Boundaries::hooks/::use-journal::hooks-split-directories"}],"verified":true,"consensus_score":2,"canonical_id":"CANON-0039","status":"CONFIRMED","cross_cutting":true,"categories":["code","refactoring"],"related_findings":[{"id":"CANON-0039","category":"code","title":"Dual hooks directories: hooks/ and lib/hooks/"},{"id":"CANON-0039","category":"refactoring","title":"Hooks split across hooks/ and lib/hooks/ directori"}],"file_hotspot":"hooks/use-geolocation.ts","priority_score":39.3,"unified_id":"UNIFIED-0052"}
{"category":"code","title":"Excessive Cognitive Complexity (40+ files)","fingerprint":"AICode::scripts::multiple-files::cognitive-complexity-pattern","severity":"S1","effort":"E3","confidence":100,"files":["scripts/check-docs-light.js","scripts/validate-audit.js","scripts/phase-complete-check.js","scripts/archive-doc.js","functions/src/security-wrapper.ts","components/notebook/pages/history-page.tsx","components/notebook/pages/resources-page.tsx"],"symbols":["checkDocument","validateS0S1Strict","checkPhaseComplete","archiveDocument","createSecurityWrapper","HistoryPage","ResourcesPage"],"duplication_cluster":{"is_cluster":true,"cluster_summary":"Pattern of deeply nested conditional logic without helper function extraction. 40+ files exceed SonarCloud's cognitive complexity threshold of 15.","instances":[{"file":"scripts/check-docs-light.js","symbol":"checkDocument","complexity":51},{"file":"scripts/validate-audit.js","symbol":"validateS0S1Strict","complexity":34},{"file":"scripts/phase-complete-check.js","symbol":"checkPhaseComplete","complexity":27},{"file":"functions/src/security-wrapper.ts","symbol":"createSecurityWrapper","complexity":39},{"file":"components/notebook/pages/history-page.tsx","symbol":"HistoryPage","complexity":35},{"file":"components/notebook/pages/resources-page.tsx","symbol":"ResourcesPage","complexity":48}]},"why_it_matters":"High cognitive complexity (15+) makes code difficult to understand, test, and debug. Pattern suggests AI-generated code without human refactoring. Increases bug density and maintenance burden.","suggested_fix":"Extract helper functions to reduce nesting. Pattern: (1) Extract validation helpers, (2) Extract conditional branches into named functions, (3) Use early returns to flatten logic. Apply SonarCloud refactoring suggestions already documented in TDMS DEBT-0010 through DEBT-0044.","acceptance_tests":["All affected files reduce complexity to <=15","Functionality unchanged (regression tests pass)","Helper functions have descriptive names","Code coverage maintained or improved"],"pr_bucket_suggestion":"misc","dependencies":[],"evidence":["MASTER_DEBT.jsonl entries DEBT-0010 to DEBT-0044 document 35 cognitive complexity violations","SonarCloud rule typescript:S3776 and javascript:S3776","Grep shows helper function extraction pattern already used in some files (line 97 comment in users-tab.tsx)"],"notes":"This is a cross-cutting pattern, not isolated instances. Shows good intent (helper comment exists) but incomplete application. Roadmap: M2.1 (components), M2.2 (functions), Track-E (scripts).","sources":[{"source":"claude-code","file":"performance-claude-code.jsonl","original_fingerprint":"Bundle Size::components/maps/meeting-map.tsx::leaflet_not_lazy"},{"source":"chatgpt","file":"refactoring-chatgpt.jsonl","original_fingerprint":"Security/Hardening::components/growth/DailySloganWidget.tsx::DailySloganWidget::raw-error-logging-drift"}],"verified":true,"consensus_score":2,"canonical_id":"CANON-0008","status":"CONFIRMED","cross_cutting":true,"categories":["code","performance","refactoring"],"related_findings":[{"id":"CANON-0008","category":"code","title":"Excessive Cognitive Complexity (40+ files)"},{"id":"CANON-0018","category":"performance","title":"Leaflet + react-leaflet loaded eagerly despite bei"},{"id":"CANON-0003","category":"refactoring","title":"Error logging inconsistent: many call sites log ra"}],"file_hotspot":"components/notebook/pages/resources-page.tsx","priority_score":35,"unified_id":"UNIFIED-0053"}
{"category":"refactoring","title":"Triple data access layer: 3 overlapping Firestore patterns","fingerprint":"Architecture::lib::triple_data_access_layer","severity":"S1","effort":"E3","confidence":100,"files":["lib/firestore-service.ts","lib/database/firestore-adapter.ts","lib/db/meetings.ts","lib/db/library.ts","lib/db/glossary.ts","lib/db/quotes.ts","lib/db/slogans.ts","lib/db/sober-living.ts"],"line":null,"description":"Three overlapping Firestore access patterns coexist: (1) FirestoreService in lib/firestore-service.ts (476 lines) handles daily logs, inventory, journal; (2) FirestoreAdapter in lib/database/firestore-adapter.ts overlaps with daily logs; (3) Per-entity services in lib/db/*.ts (7 modules) handle meetings, quotes, slogans, glossary, etc. No clear canonical path for data access.","evidence":["lib/firestore-service.ts: 476 lines, handles daily logs + inventory + journal","lib/database/firestore-adapter.ts: overlaps with FirestoreService on daily logs","lib/db/*.ts: 7 separate modules (meetings, library, glossary, quotes, slogans, sober-living, collections)","Components import from different layers depending on which entity they need"],"remediation":{"steps":["1. Migrate FirestoreService methods into appropriate lib/db/ modules","2. Deprecate and remove FirestoreAdapter (functionality absorbed by lib/db/)","3. Establish lib/db/ as the single canonical data access layer","4. Update all component imports to use lib/db/ exclusively"],"verification":["FirestoreService removed or reduced to re-exports from lib/db/","FirestoreAdapter removed entirely","All data access goes through lib/db/ modules","No overlapping functionality between modules"]},"sources":[{"source":"claude","file":"refactoring-claude.jsonl","original_fingerprint":"Architecture::lib::triple_data_access_layer"},{"source":"codex","file":"performance-codex.jsonl","original_fingerprint":"Data Fetching::lib/db/sober-living.ts::unbounded-query"}],"verified":true,"consensus_score":2,"canonical_id":"CANON-0010","status":"CONFIRMED","cross_cutting":true,"categories":["code","performance","refactoring"],"related_findings":[{"id":"CANON-0023","category":"code","title":"Sober Living Admin Tab Silently Fails All Writes"},{"id":"CANON-0046","category":"performance","title":"Sober living list loads entire collection without "},{"id":"CANON-0010","category":"refactoring","title":"Triple data access layer: 3 overlapping Firestore "}],"file_hotspot":"lib/db/sober-living.ts","priority_score":35,"unified_id":"UNIFIED-0054"}
{"category":"refactoring","title":"Triple data access layer: 3 overlapping Firestore patterns","fingerprint":"Architecture::lib::triple_data_access_layer","severity":"S1","effort":"E3","confidence":100,"files":["lib/firestore-service.ts","lib/database/firestore-adapter.ts","lib/db/meetings.ts","lib/db/library.ts","lib/db/glossary.ts","lib/db/quotes.ts","lib/db/slogans.ts","lib/db/sober-living.ts"],"line":null,"description":"Three overlapping Firestore access patterns coexist: (1) FirestoreService in lib/firestore-service.ts (476 lines) handles daily logs, inventory, journal; (2) FirestoreAdapter in lib/database/firestore-adapter.ts overlaps with daily logs; (3) Per-entity services in lib/db/*.ts (7 modules) handle meetings, quotes, slogans, glossary, etc. No clear canonical path for data access.","evidence":["lib/firestore-service.ts: 476 lines, handles daily logs + inventory + journal","lib/database/firestore-adapter.ts: overlaps with FirestoreService on daily logs","lib/db/*.ts: 7 separate modules (meetings, library, glossary, quotes, slogans, sober-living, collections)","Components import from different layers depending on which entity they need"],"remediation":{"steps":["1. Migrate FirestoreService methods into appropriate lib/db/ modules","2. Deprecate and remove FirestoreAdapter (functionality absorbed by lib/db/)","3. Establish lib/db/ as the single canonical data access layer","4. Update all component imports to use lib/db/ exclusively"],"verification":["FirestoreService removed or reduced to re-exports from lib/db/","FirestoreAdapter removed entirely","All data access goes through lib/db/ modules","No overlapping functionality between modules"]},"sources":[{"source":"claude","file":"refactoring-claude.jsonl","original_fingerprint":"Architecture::lib::triple_data_access_layer"},{"source":"codex","file":"security-codex.jsonl","original_fingerprint":"Firebase::lib/db/quotes.ts::client-admin-writes"}],"verified":true,"consensus_score":2,"canonical_id":"CANON-0010","status":"CONFIRMED","cross_cutting":true,"categories":["code","refactoring","security"],"related_findings":[{"id":"CANON-0029","category":"code","title":"Inconsistent lib/db/ Write Patterns"},{"id":"CANON-0010","category":"refactoring","title":"Triple data access layer: 3 overlapping Firestore "},{"id":"CANON-0011","category":"security","title":"Admin CRUD uses client Firestore writes, bypassing"}],"file_hotspot":"lib/db/quotes.ts","priority_score":35,"unified_id":"UNIFIED-0055"}
{"category":"refactoring","title":"Triple data access layer: 3 overlapping Firestore patterns","fingerprint":"Architecture::lib::triple_data_access_layer","severity":"S1","effort":"E3","confidence":100,"files":["lib/firestore-service.ts","lib/database/firestore-adapter.ts","lib/db/meetings.ts","lib/db/library.ts","lib/db/glossary.ts","lib/db/quotes.ts","lib/db/slogans.ts","lib/db/sober-living.ts"],"line":null,"description":"Three overlapping Firestore access patterns coexist: (1) FirestoreService in lib/firestore-service.ts (476 lines) handles daily logs, inventory, journal; (2) FirestoreAdapter in lib/database/firestore-adapter.ts overlaps with daily logs; (3) Per-entity services in lib/db/*.ts (7 modules) handle meetings, quotes, slogans, glossary, etc. No clear canonical path for data access.","evidence":["lib/firestore-service.ts: 476 lines, handles daily logs + inventory + journal","lib/database/firestore-adapter.ts: overlaps with FirestoreService on daily logs","lib/db/*.ts: 7 separate modules (meetings, library, glossary, quotes, slogans, sober-living, collections)","Components import from different layers depending on which entity they need"],"remediation":{"steps":["1. Migrate FirestoreService methods into appropriate lib/db/ modules","2. Deprecate and remove FirestoreAdapter (functionality absorbed by lib/db/)","3. Establish lib/db/ as the single canonical data access layer","4. Update all component imports to use lib/db/ exclusively"],"verification":["FirestoreService removed or reduced to re-exports from lib/db/","FirestoreAdapter removed entirely","All data access goes through lib/db/ modules","No overlapping functionality between modules"]},"sources":[{"source":"claude","file":"refactoring-claude.jsonl","original_fingerprint":"Architecture::lib::triple_data_access_layer"},{"source":"codex","file":"security-codex.jsonl","original_fingerprint":"Firebase::lib/db/quotes.ts::client-admin-writes"}],"verified":true,"consensus_score":2,"canonical_id":"CANON-0010","status":"CONFIRMED","cross_cutting":true,"categories":["code","refactoring","security"],"related_findings":[{"id":"CANON-0029","category":"code","title":"Inconsistent lib/db/ Write Patterns"},{"id":"CANON-0010","category":"refactoring","title":"Triple data access layer: 3 overlapping Firestore "},{"id":"CANON-0011","category":"security","title":"Admin CRUD uses client Firestore writes, bypassing"}],"file_hotspot":"lib/db/slogans.ts","priority_score":35,"unified_id":"UNIFIED-0056"}
{"category":"refactoring","title":"Triple data access layer: 3 overlapping Firestore patterns","fingerprint":"Architecture::lib::triple_data_access_layer","severity":"S1","effort":"E3","confidence":100,"files":["lib/firestore-service.ts","lib/database/firestore-adapter.ts","lib/db/meetings.ts","lib/db/library.ts","lib/db/glossary.ts","lib/db/quotes.ts","lib/db/slogans.ts","lib/db/sober-living.ts"],"line":null,"description":"Three overlapping Firestore access patterns coexist: (1) FirestoreService in lib/firestore-service.ts (476 lines) handles daily logs, inventory, journal; (2) FirestoreAdapter in lib/database/firestore-adapter.ts overlaps with daily logs; (3) Per-entity services in lib/db/*.ts (7 modules) handle meetings, quotes, slogans, glossary, etc. No clear canonical path for data access.","evidence":["lib/firestore-service.ts: 476 lines, handles daily logs + inventory + journal","lib/database/firestore-adapter.ts: overlaps with FirestoreService on daily logs","lib/db/*.ts: 7 separate modules (meetings, library, glossary, quotes, slogans, sober-living, collections)","Components import from different layers depending on which entity they need"],"remediation":{"steps":["1. Migrate FirestoreService methods into appropriate lib/db/ modules","2. Deprecate and remove FirestoreAdapter (functionality absorbed by lib/db/)","3. Establish lib/db/ as the single canonical data access layer","4. Update all component imports to use lib/db/ exclusively"],"verification":["FirestoreService removed or reduced to re-exports from lib/db/","FirestoreAdapter removed entirely","All data access goes through lib/db/ modules","No overlapping functionality between modules"]},"sources":[{"source":"claude","file":"refactoring-claude.jsonl","original_fingerprint":"Architecture::lib::triple_data_access_layer"},{"source":"claude-code","file":"performance-claude-code.jsonl","original_fingerprint":"Memory::hooks::multiple_onSnapshot"}],"verified":true,"consensus_score":2,"canonical_id":"CANON-0010","status":"CONFIRMED","cross_cutting":true,"categories":["code","performance","refactoring"],"related_findings":[{"id":"CANON-0057","category":"code","title":"Lingering TODO Comments (2 Instances)"},{"id":"CANON-0053","category":"performance","title":"4 real-time onSnapshot listeners active simultaneo"},{"id":"CANON-0010","category":"refactoring","title":"Triple data access layer: 3 overlapping Firestore "}],"file_hotspot":"lib/database/firestore-adapter.ts","priority_score":35,"unified_id":"UNIFIED-0057"}
{"category":"code","title":"God Object: functions/src/admin.ts (4108 lines)","fingerprint":"Hygiene::functions/src/admin.ts::admin.ts::god-object","severity":"S1","effort":"E3","confidence":100,"files":["functions/src/admin.ts"],"symbols":["admin.ts"],"duplication_cluster":{"is_cluster":false,"cluster_summary":"","instances":[]},"why_it_matters":"4108-line file violates single responsibility principle. Contains 30+ Cloud Functions in one file, making it difficult to navigate, test, and maintain. Changes require understanding entire file context.","suggested_fix":"Split into domain-specific modules: admin/users.ts, admin/privileges.ts, admin/analytics.ts, admin/errors.ts, admin/logs.ts, admin/jobs.ts. Each module exports 3-5 related functions. Use barrel export from admin/index.ts.","acceptance_tests":["Verify all Cloud Functions still callable after split","Run integration tests for admin endpoints","Verify no circular dependencies with: npm run deps:circular","Check test coverage maintained or improved"],"pr_bucket_suggestion":"misc","dependencies":[],"evidence":["wc -l shows 4108 lines","File contains adminGetUsers, adminSetUserPrivilege, adminGetErrorsWithUsers, adminGetUserAnalytics, adminGetJobRunHistory, and 20+ more functions","DEBT-0012 confirms cognitive complexity 22 at line 576"],"notes":"TDMS already tracks this - references DEBT-0012, DEBT-0035, DEBT-0045, DEBT-0046. Roadmap placement: M2.2 (Functions refactoring).","sources":[{"source":"claude-code","file":"code-claude-code.jsonl","original_fingerprint":"Hygiene::functions/src/admin.ts::admin.ts::god-object"},{"source":"claude","file":"refactoring-claude.jsonl","original_fingerprint":"Duplication::functions/src/admin.ts::mega_file_boilerplate"}],"merged_from":["Hygiene::functions/src/admin.ts::admin.ts::god-object","Hygiene::functions/src/admin.ts::admin.ts::god-object"],"verified":true,"consensus_score":3,"canonical_id":"CANON-0001","status":"CONFIRMED","cross_cutting":true,"categories":["code","refactoring"],"related_findings":[{"id":"CANON-0001","category":"code","title":"God Object: functions/src/admin.ts (4108 lines)"},{"id":"CANON-0008","category":"refactoring","title":"admin.ts Mega-File: 33 Cloud Functions with identi"}],"file_hotspot":"functions/src/admin.ts","priority_score":33.8,"unified_id":"UNIFIED-0058"}
{"category":"engineering-productivity","title":"Logger is present but lacks correlation/request IDs; tracing across async flows is difficult","fingerprint":"engineering-productivity::lib/logger.ts::missing-correlation-ids","severity":"S2","effort":"E2","confidence":90,"files":["lib/logger.ts","components/providers/error-boundary.tsx","lib/firestore-service.ts"],"why_it_matters":"Without a correlation ID, it's hard to connect logs from UI actions, cloud function calls, and error boundaries into a single timeline.","suggested_fix":"Add optional requestId/correlationId to logger context and propagate it through: UI action → secure-caller → callable payload.","acceptance_tests":["grep -R 'correlationId|x-request-id' shows new implementation points","A single user action emits multiple logs sharing the same correlationId"],"evidence":["lib/logger.ts:99-106 payload has no request/correlation id field","repo-wide search for correlationId: no matches","grep -r 'correlationId' lib/ app/ components/ → 10 matches (scattered)","lib/logger.ts doesn't enforce correlationId parameter","lib/firestore-service.ts Cloud Function calls don't include request context","Sentry initialization doesn't configure correlationId as tag"],"line":99,"sources":[{"source":"chatgpt","file":"engineering-productivity-chatgpt.jsonl","original_fingerprint":"engineering-productivity::lib/logger.ts::missing-correlation-ids"},{"source":"claudecode","file":"engineering-productivity-claudecode.jsonl","original_fingerprint":"engineering-productivity::lib/logger.ts::missing-correlation-ids"},{"source":"codex","file":"security-codex.jsonl","original_fingerprint":"Framework::components/providers/error-boundary.tsx::client-process-env"}],"merged_from":["engineering-productivity::lib/logger.ts::missing-correlation-ids","engineering-productivity::lib/logger.ts::missing-correlation-ids"],"verified":true,"consensus_score":3,"canonical_id":"CANON-0018","status":"CONFIRMED","cross_cutting":true,"categories":["engineering-productivity","security"],"related_findings":[{"id":"CANON-0018","category":"engineering-productivity","title":"Logger is present but lacks correlation/request ID"},{"id":"CANON-0029","category":"security","title":"Client components access process.env directly"}],"file_hotspot":"components/providers/error-boundary.tsx","priority_score":29.3,"unified_id":"UNIFIED-0059"}
{"category":"code","title":"Zero Component Test Coverage","fingerprint":"Testing::components::all-components::no-component-tests","severity":"S1","effort":"E3","confidence":100,"files":["components/"],"symbols":["*"],"duplication_cluster":{"is_cluster":false,"cluster_summary":"","instances":[]},"why_it_matters":"20+ component directories with 150+ React components have zero test coverage. No automated verification of UI behavior, accessibility, or user interactions. High regression risk when refactoring large components.","suggested_fix":"Start with critical paths: (1) auth-context provider, (2) admin CRUD operations, (3) journal entry creation. Use @testing-library/react with MSW for API mocking. Target 50% coverage for Phase 1. Document testing patterns in TESTING.md.","acceptance_tests":["npm test runs component tests successfully","Critical user flows have test coverage","Tests catch at least one real bug during implementation","CI runs tests on every PR"],"pr_bucket_suggestion":"tests-hardening","dependencies":[],"evidence":["find components -name '*.test.tsx' returns 0 results","package.json shows testing infrastructure exists (node:test, cross-env)","tests/ directory contains 20 files but none for components"],"notes":"Major gap. Aligns with DEBT-0050 (script test coverage). Track A Testing Plan exists in docs/plans/TRACK_A_TESTING_PLAN.md.","sources":[{"source":"claude-code","file":"code-claude-code.jsonl","original_fingerprint":"Testing::components::all-components::no-component-tests"},{"source":"copilot","file":"engineering-productivity-copilot.jsonl","original_fingerprint":"engineering-productivity::app/::console-log-ratio"}],"verified":true,"consensus_score":2,"canonical_id":"CANON-0007","status":"CONFIRMED","cross_cutting":true,"categories":["code","engineering-productivity"],"related_findings":[{"id":"CANON-0007","category":"code","title":"Zero Component Test Coverage"},{"id":"CANON-0038","category":"engineering-productivity","title":"8:1 console.log to logger ratio — production obser"}],"file_hotspot":"components/","priority_score":28.8,"unified_id":"UNIFIED-0060"}
{"category":"code","title":"Excessive Cognitive Complexity (40+ files)","fingerprint":"AICode::scripts::multiple-files::cognitive-complexity-pattern","severity":"S1","effort":"E3","confidence":100,"files":["scripts/check-docs-light.js","scripts/validate-audit.js","scripts/phase-complete-check.js","scripts/archive-doc.js","functions/src/security-wrapper.ts","components/notebook/pages/history-page.tsx","components/notebook/pages/resources-page.tsx"],"symbols":["checkDocument","validateS0S1Strict","checkPhaseComplete","archiveDocument","createSecurityWrapper","HistoryPage","ResourcesPage"],"duplication_cluster":{"is_cluster":true,"cluster_summary":"Pattern of deeply nested conditional logic without helper function extraction. 40+ files exceed SonarCloud's cognitive complexity threshold of 15.","instances":[{"file":"scripts/check-docs-light.js","symbol":"checkDocument","complexity":51},{"file":"scripts/validate-audit.js","symbol":"validateS0S1Strict","complexity":34},{"file":"scripts/phase-complete-check.js","symbol":"checkPhaseComplete","complexity":27},{"file":"functions/src/security-wrapper.ts","symbol":"createSecurityWrapper","complexity":39},{"file":"components/notebook/pages/history-page.tsx","symbol":"HistoryPage","complexity":35},{"file":"components/notebook/pages/resources-page.tsx","symbol":"ResourcesPage","complexity":48}]},"why_it_matters":"High cognitive complexity (15+) makes code difficult to understand, test, and debug. Pattern suggests AI-generated code without human refactoring. Increases bug density and maintenance burden.","suggested_fix":"Extract helper functions to reduce nesting. Pattern: (1) Extract validation helpers, (2) Extract conditional branches into named functions, (3) Use early returns to flatten logic. Apply SonarCloud refactoring suggestions already documented in TDMS DEBT-0010 through DEBT-0044.","acceptance_tests":["All affected files reduce complexity to <=15","Functionality unchanged (regression tests pass)","Helper functions have descriptive names","Code coverage maintained or improved"],"pr_bucket_suggestion":"misc","dependencies":[],"evidence":["MASTER_DEBT.jsonl entries DEBT-0010 to DEBT-0044 document 35 cognitive complexity violations","SonarCloud rule typescript:S3776 and javascript:S3776","Grep shows helper function extraction pattern already used in some files (line 97 comment in users-tab.tsx)"],"notes":"This is a cross-cutting pattern, not isolated instances. Shows good intent (helper comment exists) but incomplete application. Roadmap: M2.1 (components), M2.2 (functions), Track-E (scripts).","sources":[{"source":"claude-code","file":"code-claude-code.jsonl","original_fingerprint":"AICode::scripts::multiple-files::cognitive-complexity-pattern"},{"source":"copilot","file":"process-copilot.jsonl","original_fingerprint":"scripts::aggregate-audit-findings.js::oversized_scripts"}],"verified":true,"consensus_score":2,"canonical_id":"CANON-0008","status":"CONFIRMED","cross_cutting":true,"categories":["code","process"],"related_findings":[{"id":"CANON-0008","category":"code","title":"Excessive Cognitive Complexity (40+ files)"},{"id":"CANON-0019","category":"process","title":"Oversized scripts: aggregate-audit-findings.js (63"}],"file_hotspot":"scripts/validate-audit.js","priority_score":28.8,"unified_id":"UNIFIED-0061"}
{"category":"refactoring","title":"Triple data access layer: 3 overlapping Firestore patterns","fingerprint":"Architecture::lib::triple_data_access_layer","severity":"S1","effort":"E3","confidence":100,"files":["lib/firestore-service.ts","lib/database/firestore-adapter.ts","lib/db/meetings.ts","lib/db/library.ts","lib/db/glossary.ts","lib/db/quotes.ts","lib/db/slogans.ts","lib/db/sober-living.ts"],"line":null,"description":"Three overlapping Firestore access patterns coexist: (1) FirestoreService in lib/firestore-service.ts (476 lines) handles daily logs, inventory, journal; (2) FirestoreAdapter in lib/database/firestore-adapter.ts overlaps with daily logs; (3) Per-entity services in lib/db/*.ts (7 modules) handle meetings, quotes, slogans, glossary, etc. No clear canonical path for data access.","evidence":["lib/firestore-service.ts: 476 lines, handles daily logs + inventory + journal","lib/database/firestore-adapter.ts: overlaps with FirestoreService on daily logs","lib/db/*.ts: 7 separate modules (meetings, library, glossary, quotes, slogans, sober-living, collections)","Components import from different layers depending on which entity they need"],"remediation":{"steps":["1. Migrate FirestoreService methods into appropriate lib/db/ modules","2. Deprecate and remove FirestoreAdapter (functionality absorbed by lib/db/)","3. Establish lib/db/ as the single canonical data access layer","4. Update all component imports to use lib/db/ exclusively"],"verification":["FirestoreService removed or reduced to re-exports from lib/db/","FirestoreAdapter removed entirely","All data access goes through lib/db/ modules","No overlapping functionality between modules"]},"sources":[{"source":"claude","file":"refactoring-claude.jsonl","original_fingerprint":"Architecture::lib::triple_data_access_layer"}],"verified":true,"consensus_score":2,"canonical_id":"CANON-0010","status":"CONFIRMED","cross_cutting":true,"categories":["code","refactoring"],"related_findings":[{"id":"CANON-0029","category":"code","title":"Inconsistent lib/db/ Write Patterns"},{"id":"CANON-0010","category":"refactoring","title":"Triple data access layer: 3 overlapping Firestore "}],"file_hotspot":"lib/db/glossary.ts","priority_score":28.8,"unified_id":"UNIFIED-0062"}
{"category":"code","title":"Potential Firestore-rules alignment risk for direct weekly log reads","fingerprint":"Security::components/notebook/pages/today-page.tsx::calculateWeeklyStats::rules_alignment_uncertain","severity":"S2","effort":"E1","confidence":35,"files":["components/notebook/pages/today-page.tsx","storage.rules"],"symbols":["calculateWeeklyStats"],"duplication_cluster":{"is_cluster":false,"cluster_summary":"","instances":[]},"why_it_matters":"If rules evolve, direct query behavior may diverge from service-backed behavior and fail unexpectedly.","suggested_fix":"Consolidate to service layer and add emulator-based rules tests for weekly-read path.","acceptance_tests":["Firestore emulator integration tests for daily_logs weekly query"],"pr_bucket_suggestion":"security-hardening","dependencies":[],"evidence":["Rules-to-query alignment was not fully validated in this pass."],"sources":[{"source":"codex-suspected","file":"code-codex-suspected.jsonl","original_fingerprint":"Security::components/notebook/pages/today-page.tsx::calculateWeeklyStats::rules_alignment_uncertain"},{"source":"copilot","file":"security-copilot.jsonl","original_fingerprint":"FileHandling::storage.rules::missing_mime_validation"}],"verified":true,"consensus_score":1.5,"canonical_id":"CANON-0054","status":"SUSPECTED","cross_cutting":true,"categories":["code","security"],"related_findings":[{"id":"CANON-0054","category":"code","title":"Potential Firestore-rules alignment risk for direc"},{"id":"CANON-0014","category":"security","title":"Missing File MIME Type Validation in Storage Rules"}],"file_hotspot":"storage.rules","priority_score":27.8,"unified_id":"UNIFIED-0063"}
{"category":"performance","title":"Excessive client-component surface (\"use client\" appears 107 times) increases hydration + JS cost","fingerprint":"Bundle Size::app/components::use_client_overuse","severity":"S1","effort":"E3","confidence":90,"files":["app/admin/page.tsx","app/meetings/all/page.tsx","components/admin/admin-crud-table.tsx"],"symbols":["AdminPage","MeetingsAllPage","AdminCrudTable"],"performance_details":{"current_metric":"107 occurrences of \"use client\" across app/components/hooks/lib/types (high hydration surface)","expected_improvement":"20–40% reduction in initial JS/hydration work on non-interactive routes after moving logic to server components and narrowing client islands","affected_metric":"bundle"},"optimization":{"description":"Reduce client boundary: keep pages/layouts server by default; move only interactive subtrees to client components; prefer server-side data shaping for static/exported pages where possible.","code_example":"// app/some-route/page.tsx (Server)\nimport ClientWidget from './client-widget';\nexport default function Page(){\n  return (<>\n    <StaticSection />\n    <ClientWidget />\n  </>);\n}\n","verification":["Re-run grep count for \"use client\" and track down; ensure key routes remain interactive.","After changes, run bundle analyzer + Lighthouse to confirm reduced JS and improved INP."]},"evidence":["grep count: 107 lines match \"\\\"use client\\\"\" under app/components/hooks/lib/types","app/admin/page.tsx:1 \"use client\"","app/meetings/all/page.tsx:1 \"use client\""],"notes":"Scope note: routes like /dashboard, /daily-log, /analytics were not present in this repo snapshot; audit focuses on existing routes.","line":1,"sources":[{"source":"chatgpt","file":"refactoring-chatgpt.jsonl","original_fingerprint":"Security/Hardening::components/growth/DailySloganWidget.tsx::DailySloganWidget::raw-error-logging-drift"}],"verified":true,"consensus_score":2,"canonical_id":"CANON-0001","status":"CONFIRMED","cross_cutting":true,"categories":["performance","refactoring"],"related_findings":[{"id":"CANON-0001","category":"performance","title":"Excessive client-component surface (\"use client\" a"},{"id":"CANON-0003","category":"refactoring","title":"Error logging inconsistent: many call sites log ra"}],"file_hotspot":"app/admin/page.tsx","priority_score":27.8,"unified_id":"UNIFIED-0064"}
{"category":"performance","title":"Excessive client-component surface (\"use client\" appears 107 times) increases hydration + JS cost","fingerprint":"Bundle Size::app/components::use_client_overuse","severity":"S1","effort":"E3","confidence":90,"files":["app/admin/page.tsx","app/meetings/all/page.tsx","components/admin/admin-crud-table.tsx"],"symbols":["AdminPage","MeetingsAllPage","AdminCrudTable"],"performance_details":{"current_metric":"107 occurrences of \"use client\" across app/components/hooks/lib/types (high hydration surface)","expected_improvement":"20–40% reduction in initial JS/hydration work on non-interactive routes after moving logic to server components and narrowing client islands","affected_metric":"bundle"},"optimization":{"description":"Reduce client boundary: keep pages/layouts server by default; move only interactive subtrees to client components; prefer server-side data shaping for static/exported pages where possible.","code_example":"// app/some-route/page.tsx (Server)\nimport ClientWidget from './client-widget';\nexport default function Page(){\n  return (<>\n    <StaticSection />\n    <ClientWidget />\n  </>);\n}\n","verification":["Re-run grep count for \"use client\" and track down; ensure key routes remain interactive.","After changes, run bundle analyzer + Lighthouse to confirm reduced JS and improved INP."]},"evidence":["grep count: 107 lines match \"\\\"use client\\\"\" under app/components/hooks/lib/types","app/admin/page.tsx:1 \"use client\"","app/meetings/all/page.tsx:1 \"use client\""],"notes":"Scope note: routes like /dashboard, /daily-log, /analytics were not present in this repo snapshot; audit focuses on existing routes.","line":1,"sources":[{"source":"chatgpt","file":"refactoring-chatgpt.jsonl","original_fingerprint":"Security/Hardening::components/growth/DailySloganWidget.tsx::DailySloganWidget::raw-error-logging-drift"}],"verified":true,"consensus_score":2,"canonical_id":"CANON-0001","status":"CONFIRMED","cross_cutting":true,"categories":["performance","refactoring"],"related_findings":[{"id":"CANON-0001","category":"performance","title":"Excessive client-component surface (\"use client\" a"},{"id":"CANON-0003","category":"refactoring","title":"Error logging inconsistent: many call sites log ra"}],"file_hotspot":"app/meetings/all/page.tsx","priority_score":27.8,"unified_id":"UNIFIED-0065"}
{"category":"process","title":"Oversized scripts: aggregate-audit-findings.js (63KB), check-pattern-compliance.js (45KB)","fingerprint":"scripts::aggregate-audit-findings.js::oversized_scripts","severity":"S2","effort":"E2","confidence":95,"files":["scripts/aggregate-audit-findings.js","scripts/check-pattern-compliance.js","scripts/analyze-learning-effectiveness.js","scripts/check-review-needed.js","scripts/validate-audit.js"],"line":1,"description":"Multiple scripts exceed 30KB: aggregate-audit-findings.js (63KB), analyze-learning-effectiveness.js (47KB), check-pattern-compliance.js (45KB), check-review-needed.js (40KB), validate-audit.js (30KB). Unmaintainable monoliths that likely don't use scripts/lib/ shared utilities.","evidence":["scripts/aggregate-audit-findings.js: 63,430 bytes","scripts/analyze-learning-effectiveness.js: 47,047 bytes","scripts/check-pattern-compliance.js: 45,605 bytes","scripts/check-review-needed.js: 40,692 bytes","scripts/validate-audit.js: 30,816 bytes"],"remediation":{"steps":["Extract common JSONL parsing, file traversal, reporting utilities to scripts/lib/","Break large scripts into modules","Target <500 lines per script file"],"verification":["Largest script < 20KB","scripts/lib/ contains shared utilities"]},"sources":[{"source":"copilot","file":"process-copilot.jsonl","original_fingerprint":"scripts::aggregate-audit-findings.js::oversized_scripts"},{"source":"chatgpt","file":"refactoring-chatgpt.jsonl","original_fingerprint":"Testing Infrastructure::scripts/check-pattern-compliance.js::main::missing-logger-guardrail"}],"verified":true,"consensus_score":2,"canonical_id":"CANON-0019","status":"CONFIRMED","cross_cutting":true,"categories":["process","refactoring"],"related_findings":[{"id":"CANON-0019","category":"process","title":"Oversized scripts: aggregate-audit-findings.js (63"},{"id":"CANON-0046","category":"refactoring","title":"No automated guardrail to prevent new raw logger.e"}],"file_hotspot":"scripts/check-pattern-compliance.js","priority_score":24.6,"unified_id":"UNIFIED-0066"}
{"category":"engineering-productivity","title":"8:1 console.log to logger ratio — production observability gap","fingerprint":"engineering-productivity::app/::console-log-ratio","severity":"S2","effort":"E2","confidence":90,"files":["app/","lib/","components/"],"why_it_matters":"~3111 console.log calls vs ~394 logger calls means most production errors are invisible to Sentry. Console.log output is not redacted for PII, not structured, and not captured by monitoring.","suggested_fix":"Add ESLint rule no-console (warn level) to flag new console.log additions. Prioritize converting console.log in error paths to logger.error.","acceptance_tests":["ESLint warns on new console.log","Critical error paths use logger.error","Ratio improves to <4:1"],"evidence":["Prior audit: 3111 console.log vs 394 logger calls","lib/logger.ts exists but is underutilized"],"line":1,"sources":[{"source":"copilot","file":"engineering-productivity-copilot.jsonl","original_fingerprint":"engineering-productivity::app/::console-log-ratio"},{"source":"kimi","file":"performance-kimi.jsonl","original_fingerprint":"BundleSize::app/::no_code_splitting"}],"verified":true,"consensus_score":2,"canonical_id":"CANON-0038","status":"CONFIRMED","cross_cutting":true,"categories":["engineering-productivity","performance"],"related_findings":[{"id":"CANON-0038","category":"engineering-productivity","title":"8:1 console.log to logger ratio — production obser"},{"id":"CANON-0031","category":"performance","title":"No code splitting strategy implemented"}],"file_hotspot":"app/","priority_score":24.3,"unified_id":"UNIFIED-0067"}
{"category":"documentation","title":"Potential Misplaced Plans in Archive/Templates","fingerprint":"Documentation::docs/archive/::misplaced_plan","severity":"S3","effort":"E0","confidence":40,"files":["docs/archive/completed-plans/DOCUMENTATION_STANDARDIZATION_PLAN.md","docs/multi-ai-audit/templates/CODE_REVIEW_PLAN.md","docs/multi-ai-audit/templates/PERFORMANCE_AUDIT_PLAN.md"],"line":1,"description":"Files ending in _PLAN.md are flagged as misplaced by the placement script, but may be correctly located in archive or templates directories.","evidence":["Current: docs/archive/.../PLAN.md","Expected: docs/plans/"],"remediation":{"steps":["Verify if script logic needs update to allow plans in archive/templates","Or move if truly misplaced"],"verification":["Manual review"]},"sources":[{"source":"jules","file":"documentation-jules.jsonl","original_fingerprint":"Documentation::docs/archive/::misplaced_plan"}],"verified":true,"consensus_score":1.5,"canonical_id":"CANON-0065","status":"SUSPECTED","cross_cutting":false,"categories":["documentation"],"priority_score":14.5,"unified_id":"UNIFIED-0068"}
{"category":"documentation","title":"docs/OPERATIONAL_VISIBILITY_SPRINT.md and docs/HOOKIFY_STRATEGY.md are large planning docs that may be partially complete","fingerprint":"Documentation::docs/OPERATIONAL_VISIBILITY_SPRINT.md::large_planning_docs_review","severity":"S3","effort":"E1","confidence":70,"files":["docs/OPERATIONAL_VISIBILITY_SPRINT.md","docs/HOOKIFY_STRATEGY.md"],"line":1,"description":"OPERATIONAL_VISIBILITY_SPRINT.md (40KB) is the active P0 sprint per ROADMAP.md (~30% complete). HOOKIFY_STRATEGY.md (33KB) appears to be a strategy doc. Both are large. The OVS doc is actively used but should be reviewed for content that can be archived. HOOKIFY_STRATEGY.md should be checked for completion status.","evidence":["docs/OPERATIONAL_VISIBILITY_SPRINT.md: 40,860 bytes, referenced as active sprint in ROADMAP.md:87","docs/HOOKIFY_STRATEGY.md: 33,509 bytes"],"remediation":{"steps":["1. Review HOOKIFY_STRATEGY.md for completion status — if complete, archive","2. Trim completed sections from OPERATIONAL_VISIBILITY_SPRINT.md to keep it focused","3. Both should have current Status headers per Tier 3 requirements"],"verification":["Both docs have accurate status headers","Completed content archived"]},"sources":[{"source":"copilot","file":"documentation-copilot.jsonl","original_fingerprint":"Documentation::docs/OPERATIONAL_VISIBILITY_SPRINT.md::large_planning_docs_review"}],"verified":true,"consensus_score":1.5,"canonical_id":"CANON-0064","status":"SUSPECTED","cross_cutting":false,"categories":["documentation"],"priority_score":11.8,"unified_id":"UNIFIED-0069"}
{"category":"engineering-productivity","title":"No UI indicator for online/offline state","fingerprint":"engineering-productivity::components/offline-indicator.tsx::missing-offline-ui","severity":"S3","effort":"E1","confidence":70,"files":["components/offline-indicator.tsx"],"line":1,"why_it_matters":"Users don't know when they're offline and may be confused why saves fail or data doesn't load. A simple online/offline indicator (banner, toast, status icon) provides critical feedback. Currently found 8 mentions of 'offline' in components but no dedicated UI indicator. Without visual feedback, users may think app is broken rather than their network. Low severity because app may work without obvious issues, but creates confusion when offline features are added.","suggested_fix":"Create components/offline-indicator.tsx that: (1) Listens to window online/offline events, (2) Shows banner at top when offline ('You are offline. Changes will sync when reconnected'), (3) Shows toast when transitioning online to offline and vice versa, (4) Optionally shows pending sync count if offline queue implemented. Use React Context to make online state available app-wide. Add to app/layout.tsx.","acceptance_tests":["components/offline-indicator.tsx created","Component listens to window.addEventListener('online/offline')","Banner appears at top when offline with appropriate message","Toast notification on network state change","Component uses React Context to share state app-wide","Test: Disconnect network, verify banner appears immediately","Test: Reconnect network, verify banner disappears and toast shows","Integration with offline queue to show pending sync count"],"evidence":["grep -r 'offline.*indicator|network.*status' components/ → 0 matches","grep -r 'navigator.onLine|window.addEventListener.*online' components/ → 8 mentions (scattered, no UI component)","No dedicated offline UI component found","Standard pattern: https://web.dev/offline-ux-design-guidelines/"],"sources":[{"source":"claudecode","file":"engineering-productivity-claudecode.jsonl","original_fingerprint":"engineering-productivity::components/offline-indicator.tsx::missing-offline-ui"}],"verified":false,"consensus_score":1,"canonical_id":"CANON-0065","status":"SUSPECTED","cross_cutting":false,"categories":["engineering-productivity"],"priority_score":9.3,"unified_id":"UNIFIED-0070"}
{"category":"documentation","title":"Markdownlint and Prettier checks not confirmed","fingerprint":"Documentation::docs/::format_checks_unverified","severity":"S3","effort":"E1","confidence":40,"files":["docs/**/*.md"],"line":1,"description":"SUSPECTED: npm run docs:lint and format:check were not executed. Additional format issues may exist beyond Node-based doc scripts.","evidence":["package.json includes docs:lint and format:check but only Node-based scripts were used"],"remediation":{"steps":["Run npm run docs:lint and npm run format:check -- docs/ in CI/local."],"verification":["npm run docs:lint","npm run format:check -- docs/"]},"sources":[{"source":"chatgpt","file":"documentation-chatgpt.jsonl","original_fingerprint":"Documentation::docs/::format_checks_unverified"}],"verified":false,"consensus_score":1,"canonical_id":"CANON-0066","status":"SUSPECTED","cross_cutting":false,"categories":["documentation"],"priority_score":8.5,"unified_id":"UNIFIED-0071"}
{"category":"engineering-productivity","title":"Potentially missing performance monitoring","fingerprint":"engineering-productivity::lib/performance.ts::missing-monitoring","severity":"S3","effort":"E1","confidence":40,"files":["lib/performance.ts","next.config.js"],"line":1,"why_it_matters":"May lack runtime performance monitoring (Core Web Vitals, API latency, render times). Sentry is integrated but primarily for error tracking, not performance. Next.js has built-in performance monitoring but needs configuration. Without performance data, can't identify slow pages or regressions. Very low confidence - monitoring may exist but not obviously named.","suggested_fix":"If performance monitoring missing: (1) Enable Next.js Analytics in next.config.js, (2) Configure Sentry Performance monitoring (already have Sentry), (3) Add Web Vitals tracking with next/web-vitals, (4) Consider Firebase Performance Monitoring for API calls, (5) Add performance budgets in Lighthouse CI. Document baseline metrics in DEVELOPMENT.md.","acceptance_tests":["Performance monitoring configured (Next.js Analytics or Sentry Performance)","Web Vitals tracked: LCP, FID, CLS","API call latency tracked","Dashboard showing performance trends","Performance budgets defined","Documentation: DEVELOPMENT.md explains performance monitoring"],"evidence":["Sentry integrated (seen in DEVELOPMENT.md)","Don't know if Sentry Performance enabled (need to check Sentry init)","No obvious lib/performance.ts or lib/analytics.ts found","Next.js has built-in monitoring but needs opt-in","Need to verify: Sentry config, next.config.js, Firebase Performance"],"sources":[{"source":"claudecode-suspected","file":"engineering-productivity-claudecode-suspected.jsonl","original_fingerprint":"engineering-productivity::lib/performance.ts::missing-monitoring"}],"verified":false,"consensus_score":1,"canonical_id":"CANON-0064","status":"SUSPECTED","cross_cutting":false,"categories":["engineering-productivity"],"priority_score":8.5,"unified_id":"UNIFIED-0072"}