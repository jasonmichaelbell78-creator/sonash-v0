{"category":"Security","title":"App Check Completely Disabled Across Entire Stack","fingerprint":"Security::functions/src/index.ts::requireAppCheck::app-check-disabled","severity":"S0","effort":"E1","confidence":100,"files":["functions/src/index.ts","lib/firebase.ts"],"symbols":["requireAppCheck","initializeAppCheck"],"duplication_cluster":{"is_cluster":false,"cluster_summary":null,"instances":[]},"why_it_matters":"All Cloud Functions have requireAppCheck: false with comment 'TEMPORARILY DISABLED'. Client-side initialization also commented out. This disables bot protection across all user data writes (journal, daily logs, inventory).","suggested_fix":"Re-enable App Check in lib/firebase.ts (uncomment initialization). Set requireAppCheck: true in all Cloud Functions. Verify reCAPTCHA site key is configured. Test with debug token in development.","acceptance_tests":["App Check enforced on all Cloud Functions","reCAPTCHA site key configured in production","Debug token works in development","Automated requests without App Check token are rejected"],"pr_bucket_suggestion":"security-hardening"}
{"category":"Security","title":"Direct Firestore Write Bypasses Cloud Function Architecture","fingerprint":"Security::components/providers/auth-context.tsx::updateDoc::direct-firestore-write","severity":"S0","effort":"E0","confidence":100,"files":["components/providers/auth-context.tsx"],"symbols":["updateDoc","onAuthStateChanged"],"duplication_cluster":{"is_cluster":false,"cluster_summary":null,"instances":[]},"why_it_matters":"Direct updateDoc call in onAuthStateChanged bypasses the documented Cloud Functions-only architecture for user data. While the specific write is benign (lastActive timestamp), it violates the security model and sets a dangerous precedent.","suggested_fix":"Create updateLastActive Cloud Function OR accept this as an explicit exception and document it in ARCHITECTURE.md.","acceptance_tests":["No direct Firestore writes in client code (or documented exceptions)","lastActive timestamp still updates correctly","Cloud Function architecture consistency verified"],"pr_bucket_suggestion":"security-hardening"}
{"category":"Security","title":"Sober Living Admin Tab Silently Fails All Writes","fingerprint":"Security::components/admin/sober-living-tab.tsx::SoberLivingService::silent-write-failure","severity":"S0","effort":"E0","confidence":100,"files":["components/admin/sober-living-tab.tsx","lib/db/sober-living.ts"],"symbols":["soberLivingConfig","SoberLivingService"],"duplication_cluster":{"is_cluster":false,"cluster_summary":null,"instances":[]},"why_it_matters":"Admin tab uses direct client-side writes via SoberLivingService, but Firestore rules block ALL writes: 'allow write: if false'. Cloud Functions adminSaveSoberLiving and adminDeleteSoberLiving exist but are not wired to the UI.","suggested_fix":"Update soberLivingConfig in sober-living-tab.tsx to use cloudFunctions config with saveFunctionName: 'adminSaveSoberLiving' and deleteFunctionName: 'adminDeleteSoberLiving'. Remove service: soberLivingServiceAdapter line.","acceptance_tests":["Sober living CRUD operations succeed in admin panel","Firestore rules remain restrictive (allow write: if false)","Cloud Functions used for all sober-living writes"],"pr_bucket_suggestion":"security-hardening"}
{"category":"Hygiene","title":"Monolithic Admin Cloud Functions File (4,108 Lines)","fingerprint":"Hygiene::functions/src/admin.ts::admin.ts::god-object","severity":"S1","effort":"E2","confidence":100,"files":["functions/src/admin.ts"],"symbols":["admin.ts"],"duplication_cluster":{"is_cluster":false,"cluster_summary":null,"instances":[]},"why_it_matters":"Single file contains all admin Cloud Functions: meetings, sober living, quotes, dashboard stats, user management, jobs, errors, logs, privileges, analytics, storage, rate limits. 4,108 lines violates single responsibility.","suggested_fix":"Split into domain-specific files: admin/meetings.ts, admin/users.ts, admin/content.ts (quotes, slogans, glossary), admin/monitoring.ts (errors, logs, jobs), admin/privileges.ts, admin/analytics.ts. Keep shared helpers in admin/shared.ts.","acceptance_tests":["All Cloud Functions still callable after split","Integration tests pass","No circular dependencies","Test coverage maintained or improved"],"pr_bucket_suggestion":"misc"}
{"category":"Testing","title":"Critical Paths Lack Test Coverage","fingerprint":"Testing::hooks/use-journal.ts::useJournal::critical-path-no-tests","severity":"S1","effort":"E2","confidence":100,"files":["hooks/use-journal.ts","components/providers/auth-context.tsx","components/providers/profile-context.tsx","components/providers/daily-log-context.tsx","lib/auth/account-linking.ts","lib/recaptcha.ts","lib/sentry.client.ts"],"symbols":["useJournal","AuthProvider","ProfileProvider","DailyLogProvider","accountLinking","recaptcha"],"duplication_cluster":{"is_cluster":false,"cluster_summary":null,"instances":[]},"why_it_matters":"Core hooks and providers are untested. use-journal.ts: Core data management hook for all journal CRUD. auth-context.tsx: Anonymous session creation, retry logic, lastActive updates. account-linking.ts: Complex migration logic with data loss risk.","suggested_fix":"Add test files for: use-journal, auth-context, profile-context, daily-log-context, account-linking, recaptcha. Use mocks, not real Firebase. Target >80% coverage for critical paths.","acceptance_tests":["Test files exist for all critical paths","Coverage >80% for hooks and providers","Tests use mocks, not real Firebase","CI runs tests on every PR"],"pr_bucket_suggestion":"tests-hardening"}
{"category":"Hygiene","title":"Oversized UI Components (1,000-2,000+ Lines Each)","fingerprint":"Hygiene::components/admin/users-tab.tsx::UsersTab::oversized-components","severity":"S1","effort":"E2","confidence":100,"files":["components/admin/users-tab.tsx","components/notebook/pages/today-page.tsx","components/admin/errors-tab.tsx","components/admin/dashboard-tab.tsx"],"symbols":["UsersTab","TodayPage","ErrorsTab","DashboardTab"],"duplication_cluster":{"is_cluster":false,"cluster_summary":null,"instances":[]},"why_it_matters":"Four files exceed 1,000 lines each. users-tab.tsx (2,092 lines) contains 10 getFunctions() calls, multiple state variables, complex filtering logic. Hard to understand, modify, and test.","suggested_fix":"Extract sub-components and hooks. users-tab.tsx -> UserFilters, UserTable, UserDetailModal, UserEditForm, useUserManagement hook. today-page.tsx -> JournalTextarea, MoodSelector, CravingsToggle, useTodayLog hook.","acceptance_tests":["Components render without errors","Functionality unchanged","Main components <200 lines each","No console errors during interactions"],"pr_bucket_suggestion":"misc"}
{"category":"Security","title":"Inconsistent Admin Write Patterns (Cloud Functions vs Direct Writes)","fingerprint":"Security::components/admin/admin-crud-table.tsx::AdminCrudTable::inconsistent-write-patterns","severity":"S1","effort":"E1","confidence":100,"files":["components/admin/meetings-tab.tsx","components/admin/sober-living-tab.tsx","components/admin/quotes-tab.tsx","components/admin/glossary-tab.tsx","components/admin/slogans-tab.tsx","components/admin/admin-crud-table.tsx"],"symbols":["AdminCrudTable","cloudFunctions","service"],"duplication_cluster":{"is_cluster":false,"cluster_summary":null,"instances":[]},"why_it_matters":"AdminCrudTable accepts either cloudFunctions or service config. Meetings use Cloud Functions, others use direct client writes. Firestore rules allow admin writes for quotes/glossary/slogans but not sober_living. Inconsistent security model.","suggested_fix":"Standardize on Cloud Functions for all admin writes. Create Cloud Functions for quotes, glossary, slogans (or document why direct writes are acceptable). Update all admin tabs to use cloudFunctions config.","acceptance_tests":["All admin tabs use consistent write pattern","Firestore rules match code behavior","Security model documented and enforced"],"pr_bucket_suggestion":"security-hardening"}
{"category":"Hygiene","title":"Duplicate Quote Widget Components (3 Variants)","fingerprint":"Hygiene::components/widgets/daily-quote-card.tsx::DailyQuoteCard::duplicate-quote-widgets","severity":"S2","effort":"E1","confidence":100,"files":["components/widgets/daily-quote-card.tsx","components/widgets/compact-daily-quote.tsx","components/notebook/features/daily-quote-card.tsx"],"symbols":["DailyQuoteCard","CompactDailyQuote"],"duplication_cluster":{"is_cluster":true,"cluster_summary":"Three separate components for displaying daily quotes with different styling","instances":[{"file":"components/widgets/daily-quote-card.tsx","symbol":"DailyQuoteCard"},{"file":"components/widgets/compact-daily-quote.tsx","symbol":"CompactDailyQuote"},{"file":"components/notebook/features/daily-quote-card.tsx","symbol":"DailyQuoteCard"}]},"why_it_matters":"Three separate components for displaying daily quotes. All use useDailyQuote() hook but have different styling. daily-quote-card.tsx exists in two locations with different implementations.","suggested_fix":"Consolidate into single DailyQuoteCard component with variant prop ('default' | 'compact' | 'sticky-note'). Keep in components/widgets/daily-quote-card.tsx, delete duplicates.","acceptance_tests":["Single quote component with variant prop","All quote display contexts use unified component","No duplicate implementations"],"pr_bucket_suggestion":"ui-primitives"}
{"category":"Hygiene","title":"Duplicate Mood Selector Components (2 Variants)","fingerprint":"Hygiene::components/notebook/features/mood-selector.tsx::MoodSelector::duplicate-mood-selectors","severity":"S2","effort":"E1","confidence":100,"files":["components/notebook/features/mood-selector.tsx","components/notebook/features/enhanced-mood-selector.tsx"],"symbols":["MoodSelector","EnhancedMoodSelector"],"duplication_cluster":{"is_cluster":true,"cluster_summary":"Two mood selector implementations with different feature sets","instances":[{"file":"components/notebook/features/mood-selector.tsx","symbol":"MoodSelector"},{"file":"components/notebook/features/enhanced-mood-selector.tsx","symbol":"EnhancedMoodSelector"}]},"why_it_matters":"Two mood selector implementations. enhanced-mood-selector.tsx has additional features but both are actively used in different contexts. Inconsistent mood selection UX.","suggested_fix":"Merge into single component with feature flags or consolidate on enhanced version.","acceptance_tests":["Single mood selector component","Consistent UX across all contexts","No duplicate implementations"],"pr_bucket_suggestion":"ui-primitives"}
{"category":"Hygiene","title":"Duplicate Meeting Countdown Widgets (2 Variants)","fingerprint":"Hygiene::components/widgets/meeting-countdown.tsx::MeetingCountdown::duplicate-countdown-widgets","severity":"S2","effort":"E1","confidence":100,"files":["components/widgets/meeting-countdown.tsx","components/widgets/compact-meeting-countdown.tsx"],"symbols":["MeetingCountdown","CompactMeetingCountdown"],"duplication_cluster":{"is_cluster":true,"cluster_summary":"Two meeting countdown implementations with misleading naming (compact is larger)","instances":[{"file":"components/widgets/meeting-countdown.tsx","symbol":"MeetingCountdown"},{"file":"components/widgets/compact-meeting-countdown.tsx","symbol":"CompactMeetingCountdown"}]},"why_it_matters":"Two meeting countdown implementations. 'Compact' version is actually larger (316 vs 90 lines), suggesting feature creep. Code duplication and confusing naming.","suggested_fix":"Consolidate with variant prop or rename to reflect actual complexity.","acceptance_tests":["Single countdown component with variant prop","Naming matches actual complexity","No duplicate implementations"],"pr_bucket_suggestion":"ui-primitives"}
{"category":"Hygiene","title":"Redundant getFunctions() Calls (28+ Across Admin Components)","fingerprint":"Hygiene::components/admin::getFunctions::redundant-getfunctions-calls","severity":"S2","effort":"E0","confidence":100,"files":["components/admin/users-tab.tsx","components/admin/dashboard-tab.tsx","components/admin/jobs-tab.tsx","components/admin/errors-tab.tsx","components/admin/admin-crud-table.tsx"],"symbols":["getFunctions"],"duplication_cluster":{"is_cluster":false,"cluster_summary":null,"instances":[]},"why_it_matters":"28+ getFunctions() calls across admin components. Each call creates a new Functions instance unnecessarily. Harder to mock in tests.","suggested_fix":"Create lib/admin-functions.ts exporting a singleton: export const adminFunctions = getFunctions(). Import and use throughout admin components.","acceptance_tests":["Single getFunctions() call via singleton","All admin components import from lib/admin-functions.ts","Tests can mock single import"],"pr_bucket_suggestion":"misc"}
{"category":"Debugging","title":"Missing Correlation IDs for Request Tracing","fingerprint":"Debugging::lib::all-files::missing-correlation-ids","severity":"S2","effort":"E1","confidence":70,"files":[],"symbols":["correlationId"],"duplication_cluster":{"is_cluster":false,"cluster_summary":null,"instances":[]},"why_it_matters":"Only 10 references to correlation/request IDs found, all in jobs-tab.tsx for local deduplication. No frontend to backend correlation IDs for tracing requests through the system.","suggested_fix":"Generate correlation ID in client before Cloud Function call. Pass as metadata in request. Log in Cloud Function with the same ID. Include in Sentry breadcrumbs.","acceptance_tests":["Correlation IDs generated for all Cloud Function calls","IDs logged both client-side and server-side","Sentry breadcrumbs include correlation ID"],"pr_bucket_suggestion":"debugging"}
{"category":"Debugging","title":"Network Status Not Captured in Error Logs","fingerprint":"Debugging::lib/logger.ts::logger::no-network-status-in-errors","severity":"S2","effort":"E0","confidence":100,"files":["components/status/offline-indicator.tsx","lib/logger.ts","lib/utils/errors.ts"],"symbols":["OfflineIndicator","logger"],"duplication_cluster":{"is_cluster":false,"cluster_summary":null,"instances":[]},"why_it_matters":"OfflineIndicator component tracks navigator.onLine, but error logs don't capture network status. When errors occur, offline vs online context is unknown. Cannot distinguish network errors from application errors.","suggested_fix":"Add networkStatus: navigator.onLine to all error logs in lib/logger.ts.","acceptance_tests":["Error logs include network status","Offline errors distinguishable from application errors","Logger enriches all error entries with navigator.onLine"],"pr_bucket_suggestion":"debugging"}
{"category":"Debugging","title":"Console.log Statements in Production Code (13 Instances)","fingerprint":"Debugging::generic::console-log::production-console-logs","severity":"S2","effort":"E0","confidence":70,"files":[],"symbols":["console.log"],"duplication_cluster":{"is_cluster":false,"cluster_summary":null,"instances":[]},"why_it_matters":"Thirteen console.log statements remain in production source code rather than using the structured logger. May leak sensitive data in production.","suggested_fix":"Replace with logger.info() or remove if debugging code. Add ESLint rule to prevent future console.log in production.","acceptance_tests":["Zero console.log in production code (or documented exceptions)","ESLint rule enforces no-console","All logging uses structured logger"],"pr_bucket_suggestion":"misc"}
{"category":"Hygiene","title":"Inconsistent lib/db/ Write Patterns","fingerprint":"Hygiene::lib/db::write-methods::inconsistent-write-patterns","severity":"S2","effort":"E1","confidence":100,"files":["lib/db/sober-living.ts","lib/db/glossary.ts","lib/db/quotes.ts","lib/db/slogans.ts","lib/db/library.ts","lib/db/users.ts"],"symbols":["SoberLivingService","GlossaryService","QuotesService","SlogansService"],"duplication_cluster":{"is_cluster":false,"cluster_summary":null,"instances":[]},"why_it_matters":"Some lib/db/ modules have write operations that Firestore rules block (sober-living), others are allowed (quotes, glossary). Creates confusion about which writes are permitted.","suggested_fix":"Document which lib/db/ writes are permitted and why. Mark blocked methods with @deprecated JSDoc. Consider removing write methods from lib/db/sober-living.ts.","acceptance_tests":["Write patterns documented","Blocked methods marked @deprecated","Developers can determine permitted writes from code"],"pr_bucket_suggestion":"misc"}
{"category":"Types","title":"Single 'any' Type Usage","fingerprint":"Types::components/notebook/pages/today-page.tsx::handleSnapshotUpdate::any-type","severity":"S3","effort":"E0","confidence":100,"files":["components/notebook/pages/today-page.tsx"],"symbols":["handleSnapshotUpdate"],"duplication_cluster":{"is_cluster":false,"cluster_summary":null,"instances":[]},"why_it_matters":"One instance of 'any' type: (docSnap: any, isMounted: boolean). Minor type safety gap.","suggested_fix":"Replace with: (docSnap: DocumentSnapshot<DailyLog>, isMounted: boolean).","acceptance_tests":["TypeScript compiles without errors","No any types in codebase"],"pr_bucket_suggestion":"misc"}
{"category":"Hygiene","title":"Lingering TODO Comments (2 Instances)","fingerprint":"Hygiene::generic::TODO::lingering-todos","severity":"S3","effort":"E0","confidence":100,"files":["components/notebook/features/quick-actions-fab.tsx","lib/database/firestore-adapter.ts"],"symbols":["TODO"],"duplication_cluster":{"is_cluster":false,"cluster_summary":null,"instances":[]},"why_it_matters":"Two TODO comments: 'Make action buttons customizable by user' and 'Pass limit to FirestoreService when it supports configurable limits'. Should be tracked as issues or implemented.","suggested_fix":"Implement or convert to GitHub issues and remove comments.","acceptance_tests":["No TODO comments in codebase (or tracked as GitHub issues)"],"pr_bucket_suggestion":"misc"}