{"category":"process","title":"Duplicate analyze-user-request: .sh and .js versions both exist, only .js is wired","fingerprint":"hooks::analyze-user-request.sh::dead_code","severity":"S2","effort":"E0","confidence":95,"files":[".claude/hooks/analyze-user-request.sh",".claude/hooks/analyze-user-request.js",".claude/settings.json"],"line":240,"why_it_matters":"Both analyze-user-request.sh (4KB) and analyze-user-request.js (5KB) exist in .claude/hooks/. Settings.json only wires the .js version. The .sh is dead code. Similarly, session-start.sh and check-mcp-servers.sh exist alongside .js replacements.","evidence":["settings.json:240 wires analyze-user-request.js","analyze-user-request.js:3 says 'Cross-platform replacement for analyze-user-request.sh'","Both files exist in .claude/hooks/"],"suggested_fix":{"steps":["Delete .claude/hooks/analyze-user-request.sh","Delete .claude/hooks/session-start.sh","Delete .claude/hooks/check-mcp-servers.sh"],"verification":["No settings.json entries reference .sh files"]},"acceptance_tests":["Verify fix applied correctly"]}
{"category":"process","title":"PostToolUse Write/Edit/MultiEdit hooks are 90% copy-pasted — extract shared hook list","fingerprint":"hooks::settings.json::hook_duplication","severity":"S1","effort":"E1","confidence":100,"files":[".claude/settings.json"],"line":33,"why_it_matters":"In settings.json, PostToolUse matcher blocks for Write (lines 36-87), Edit (lines 91-137), and MultiEdit (lines 141-187) share 8 identical hooks. Only the first hook differs. This is ~150 lines of copy-paste that must be kept in sync. Any hook addition requires 3 edits.","evidence":["settings.json lines 36-87: Write hooks (10 hooks)","settings.json lines 91-137: Edit hooks (9 hooks, same 8 shared)","settings.json lines 141-187: MultiEdit hooks (9 hooks, same 8 shared)","audit-s0s1-validator.js only in Write, not Edit/MultiEdit"],"suggested_fix":{"steps":["Document shared hook list in a comment at top of settings.json","Create validation script that checks Write/Edit/MultiEdit hooks are in sync","Add CI check for hook drift"],"verification":["CI catches drift between Write/Edit/MultiEdit hook lists"]},"acceptance_tests":["Verify fix applied correctly"]}
{"category":"process","title":"Pre-commit hook is 281 lines with 13 checks — high latency risk","fingerprint":"hooks::pre-commit::bloat","severity":"S2","effort":"E2","confidence":90,"files":[".husky/pre-commit"],"line":1,"why_it_matters":"Pre-commit hook runs 13 sequential checks: ESLint, lint-staged, pattern compliance, tests, CANON validation, skill validation, cross-doc deps, doc index staleness, doc headers, learning reminder, audit S0/S1, agent compliance, and debt validation. At 281 lines, likely takes 30-90 seconds per commit. No parallelization.","evidence":[".husky/pre-commit: 281 lines","13 distinct check blocks, each invoking npm run or node scripts/","No parallel execution (all sequential)"],"suggested_fix":{"steps":["Profile actual pre-commit timing","Replace npm run with direct node invocations where possible","Consider parallel execution for independent checks","Move non-blocking checks to post-commit hook"],"verification":["Time pre-commit before and after optimization"]},"acceptance_tests":["Verify fix applied correctly"]}
{"category":"process","title":"Pattern compliance checked in BOTH pre-commit and pre-push — redundant","fingerprint":"hooks::pre-push::duplicate_pattern_check","severity":"S2","effort":"E0","confidence":100,"files":[".husky/pre-commit",".husky/pre-push"],"line":34,"why_it_matters":"Pattern compliance (npm run patterns:check) runs as a BLOCKING check in both pre-commit (line 34) AND pre-push (line 26). Since pre-commit already blocks on failure, the pre-push check is redundant.","evidence":[".husky/pre-commit:34-42 — patterns:check blocking",".husky/pre-push:25-35 — patterns:check blocking (same command)"],"suggested_fix":{"steps":["Remove patterns:check from pre-push","Keep CI workflow check as backup gate"],"verification":["CI still runs pattern compliance","Pre-commit still blocks on pattern violations"]},"acceptance_tests":["Verify fix applied correctly"]}
{"category":"process","title":"ESLint inconsistency: root uses warn for unused-vars, functions/ uses error","fingerprint":"lint::eslint.config.mjs::severity_mismatch","severity":"S3","effort":"E0","confidence":100,"files":["eslint.config.mjs","functions/eslint.config.mjs"],"line":38,"why_it_matters":"Root eslint.config.mjs sets @typescript-eslint/no-unused-vars to warn with argsIgnorePattern + varsIgnorePattern. Functions eslint.config.mjs sets it to error with only argsIgnorePattern. Functions config also lacks the security plugin that root has.","evidence":["eslint.config.mjs:38-41 — warn, argsIgnorePattern + varsIgnorePattern","functions/eslint.config.mjs:19 — error, argsIgnorePattern only","Root has eslint-plugin-security, functions/ does not"],"suggested_fix":{"steps":["Add varsIgnorePattern to functions/eslint.config.mjs","Add eslint-plugin-security to functions/","Document intentional differences"],"verification":["cd functions && npm run lint passes","Both configs handle unused vars consistently"]},"acceptance_tests":["Verify fix applied correctly"]}
{"category":"process","title":"CI workflow has 18 steps in lint-typecheck-test job — long serial pipeline","fingerprint":"ci::ci.yml::serial_pipeline","severity":"S2","effort":"E2","confidence":85,"files":[".github/workflows/ci.yml"],"line":10,"why_it_matters":"CI lint-typecheck-test job runs 18 steps serially. Many are independent and could run in parallel jobs (ESLint, Prettier, circular deps, type check). Estimated 5-10 min CI times.","evidence":["ci.yml:10-131 — single job with 18 steps","No matrix or parallel job strategy","Steps like ESLint, Prettier, circular deps, type check are independent"],"suggested_fix":{"steps":["Split into parallel jobs: lint+format, type-check, tests, pattern-checks, debt-validation","Use needs: dependency graph","Share node_modules via cache"],"verification":["CI total time decreases","All checks still run and gate PRs"]},"acceptance_tests":["Verify fix applied correctly"]}
{"category":"process","title":"3 disabled MCP servers referenced in settings.json but not in .mcp.json","fingerprint":"mcp::settings.json::disabled_servers_referenced","severity":"S3","effort":"E0","confidence":85,"files":[".claude/settings.json",".mcp.json"],"line":3,"why_it_matters":"settings.json disables 3 MCP servers: rube, serena, nextjs-devtools. But .mcp.json only defines 5 servers (filesystem, playwright, memory, git, sonarcloud). The disabled servers don't exist in .mcp.json — dead configuration.","evidence":["settings.json:3 — disabledMcpjsonServers: [rube, serena, nextjs-devtools]",".mcp.json defines: filesystem, playwright, memory, git, sonarcloud"],"suggested_fix":{"steps":["Remove rube, serena, nextjs-devtools from disabledMcpjsonServers"],"verification":["disabledMcpjsonServers only references servers in .mcp.json"]},"acceptance_tests":["Verify fix applied correctly"]}
{"category":"process","title":"AskUserQuestion and Task matchers use explicit case variants instead of (?i) flag","fingerprint":"hooks::settings.json::askuserquestion_matcher","severity":"S3","effort":"E0","confidence":100,"files":[".claude/settings.json"],"line":210,"why_it_matters":"AskUserQuestion PostToolUse matcher uses explicit case variants (askuserquestion|AskUserQuestion|ASKUSERQUESTION) instead of the (?i) flag used by Write/Edit matchers. Mixed-case variants like askUserQuestion would not match. Same issue with Task matcher on line 220.","evidence":["settings.json:210 — explicit case variants for AskUserQuestion","settings.json:220 — explicit case variants for Task","settings.json:35 — '^(?i)write' (correct pattern)","settings.json:90 — '^(?i)edit' (correct pattern)"],"suggested_fix":{"steps":["Change AskUserQuestion matcher to use (?i) flag","Change Task matcher to use (?i) flag"],"verification":["All PostToolUse matchers use (?i) flag consistently"]},"acceptance_tests":["Verify fix applied correctly"]}
{"category":"process","title":"Oversized scripts: aggregate-audit-findings.js (63KB), check-pattern-compliance.js (45KB)","fingerprint":"scripts::aggregate-audit-findings.js::oversized_scripts","severity":"S2","effort":"E2","confidence":95,"files":["scripts/aggregate-audit-findings.js","scripts/check-pattern-compliance.js","scripts/analyze-learning-effectiveness.js","scripts/check-review-needed.js","scripts/validate-audit.js"],"line":1,"why_it_matters":"Multiple scripts exceed 30KB: aggregate-audit-findings.js (63KB), analyze-learning-effectiveness.js (47KB), check-pattern-compliance.js (45KB), check-review-needed.js (40KB), validate-audit.js (30KB). Unmaintainable monoliths that likely don't use scripts/lib/ shared utilities.","evidence":["scripts/aggregate-audit-findings.js: 63,430 bytes","scripts/analyze-learning-effectiveness.js: 47,047 bytes","scripts/check-pattern-compliance.js: 45,605 bytes","scripts/check-review-needed.js: 40,692 bytes","scripts/validate-audit.js: 30,816 bytes"],"suggested_fix":{"steps":["Extract common JSONL parsing, file traversal, reporting utilities to scripts/lib/","Break large scripts into modules","Target <500 lines per script file"],"verification":["Largest script < 20KB","scripts/lib/ contains shared utilities"]},"acceptance_tests":["Verify fix applied correctly"]}
{"category":"process","title":"enrichment_failures.json is committed data artifact in scripts/","fingerprint":"scripts::enrichment_failures.json::committed_data","severity":"S2","effort":"E0","confidence":95,"files":["scripts/enrichment_failures.json"],"line":1,"why_it_matters":"scripts/enrichment_failures.json (6KB) is a data artifact from one-time geocoding enrichment. Should not be version controlled.","evidence":["scripts/enrichment_failures.json: 6,185 bytes","scripts/enrich-addresses.ts: related enrichment script","scripts/retry-failures.ts: retry script referencing failures"],"suggested_fix":{"steps":["Add to .gitignore","Remove from git tracking: git rm --cached scripts/enrichment_failures.json"],"verification":["File not tracked by git"]},"acceptance_tests":["Verify fix applied correctly"]}
{"category":"process","title":"Firebase Functions use Node 20 but CI uses Node 22 — version mismatch","fingerprint":"ci::ci.yml::node_version_mismatch","severity":"S1","effort":"E0","confidence":100,"files":[".github/workflows/ci.yml","functions/package.json"],"line":21,"why_it_matters":"CI uses Node 22 (ci.yml:21) but functions/package.json specifies engines.node: '20'. CI tests run on different Node version than Firebase Functions deploy runtime. Could mask Node 20-specific issues.","evidence":["ci.yml:21 — node-version: '22'","functions/package.json:14 — engines.node: '20'"],"suggested_fix":{"steps":["Upgrade functions to Node 22 if Firebase supports it","Or add separate CI job for functions/ using Node 20","Or change CI to Node 20"],"verification":["functions/package.json engines.node matches CI node-version"]},"acceptance_tests":["Verify fix applied correctly"]}
{"category":"process","title":"Multiple one-time migration scripts still in scripts/ directory","fingerprint":"scripts::migrate-*.ts::dead_migration_scripts","severity":"S3","effort":"E1","confidence":80,"files":["scripts/migrate-addresses.ts","scripts/migrate-library-content.ts","scripts/migrate-meetings-dayindex.ts","scripts/migrate-to-journal.ts","scripts/seed-meetings.ts","scripts/seed-real-data.ts","scripts/seed-sober-living-data.ts"],"line":1,"why_it_matters":"7+ migration and seed scripts (migrate-*.ts, seed-*.ts) appear to be one-time operations. Should be archived to scripts/archive/.","evidence":["scripts/migrate-addresses.ts, migrate-library-content.ts, migrate-meetings-dayindex.ts, migrate-to-journal.ts","scripts/seed-meetings.ts, seed-real-data.ts, seed-sober-living-data.ts"],"suggested_fix":{"steps":["Create scripts/archive/ directory","Move completed migration scripts there"],"verification":["scripts/ contains only active scripts"]},"acceptance_tests":["Verify fix applied correctly"]}
{"category":"process","title":"session-start.sh is 15KB — extremely large and dead code","fingerprint":"hooks::session-start.sh::oversized_hook","severity":"S2","effort":"E1","confidence":95,"files":[".claude/hooks/session-start.sh"],"line":1,"why_it_matters":"session-start.sh is 15,166 bytes (~400+ lines) and is dead code since settings.json wires session-start.js instead. Includes dependency caching, hash computation, npm install, Functions build, test compilation.","evidence":[".claude/hooks/session-start.sh: 15,166 bytes","settings.json:10 — wires session-start.js, not session-start.sh"],"suggested_fix":{"steps":["Delete session-start.sh (dead code)","If session-start.js is similarly large, extract build logic to scripts/setup-session.js"],"verification":["Session hooks are <100 lines"]},"acceptance_tests":["Verify fix applied correctly"]}
{"category":"process","title":"CI workflow docs-lint.yml and specialized workflows may be infrequently triggered","fingerprint":"ci::docs-lint.yml::coverage_gap","severity":"S3","effort":"E0","confidence":70,"files":[".github/workflows/docs-lint.yml",".github/workflows/backlog-enforcement.yml",".github/workflows/resolve-debt.yml"],"line":1,"why_it_matters":"Several specialized workflows (docs-lint, backlog-enforcement, resolve-debt, auto-label-review-tier) may run infrequently. 10 workflows is a lot for a single-developer project — maintenance burden concern.","evidence":["docs-lint.yml: 5,761 bytes","backlog-enforcement.yml: 5,450 bytes","resolve-debt.yml: 3,748 bytes","10 total workflows"],"suggested_fix":{"steps":["Review workflow run history","Consolidate docs-lint into main CI workflow","Consider manual/dispatch-only for resolve-debt and backlog-enforcement"],"verification":["Each workflow has run in last 30 days or is consolidated"]},"acceptance_tests":["Verify fix applied correctly"]}
{"category":"process","title":"check-edit-requirements.sh may be dead code like analyze-user-request.sh","fingerprint":"hooks::check-edit-requirements.sh::suspected_dead","severity":"S2","effort":"E0","confidence":35,"files":[".claude/hooks/check-edit-requirements.sh"],"line":1,"why_it_matters":"SUSPECTED: check-edit-requirements.sh exists alongside check-edit-requirements.js. If .js version is wired in settings.json, the .sh is dead code.","evidence":["settings.json:94 references .claude/hooks/check-edit-requirements.js","check-edit-requirements.sh exists in .claude/hooks/"],"suggested_fix":{"steps":["Verify check-edit-requirements.js exists","If yes, delete check-edit-requirements.sh"],"verification":["ls .claude/hooks/check-edit-requirements.*"]},"acceptance_tests":["Verify fix applied correctly"]}
{"category":"process","title":"scripts/lib/ may be underutilized — large scripts not importing shared code","fingerprint":"scripts::lib::underutilization","severity":"S2","effort":"E1","confidence":30,"files":["scripts/lib/"],"line":1,"why_it_matters":"SUSPECTED: scripts/lib/ has 4 library files but the 5 largest scripts (63KB, 47KB, 45KB, 40KB, 30KB) may not import from lib/. Shared library pattern established but potentially not adopted.","evidence":["scripts/lib/ contains 4 files","5 scripts exceed 30KB"],"suggested_fix":{"steps":["Check if large scripts import from scripts/lib/","If not, extract common patterns to lib/"],"verification":["grep -r 'scripts/lib' scripts/*.js | wc -l"]},"acceptance_tests":["Verify fix applied correctly"]}
{"category":"process","title":"stop-serena-dashboard.js hook runs on every SessionStart but Serena is disabled","fingerprint":"hooks::stop-serena-dashboard.js::disabled_server","severity":"S3","effort":"E0","confidence":35,"files":[".claude/settings.json",".claude/hooks/stop-serena-dashboard.js"],"line":25,"why_it_matters":"SUSPECTED: stop-serena-dashboard.js runs on every SessionStart with 10s timeout, but Serena is in disabledMcpjsonServers. Wasted time if Serena is never running.","evidence":["settings.json:25-29 — stop-serena-dashboard.js on SessionStart","settings.json:3 — serena in disabledMcpjsonServers","timeout: 10000"],"suggested_fix":{"steps":["Remove from SessionStart hooks or make conditional on Serena being enabled"],"verification":["SessionStart hooks don't reference disabled MCP servers"]},"acceptance_tests":["Verify fix applied correctly"]}
{"category":"process","title":"Firebase Functions may not have unit tests in CI","fingerprint":"ci::ci.yml::functions_test_gap","severity":"S2","effort":"E1","confidence":30,"files":[".github/workflows/ci.yml","functions/package.json"],"line":114,"why_it_matters":"SUSPECTED: CI runs root npm run test:coverage but functions/package.json has no test script despite having firebase-functions-test as devDependency. Functions tests may not run in CI.","evidence":["ci.yml:114-115 — runs root npm run test:coverage","functions/package.json has no 'test' script","functions/package.json has firebase-functions-test as devDependency"],"suggested_fix":{"steps":["Add test script to functions/package.json","Add CI step: cd functions && npm test"],"verification":["Functions have test coverage in CI"]},"acceptance_tests":["Verify fix applied correctly"]}