{"category":"Hygiene","title":"Duplicated Firestore Logic","fingerprint":"Hygiene::lib/db/users.ts::db::duplicate-firestore-logic","severity":"S2","effort":"E2","confidence":100,"files":["lib/db/users.ts","lib/db/quotes.ts","lib/firestore-service.ts"],"symbols":["db","getDoc","setDoc"],"duplication_cluster":{"is_cluster":true,"cluster_summary":"Direct Firestore SDK usage bypassing FirestoreService","instances":[{"file":"lib/db/users.ts","symbol":"createUserProfile"},{"file":"lib/db/quotes.ts","symbol":"QuotesService"}]},"why_it_matters":"Bypassing the centralized service fragments data access logic, making it harder to enforce security policies, rate limiting, and logging uniformly.","suggested_fix":"Refactor lib/db modules to use FirestoreService methods or merge them into FirestoreService.","acceptance_tests":["Verify all Firestore calls go through FirestoreService mocks in tests"],"pr_bucket_suggestion":"hooks-standardization"}
{"category":"Hygiene","title":"Complex Logic in UI Component","fingerprint":"Hygiene::components/notebook/pages/today-page.tsx::onSnapshot::ui-logic-bloat","severity":"S2","effort":"E1","confidence":100,"files":["components/notebook/pages/today-page.tsx"],"symbols":["onSnapshot"],"duplication_cluster":{"is_cluster":false,"cluster_summary":null,"instances":[]},"why_it_matters":"Complex Firestore subscription logic inside a UI component makes it hard to test and reuse. It also mixes concerns (data fetching vs presentation).","suggested_fix":"Extract the subscription logic into a custom hook (e.g., useDailyLogSubscription).","acceptance_tests":["Refactor to use hook","Verify UI behaves same"],"pr_bucket_suggestion":"ui-primitives"}
{"category":"Types","title":"Explicit Any Type","fingerprint":"Types::components/notebook/pages/today-page.tsx::docSnap::explicit-any","severity":"S3","effort":"E0","confidence":100,"files":["components/notebook/pages/today-page.tsx"],"symbols":["docSnap"],"duplication_cluster":{"is_cluster":false,"cluster_summary":null,"instances":[]},"why_it_matters":"Using 'any' defeats the purpose of TypeScript and hides potential runtime errors.","suggested_fix":"Type the docSnap correctly using DocumentSnapshot<DailyLog>.","acceptance_tests":["Run tsc and ensure no errors"],"pr_bucket_suggestion":"types-domain"}
{"category":"Debugging","title":"Missing Correlation IDs","fingerprint":"Debugging::lib/logger.ts::logger::no-correlation-id","severity":"S2","effort":"E2","confidence":90,"files":["lib/logger.ts","functions/src/index.ts"],"symbols":["logger","logSecurityEvent"],"duplication_cluster":{"is_cluster":false,"cluster_summary":null,"instances":[]},"why_it_matters":"Without correlation IDs, it is impossible to trace a specific user action from the frontend client to the backend Cloud Function execution, hindering debugging of production issues.","suggested_fix":"Generate a unique Request ID in the client, pass it in Cloud Function calls, and include it in all logs.","acceptance_tests":["Verify logs contain correlationId"],"pr_bucket_suggestion":"misc"}
{"category":"Security","title":"Inconsistent Write Patterns","fingerprint":"Security::lib/db/users.ts::setDoc::direct-write","severity":"S2","effort":"E2","confidence":100,"files":["lib/db/users.ts"],"symbols":["setDoc"],"duplication_cluster":{"is_cluster":false,"cluster_summary":null,"instances":[]},"why_it_matters":"While 'users' collection allows writes in rules, the application pattern is to use Cloud Functions for writes to ensure validation and rate limiting. Direct writes here create an inconsistency.","suggested_fix":"Migrate user profile creation/updates to a Cloud Function (e.g., saveUserProfile).","acceptance_tests":["Verify no direct setDoc calls in client bundles"],"pr_bucket_suggestion":"security-hardening"}
{"category":"Testing","title":"Skipped Critical Test","fingerprint":"Testing::tests/firestore-service.test.ts::saveDailyLog::skipped-test","severity":"S1","effort":"E1","confidence":100,"files":["tests/firestore-service.test.ts"],"symbols":["saveDailyLog"],"duplication_cluster":{"is_cluster":false,"cluster_summary":null,"instances":[]},"why_it_matters":"The 'saveDailyLog' function is a critical write path. Skipping its test means regressions in saving data might go unnoticed.","suggested_fix":"Mock the Cloud Function call (httpsCallable) and enable the test.","acceptance_tests":["npm test passes with test enabled"],"pr_bucket_suggestion":"tests-hardening"}
{"category":"AICode","title":"Happy Path Testing Only","fingerprint":"AICode::tests/firestore-service.test.ts::getTodayLog::happy-path","severity":"S2","effort":"E1","confidence":80,"files":["tests/firestore-service.test.ts"],"symbols":["getTodayLog"],"duplication_cluster":{"is_cluster":false,"cluster_summary":null,"instances":[]},"why_it_matters":"Tests only cover the success scenario. Failure modes (network error, permission denied) are not tested, which are common in distributed systems.","suggested_fix":"Add test cases for error scenarios and edge cases.","acceptance_tests":["Coverage report shows error handling branches covered"],"pr_bucket_suggestion":"tests-hardening"}
{"category":"AICode","title":"Confusing Auth Hook Layering","fingerprint":"AICode::components/providers/auth-provider.tsx::useAuth::hook-layering","severity":"S3","effort":"E0","confidence":90,"files":["components/providers/auth-provider.tsx"],"symbols":["useAuth","useAuthCore"],"duplication_cluster":{"is_cluster":false,"cluster_summary":null,"instances":[]},"why_it_matters":"Having useAuth wrap useAuthCore with slightly different semantics can confuse AI agents and developers, leading to incorrect imports.","suggested_fix":"Consolidate into a single clear hook or explicitly document why the layering exists.","acceptance_tests":["Code review"],"pr_bucket_suggestion":"hooks-standardization"}