{"category":"Firebase","title":"App Check Disabled - Allows Unauthorized API Access","fingerprint":"Firebase::lib/firebase.ts::app_check_disabled","severity":"S0","effort":"E1","confidence":100,"files":["lib/firebase.ts","functions/src/index.ts"],"line":56,"vulnerability_details":{"description":"Firebase App Check is completely disabled in production. Comment states 'TEMPORARILY DISABLED - waiting for throttle to clear' with target date Dec 31.","exploitation":"Attacker can call Cloud Functions directly from curl/Postman without legitimate app attestation, bypassing client-side security.","impact":"Unauthorized API access, rate limit bypass via multiple IPs, automated abuse, potential Firebase bill run-up.","affected_data":"All Cloud Functions: saveDailyLog, saveJournalEntry, deleteJournalEntry, saveInventoryEntry, migrateUserData"},"remediation":{"steps":["Re-enable App Check in lib/firebase.ts (uncomment lines 56-81)","Change requireAppCheck: false to true in all Cloud Functions","Deploy client and functions","Test attestation in browser console","Monitor Firebase App Check dashboard"],"code_example":"_appCheck = initializeAppCheck(_app, {\n  provider: new ReCaptchaEnterpriseProvider(recaptchaSiteKey),\n  isTokenAutoRefreshEnabled: true,\n});\n\n// functions/src/index.ts\nrequireAppCheck: true,","verification":["Attempt curl call to Cloud Function (should fail with 'App Check verification failed')","Call from legitimate app (should succeed)","Check Firebase Console > App Check > Metrics for attestation rate"]},"owasp_category":"A05","cvss_estimate":"CRITICAL","evidence":["lib/firebase.ts:56-81 // TEMPORARILY DISABLED comment","functions/src/index.ts:81 requireAppCheck: false"]}
{"category":"Headers","title":"Missing Content-Security-Policy Header","fingerprint":"Headers::firebase.json::missing_csp","severity":"S1","effort":"E1","confidence":100,"files":["firebase.json"],"line":6,"vulnerability_details":{"description":"No Content-Security-Policy (CSP) header configured in Firebase Hosting. This is the primary defense against XSS attacks.","exploitation":"If an XSS vulnerability is introduced (e.g., via rich text editor), attacker can inject arbitrary scripts with no CSP enforcement.","impact":"Cookie theft, session hijacking, malicious redirects, keylogging.","affected_data":"All pages served by Firebase Hosting"},"remediation":{"steps":["Add CSP header to firebase.json headers section","Start with restrictive policy (script-src 'self')","Test for breakage (inline scripts, analytics)","Adjust policy with nonces/hashes for inline scripts","Monitor CSP violation reports"],"code_example":"{\n  \"key\": \"Content-Security-Policy\",\n  \"value\": \"default-src 'self'; script-src 'self' https://www.google.com https://www.gstatic.com; style-src 'self' 'unsafe-inline'; img-src 'self' data: https:; font-src 'self' data:; connect-src 'self' https://*.firebaseio.com https://*.googleapis.com; frame-ancestors 'none'; base-uri 'self'; form-action 'self';\"\n}","verification":["Check response headers in browser DevTools","Attempt inline script injection in console (should be blocked)","Test all app functionality (maps, charts, integrations)"]},"owasp_category":"A05","cvss_estimate":"HIGH","evidence":["firebase.json:6-57 - NO Content-Security-Policy header found in headers array"]}
{"category":"InputValidation","title":"Zod Schemas Missing .strict() - Allows Unknown Fields","fingerprint":"InputValidation::functions/src/schemas.ts::missing_strict","severity":"S2","effort":"E1","confidence":100,"files":["functions/src/schemas.ts"],"line":5,"vulnerability_details":{"description":"Zod schemas do NOT use .strict() mode, allowing extra/unknown fields to pass validation without error.","exploitation":"Attacker can send additional fields (e.g., isAdmin: true, role: admin) that may be processed by downstream code if not filtered.","impact":"Potential mass assignment vulnerabilities, privilege escalation, unexpected behavior if extra fields spread into database.","affected_data":"All Cloud Function inputs: daily_logs, journal, inventoryEntries"},"remediation":{"steps":["Add .strict() to all Zod schemas in functions/src/schemas.ts","Test existing clients for extra field sending","Deploy and monitor validation failures"],"code_example":"export const dailyLogSchema = z.object({\n  date: z.string().regex(/^\\d{4}-\\d{2}-\\d{2}$/),\n  content: z.string().max(50000),\n  mood: z.string().nullable().optional(),\n  cravings: z.boolean().optional(),\n  used: z.boolean().optional(),\n  userId: z.string().optional(),\n  recaptchaToken: z.string().optional(),\n}).strict(); // <-- ADD THIS","verification":["Send test request with extra field: { date: '2026-02-06', content: 'test', extraField: 'malicious' }","Should receive error: 'Unrecognized key(s) in object: extraField'","Verify legitimate requests succeed"]},"owasp_category":"A03","cvss_estimate":"MEDIUM","evidence":["functions/src/schemas.ts:5-70 - No .strict() calls found in dailyLogSchema, journalEntrySchema, inventoryEntrySchema"]}
{"category":"SecretsManagement","title":"Hardcoded reCAPTCHA Site Key Fallback","fingerprint":"SecretsManagement::functions/src/recaptcha-verify.ts::hardcoded_site_key","severity":"S3","effort":"E0","confidence":100,"files":["functions/src/recaptcha-verify.ts"],"line":66,"vulnerability_details":{"description":"reCAPTCHA site key has hardcoded fallback value: '6LdeazosAAAAAMDNCh1hTUDKh_UeS6xWY1-85B2O'. Site keys are public but hardcoding violates best practices.","exploitation":"Limited - site keys are designed to be public. Primary issue is difficulty rotating keys.","impact":"Harder key rotation, potential for using wrong environment's key.","affected_data":"reCAPTCHA verification in Cloud Functions"},"remediation":{"steps":["Remove hardcoded fallback from recaptcha-verify.ts:66","Ensure RECAPTCHA_SITE_KEY set in all environments","Throw error if env var missing"],"code_example":"const siteKey = process.env.RECAPTCHA_SITE_KEY;\nif (!siteKey) {\n  throw new Error('RECAPTCHA_SITE_KEY environment variable not configured');\n}","verification":["Deploy without env var (should fail on init)","Set env var and verify reCAPTCHA works"]},"owasp_category":"A05","cvss_estimate":"LOW","evidence":["functions/src/recaptcha-verify.ts:66 const siteKey = process.env.RECAPTCHA_SITE_KEY || '6LdeazosAAAAAMDNCh1hTUDKh_UeS6xWY1-85B2O';"]}
{"category":"Headers","title":"Missing Cross-Origin-Embedder-Policy Header","fingerprint":"Headers::firebase.json::missing_coep","severity":"S2","effort":"E0","confidence":100,"files":["firebase.json"],"line":6,"vulnerability_details":{"description":"Cross-Origin-Embedder-Policy (COEP) header not configured. Limits benefits of cross-origin isolation (Spectre mitigation).","exploitation":"No direct exploit. Weakens defense-in-depth for cross-origin attacks.","impact":"Cannot use advanced browser features like SharedArrayBuffer, high-resolution timers (if needed in future).","affected_data":"All hosted pages"},"remediation":{"steps":["Add COEP header to firebase.json headers","Test for breakage (embedded iframes, third-party resources)","Use 'require-corp' value (strictest)"],"code_example":"{\n  \"key\": \"Cross-Origin-Embedder-Policy\",\n  \"value\": \"require-corp\"\n}","verification":["Check response headers in browser DevTools","Verify crossOriginIsolated property is true in console"]},"owasp_category":"A05","cvss_estimate":"MEDIUM","evidence":["firebase.json:6-57 - No Cross-Origin-Embedder-Policy header found"]}
{"category":"FileHandling","title":"Missing File MIME Type Validation in Storage Rules","fingerprint":"FileHandling::storage.rules::missing_mime_validation","severity":"S2","effort":"E2","confidence":90,"files":["storage.rules"],"line":14,"vulnerability_details":{"description":"Storage rules do NOT validate file MIME types. User can upload arbitrary files (executables, scripts).","exploitation":"Upload malicious files disguised as images. If file sharing added, serve to other users.","impact":"Potential phishing, malware distribution, stored XSS (if files rendered as HTML).","affected_data":"All user uploads in Firebase Storage"},"remediation":{"steps":["Add MIME type validation to storage.rules","Restrict to allowed types (image/*, application/pdf)","Add file size limit (10MB)","Test file upload functionality"],"code_example":"match /users/{userId}/{allPaths=**} {\n  allow read: if request.auth != null && request.auth.uid == userId;\n  allow write: if request.auth != null \n    && request.auth.uid == userId\n    && request.resource.size < 10 * 1024 * 1024\n    && request.resource.contentType.matches('image/.*|application/pdf');\n}","verification":["Attempt to upload .exe file (should fail)","Upload valid image (should succeed)","Verify user-friendly error message"]},"owasp_category":"A01","cvss_estimate":"MEDIUM","evidence":["storage.rules:14-17 - No request.resource.contentType validation found"]}
