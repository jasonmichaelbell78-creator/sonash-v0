{"category":"ai-optimization","title":"SessionStart critical path runs multiple heavyweight synchronous tasks serially","fingerprint":"ai-optimization::.claude/hooks/session-start.js::serial-heavy-sessionstart","severity":"S1","effort":"E2","confidence":92,"files":[".claude/hooks/session-start.js"],"why_it_matters":"This hook is on every session start and executes dependency installs, builds, pattern checks, consolidation, and metrics checks in sequence. That design can add multi-second to multi-minute startup latency and blocks developer flow before work begins.","suggested_fix":"Split SessionStart into a fast path (environment sanity + minimal checks) and deferred/background tasks (functions build, test build, consolidation, debt metrics). Add a cache/TTL gate for expensive checks and skip steps unless relevant files changed.","acceptance_tests":["Measure median SessionStart wall-clock before/after over 10 runs; target >40% reduction.","Verify hook still reports critical failures (e.g., malformed config) while deferring non-critical tasks.","Confirm deferred tasks only run when trigger files change (lockfiles, functions source, debt metrics inputs)."],"evidence":[".claude/hooks/session-start.js:325-379 runs installs/builds in sequence via execSync wrappers.",".claude/hooks/session-start.js:383-423 adds additional synchronous pattern + consolidation commands.",".claude/hooks/session-start.js:456-485 performs extra TDMS read/parse checks on the same startup path.","Command: nl -ba .claude/hooks/session-start.js | sed -n '260,520p'"]}
{"category":"ai-optimization","title":"SessionStart uses stacked synchronous subprocesses across hook chain","fingerprint":"ai-optimization::.claude/settings.json::sessionstart-multi-sync-hooks","severity":"S1","effort":"E1","confidence":88,"files":[".claude/settings.json",".claude/hooks/session-start.js"],"why_it_matters":"Startup latency compounds because SessionStart invokes multiple hook commands, and at least one of them (session-start.js) itself shells out repeatedly with execSync. This increases startup wait time and failure surface on every session.","suggested_fix":"Consolidate lightweight checks into one Node process, replace version probes (node -v, npm -v) with process.version and npm_config_user_agent where possible, and move best-effort checks to async/deferred execution.","acceptance_tests":["Profile SessionStart with timestamps per hook and verify reduced total startup time.","Ensure no loss of safety checks after consolidation by replaying malformed .mcp.json and missing metrics scenarios.","Verify command count from startup logs is reduced (before vs after)."],"evidence":[".claude/settings.json:8-33 configures multiple SessionStart commands executed for each session.",".claude/hooks/session-start.js:49-56 shells out for node/npm version checks.",".claude/hooks/session-start.js:303-312 uses execSync(shell:true) for each startup command.","Command: nl -ba .claude/settings.json | sed -n '1,60p'"]}
{"category":"ai-optimization","title":"Legacy shell hook scripts appear runtime-unused (possibly unused)","fingerprint":"ai-optimization::.claude/hooks/.sh::legacy-shell-hooks-possibly-unused","severity":"S2","effort":"E1","confidence":84,"files":[".claude/hooks/analyze-user-request.sh",".claude/hooks/check-edit-requirements.sh",".claude/hooks/check-write-requirements.sh",".claude/hooks/check-mcp-servers.sh",".claude/hooks/pattern-check.sh",".claude/hooks/session-start.sh",".claude/settings.json"],"why_it_matters":"Maintaining duplicate JS+SH hook implementations increases maintenance/token overhead and can confuse future edits. If shell variants are no longer executed by hook config, they become drift-prone documentation code.","suggested_fix":"Either remove/archive shell variants or mark them explicitly as fallback-only with a single source-of-truth policy. If kept, add automated parity tests between JS and SH behavior.","acceptance_tests":["Search execution config (settings.json, CI, husky, package scripts) and verify no .sh hook is invoked.","If keeping shell versions, add CI parity check that compares outputs for representative inputs.","Update cross-platform docs to explicitly state support status for each shell file."],"evidence":[".claude/settings.json:13,17,22,28 references only Node hook entrypoints (no .sh hook commands).",".claude/hooks/session-start.js:7 and .claude/hooks/check-mcp-servers.js:7 state they are cross-platform replacements for .sh scripts.","Command: rg -n \".claude/hooks/.*.sh\" .claude/settings.json .github/workflows package.json .husky/* returned no runtime references.","Command: for f in .claude/hooks/*.sh; do rg -n \"$(basename $f)\" .claude .github package.json scripts docs; done"]}
{"category":"ai-optimization","title":"Audit skill templates have high duplication and could be parameterized","fingerprint":"ai-optimization::.claude/skills/audit-/SKILL.md::audit-skill-overlap","severity":"S2","effort":"E2","confidence":81,"files":[".claude/skills/audit-code/SKILL.md",".claude/skills/audit-security/SKILL.md"],"why_it_matters":"Large duplicated prompt scaffolding increases context token load and maintenance cost; fixes must be replicated across multiple long SKILL.md files, increasing drift risk.","suggested_fix":"Extract shared sections (execution-mode table, pre-audit validation framework, checkpoint schema, output protocol) into a referenced base template and keep only domain-specific deltas per skill.","acceptance_tests":["Run a similarity check and reduce duplicated content between audit skills by at least 30%.","Verify all audit skills still render required domain-specific steps after templating.","Confirm one shared update (e.g., protocol tweak) propagates across all audit skills without manual copy edits."],"evidence":[".claude/skills/audit-code/SKILL.md:12-20 and .claude/skills/audit-security/SKILL.md:12-20 contain near-identical execution-mode matrices.",".claude/skills/audit-code/SKILL.md:114-203 and .claude/skills/audit-security/SKILL.md:147-247 mirror pre-audit validation structure and flow.","Command: Python difflib SequenceMatcher reported 0.63 similarity for audit-code vs audit-security."]}
{"category":"ai-optimization","title":"Pre-commit subagent Task prompt is under-specified for deterministic outputs","fingerprint":"ai-optimization::.claude/skills/pre-commit-fixer/SKILL.md::task-prompt-missing-structured-contract","severity":"S2","effort":"E1","confidence":86,"files":[".claude/skills/pre-commit-fixer/SKILL.md"],"why_it_matters":"The Task prompt asks for fixes but does not define structured output schema, required artifact paths, or strict return protocol. This can increase retries and ambiguity, wasting tokens and causing inconsistent automation behavior.","suggested_fix":"Add a strict subagent contract: required output JSON schema, explicit file list constraints, success/failure return block, and path-based artifact/report destinations.","acceptance_tests":["Run the skill on 5 pre-commit failure samples and confirm subagent outputs are parseable with zero manual interpretation.","Validate subagent response against a JSON schema in CI.","Ensure retry loop can make decisions solely from structured return fields."],"evidence":[".claude/skills/pre-commit-fixer/SKILL.md:90-94 defines a free-form Task prompt with no schema or output path contract.",".claude/skills/pre-commit-fixer/SKILL.md:134-150 defines human-readable result format, but not a machine-validated schema for subagent return.","Command: rg -n \"CRITICAL RETURN PROTOCOL|JSONL schema|output file\" .claude/skills/pre-commit-fixer/SKILL.md found no protocol requirement block."]}
{"category":"ai-optimization","title":"Session-begin checklist duplicates mandatory context reads","fingerprint":"ai-optimization::.claude/skills/session-begin/SKILL.md::duplicate-context-load-steps","severity":"S3","effort":"E0","confidence":83,"files":[".claude/skills/session-begin/SKILL.md"],"why_it_matters":"Repeated mandatory instructions (e.g., reading ROADMAP Active Sprint in multiple sections) add avoidable context and operator overhead each session. This is small per run but persistent across all sessions.","suggested_fix":"Deduplicate repeated checklist items into a single canonical step and reference it later by anchor instead of repeating prose.","acceptance_tests":["Verify ROADMAP read requirement appears once as canonical instruction.","Run session-begin and confirm no required behavior is lost.","Measure instruction token count before/after and target a reduction of at least 10%."],"evidence":[".claude/skills/session-begin/SKILL.md:124-126 requires reading ROADMAP Active Sprint.",".claude/skills/session-begin/SKILL.md:176-177 repeats reading ROADMAP Active Sprint.","Command: nl -ba .claude/skills/session-begin/SKILL.md | sed -n '118,182p'"]}
{"category":"ai-optimization","title":"Remote-branch parsing relies on delimiter split that can break on format drift","fingerprint":"ai-optimization::.claude/hooks/check-remote-session-context.js::fragile-branch-line-split","severity":"S3","effort":"E1","confidence":78,"files":[".claude/hooks/check-remote-session-context.js"],"why_it_matters":"The parser assumes git branch --format will always contain exactly one | delimiter and directly splits into two fields. Minor output format changes can silently corrupt date parsing and skip useful branch comparisons.","suggested_fix":"Parse with a safer structured format (e.g., NUL-delimited fields via %x00) or split once with validation and explicit fallback logging.","acceptance_tests":["Inject malformed/multi-delimiter branch lines in tests and confirm parser rejects safely.","Verify branch/date extraction still works across Linux/macOS git versions.","Ensure bad lines are logged once and do not abort the full check."],"evidence":[".claude/hooks/check-remote-session-context.js:143 uses pipe-delimited git format.",".claude/hooks/check-remote-session-context.js:151-153 uses const [branch, dateStr] = line.split(\"|\") without field-count validation.","Command: nl -ba .claude/hooks/check-remote-session-context.js | sed -n '135,156p'"]}