{"category":"ai-optimization","title":"session-start.js uses execSync with shell:true — subprocess overhead + injection risk","fingerprint":"ai-optimization::.claude/hooks/session-start.js::execsync-shell-true","severity":"S1","effort":"E1","confidence":95,"files":[".claude/hooks/session-start.js"],"why_it_matters":"session-start.js runs on every session start and uses execSync with {shell: true} for npm ci, npm run build, and version checks (lines 49, 55, 306-311). This spawns a shell subprocess for each command, adding latency and introducing shell injection risk. The hook itself warns about exec injection patterns in post-write-validator.js.","suggested_fix":"Replace execSync({shell:true}) with execFileSync('npm', ['ci', ...], {shell:false}) for npm commands. Use execFileSync('node', ['-v']) for version checks.","acceptance_tests":["No execSync calls with shell:true remain in session-start.js","All npm commands use execFileSync with argument arrays","Session startup time is not degraded"],"evidence":["Line 18: const { execSync } = require('node:child_process')","Line 306-311: execSync(command, { shell: true, timeout: timeoutMs })","Lines 49, 55: execSync('node -v'), execSync('npm -v')"],"sources":[{"source":"copilot","file":"ai-optimization-copilot.jsonl","original_fingerprint":"ai-optimization::.claude/hooks/session-start.js::execsync-shell-true"}],"verified":true,"consensus_score":2,"canonical_id":"CANON-0006","status":"CONFIRMED","cross_cutting":false,"categories":["ai-optimization"],"priority_score":58.8,"unified_id":"UNIFIED-0001"}
{"category":"ai-optimization","title":"SessionStart uses stacked synchronous subprocesses across hook chain","fingerprint":"ai-optimization::.claude/settings.json::sessionstart-multi-sync-hooks","severity":"S1","effort":"E1","confidence":88,"files":[".claude/settings.json",".claude/hooks/session-start.js"],"why_it_matters":"Startup latency compounds because SessionStart invokes multiple hook commands, and at least one of them (session-start.js) itself shells out repeatedly with execSync. This increases startup wait time and failure surface on every session.","suggested_fix":"Consolidate lightweight checks into one Node process, replace version probes (node -v, npm -v) with process.version and npm_config_user_agent where possible, and move best-effort checks to async/deferred execution.","acceptance_tests":["Profile SessionStart with timestamps per hook and verify reduced total startup time.","Ensure no loss of safety checks after consolidation by replaying malformed .mcp.json and missing metrics scenarios.","Verify command count from startup logs is reduced (before vs after)."],"evidence":[".claude/settings.json:8-33 configures multiple SessionStart commands executed for each session.",".claude/hooks/session-start.js:49-56 shells out for node/npm version checks.",".claude/hooks/session-start.js:303-312 uses execSync(shell:true) for each startup command.","Command: nl -ba .claude/settings.json | sed -n '1,60p'"],"sources":[{"source":"codex","file":"ai-optimization-codex.jsonl","original_fingerprint":"ai-optimization::.claude/settings.json::sessionstart-multi-sync-hooks"}],"verified":true,"consensus_score":2,"canonical_id":"CANON-0004","status":"CONFIRMED","cross_cutting":false,"categories":["ai-optimization"],"priority_score":57,"unified_id":"UNIFIED-0002"}
{"category":"ai-optimization","title":"Dead Script: dedupe-quotes.ts","fingerprint":"ai-optimization::scripts/dedupe-quotes.ts::dead-script","severity":"S2","effort":"E0","confidence":100,"files":["scripts/dedupe-quotes.ts"],"why_it_matters":"Unused migration script increases maintenance burden and confuses developers.","suggested_fix":"Delete the file.","acceptance_tests":["File is deleted","CI/CD pipelines still pass"],"evidence":["Script is not in package.json and not referenced in active codebase (checked via grep)"],"sources":[{"source":"jules","file":"ai-optimization-jules.jsonl","original_fingerprint":"ai-optimization::scripts/dedupe-quotes.ts::dead-script"}],"verified":true,"consensus_score":2,"canonical_id":"CANON-0025","status":"CONFIRMED","cross_cutting":false,"categories":["ai-optimization"],"priority_score":50,"unified_id":"UNIFIED-0003"}
{"category":"ai-optimization","title":"Dead Script: enrich-addresses.ts","fingerprint":"ai-optimization::scripts/enrich-addresses.ts::dead-script","severity":"S2","effort":"E0","confidence":100,"files":["scripts/enrich-addresses.ts","scripts/migrate-addresses.ts"],"why_it_matters":"Unused migration script increases maintenance burden and confuses developers.","suggested_fix":"Delete the file.","acceptance_tests":["File is deleted","CI/CD pipelines still pass"],"evidence":["Script is not in package.json and not referenced in active codebase (checked via grep)"],"sources":[{"source":"jules","file":"ai-optimization-jules.jsonl","original_fingerprint":"ai-optimization::scripts/enrich-addresses.ts::dead-script"}],"merged_from":["ai-optimization::scripts/enrich-addresses.ts::dead-script","ai-optimization::scripts/migrate-addresses.ts::dead-script"],"verified":true,"consensus_score":2,"canonical_id":"CANON-0026","status":"CONFIRMED","cross_cutting":false,"categories":["ai-optimization"],"priority_score":50,"unified_id":"UNIFIED-0004"}
{"category":"ai-optimization","title":"Dead Script: import-nashville-links.ts","fingerprint":"ai-optimization::scripts/import-nashville-links.ts::dead-script","severity":"S2","effort":"E0","confidence":100,"files":["scripts/import-nashville-links.ts"],"why_it_matters":"Unused migration script increases maintenance burden and confuses developers.","suggested_fix":"Delete the file.","acceptance_tests":["File is deleted","CI/CD pipelines still pass"],"evidence":["Script is not in package.json and not referenced in active codebase (checked via grep)"],"sources":[{"source":"jules","file":"ai-optimization-jules.jsonl","original_fingerprint":"ai-optimization::scripts/import-nashville-links.ts::dead-script"}],"verified":true,"consensus_score":2,"canonical_id":"CANON-0027","status":"CONFIRMED","cross_cutting":false,"categories":["ai-optimization"],"priority_score":50,"unified_id":"UNIFIED-0005"}
{"category":"ai-optimization","title":"Dead Script: migrate-library-content.ts","fingerprint":"ai-optimization::scripts/migrate-library-content.ts::dead-script","severity":"S2","effort":"E0","confidence":100,"files":["scripts/migrate-library-content.ts"],"why_it_matters":"Unused migration script increases maintenance burden and confuses developers.","suggested_fix":"Delete the file.","acceptance_tests":["File is deleted","CI/CD pipelines still pass"],"evidence":["Script is not in package.json and not referenced in active codebase (checked via grep)"],"sources":[{"source":"jules","file":"ai-optimization-jules.jsonl","original_fingerprint":"ai-optimization::scripts/migrate-library-content.ts::dead-script"}],"verified":true,"consensus_score":2,"canonical_id":"CANON-0028","status":"CONFIRMED","cross_cutting":false,"categories":["ai-optimization"],"priority_score":50,"unified_id":"UNIFIED-0006"}
{"category":"ai-optimization","title":"Dead Script: migrate-meetings-dayindex.ts","fingerprint":"ai-optimization::scripts/migrate-meetings-dayindex.ts::dead-script","severity":"S2","effort":"E0","confidence":100,"files":["scripts/migrate-meetings-dayindex.ts"],"why_it_matters":"Unused migration script increases maintenance burden and confuses developers.","suggested_fix":"Delete the file.","acceptance_tests":["File is deleted","CI/CD pipelines still pass"],"evidence":["Script is not in package.json and not referenced in active codebase (checked via grep)"],"sources":[{"source":"jules","file":"ai-optimization-jules.jsonl","original_fingerprint":"ai-optimization::scripts/migrate-meetings-dayindex.ts::dead-script"}],"verified":true,"consensus_score":2,"canonical_id":"CANON-0029","status":"CONFIRMED","cross_cutting":false,"categories":["ai-optimization"],"priority_score":50,"unified_id":"UNIFIED-0007"}
{"category":"ai-optimization","title":"Dead Script: migrate-to-journal.ts","fingerprint":"ai-optimization::scripts/migrate-to-journal.ts::dead-script","severity":"S2","effort":"E0","confidence":100,"files":["scripts/migrate-to-journal.ts"],"why_it_matters":"Unused migration script increases maintenance burden and confuses developers.","suggested_fix":"Delete the file.","acceptance_tests":["File is deleted","CI/CD pipelines still pass"],"evidence":["Script is not in package.json and not referenced in active codebase (checked via grep)"],"sources":[{"source":"jules","file":"ai-optimization-jules.jsonl","original_fingerprint":"ai-optimization::scripts/migrate-to-journal.ts::dead-script"}],"verified":true,"consensus_score":2,"canonical_id":"CANON-0030","status":"CONFIRMED","cross_cutting":false,"categories":["ai-optimization"],"priority_score":50,"unified_id":"UNIFIED-0008"}
{"category":"ai-optimization","title":"Dead Script: seed-meetings.ts","fingerprint":"ai-optimization::scripts/seed-meetings.ts::dead-script","severity":"S2","effort":"E0","confidence":100,"files":["scripts/seed-meetings.ts"],"why_it_matters":"Unused migration script increases maintenance burden and confuses developers.","suggested_fix":"Delete the file.","acceptance_tests":["File is deleted","CI/CD pipelines still pass"],"evidence":["Script is not in package.json and not referenced in active codebase (checked via grep)"],"sources":[{"source":"jules","file":"ai-optimization-jules.jsonl","original_fingerprint":"ai-optimization::scripts/seed-meetings.ts::dead-script"}],"verified":true,"consensus_score":2,"canonical_id":"CANON-0031","status":"CONFIRMED","cross_cutting":false,"categories":["ai-optimization"],"priority_score":50,"unified_id":"UNIFIED-0009"}
{"category":"ai-optimization","title":"Dead Script: seed-real-data.ts","fingerprint":"ai-optimization::scripts/seed-real-data.ts::dead-script","severity":"S2","effort":"E0","confidence":100,"files":["scripts/seed-real-data.ts"],"why_it_matters":"Unused migration script increases maintenance burden and confuses developers.","suggested_fix":"Delete the file.","acceptance_tests":["File is deleted","CI/CD pipelines still pass"],"evidence":["Script is not in package.json and not referenced in active codebase (checked via grep)"],"sources":[{"source":"jules","file":"ai-optimization-jules.jsonl","original_fingerprint":"ai-optimization::scripts/seed-real-data.ts::dead-script"}],"verified":true,"consensus_score":2,"canonical_id":"CANON-0032","status":"CONFIRMED","cross_cutting":false,"categories":["ai-optimization"],"priority_score":50,"unified_id":"UNIFIED-0010"}
{"category":"ai-optimization","title":"Dead Script: seed-sober-living-data.ts","fingerprint":"ai-optimization::scripts/seed-sober-living-data.ts::dead-script","severity":"S2","effort":"E0","confidence":100,"files":["scripts/seed-sober-living-data.ts"],"why_it_matters":"Unused migration script increases maintenance burden and confuses developers.","suggested_fix":"Delete the file.","acceptance_tests":["File is deleted","CI/CD pipelines still pass"],"evidence":["Script is not in package.json and not referenced in active codebase (checked via grep)"],"sources":[{"source":"jules","file":"ai-optimization-jules.jsonl","original_fingerprint":"ai-optimization::scripts/seed-sober-living-data.ts::dead-script"}],"verified":true,"consensus_score":2,"canonical_id":"CANON-0033","status":"CONFIRMED","cross_cutting":false,"categories":["ai-optimization"],"priority_score":50,"unified_id":"UNIFIED-0011"}
{"category":"ai-optimization","title":"Dead Script: set-admin-claim.ts","fingerprint":"ai-optimization::scripts/set-admin-claim.ts::dead-script","severity":"S2","effort":"E0","confidence":100,"files":["scripts/set-admin-claim.ts"],"why_it_matters":"Unused migration script increases maintenance burden and confuses developers.","suggested_fix":"Delete the file.","acceptance_tests":["File is deleted","CI/CD pipelines still pass"],"evidence":["Script is not in package.json and not referenced in active codebase (checked via grep)"],"sources":[{"source":"jules","file":"ai-optimization-jules.jsonl","original_fingerprint":"ai-optimization::scripts/set-admin-claim.ts::dead-script"}],"verified":true,"consensus_score":2,"canonical_id":"CANON-0034","status":"CONFIRMED","cross_cutting":false,"categories":["ai-optimization"],"priority_score":50,"unified_id":"UNIFIED-0012"}
{"category":"ai-optimization","title":"Dead Script: sync-geocache.ts","fingerprint":"ai-optimization::scripts/sync-geocache.ts::dead-script","severity":"S2","effort":"E0","confidence":100,"files":["scripts/sync-geocache.ts"],"why_it_matters":"Unused migration script increases maintenance burden and confuses developers.","suggested_fix":"Delete the file.","acceptance_tests":["File is deleted","CI/CD pipelines still pass"],"evidence":["Script is not in package.json and not referenced in active codebase (checked via grep)"],"sources":[{"source":"jules","file":"ai-optimization-jules.jsonl","original_fingerprint":"ai-optimization::scripts/sync-geocache.ts::dead-script"}],"verified":true,"consensus_score":2,"canonical_id":"CANON-0035","status":"CONFIRMED","cross_cutting":false,"categories":["ai-optimization"],"priority_score":50,"unified_id":"UNIFIED-0013"}
{"category":"ai-optimization","title":"Dead Script: test-geocode.ts","fingerprint":"ai-optimization::scripts/test-geocode.ts::dead-script","severity":"S2","effort":"E0","confidence":100,"files":["scripts/test-geocode.ts"],"why_it_matters":"Unused migration script increases maintenance burden and confuses developers.","suggested_fix":"Delete the file.","acceptance_tests":["File is deleted","CI/CD pipelines still pass"],"evidence":["Script is not in package.json and not referenced in active codebase (checked via grep)"],"sources":[{"source":"jules","file":"ai-optimization-jules.jsonl","original_fingerprint":"ai-optimization::scripts/test-geocode.ts::dead-script"}],"verified":true,"consensus_score":2,"canonical_id":"CANON-0036","status":"CONFIRMED","cross_cutting":false,"categories":["ai-optimization"],"priority_score":50,"unified_id":"UNIFIED-0014"}
{"category":"ai-optimization","title":"Dead Script: retry-failures.ts","fingerprint":"ai-optimization::scripts/retry-failures.ts::dead-script","severity":"S2","effort":"E0","confidence":100,"files":["scripts/retry-failures.ts"],"why_it_matters":"Unused migration script increases maintenance burden and confuses developers.","suggested_fix":"Delete the file.","acceptance_tests":["File is deleted","CI/CD pipelines still pass"],"evidence":["Script is not in package.json and not referenced in active codebase (checked via grep)"],"sources":[{"source":"jules","file":"ai-optimization-jules.jsonl","original_fingerprint":"ai-optimization::scripts/retry-failures.ts::dead-script"}],"verified":true,"consensus_score":2,"canonical_id":"CANON-0037","status":"CONFIRMED","cross_cutting":false,"categories":["ai-optimization"],"priority_score":50,"unified_id":"UNIFIED-0015"}
{"category":"ai-optimization","title":"session-start.js spawns 2 unnecessary child processes for node/npm version strings","fingerprint":"ai-optimization::.claude/hooks/session-start.js::execsync-version-display-subprocess","severity":"S2","effort":"E0","confidence":95,"files":[".claude/hooks/session-start.js"],"why_it_matters":"Two execSync() calls for version strings with near-zero diagnostic value. process.version provides node version at zero cost.","suggested_fix":"Replace execSync('node -v') with process.version. Remove npm -v entirely.","acceptance_tests":["No execSync for version checks","Node version uses process.version"],"evidence":["session-start.js line 49: execSync('node -v')","session-start.js line 55: execSync('npm -v')"],"sources":[{"source":"claude","file":"ai-optimization-claude.jsonl","original_fingerprint":"ai-optimization::.claude/hooks/session-start.js::execsync-version-display-subprocess"}],"verified":true,"consensus_score":2,"canonical_id":"CANON-0009","status":"CONFIRMED","cross_cutting":false,"categories":["ai-optimization"],"priority_score":49,"unified_id":"UNIFIED-0016"}
{"category":"ai-optimization","title":"session-start.sh (365 lines) is dead code — replaced by session-start.js","fingerprint":"ai-optimization::.claude/hooks/session-start.sh::dead-replaced-hook-script","severity":"S2","effort":"E0","confidence":90,"files":[".claude/hooks/session-start.sh"],"why_it_matters":"session-start.js states it is the Cross-platform replacement. settings.json only wires session-start.js. The 365-line shell script is never invoked.","suggested_fix":"Delete session-start.sh.","acceptance_tests":["session-start.sh does not exist","settings.json has no reference to it"],"evidence":["settings.json only lists session-start.js","session-start.js line 7: Cross-platform replacement for session-start.sh"],"sources":[{"source":"claude","file":"ai-optimization-claude.jsonl","original_fingerprint":"ai-optimization::.claude/hooks/session-start.sh::dead-replaced-hook-script"}],"verified":true,"consensus_score":2,"canonical_id":"CANON-0010","status":"CONFIRMED","cross_cutting":false,"categories":["ai-optimization"],"priority_score":48,"unified_id":"UNIFIED-0017"}
{"category":"ai-optimization","title":"stop-serena-dashboard.js runs every SessionStart despite Serena MCP being disabled","fingerprint":"ai-optimization::.claude/hooks/stop-serena-dashboard.js::unnecessary-session-start-hook","severity":"S2","effort":"E0","confidence":90,"files":[".claude/hooks/stop-serena-dashboard.js",".claude/settings.json"],"why_it_matters":"Serena is in disabledMcpjsonServers but stop-serena-dashboard.js still runs every session checking port 24282.","suggested_fix":"Add early-exit reading disabledMcpjsonServers or remove from SessionStart hooks.","acceptance_tests":["No port check when Serena disabled","Exits within <10ms when disabled"],"evidence":["settings.json: disabledMcpjsonServers includes serena","Session transcript: No process listening on port 24282"],"sources":[{"source":"claude","file":"ai-optimization-claude.jsonl","original_fingerprint":"ai-optimization::.claude/hooks/stop-serena-dashboard.js::unnecessary-session-start-hook"}],"verified":true,"consensus_score":2,"canonical_id":"CANON-0013","status":"CONFIRMED","cross_cutting":false,"categories":["ai-optimization"],"priority_score":48,"unified_id":"UNIFIED-0018"}
{"category":"ai-optimization","title":"Shell hooks (.sh) are dead code — replaced by .js equivalents but still present","fingerprint":"ai-optimization::.claude/hooks/shell-hooks::dead-shell-hooks","severity":"S2","effort":"E0","confidence":90,"files":[".claude/hooks/session-start.sh",".claude/hooks/check-mcp-servers.sh",".claude/hooks/check-edit-requirements.sh",".claude/hooks/check-write-requirements.sh",".claude/hooks/pattern-check.sh"],"why_it_matters":"settings.json references only .js versions (session-start.js, check-mcp-servers.js, post-write-validator.js, pattern-check.js). The .sh scripts are not invoked by any hook, CI workflow, or npm script. They add ~35KB of dead code that confuses audits and inflates the hooks directory.","suggested_fix":"Delete the 5 .sh files after verifying no other script references them. The .js equivalents are already the active versions.","acceptance_tests":[".claude/hooks/*.sh files are removed","All functionality still works via .js hooks","No references to deleted .sh files remain in docs or scripts"],"evidence":["settings.json hooks reference: session-start.js, check-mcp-servers.js, post-write-validator.js","check-edit-requirements.sh and check-write-requirements.sh are not referenced in settings.json at all","session-start.sh comments say 'Cross-platform replacement for session-start.sh' in session-start.js"],"sources":[{"source":"copilot","file":"ai-optimization-copilot.jsonl","original_fingerprint":"ai-optimization::.claude/hooks/shell-hooks::dead-shell-hooks"}],"verified":true,"consensus_score":2,"canonical_id":"CANON-0019","status":"CONFIRMED","cross_cutting":false,"categories":["ai-optimization"],"priority_score":48,"unified_id":"UNIFIED-0019"}
{"category":"ai-optimization","title":"Agent sub-prompts omit evidence field from output schema","fingerprint":"ai-optimization::.claude/skills/audit-ai-optimization/SKILL.md::agent-prompt-missing-evidence-field","severity":"S2","effort":"E0","confidence":85,"files":[".claude/skills/audit-ai-optimization/SKILL.md"],"why_it_matters":"Audit instructions require evidence array but Task() agent schemas omit this field.","suggested_fix":"Add evidence field to every agent output schema.","acceptance_tests":["All agent schemas include evidence field","S0/S1 findings include at least 2 evidence items"],"evidence":["Agent 1A schema line 170-171: no evidence field","Agent 1B schema line 196-197: same omission"],"sources":[{"source":"claude","file":"ai-optimization-claude.jsonl","original_fingerprint":"ai-optimization::.claude/skills/audit-ai-optimization/SKILL.md::agent-prompt-missing-evidence-field"}],"verified":true,"consensus_score":2,"canonical_id":"CANON-0014","status":"CONFIRMED","cross_cutting":false,"categories":["ai-optimization"],"priority_score":47,"unified_id":"UNIFIED-0020"}
{"category":"ai-optimization","title":"session-start.js outputs 400-600 tokens of verbose status on every session start","fingerprint":"ai-optimization::.claude/hooks/session-start.js::verbose-hook-output-token-waste","severity":"S1","effort":"E2","confidence":84,"files":[".claude/hooks/session-start.js",".claude/hooks/post-write-validator.js"],"why_it_matters":"SessionStart hook stdout is injected into Claude context on every session. The 30+ line output costs ~400-600 tokens per session before any user work begins.","suggested_fix":"Condense hook output to 5-8 lines: one status line per major step only, suppress decorative borders, remove footer text.","acceptance_tests":["Hook output is <=10 lines when all steps pass","Token count of hook output is <100 tokens per session","Warnings and errors still surface clearly"],"evidence":["session-start.js lines 43-505: 30+ console.log() calls","system-reminder tag confirms full hook stdout injected into context","session-start.js line 383-396: execSync with no hash-cache guard","Hash caching exists for npm install but NOT for pattern check","Lines 43-44: emoji + separator line","Lines 47-60: environment version logging","Lines 219-235: multi-line secrets status","Lines 304-312: per-step status with emoji"],"sources":[{"source":"claude","file":"ai-optimization-claude.jsonl","original_fingerprint":"ai-optimization::.claude/hooks/session-start.js::verbose-hook-output-token-waste"},{"source":"copilot","file":"ai-optimization-copilot.jsonl","original_fingerprint":"ai-optimization::.claude/hooks/session-start.js::verbose-session-output"}],"merged_from":["ai-optimization::.claude/hooks/session-start.js::verbose-hook-output-token-waste","ai-optimization::.claude/hooks/session-start.js::execsync-pattern-check-subprocess","ai-optimization::.claude/hooks/session-start.js::verbose-session-output"],"verified":true,"consensus_score":3,"canonical_id":"CANON-0001","status":"CONFIRMED","cross_cutting":false,"categories":["ai-optimization"],"priority_score":38,"unified_id":"UNIFIED-0021"}
{"category":"ai-optimization","title":"SessionStart critical path runs multiple heavyweight synchronous tasks serially","fingerprint":"ai-optimization::.claude/hooks/session-start.js::serial-heavy-sessionstart","severity":"S1","effort":"E2","confidence":92,"files":[".claude/hooks/session-start.js"],"why_it_matters":"This hook is on every session start and executes dependency installs, builds, pattern checks, consolidation, and metrics checks in sequence. That design can add multi-second to multi-minute startup latency and blocks developer flow before work begins.","suggested_fix":"Split SessionStart into a fast path (environment sanity + minimal checks) and deferred/background tasks (functions build, test build, consolidation, debt metrics). Add a cache/TTL gate for expensive checks and skip steps unless relevant files changed.","acceptance_tests":["Measure median SessionStart wall-clock before/after over 10 runs; target >40% reduction.","Verify hook still reports critical failures (e.g., malformed config) while deferring non-critical tasks.","Confirm deferred tasks only run when trigger files change (lockfiles, functions source, debt metrics inputs)."],"evidence":[".claude/hooks/session-start.js:325-379 runs installs/builds in sequence via execSync wrappers.",".claude/hooks/session-start.js:383-423 adds additional synchronous pattern + consolidation commands.",".claude/hooks/session-start.js:456-485 performs extra TDMS read/parse checks on the same startup path.","Command: nl -ba .claude/hooks/session-start.js | sed -n '260,520p'"],"sources":[{"source":"codex","file":"ai-optimization-codex.jsonl","original_fingerprint":"ai-optimization::.claude/hooks/session-start.js::serial-heavy-sessionstart"}],"verified":true,"consensus_score":2,"canonical_id":"CANON-0003","status":"CONFIRMED","cross_cutting":false,"categories":["ai-optimization"],"priority_score":34,"unified_id":"UNIFIED-0022"}
{"category":"ai-optimization","title":"Hook Latency: Unconditional test build","fingerprint":"ai-optimization::.claude/hooks/session-start.js::latency-test-build","severity":"S1","effort":"E2","confidence":90,"files":[".claude/hooks/session-start.js"],"why_it_matters":"Running 'npm run test:build' on every session start adds significant latency.","suggested_fix":"Run test build only if source files changed or on demand.","acceptance_tests":["Session start is faster"],"evidence":["runCommand('Building test files', 'npm run test:build', 60000) is unconditional"],"sources":[{"source":"jules","file":"ai-optimization-jules.jsonl","original_fingerprint":"ai-optimization::.claude/hooks/session-start.js::latency-test-build"}],"verified":true,"consensus_score":2,"canonical_id":"CANON-0007","status":"CONFIRMED","cross_cutting":false,"categories":["ai-optimization"],"priority_score":33.8,"unified_id":"UNIFIED-0023"}
{"category":"ai-optimization","title":"SessionStart runs 4 sequential Node process spawns — 4-8s cold-start latency","fingerprint":"ai-optimization::.claude/settings.json::sequential-session-start-hooks","severity":"S1","effort":"E2","confidence":85,"files":[".claude/settings.json",".claude/hooks/session-start.js",".claude/hooks/check-mcp-servers.js",".claude/hooks/check-remote-session-context.js",".claude/hooks/stop-serena-dashboard.js"],"why_it_matters":"settings.json wires 4 sequential SessionStart hooks. Cold-start latency is 4-8 seconds before any user turn.","suggested_fix":"Merge check-mcp-servers.js and stop-serena-dashboard.js into session-start.js. Run check-remote-session-context.js asynchronously.","acceptance_tests":["SessionStart completes in <3 seconds on warm session","MCP server and remote branch checks still occur"],"evidence":["settings.json hooks.SessionStart: 4 separate command entries","check-remote-session-context.js: FETCH_TTL_MS = 5 * 60 * 1000"],"sources":[{"source":"claude","file":"ai-optimization-claude.jsonl","original_fingerprint":"ai-optimization::.claude/settings.json::sequential-session-start-hooks"}],"verified":true,"consensus_score":2,"canonical_id":"CANON-0002","status":"CONFIRMED","cross_cutting":false,"categories":["ai-optimization"],"priority_score":33.1,"unified_id":"UNIFIED-0024"}
{"category":"ai-optimization","title":"COMMAND_REFERENCE.md is 109KB — loaded on demand but risks massive token cost if read","fingerprint":"ai-optimization::.claude/COMMAND_REFERENCE.md::oversized-reference-doc","severity":"S1","effort":"E2","confidence":85,"files":[".claude/COMMAND_REFERENCE.md"],"why_it_matters":"At 109KB, this single file consumes ~27,000 tokens if read in full. Any skill or session flow that reads this file injects massive context. It duplicates information already present in individual SKILL.md files and HOOKS.md.","suggested_fix":"Split into focused reference files (commands-ref.md, agents-ref.md, hooks-ref.md) under 10KB each, or create a lightweight index that links to sections on demand.","acceptance_tests":["COMMAND_REFERENCE.md replaced with files <15KB each","No skill/hook reads the full 109KB file in a single operation","All information is still accessible via smaller, focused files"],"evidence":[".claude/COMMAND_REFERENCE.md has size 108,954 bytes","Content duplicates slash command, agent, skill, hook, and MCP docs that each have their own files"],"sources":[{"source":"copilot","file":"ai-optimization-copilot.jsonl","original_fingerprint":"ai-optimization::.claude/COMMAND_REFERENCE.md::oversized-reference-doc"}],"verified":true,"consensus_score":2,"canonical_id":"CANON-0005","status":"CONFIRMED","cross_cutting":false,"categories":["ai-optimization"],"priority_score":33.1,"unified_id":"UNIFIED-0025"}
{"category":"ai-optimization","title":"Session-start hook uses execSync for version checks that could be cached","fingerprint":"ai-optimization::.claude/hooks/session-start.js::execsync-overhead","severity":"S1","effort":"E2","confidence":84,"files":[".claude/hooks/session-start.js"],"why_it_matters":"Hook spawns synchronous child processes for 'node -v' and 'npm -v' on every session start. Each execSync adds 50-200ms latency. Node.js versions rarely change within a session - this is wasteful.","suggested_fix":"Cache version info in .claude/state/versions.json with 1-hour TTL, or read from package.json engines field directly without spawning processes.","acceptance_tests":["No execSync for version-only checks","Version cache file exists in .claude/state/","Session start latency reduced by >100ms"],"evidence":["const nodeVersion = execSync('node -v', {encoding: 'utf8'}).trim();","const npmVersion = execSync('npm -v', {encoding: 'utf8'}).trim();","Lines 60-75: Sequential synchronous process spawning","Sequential pattern: execSync('npm install'), then execSync('npm run build:functions')","Lines 80-120: All operations are synchronous and sequential"],"sources":[{"source":"kimik2","file":"ai-optimization-kimik2.jsonl","original_fingerprint":"ai-optimization::.claude/hooks/session-start.js::execsync-overhead"}],"merged_from":["ai-optimization::.claude/hooks/session-start.js::execsync-overhead","ai-optimization::.claude/hooks/session-start.js::sequential-ops"],"verified":true,"consensus_score":2,"canonical_id":"CANON-0008","status":"CONFIRMED","cross_cutting":false,"categories":["ai-optimization"],"priority_score":33,"unified_id":"UNIFIED-0026"}
{"category":"ai-optimization","title":"Dead Documentation: Code Review Checklist references","fingerprint":"ai-optimization::.claude/skills/code-reviewer/SKILL.md::broken-links","severity":"S2","effort":"E1","confidence":100,"files":[".claude/skills/code-reviewer/SKILL.md:140"],"why_it_matters":"Skill references non-existent documentation (references/ directory), confusing the AI.","suggested_fix":"Update links to point to docs/agent_docs/CODE_PATTERNS.md or remove them.","acceptance_tests":["Links are valid"],"evidence":["References to references/code_review_checklist.md which does not exist"],"sources":[{"source":"jules","file":"ai-optimization-jules.jsonl","original_fingerprint":"ai-optimization::.claude/skills/code-reviewer/SKILL.md::broken-links"}],"verified":true,"consensus_score":2,"canonical_id":"CANON-0038","status":"CONFIRMED","cross_cutting":false,"categories":["ai-optimization"],"priority_score":30,"unified_id":"UNIFIED-0027"}
{"category":"ai-optimization","title":"Fragile Parsing: Git output parsing in post-read-handler.js","fingerprint":"ai-optimization::.claude/hooks/post-read-handler.js::fragile-git-parsing","severity":"S2","effort":"E1","confidence":100,"files":[".claude/hooks/post-read-handler.js"],"why_it_matters":"Parsing git output by splitting on newline fails for filenames with newlines.","suggested_fix":"Use -z flag for git diff and split by NUL byte, similar to pre-compaction-save.js.","acceptance_tests":["Verify correct handling of filenames with newlines"],"evidence":["gitExec(['diff', '--name-only']).split('\\n') in gatherGitContext"],"sources":[{"source":"jules","file":"ai-optimization-jules.jsonl","original_fingerprint":"ai-optimization::.claude/hooks/post-read-handler.js::fragile-git-parsing"}],"verified":true,"consensus_score":2,"canonical_id":"CANON-0039","status":"CONFIRMED","cross_cutting":false,"categories":["ai-optimization"],"priority_score":30,"unified_id":"UNIFIED-0028"}
{"category":"ai-optimization","title":"AI Instruction Bloat: audit-code SKILL.md","fingerprint":"ai-optimization::.claude/skills/audit-code/SKILL.md::bloat","severity":"S2","effort":"E1","confidence":100,"files":[".claude/skills/audit-code/SKILL.md"],"why_it_matters":"Skill file is 370 lines long, duplicating process documentation.","suggested_fix":"Move process documentation to a separate doc file and reference it in the skill.","acceptance_tests":["SKILL.md size reduced"],"evidence":["Contains full 'Pre-Audit Validation', 'Audit Execution', 'Output Requirements' sections"],"sources":[{"source":"jules","file":"ai-optimization-jules.jsonl","original_fingerprint":"ai-optimization::.claude/skills/audit-code/SKILL.md::bloat"}],"verified":true,"consensus_score":2,"canonical_id":"CANON-0042","status":"CONFIRMED","cross_cutting":false,"categories":["ai-optimization"],"priority_score":30,"unified_id":"UNIFIED-0029"}
{"category":"ai-optimization","title":"check-edit-requirements.sh and check-write-requirements.sh share ~90% identical code","fingerprint":"ai-optimization::.claude/hooks/check-edit-write-requirements::duplicate-shell-hooks","severity":"S2","effort":"E1","confidence":95,"files":[".claude/hooks/check-edit-requirements.sh",".claude/hooks/check-write-requirements.sh"],"why_it_matters":"These two shell scripts have nearly identical input validation, path sanitization, security keyword matching, and file type classification. They differ only in the specific post-task messages. This duplication means bugs must be fixed in two places. However, these are also dead .sh files (see dead shell hooks finding), so this is only relevant if the .sh files are kept.","suggested_fix":"Since .js replacements exist (post-write-validator.js handles Write/Edit/MultiEdit), simply delete both .sh files. If .sh files need to stay, merge into a single parameterized script.","acceptance_tests":["Either both .sh files deleted, or consolidated into one parameterized script","No duplicated validation logic exists across hooks"],"evidence":["check-edit-requirements.sh lines 1-75 are structurally identical to check-write-requirements.sh lines 1-76","Both have identical path traversal rejection, sanitization, and security keyword regex","settings.json uses post-write-validator.js for all Write/Edit/MultiEdit operations"],"sources":[{"source":"copilot","file":"ai-optimization-copilot.jsonl","original_fingerprint":"ai-optimization::.claude/hooks/check-edit-write-requirements::duplicate-shell-hooks"}],"verified":true,"consensus_score":2,"canonical_id":"CANON-0021","status":"CONFIRMED","cross_cutting":false,"categories":["ai-optimization"],"priority_score":29.5,"unified_id":"UNIFIED-0030"}
{"category":"ai-optimization","title":"post-write-validator.js and pattern-check.js share identical INLINE_PATTERNS arrays","fingerprint":"ai-optimization::.claude/hooks/post-write-validator-pattern-check::duplicated-inline-patterns","severity":"S2","effort":"E1","confidence":95,"files":[".claude/hooks/post-write-validator.js",".claude/hooks/pattern-check.js"],"why_it_matters":"Both hooks contain identical INLINE_PATTERNS arrays (~70 lines each) with the same regex patterns for clickable div, test-mock-firestore, SQL injection, and shell injection detection. The checkInlinePatterns function is also duplicated. Any pattern update must be made in both files or they drift.","suggested_fix":"Extract INLINE_PATTERNS and checkInlinePatterns into a shared module (e.g., .claude/hooks/lib/inline-patterns.js) and import from both hooks.","acceptance_tests":["INLINE_PATTERNS defined in exactly one file","Both hooks import from the shared module","Pattern check behavior unchanged"],"evidence":["post-write-validator.js lines 480-540: identical patterns to pattern-check.js lines 91-158","checkInlinePatterns function logic is duplicated in both files","Both contain sql-injection-risk, shell-command-injection, test-mock-firestore-directly patterns"],"sources":[{"source":"copilot","file":"ai-optimization-copilot.jsonl","original_fingerprint":"ai-optimization::.claude/hooks/post-write-validator-pattern-check::duplicated-inline-patterns"}],"verified":true,"consensus_score":2,"canonical_id":"CANON-0022","status":"CONFIRMED","cross_cutting":false,"categories":["ai-optimization"],"priority_score":29.5,"unified_id":"UNIFIED-0031"}
{"category":"ai-optimization","title":"Multiple hooks contain duplicated gitExec helper function","fingerprint":"ai-optimization::.claude/hooks/multiple::duplicated-gitexec-helper","severity":"S2","effort":"E1","confidence":90,"files":[".claude/hooks/post-read-handler.js",".claude/hooks/pre-compaction-save.js",".claude/hooks/compaction-handoff.js",".claude/hooks/commit-tracker.js",".claude/hooks/check-remote-session-context.js",".claude/hooks/check-mcp-servers.js",".claude/hooks/agent-trigger-enforcer.js"],"why_it_matters":"At least 5 hooks define their own gitExec() function with identical logic: execFileSync('git', args, {cwd, encoding, timeout}). This is ~10 lines duplicated 5 times. The state-utils.js shared module pattern already exists but doesn't include git utilities.","suggested_fix":"Add a gitExec function to .claude/hooks/lib/ (either state-utils.js or a new git-utils.js) and import it from all hooks.","acceptance_tests":["gitExec defined in exactly one shared module","All 5+ hooks import from the shared module","Git operations still work correctly from all hooks"],"evidence":["post-read-handler.js: function gitExec(args) { try { return execFileSync('git', args, {cwd: projectDir ...})","pre-compaction-save.js: function gitExec(args) { try { return execFileSync('git', args, {cwd: projectDir ...})","compaction-handoff.js, commit-tracker.js, check-remote-session-context.js all have equivalent functions","post-read-handler.js lines 40-55: safeBaseDir/projectDirInput/projectDir/baseForCheck/projectForCheck pattern","commit-tracker.js lines 24-40: identical pattern","compaction-handoff.js lines 35-50: identical pattern","check-remote-session-context.js lines 67-76: same pattern with minor variant"],"sources":[{"source":"copilot","file":"ai-optimization-copilot.jsonl","original_fingerprint":"ai-optimization::.claude/hooks/multiple::duplicated-gitexec-helper"}],"merged_from":["ai-optimization::.claude/hooks/multiple::duplicated-gitexec-helper","ai-optimization::.claude/hooks/multiple::duplicated-projectdir-validation"],"verified":true,"consensus_score":2,"canonical_id":"CANON-0023","status":"CONFIRMED","cross_cutting":false,"categories":["ai-optimization"],"priority_score":29,"unified_id":"UNIFIED-0032"}
{"category":"ai-optimization","title":"Context Optimization: Heavy episodic memory search","fingerprint":"ai-optimization::.claude/skills/audit-code/SKILL.md::heavy-context","severity":"S2","effort":"E1","confidence":90,"files":[".claude/skills/audit-code/SKILL.md"],"why_it_matters":"Mandatory episodic memory search for generic terms ('code audit') loads potentially large/irrelevant context.","suggested_fix":"Refine search queries or make them conditional.","acceptance_tests":["Token usage reduced"],"evidence":["memory__search({ query: ['code audit', 'patterns', 'quality'], limit: 5 })"],"sources":[{"source":"jules","file":"ai-optimization-jules.jsonl","original_fingerprint":"ai-optimization::.claude/skills/audit-code/SKILL.md::heavy-context"}],"verified":true,"consensus_score":2,"canonical_id":"CANON-0043","status":"CONFIRMED","cross_cutting":false,"categories":["ai-optimization"],"priority_score":29,"unified_id":"UNIFIED-0033"}
{"category":"ai-optimization","title":"Pre-commit subagent Task prompt is under-specified for deterministic outputs","fingerprint":"ai-optimization::.claude/skills/pre-commit-fixer/SKILL.md::task-prompt-missing-structured-contract","severity":"S2","effort":"E1","confidence":86,"files":[".claude/skills/pre-commit-fixer/SKILL.md"],"why_it_matters":"The Task prompt asks for fixes but does not define structured output schema, required artifact paths, or strict return protocol. This can increase retries and ambiguity, wasting tokens and causing inconsistent automation behavior.","suggested_fix":"Add a strict subagent contract: required output JSON schema, explicit file list constraints, success/failure return block, and path-based artifact/report destinations.","acceptance_tests":["Run the skill on 5 pre-commit failure samples and confirm subagent outputs are parseable with zero manual interpretation.","Validate subagent response against a JSON schema in CI.","Ensure retry loop can make decisions solely from structured return fields."],"evidence":[".claude/skills/pre-commit-fixer/SKILL.md:90-94 defines a free-form Task prompt with no schema or output path contract.",".claude/skills/pre-commit-fixer/SKILL.md:134-150 defines human-readable result format, but not a machine-validated schema for subagent return.","Command: rg -n \"CRITICAL RETURN PROTOCOL|JSONL schema|output file\" .claude/skills/pre-commit-fixer/SKILL.md found no protocol requirement block."],"sources":[{"source":"codex","file":"ai-optimization-codex.jsonl","original_fingerprint":"ai-optimization::.claude/skills/pre-commit-fixer/SKILL.md::task-prompt-missing-structured-contract"}],"verified":true,"consensus_score":2,"canonical_id":"CANON-0018","status":"CONFIRMED","cross_cutting":false,"categories":["ai-optimization"],"priority_score":28.6,"unified_id":"UNIFIED-0034"}
{"category":"ai-optimization","title":"CRITICAL Persistence Rules boilerplate copy-pasted across 4+ audit SKILL.md files","fingerprint":"ai-optimization::.claude/skills::duplicated-persistence-rules-boilerplate","severity":"S2","effort":"E1","confidence":85,"files":[".claude/skills/audit-ai-optimization/SKILL.md",".claude/skills/audit-process/SKILL.md",".claude/skills/audit-enhancements/SKILL.md",".claude/skills/create-audit/SKILL.md"],"why_it_matters":"~50-line Persistence Rules block duplicated across 4+ files. Costs ~150 tokens per skill load.","suggested_fix":"Create _shared/AUDIT_PERSISTENCE_RULES.md as single canonical source.","acceptance_tests":["Block appears in only one location","Each audit SKILL.md references shared file"],"evidence":["audit-ai-optimization/SKILL.md lines 36-57: identical boilerplate","audit-process/SKILL.md lines 32-52: identical boilerplate"],"sources":[{"source":"claude","file":"ai-optimization-claude.jsonl","original_fingerprint":"ai-optimization::.claude/skills::duplicated-persistence-rules-boilerplate"}],"verified":true,"consensus_score":2,"canonical_id":"CANON-0012","status":"CONFIRMED","cross_cutting":false,"categories":["ai-optimization"],"priority_score":28.5,"unified_id":"UNIFIED-0035"}
{"category":"ai-optimization","title":"hook-warnings-log.jsonl has repetitive low-value entries — no rotation","fingerprint":"ai-optimization::.claude/state/hook-warnings-log.jsonl::unbounded-log-growth","severity":"S2","effort":"E1","confidence":85,"files":[".claude/state/hook-warnings-log.jsonl"],"why_it_matters":"hook-warnings-log.jsonl grows unbounded with 15 nearly identical entries visible ('WARNING TRIGGERS (recommended actions):' repeated with only timestamps differing). Over time this file will grow indefinitely, consuming storage and making log analysis harder. The same trigger fires on every push without new information.","suggested_fix":"Add log rotation: keep only the last 100 entries (or last 7 days). Deduplicate consecutive identical messages (store count instead of repeating).","acceptance_tests":["hook-warnings-log.jsonl has a maximum size or entry count","Consecutive duplicate messages are deduplicated","Rotation runs automatically (e.g., in session-start or pre-push)"],"evidence":[".claude/state/hook-warnings-log.jsonl: 15 entries visible, 14 are identical 'WARNING TRIGGERS' messages","Each entry is ~170 bytes, growing without bounds","No rotation logic found in any hook or script"],"sources":[{"source":"copilot","file":"ai-optimization-copilot.jsonl","original_fingerprint":"ai-optimization::.claude/state/hook-warnings-log.jsonl::unbounded-log-growth"}],"verified":true,"consensus_score":2,"canonical_id":"CANON-0024","status":"CONFIRMED","cross_cutting":false,"categories":["ai-optimization"],"priority_score":28.5,"unified_id":"UNIFIED-0036"}
{"category":"ai-optimization","title":"Legacy shell hook scripts appear runtime-unused (possibly unused)","fingerprint":"ai-optimization::.claude/hooks/.sh::legacy-shell-hooks-possibly-unused","severity":"S2","effort":"E1","confidence":84,"files":[".claude/hooks/analyze-user-request.sh",".claude/hooks/check-edit-requirements.sh",".claude/hooks/check-write-requirements.sh",".claude/hooks/check-mcp-servers.sh",".claude/hooks/pattern-check.sh",".claude/hooks/session-start.sh",".claude/settings.json"],"why_it_matters":"Maintaining duplicate JS+SH hook implementations increases maintenance/token overhead and can confuse future edits. If shell variants are no longer executed by hook config, they become drift-prone documentation code.","suggested_fix":"Either remove/archive shell variants or mark them explicitly as fallback-only with a single source-of-truth policy. If kept, add automated parity tests between JS and SH behavior.","acceptance_tests":["Search execution config (settings.json, CI, husky, package scripts) and verify no .sh hook is invoked.","If keeping shell versions, add CI parity check that compares outputs for representative inputs.","Update cross-platform docs to explicitly state support status for each shell file."],"evidence":[".claude/settings.json:13,17,22,28 references only Node hook entrypoints (no .sh hook commands).",".claude/hooks/session-start.js:7 and .claude/hooks/check-mcp-servers.js:7 state they are cross-platform replacements for .sh scripts.","Command: rg -n \".claude/hooks/.*.sh\" .claude/settings.json .github/workflows package.json .husky/* returned no runtime references.","Command: for f in .claude/hooks/*.sh; do rg -n \"$(basename $f)\" .claude .github package.json scripts docs; done"],"sources":[{"source":"codex","file":"ai-optimization-codex.jsonl","original_fingerprint":"ai-optimization::.claude/hooks/.sh::legacy-shell-hooks-possibly-unused"}],"verified":true,"consensus_score":2,"canonical_id":"CANON-0016","status":"CONFIRMED","cross_cutting":false,"categories":["ai-optimization"],"priority_score":28.4,"unified_id":"UNIFIED-0037"}
{"category":"ai-optimization","title":"13 consolidated-out hook JS files remain as dead standalone executables","fingerprint":"ai-optimization::.claude/hooks::orphaned-pre-consolidation-hook-files","severity":"S2","effort":"E1","confidence":80,"files":[".claude/hooks/agent-trigger-enforcer.js",".claude/hooks/app-check-validator.js",".claude/hooks/audit-s0s1-validator.js",".claude/hooks/auto-save-context.js",".claude/hooks/check-requirements.js",".claude/hooks/compaction-handoff.js",".claude/hooks/component-size-check.js",".claude/hooks/firestore-write-block.js",".claude/hooks/large-context-warning.js",".claude/hooks/repository-pattern-check.js",".claude/hooks/test-mocking-validator.js",".claude/hooks/typescript-strict-check.js",".claude/hooks/pattern-check.js"],"why_it_matters":"post-write-validator.js replaced 10 hooks, post-read-handler.js replaced 3 more. Originals remain as ~2000 lines of dead code.","suggested_fix":"Move to .claude/hooks/archive/ or delete them.","acceptance_tests":["All 13 files deleted or archived","settings.json functions correctly"],"evidence":["post-write-validator.js: Replaces 10 separate hooks","post-read-handler.js: Replaces 3 separate hooks"],"sources":[{"source":"claude","file":"ai-optimization-claude.jsonl","original_fingerprint":"ai-optimization::.claude/hooks::orphaned-pre-consolidation-hook-files"}],"verified":true,"consensus_score":2,"canonical_id":"CANON-0011","status":"CONFIRMED","cross_cutting":false,"categories":["ai-optimization"],"priority_score":28,"unified_id":"UNIFIED-0038"}
{"category":"ai-optimization","title":"Task() sub-agents dont check FALSE_POSITIVES.jsonl before reporting","fingerprint":"ai-optimization::.claude/skills/audit-ai-optimization/SKILL.md::agent-prompts-missing-false-positive-exclusion","severity":"S2","effort":"E1","confidence":80,"files":[".claude/skills/audit-ai-optimization/SKILL.md",".claude/skills/audit-process/SKILL.md"],"why_it_matters":"Orchestrator reads FALSE_POSITIVES.jsonl but Task() agents start in fresh contexts without it. Known FPs re-reported every audit.","suggested_fix":"Add to each agent prompt: read FALSE_POSITIVES.jsonl and exclude matching entries.","acceptance_tests":["No findings matching FALSE_POSITIVES.jsonl","Agent prompts mention FALSE_POSITIVES.jsonl"],"evidence":["Orchestrator reads FALSE_POSITIVES not propagated to subagents","Agent 1A prompt has zero mention of FALSE_POSITIVES.jsonl"],"sources":[{"source":"claude","file":"ai-optimization-claude.jsonl","original_fingerprint":"ai-optimization::.claude/skills/audit-ai-optimization/SKILL.md::agent-prompts-missing-false-positive-exclusion"}],"verified":true,"consensus_score":2,"canonical_id":"CANON-0015","status":"CONFIRMED","cross_cutting":false,"categories":["ai-optimization"],"priority_score":28,"unified_id":"UNIFIED-0039"}
{"category":"ai-optimization","title":"stop-serena-dashboard.js uses 6+ execFileSync calls at session start — port check may be unnecessary","fingerprint":"ai-optimization::.claude/hooks/stop-serena-dashboard.js::unnecessary-session-start-overhead","severity":"S2","effort":"E1","confidence":80,"files":[".claude/hooks/stop-serena-dashboard.js"],"why_it_matters":"This hook runs on every SessionStart and spawns multiple synchronous child processes (lsof, ps, kill) to stop a Serena dashboard that may not be running. In remote Claude Code environments, Serena is unlikely to be active. The hook is 250+ lines of security-hardened process termination code that executes unconditionally.","suggested_fix":"Add a fast-path check: if port 24282 is not listening, exit immediately with zero subprocess spawns. Or make this hook conditional on a local-only environment flag.","acceptance_tests":["Hook exits in <5ms when no process is listening on port 24282","No child processes are spawned when port is free","Hook still correctly stops Serena when it IS running"],"evidence":["settings.json line 28-32: stop-serena-dashboard.js runs on every SessionStart","Hook uses execFileSync for: lsof, ps (multiple calls), kill/SIGTERM","Already has continueOnError: true suggesting it's non-essential"],"sources":[{"source":"copilot","file":"ai-optimization-copilot.jsonl","original_fingerprint":"ai-optimization::.claude/hooks/stop-serena-dashboard.js::unnecessary-session-start-overhead"}],"verified":true,"consensus_score":2,"canonical_id":"CANON-0020","status":"CONFIRMED","cross_cutting":false,"categories":["ai-optimization"],"priority_score":28,"unified_id":"UNIFIED-0040"}
{"category":"ai-optimization","title":"Scripts not in package.json: add-false-positive.js, assign-review-tier.js, seed-commit-log.js, sync-claude-settings.js — potentially dead","fingerprint":"ai-optimization::scripts::unreferenced-scripts","severity":"S2","effort":"E1","confidence":75,"files":["scripts/add-false-positive.js","scripts/assign-review-tier.js","scripts/seed-commit-log.js","scripts/sync-claude-settings.js","scripts/enrichment_failures.json"],"why_it_matters":"These scripts exist in scripts/ but have no entry in package.json scripts section. They may be called by skills, hooks, or used manually, but without a package.json entry they're harder to discover and may be truly dead code. enrichment_failures.json (6KB) appears to be output data committed to the repo.","suggested_fix":"Verify each script's usage: check if any SKILL.md, hook, or CI workflow references them. If unused, delete. If used, add to package.json for discoverability. Move enrichment_failures.json to .gitignore if it's generated output.","acceptance_tests":["Each script either has a package.json entry or is confirmed used by a skill/hook","enrichment_failures.json is either documented or removed","No truly orphaned scripts remain"],"evidence":["package.json scripts section has 90 entries but none reference add-false-positive.js, assign-review-tier.js, seed-commit-log.js, or sync-claude-settings.js","scripts/enrichment_failures.json is a 6KB data file in the scripts directory","sync-claude-settings.js IS referenced in CROSS_PLATFORM_SETUP.md and HOOKS.md docs"],"sources":[{"source":"copilot","file":"ai-optimization-copilot.jsonl","original_fingerprint":"ai-optimization::scripts::unreferenced-scripts"}],"verified":true,"consensus_score":1.5,"canonical_id":"CANON-0049","status":"SUSPECTED","cross_cutting":false,"categories":["ai-optimization"],"priority_score":25,"unified_id":"UNIFIED-0041"}
{"category":"ai-optimization","title":"Hooks use string manipulation where JSON.parse should be used","fingerprint":"ai-optimization::.claude/hooks/*.js::fragile-parsing","severity":"S2","effort":"E1","confidence":75,"files":[".claude/hooks/state-utils.js",".claude/hooks/commit-tracker.js"],"why_it_matters":"Based on commit messages referencing 'fragile parsing patterns' and file names like 'state-utils.js', hooks likely use manual string splitting for JSONL/state file parsing instead of proper JSON.parse, risking corruption on edge cases.","suggested_fix":"Use JSON.parse() with try/catch for all JSON/JSONL parsing, use readline module for line-by-line JSONL processing instead of split('\\n').","acceptance_tests":["All JSON parsing uses JSON.parse()","JSONL files processed with readline or jsonl-parser","No manual string splitting on structured data"],"evidence":["Commit: 'Fix 8 fragile parsing patterns: resilient regex across 11 files'","File: state-utils.js likely handles state parsing","File: commit-tracker.js processes JSONL logs"],"sources":[{"source":"kimik2","file":"ai-optimization-kimik2.jsonl","original_fingerprint":"ai-optimization::.claude/hooks/*.js::fragile-parsing"}],"verified":true,"consensus_score":1.5,"canonical_id":"CANON-0051","status":"SUSPECTED","cross_cutting":false,"categories":["ai-optimization"],"priority_score":25,"unified_id":"UNIFIED-0042"}
{"category":"ai-optimization","title":"Audit skill prompts may not consistently reference FALSE_POSITIVES.jsonl","fingerprint":"ai-optimization::.claude/skills/audit-ai-optimization/SKILL.md::missing-fp-exclusion","severity":"S2","effort":"E1","confidence":72,"files":[".claude/skills/audit-ai-optimization/SKILL.md"],"why_it_matters":"The FALSE_POSITIVES.jsonl file exists with 3 entries but audit skill prompts may not explicitly instruct agents to exclude these patterns, leading to duplicate findings and wasted verification effort.","suggested_fix":"Add explicit instruction to all audit skill prompts: 'Check docs/technical-debt/FALSE_POSITIVES.jsonl and exclude any findings matching these patterns.'","acceptance_tests":["All audit SKILL.md files reference FALSE_POSITIVES.jsonl","Agent prompts include FP exclusion instruction","No duplicate findings matching FP patterns"],"evidence":["FALSE_POSITIVES.jsonl exists with 3 verified false positive entries","Audit skill is 632 lines but FP reference not visible in preview","Finding DEBT-2598, DEBT-2615, DEBT-0107 are marked FALSE_POSITIVE"],"sources":[{"source":"kimik2","file":"ai-optimization-kimik2.jsonl","original_fingerprint":"ai-optimization::.claude/skills/audit-ai-optimization/SKILL.md::missing-fp-exclusion"}],"verified":true,"consensus_score":1.5,"canonical_id":"CANON-0052","status":"SUSPECTED","cross_cutting":false,"categories":["ai-optimization"],"priority_score":24.7,"unified_id":"UNIFIED-0043"}
{"category":"ai-optimization","title":"filesystem MCP server configured but permanently disabled — dead config","fingerprint":"ai-optimization::.mcp.json::dead-filesystem-mcp-server-config","severity":"S3","effort":"E0","confidence":91,"files":[".mcp.json",".claude/settings.json"],"why_it_matters":"filesystem entry self-annotated as disabled and in disabledMcpjsonServers. Dead config adds cognitive overhead.","suggested_fix":"Remove filesystem entry from .mcp.json entirely.","acceptance_tests":["filesystem not in .mcp.json","MCP config only lists active servers"],"evidence":[".mcp.json: filesystem with note stating disabled","settings.json: disabledMcpjsonServers includes filesystem","'_note': 'filesystem MCP duplicates native Read/Write/Glob tools — disabled since no skills reference mcp__filesystem__ tools'","Server still configured with command/args despite being 'disabled'"],"sources":[{"source":"claude","file":"ai-optimization-claude.jsonl","original_fingerprint":"ai-optimization::.mcp.json::dead-filesystem-mcp-server-config"},{"source":"kimik2","file":"ai-optimization-kimik2.jsonl","original_fingerprint":"ai-optimization::.mcp.json::unused-mcp-server"}],"merged_from":["ai-optimization::.mcp.json::dead-filesystem-mcp-server-config","ai-optimization::.mcp.json::unused-mcp-server"],"verified":true,"consensus_score":3,"canonical_id":"CANON-0053","status":"CONFIRMED","cross_cutting":false,"categories":["ai-optimization"],"priority_score":24.6,"unified_id":"UNIFIED-0044"}
{"category":"ai-optimization","title":"Skill Overlap: audit-code vs code-reviewer","fingerprint":"ai-optimization::.claude/skills/audit-code/SKILL.md::overlap","severity":"S2","effort":"E2","confidence":100,"files":[".claude/skills/audit-code/SKILL.md",".claude/skills/code-reviewer/SKILL.md"],"why_it_matters":"Two skills perform nearly identical code quality checks, leading to confusion and maintenance drift.","suggested_fix":"Consolidate into a single 'code-quality' skill with modes (audit vs review) or distinct tasks.","acceptance_tests":["Skills are merged or clearly differentiated"],"evidence":["Both skills check Typescript, React, Firebase, Security patterns with significant content overlap"],"sources":[{"source":"jules","file":"ai-optimization-jules.jsonl","original_fingerprint":"ai-optimization::.claude/skills/audit-code/SKILL.md::overlap"}],"verified":true,"consensus_score":2,"canonical_id":"CANON-0041","status":"CONFIRMED","cross_cutting":false,"categories":["ai-optimization"],"priority_score":20,"unified_id":"UNIFIED-0045"}
{"category":"ai-optimization","title":"Dead Documentation: technical-debt/INDEX.md","fingerprint":"ai-optimization::docs/technical-debt/INDEX.md::dead-doc","severity":"S3","effort":"E0","confidence":100,"files":["docs/technical-debt/INDEX.md"],"why_it_matters":"Unreferenced documentation creates confusion and maintenance overhead.","suggested_fix":"Delete the file.","acceptance_tests":["File is deleted"],"evidence":["File is not referenced by any other file in the project (excluding archive)"],"sources":[{"source":"jules","file":"ai-optimization-jules.jsonl","original_fingerprint":"ai-optimization::docs/technical-debt/INDEX.md::dead-doc"}],"verified":true,"consensus_score":2,"canonical_id":"CANON-0061","status":"CONFIRMED","cross_cutting":false,"categories":["ai-optimization"],"priority_score":20,"unified_id":"UNIFIED-0046"}
{"category":"ai-optimization","title":"MCP Config Efficiency: Unused filesystem server","fingerprint":"ai-optimization::.mcp.json::unused-server","severity":"S3","effort":"E0","confidence":100,"files":[".mcp.json"],"why_it_matters":"Unused MCP server adds overhead and potential confusion.","suggested_fix":"Remove the filesystem server configuration.","acceptance_tests":["Server removed from config"],"evidence":["filesystem server is present but marked as disabled/unused in _note"],"sources":[{"source":"jules","file":"ai-optimization-jules.jsonl","original_fingerprint":"ai-optimization::.mcp.json::unused-server"}],"verified":true,"consensus_score":2,"canonical_id":"CANON-0063","status":"CONFIRMED","cross_cutting":false,"categories":["ai-optimization"],"priority_score":20,"unified_id":"UNIFIED-0047"}
{"category":"ai-optimization","title":"Format Waste: Verbose session-start output","fingerprint":"ai-optimization::.claude/hooks/session-start.js::verbose-output","severity":"S3","effort":"E1","confidence":90,"files":[".claude/hooks/session-start.js"],"why_it_matters":"Verbose output wastes tokens in every session start.","suggested_fix":"Reduce console.log calls, only show warnings or errors.","acceptance_tests":["Session start output is minimal"],"evidence":["Multiple console.log calls for status updates ('Checking...', 'Skipping...')","console.log('━'.repeat(66)) - decorative separator","console.log('🚀 SessionStart Hook for sonash-v0') - emoji output","console.log('📋 Environment:') - verbose section headers"],"sources":[{"source":"jules","file":"ai-optimization-jules.jsonl","original_fingerprint":"ai-optimization::.claude/hooks/session-start.js::verbose-output"},{"source":"kimik2","file":"ai-optimization-kimik2.jsonl","original_fingerprint":"ai-optimization::.claude/hooks/session-start.js::verbose-output"}],"merged_from":["ai-optimization::.claude/hooks/session-start.js::verbose-output","ai-optimization::.claude/hooks/session-start.js::verbose-output"],"verified":true,"consensus_score":3,"canonical_id":"CANON-0054","status":"CONFIRMED","cross_cutting":false,"categories":["ai-optimization"],"priority_score":19.8,"unified_id":"UNIFIED-0048"}
{"category":"ai-optimization","title":"Subprocess Overhead: Node spawning in hooks","fingerprint":"ai-optimization::.claude/hooks/session-start.js::subprocess-overhead","severity":"S2","effort":"E2","confidence":90,"files":[".claude/hooks/session-start.js"],"why_it_matters":"Spawning new Node processes consumes memory and time.","suggested_fix":"Require and call script functions directly where possible (e.g. check-pattern-compliance.js).","acceptance_tests":["Process count matches expectation","Latency reduced"],"evidence":["execSync('node scripts/check-pattern-compliance.js', ...)"],"sources":[{"source":"jules","file":"ai-optimization-jules.jsonl","original_fingerprint":"ai-optimization::.claude/hooks/session-start.js::subprocess-overhead"}],"verified":true,"consensus_score":2,"canonical_id":"CANON-0040","status":"CONFIRMED","cross_cutting":false,"categories":["ai-optimization"],"priority_score":19.5,"unified_id":"UNIFIED-0049"}
{"category":"ai-optimization","title":"Dead Documentation: technical-debt/logs artifacts","fingerprint":"ai-optimization::docs/technical-debt/logs::dead-doc","severity":"S3","effort":"E0","confidence":90,"files":["docs/technical-debt/logs/verification-log.jsonl","docs/technical-debt/logs/s1-verification-batch.json"],"why_it_matters":"Old log artifacts consume space and are not referenced.","suggested_fix":"Delete or archive the directory.","acceptance_tests":["Directory is deleted or moved to archive"],"evidence":["Files in docs/technical-debt/logs/ are not referenced by active scripts"],"sources":[{"source":"jules","file":"ai-optimization-jules.jsonl","original_fingerprint":"ai-optimization::docs/technical-debt/logs::dead-doc"}],"verified":true,"consensus_score":2,"canonical_id":"CANON-0062","status":"CONFIRMED","cross_cutting":false,"categories":["ai-optimization"],"priority_score":19.5,"unified_id":"UNIFIED-0050"}
{"category":"ai-optimization","title":"SKILL.md file exceeds 500 lines with duplicated boilerplate","fingerprint":"ai-optimization::.claude/skills/audit-ai-optimization/SKILL.md::skill-bloat","severity":"S2","effort":"E2","confidence":85,"files":[".claude/skills/audit-ai-optimization/SKILL.md"],"why_it_matters":"The audit-ai-optimization SKILL.md is 632 lines (21.8KB), containing extensive duplicated boilerplate across sections. This wastes ~200 tokens per skill invocation and increases context window pressure. Similar patterns exist across 10+ audit skills.","suggested_fix":"Extract common sections (CRITICAL RETURN PROTOCOL, Persistence Rules, Stage templates) into a shared base file referenced by all audit skills. Target: reduce to <300 lines per skill.","acceptance_tests":["SKILL.md < 300 lines","Common sections referenced from shared base","No duplication of CRITICAL headers across audit skills"],"evidence":["File size: 632 lines (470 loc) · 21.8 KB","Duplicated 'CRITICAL: Persistence Rules' section","Duplicated 'CRITICAL RETURN PROTOCOL' section","Stage template patterns repeated verbatim"],"sources":[{"source":"kimik2","file":"ai-optimization-kimik2.jsonl","original_fingerprint":"ai-optimization::.claude/skills/audit-ai-optimization/SKILL.md::skill-bloat"}],"verified":true,"consensus_score":2,"canonical_id":"CANON-0044","status":"CONFIRMED","cross_cutting":false,"categories":["ai-optimization"],"priority_score":19.3,"unified_id":"UNIFIED-0051"}
{"category":"ai-optimization","title":"settings.json disabledMcpjsonServers has 3 stale entries not in .mcp.json","fingerprint":"ai-optimization::.claude/settings.json::stale-disabled-mcp-server-entries","severity":"S3","effort":"E0","confidence":85,"files":[".claude/settings.json",".mcp.json"],"why_it_matters":"disabledMcpjsonServers includes rube, serena, nextjs-devtools — none in .mcp.json. Stale entries with no documentation.","suggested_fix":"Remove stale entries or add comments explaining they target global configs.","acceptance_tests":["Each entry corresponds to known server or is documented"],"evidence":["settings.json: rube, serena, nextjs-devtools, filesystem",".mcp.json only has: filesystem, playwright, memory, sonarcloud"],"sources":[{"source":"claude","file":"ai-optimization-claude.jsonl","original_fingerprint":"ai-optimization::.claude/settings.json::stale-disabled-mcp-server-entries"}],"verified":true,"consensus_score":2,"canonical_id":"CANON-0055","status":"CONFIRMED","cross_cutting":false,"categories":["ai-optimization"],"priority_score":19.3,"unified_id":"UNIFIED-0052"}
{"category":"ai-optimization","title":"Session-begin checklist duplicates mandatory context reads","fingerprint":"ai-optimization::.claude/skills/session-begin/SKILL.md::duplicate-context-load-steps","severity":"S3","effort":"E0","confidence":83,"files":[".claude/skills/session-begin/SKILL.md"],"why_it_matters":"Repeated mandatory instructions (e.g., reading ROADMAP Active Sprint in multiple sections) add avoidable context and operator overhead each session. This is small per run but persistent across all sessions.","suggested_fix":"Deduplicate repeated checklist items into a single canonical step and reference it later by anchor instead of repeating prose.","acceptance_tests":["Verify ROADMAP read requirement appears once as canonical instruction.","Run session-begin and confirm no required behavior is lost.","Measure instruction token count before/after and target a reduction of at least 10%."],"evidence":[".claude/skills/session-begin/SKILL.md:124-126 requires reading ROADMAP Active Sprint.",".claude/skills/session-begin/SKILL.md:176-177 repeats reading ROADMAP Active Sprint.","Command: nl -ba .claude/skills/session-begin/SKILL.md | sed -n '118,182p'"],"sources":[{"source":"codex","file":"ai-optimization-codex.jsonl","original_fingerprint":"ai-optimization::.claude/skills/session-begin/SKILL.md::duplicate-context-load-steps"}],"verified":true,"consensus_score":2,"canonical_id":"CANON-0058","status":"CONFIRMED","cross_cutting":false,"categories":["ai-optimization"],"priority_score":19.2,"unified_id":"UNIFIED-0053"}
{"category":"ai-optimization","title":"Audit skill templates have high duplication and could be parameterized","fingerprint":"ai-optimization::.claude/skills/audit-/SKILL.md::audit-skill-overlap","severity":"S2","effort":"E2","confidence":81,"files":[".claude/skills/audit-code/SKILL.md",".claude/skills/audit-security/SKILL.md"],"why_it_matters":"Large duplicated prompt scaffolding increases context token load and maintenance cost; fixes must be replicated across multiple long SKILL.md files, increasing drift risk.","suggested_fix":"Extract shared sections (execution-mode table, pre-audit validation framework, checkpoint schema, output protocol) into a referenced base template and keep only domain-specific deltas per skill.","acceptance_tests":["Run a similarity check and reduce duplicated content between audit skills by at least 30%.","Verify all audit skills still render required domain-specific steps after templating.","Confirm one shared update (e.g., protocol tweak) propagates across all audit skills without manual copy edits."],"evidence":[".claude/skills/audit-code/SKILL.md:12-20 and .claude/skills/audit-security/SKILL.md:12-20 contain near-identical execution-mode matrices.",".claude/skills/audit-code/SKILL.md:114-203 and .claude/skills/audit-security/SKILL.md:147-247 mirror pre-audit validation structure and flow.","Command: Python difflib SequenceMatcher reported 0.63 similarity for audit-code vs audit-security."],"sources":[{"source":"codex","file":"ai-optimization-codex.jsonl","original_fingerprint":"ai-optimization::.claude/skills/audit-/SKILL.md::audit-skill-overlap"}],"verified":true,"consensus_score":2,"canonical_id":"CANON-0017","status":"CONFIRMED","cross_cutting":false,"categories":["ai-optimization"],"priority_score":19.1,"unified_id":"UNIFIED-0054"}
{"category":"ai-optimization","title":"Session-start hook is 505 lines with inline prompts >10 lines","fingerprint":"ai-optimization::.claude/hooks/session-start.js::hook-bloat","severity":"S2","effort":"E2","confidence":82,"files":[".claude/hooks/session-start.js"],"why_it_matters":"Session-start.js is 505 lines (16.7KB) and runs on EVERY session start. Large hooks on the critical path add latency and consume tokens before any user work begins. Contains verbose console output and inline formatting.","suggested_fix":"Move non-critical checks to PostToolUse hooks, extract verbose output to a separate debug module, use progressive disclosure (only show details on --verbose flag).","acceptance_tests":["Hook < 200 lines for critical path","Non-critical checks moved to lazy evaluation","Console output reduced by 50%"],"evidence":["505 lines (453 loc) · 16.7 KB","console.log('🚀 SessionStart Hook for sonash-v0') - verbose emoji output","Sequential execSync calls for version checks"],"sources":[{"source":"kimik2","file":"ai-optimization-kimik2.jsonl","original_fingerprint":"ai-optimization::.claude/hooks/session-start.js::hook-bloat"}],"verified":true,"consensus_score":2,"canonical_id":"CANON-0045","status":"CONFIRMED","cross_cutting":false,"categories":["ai-optimization"],"priority_score":19.1,"unified_id":"UNIFIED-0055"}
{"category":"ai-optimization","title":"State JSONL files growing without bounds - reviews.jsonl is 18.6KB","fingerprint":"ai-optimization::.claude/state/reviews.jsonl::unbounded-growth","severity":"S2","effort":"E2","confidence":80,"files":[".claude/state/reviews.jsonl",".claude/state/health-score-log.jsonl",".claude/state/hook-warnings-log.jsonl"],"why_it_matters":"reviews.jsonl is 18.6KB with 31 lines and growing with each PR. Without rotation or compaction, these files will exceed 100KB quickly, slowing down hook operations that read them.","suggested_fix":"Implement log rotation in compaction-handoff.js - archive entries older than 30 days to .claude/state/archive/, keep only last 50 entries in active file.","acceptance_tests":["Log rotation script runs daily","Archive directory contains dated backups","Active files stay under 50KB"],"evidence":["reviews.jsonl: 31 lines · 18.6 KB","Last commit shows daily updates to state files","No rotation logic visible in compaction-handoff.js filename"],"sources":[{"source":"kimik2","file":"ai-optimization-kimik2.jsonl","original_fingerprint":"ai-optimization::.claude/state/reviews.jsonl::unbounded-growth"}],"verified":true,"consensus_score":2,"canonical_id":"CANON-0047","status":"CONFIRMED","cross_cutting":false,"categories":["ai-optimization"],"priority_score":19,"unified_id":"UNIFIED-0056"}
{"category":"ai-optimization","title":"session-start.js reads full reviews.jsonl for a single count check","fingerprint":"ai-optimization::.claude/hooks/session-start.js::reviews-jsonl-full-read-rotation-check","severity":"S3","effort":"E0","confidence":80,"files":[".claude/hooks/session-start.js"],"why_it_matters":"Reads entire reviews.jsonl (19KB), splits, counts entries for rotation threshold. A sidecar count file would suffice.","suggested_fix":"Track count in reviews-meta.json sidecar file.","acceptance_tests":["Does not read full reviews.jsonl at startup","Rotation still triggers at 50-entry threshold"],"evidence":["session-start.js lines 427-452: reads full file for count only","reviews.jsonl: 19KB with 31 entries"],"sources":[{"source":"claude","file":"ai-optimization-claude.jsonl","original_fingerprint":"ai-optimization::.claude/hooks/session-start.js::reviews-jsonl-full-read-rotation-check"}],"verified":true,"consensus_score":2,"canonical_id":"CANON-0056","status":"CONFIRMED","cross_cutting":false,"categories":["ai-optimization"],"priority_score":19,"unified_id":"UNIFIED-0057"}
{"category":"ai-optimization","title":"MCP servers configured but 4 are disabled — disabled list should match actual config","fingerprint":"ai-optimization::.claude/settings.json::disabled-mcp-servers","severity":"S3","effort":"E0","confidence":80,"files":[".claude/settings.json",".claude/mcp.global-template.json"],"why_it_matters":"settings.json disables 4 MCP servers (rube, serena, nextjs-devtools, filesystem) but mcp.global-template.json only defines 2 servers (ccusage, playwright). The disabled servers reference names that don't appear in the template, suggesting stale configuration from removed MCP servers.","suggested_fix":"Remove disabled server names that no longer exist in any MCP config. Document which MCP servers are intentionally disabled and why.","acceptance_tests":["disabledMcpjsonServers only contains names that exist in .mcp.json","Stale server names are removed","A comment or doc explains disabled servers"],"evidence":["settings.json line 6: disabledMcpjsonServers: [\"rube\", \"serena\", \"nextjs-devtools\", \"filesystem\"]","mcp.global-template.json only defines: ccusage, playwright","The disabled servers may be in .mcp.json (user-local file not in repo) — confidence adjusted"],"sources":[{"source":"copilot","file":"ai-optimization-copilot.jsonl","original_fingerprint":"ai-optimization::.claude/settings.json::disabled-mcp-servers"}],"verified":true,"consensus_score":2,"canonical_id":"CANON-0059","status":"CONFIRMED","cross_cutting":false,"categories":["ai-optimization"],"priority_score":19,"unified_id":"UNIFIED-0058"}
{"category":"ai-optimization","title":"Skills read entire large files when only headers/sections needed","fingerprint":"ai-optimization::.claude/skills/*/SKILL.md::full-file-read","severity":"S2","effort":"E2","confidence":78,"files":[".claude/skills/session-begin/",".claude/skills/audit-ai-optimization/SKILL.md"],"why_it_matters":"Skills appear to load full SKILL.md files (600+ lines) into context when only specific sections are needed for a given task. This wastes hundreds of tokens per skill invocation.","suggested_fix":"Implement section-based loading with markers (<!-- SECTION:quickref -->), read only required sections based on task parameters.","acceptance_tests":["Section markers in all SKILL.md files","Only required sections loaded per task","Token usage reduced by 30% for skill calls"],"evidence":["SKILL.md files average 400-600 lines","No section markers visible in audit-ai-optimization/SKILL.md","Progressive disclosure tiers mentioned but not enforced"],"sources":[{"source":"kimik2","file":"ai-optimization-kimik2.jsonl","original_fingerprint":"ai-optimization::.claude/skills/*/SKILL.md::full-file-read"}],"verified":true,"consensus_score":1.5,"canonical_id":"CANON-0050","status":"SUSPECTED","cross_cutting":false,"categories":["ai-optimization"],"priority_score":16.4,"unified_id":"UNIFIED-0059"}
{"category":"ai-optimization","title":"doc-optimizer and audit-process SKILL.md exceed 1500 lines without modularization","fingerprint":"ai-optimization::.claude/skills::oversized-skill-md-files","severity":"S2","effort":"E2","confidence":75,"files":[".claude/skills/doc-optimizer/SKILL.md",".claude/skills/audit-process/SKILL.md",".claude/skills/audit-documentation/SKILL.md",".claude/skills/multi-ai-audit/SKILL.md"],"why_it_matters":"doc-optimizer (1735 lines) and audit-process (1525 lines) loaded in full, adding 3000-5000 tokens.","suggested_fix":"Extract per-agent prompt templates to reference/ subdirectories.","acceptance_tests":["Both SKILL.md files <600 lines","Extracted content in reference/ subdirectories"],"evidence":["wc -l: doc-optimizer 1735, audit-process 1525, audit-documentation 1000, multi-ai-audit 948"],"sources":[{"source":"claude","file":"ai-optimization-claude.jsonl","original_fingerprint":"ai-optimization::.claude/skills::oversized-skill-md-files"}],"verified":true,"consensus_score":1.5,"canonical_id":"CANON-0048","status":"SUSPECTED","cross_cutting":false,"categories":["ai-optimization"],"priority_score":16.3,"unified_id":"UNIFIED-0060"}
{"category":"ai-optimization","title":"10 audit skills share >50% identical structure without shared base","fingerprint":"ai-optimization::.claude/skills/audit-*/SKILL.md::skill-overlap","severity":"S2","effort":"E3","confidence":85,"files":[".claude/skills/audit-code/SKILL.md",".claude/skills/audit-documentation/SKILL.md",".claude/skills/audit-performance/SKILL.md",".claude/skills/audit-security/SKILL.md",".claude/skills/audit-refactoring/SKILL.md",".claude/skills/audit-process/SKILL.md",".claude/skills/audit-enhancements/SKILL.md",".claude/skills/audit-engineering-productivity/SKILL.md",".claude/skills/audit-health/SKILL.md"],"why_it_matters":"All 9 audit skills follow identical 3-stage parallel agent pattern with duplicated CRITICAL sections, persistence rules, and return protocols. This is maintenance overhead and bloats the skill index.","suggested_fix":"Create base audit skill template with common sections, use skill parameters to specify audit domain. Consolidate into /audit --domain=code|documentation|performance|security.","acceptance_tests":["Single base audit skill with domain parameter","9 individual skills reference base template","SKILL_INDEX.md updated to show parameterized usage"],"evidence":["SKILL_INDEX.md shows 9 separate audit skills","All audit skills have 'Stage 1/2/3' structure","All contain identical 'CRITICAL RETURN PROTOCOL' section"],"sources":[{"source":"kimik2","file":"ai-optimization-kimik2.jsonl","original_fingerprint":"ai-optimization::.claude/skills/audit-*/SKILL.md::skill-overlap"}],"verified":true,"consensus_score":2,"canonical_id":"CANON-0046","status":"CONFIRMED","cross_cutting":false,"categories":["ai-optimization"],"priority_score":14.6,"unified_id":"UNIFIED-0061"}
{"category":"ai-optimization","title":"Multiple hooks duplicate loadJson/saveJson atomic write pattern","fingerprint":"ai-optimization::.claude/hooks/multiple::duplicated-json-io","severity":"S3","effort":"E1","confidence":85,"files":[".claude/hooks/post-read-handler.js",".claude/hooks/compaction-handoff.js",".claude/hooks/pre-compaction-save.js"],"why_it_matters":"At least 3 hooks implement their own loadJson/saveJson functions with atomic write (temp file + rename) and symlink guard integration. The state-utils.js module already provides readState/writeState but some hooks don't use it, duplicating the atomic write pattern with slight variations.","suggested_fix":"Standardize on state-utils.js for all JSON state I/O. Extend it if needed for non-state-directory paths.","acceptance_tests":["All hooks use state-utils.js or a single shared JSON I/O module","No duplicated atomic-write implementations remain","Existing functionality unchanged"],"evidence":["post-read-handler.js lines 86-155: loadJson + saveJson with backup-swap","compaction-handoff.js lines 66-84: loadJson + saveJson","state-utils.js already exports readState/writeState with atomic writes"],"sources":[{"source":"copilot","file":"ai-optimization-copilot.jsonl","original_fingerprint":"ai-optimization::.claude/hooks/multiple::duplicated-json-io"}],"verified":true,"consensus_score":2,"canonical_id":"CANON-0060","status":"CONFIRMED","cross_cutting":false,"categories":["ai-optimization"],"priority_score":14.6,"unified_id":"UNIFIED-0062"}
{"category":"ai-optimization","title":"health-score-log.jsonl and hook-warnings-log.jsonl grow unboundedly — no rotation","fingerprint":"ai-optimization::.claude/state::unbounded-jsonl-logs-no-rotation","severity":"S3","effort":"E1","confidence":80,"files":[".claude/state/health-score-log.jsonl",".claude/state/hook-warnings-log.jsonl"],"why_it_matters":"reviews.jsonl has rotation. health-score-log and hook-warnings-log have none. rotateJsonl() exists but only applied to reviews.jsonl.","suggested_fix":"Apply rotateJsonl() to both files in session-start.js.","acceptance_tests":["health-score-log never exceeds 30 entries","hook-warnings-log never exceeds 50 entries"],"evidence":["session-start.js: rotation NOT applied to other logs","health-score-log.jsonl: 8 entries growing","hook-warnings-log.jsonl: 16 entries growing"],"sources":[{"source":"claude","file":"ai-optimization-claude.jsonl","original_fingerprint":"ai-optimization::.claude/state::unbounded-jsonl-logs-no-rotation"}],"verified":true,"consensus_score":2,"canonical_id":"CANON-0057","status":"CONFIRMED","cross_cutting":false,"categories":["ai-optimization"],"priority_score":14.5,"unified_id":"UNIFIED-0063"}
{"category":"ai-optimization","title":"Remote-branch parsing relies on delimiter split that can break on format drift","fingerprint":"ai-optimization::.claude/hooks/check-remote-session-context.js::fragile-branch-line-split","severity":"S3","effort":"E1","confidence":78,"files":[".claude/hooks/check-remote-session-context.js"],"why_it_matters":"The parser assumes git branch --format will always contain exactly one | delimiter and directly splits into two fields. Minor output format changes can silently corrupt date parsing and skip useful branch comparisons.","suggested_fix":"Parse with a safer structured format (e.g., NUL-delimited fields via %x00) or split once with validation and explicit fallback logging.","acceptance_tests":["Inject malformed/multi-delimiter branch lines in tests and confirm parser rejects safely.","Verify branch/date extraction still works across Linux/macOS git versions.","Ensure bad lines are logged once and do not abort the full check."],"evidence":[".claude/hooks/check-remote-session-context.js:143 uses pipe-delimited git format.",".claude/hooks/check-remote-session-context.js:151-153 uses const [branch, dateStr] = line.split(\"|\") without field-count validation.","Command: nl -ba .claude/hooks/check-remote-session-context.js | sed -n '135,156p'"],"sources":[{"source":"codex","file":"ai-optimization-codex.jsonl","original_fingerprint":"ai-optimization::.claude/hooks/check-remote-session-context.js::fragile-branch-line-split"}],"verified":true,"consensus_score":1.5,"canonical_id":"CANON-0064","status":"SUSPECTED","cross_cutting":false,"categories":["ai-optimization"],"priority_score":12,"unified_id":"UNIFIED-0064"}
{"category":"ai-optimization","title":"Shell script hooks may be redundant with Node.js versions","fingerprint":"ai-optimization::.claude/hooks/*.sh::redundant-shell-scripts","severity":"S3","effort":"E1","confidence":78,"files":[".claude/hooks/session-start.sh",".claude/hooks/analyze-user-request.sh",".claude/hooks/pattern-check.sh",".claude/hooks/check-mcp-servers.sh"],"why_it_matters":"Multiple .sh files exist alongside .js versions (session-start.sh + session-start.js). Based on commit messages, the project migrated to Node.js hooks for cross-platform compatibility. Shell versions may be orphaned.","suggested_fix":"Verify shell scripts are not referenced in .claude/settings.json or hooks.json, then archive to .claude/hooks/archive/ if truly unused.","acceptance_tests":["No .sh files referenced in settings.json","All hooks use Node.js versions exclusively","Shell scripts archived or deleted"],"evidence":["session-start.sh exists alongside session-start.js","Commit: 'Cross-platform replacement for session-start.sh'","analyze-user-request.sh + analyze-user-request.js pair exists"],"sources":[{"source":"kimik2","file":"ai-optimization-kimik2.jsonl","original_fingerprint":"ai-optimization::.claude/hooks/*.sh::redundant-shell-scripts"}],"verified":true,"consensus_score":1.5,"canonical_id":"CANON-0065","status":"SUSPECTED","cross_cutting":false,"categories":["ai-optimization"],"priority_score":12,"unified_id":"UNIFIED-0065"}