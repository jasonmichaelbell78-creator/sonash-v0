{
  "plan_version": "1.5",
  "audits_included_count": 5,
  "ordering_rule": "S0 first, then S1/E0-E1, then S1/E2, then S2, then S3, then E3 refactors",
  "steps": [
    {
      "priority": 1,
      "canonical_ids": ["PERF-001"],
      "impact_label": "S0",
      "effort_label": "E1",
      "action": "Fix useJournal snapshot lifecycle so onSnapshot unsubscribe is always called on unmount and user switch.",
      "success_check": "Navigate away/back repeatedly; verify only one active journal listener and no duplicate updates."
    },
    {
      "priority": 2,
      "canonical_ids": ["PERF-016"],
      "impact_label": "S2",
      "effort_label": "E0",
      "action": "Remove/gate console.* and route errors to logger/Sentry.",
      "success_check": "grep console\\. returns ~0 for production files; production console is quiet; errors still captured."
    },
    {
      "priority": 3,
      "canonical_ids": ["PERF-003"],
      "impact_label": "S1",
      "effort_label": "E1",
      "action": "Fix TodayPage effect deps to stop resubscribe-on-keystroke behavior.",
      "success_check": "Typing does not change listener count; no frequent subscribe/unsubscribe cycles."
    },
    {
      "priority": 4,
      "canonical_ids": ["PERF-002"],
      "impact_label": "S2",
      "effort_label": "E1",
      "action": "Remove redundant auth listener from useJournal; consume AuthProvider state.",
      "success_check": "Only one auth subscription exists; journal still loads/updates correctly."
    },
    {
      "priority": 5,
      "canonical_ids": ["PERF-017", "PERF-023"],
      "impact_label": "S2",
      "effort_label": "E1",
      "action": "Gate reCAPTCHA loading + move soft-delete filtering into Firestore query.",
      "success_check": "reCAPTCHA script absent on non-auth flows; journal reads fewer docs and no client-side drop filter needed."
    },
    {
      "priority": 6,
      "canonical_ids": ["PERF-018", "PERF-019", "PERF-020", "PERF-027"],
      "impact_label": "S2-S3",
      "effort_label": "E0-E1",
      "action": "Wire Sentry client init + add Web Vitals instrumentation; fix crypto polyfill risk; adjust traces sampling as needed.",
      "success_check": "Sentry receives client errors + vitals/traces; bundle does not gain unexpected polyfills."
    },
    {
      "priority": 7,
      "canonical_ids": ["PERF-004", "PERF-024", "PERF-005"],
      "impact_label": "S1-S2",
      "effort_label": "E2",
      "action": "Code-split landing/notebook: dynamic import NotebookShell, split notebook pages per tab, keep Framer out of the initial route where possible.",
      "success_check": "Notebook chunks load only after interaction; first-load JS drops measurably; Lighthouse FCP/LCP improve."
    },
    {
      "priority": 8,
      "canonical_ids": ["PERF-012", "PERF-022"],
      "impact_label": "S2",
      "effort_label": "E1-E2",
      "action": "Stop full-collection quote reads; cache daily selection; add caching/dedup layer for non-realtime reads.",
      "success_check": "Firestore reads decrease; quote loads fast; repeated mounts do not refetch full collections."
    },
    {
      "priority": 9,
      "canonical_ids": ["PERF-010", "PERF-011", "PERF-025"],
      "impact_label": "S2-S3",
      "effort_label": "E1-E2",
      "action": "Virtualize entry list + paginate journal loads; reduce snapshot processing churn; avoid double-grouping.",
      "success_check": "Scroll stays smooth at 100+ entries; CPU time on filtering/grouping drops."
    },
    {
      "priority": 10,
      "canonical_ids": ["PERF-006", "PERF-007"],
      "impact_label": "S1-S2",
      "effort_label": "E1",
      "action": "Implement a static-friendly image optimization pipeline (responsive formats + preload/image-set) given export/unoptimized constraints.",
      "success_check": "Hero image bytes drop; LCP improves; correct variants served across viewports."
    },
    {
      "priority": 11,
      "canonical_ids": ["PERF-013", "PERF-014", "PERF-015"],
      "impact_label": "S2",
      "effort_label": "E2",
      "action": "Admin pagination, map clustering/fitBounds stabilization, confetti optimization/canvas confetti.",
      "success_check": "Admin loads fast on large datasets; map stays responsive; celebrations don't tank FPS."
    },
    {
      "priority": 12,
      "canonical_ids": ["PERF-009", "PERF-008", "PERF-026", "PERF-028"],
      "impact_label": "S1-S3",
      "effort_label": "E1-E3",
      "action": "Split/memoize Step1WorksheetCard; reduce 'use client' footprint; audit event/timer cleanup; remove unused deps.",
      "success_check": "Renders drop in profiler; client bundle shrinks; fewer long-session leaks; faster installs/CI."
    }
  ]
}
