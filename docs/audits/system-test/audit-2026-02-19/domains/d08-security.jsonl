{"id":"SYST-2026-02-19-D08-001","domain":8,"domain_name":"Security Headers & CSP","check_id":"8.1","severity":"S1","effort":"E0","category":"security","title":"Permissions-Policy blocks microphone despite voice-text-area feature","description":"firebase.json sets Permissions-Policy: microphone=() which blocks the Web Speech Recognition API used by voice-text-area.tsx. The header actively prevents a shipped feature from working.","file":"firebase.json","line":53,"evidence":["firebase.json:53 — Permissions-Policy value: geolocation=(), microphone=(), camera=(), payment=(), usb=()","components/ui/voice-text-area.tsx uses Web Speech Recognition API (SpeechRecognition) which requires microphone permission","microphone=() denies all origins including self — blocks webkitSpeechRecognition"],"confidence":"HIGH","recommendation":"Change to microphone=(self) in firebase.json Permissions-Policy header value to allow self-origin microphone access while blocking third-party access.","verification_steps":{"first_pass":{"method":"grep","evidence_collected":["grep microphone firebase.json → Permissions-Policy: microphone=()"]},"second_pass":{"method":"contextual_review","confirmed":true},"tool_confirmation":{"tool":"NONE","result":"confirmed — Permissions-Policy explicitly blocks microphone for all origins","reference":"firebase.json:53"}},"suggested_fix":"Change to microphone=(self) in firebase.json Permissions-Policy header value to allow self-origin microphone access while blocking third-party access.","status":"accepted","suggestion_text":"Accept at S1. The header actively breaks a shipped voice input feature. Fix is trivial (E0).","counter_argument":"If voice-text-area is development/testing only and not shipped to production users, the restrictive header is correct security posture.","related_findings":["D06-010"],"detected_at":"2026-02-19T13:40:00Z","reviewed_at":"2026-02-19T13:42:00Z"}
{"id":"SYST-2026-02-19-D08-002","domain":8,"domain_name":"Security Headers & CSP","check_id":"8.2","severity":"S2","effort":"E1","category":"security","title":"No Content-Security-Policy header configured","description":"No CSP header found in firebase.json hosting configuration. The app loads external scripts (reCAPTCHA Enterprise from google.com, Sentry monitoring) without CSP restrictions, allowing potential XSS vectors to load arbitrary external resources.","recommendation":"Add Content-Security-Policy header to firebase.json with script-src, connect-src, and style-src directives.","file":"firebase.json","line":30,"evidence":"firebase.json hosting.headers[] contains X-Frame-Options, X-Content-Type-Options, HSTS, Referrer-Policy, Permissions-Policy — but no Content-Security-Policy header.","suggested_fix":"Add CSP header to firebase.json catch-all headers: default-src 'self'; script-src 'self' https://www.google.com/recaptcha/ https://www.gstatic.com/recaptcha/ https://*.sentry.io; frame-src https://www.google.com/recaptcha/; connect-src 'self' https://*.firebaseio.com https://*.googleapis.com https://*.sentry.io; style-src 'self' 'unsafe-inline'; img-src 'self' data: https:; object-src 'none'","status":"accepted","suggestion_text":"Accept at S2. CSP is a defense-in-depth measure. Without it, any XSS vulnerability allows unrestricted script execution and data exfiltration.","counter_argument":"React auto-escapes JSX reducing XSS risk significantly. Firebase Auth uses tokens not cookies, limiting session theft. Adding CSP with external scripts (reCAPTCHA, Sentry, Leaflet) requires careful allowlisting and testing.","related_findings":[],"detected_at":"2026-02-19T13:40:00Z","reviewed_at":"2026-02-19T13:42:00Z"}
{"id":"SYST-2026-02-19-D08-003","domain":8,"domain_name":"Security Headers & CSP","check_id":"8.3","severity":"S2","effort":"E1","category":"security","title":"HSTS missing preload and includeSubDomains directives","description":"firebase.json sets Strict-Transport-Security: max-age=63072000 but omits includeSubDomains and preload directives. Without includeSubDomains, subdomains can be served over HTTP. Without preload, the domain cannot be submitted to the HSTS preload list.","recommendation":"Add includeSubDomains and preload directives to HSTS header in firebase.json.","file":"firebase.json","line":37,"evidence":"firebase.json:37 — Strict-Transport-Security: max-age=63072000 (missing includeSubDomains; preload)","suggested_fix":"Change to: Strict-Transport-Security: max-age=63072000; includeSubDomains; preload","status":"accepted","suggestion_text":"Accept at S2. Missing directives weaken HSTS. includeSubDomains prevents subdomain downgrade attacks.","counter_argument":"Firebase Hosting enforces HTTPS at the infrastructure level. Adding preload requires commitment — cannot easily undo. If no subdomains exist, includeSubDomains has no practical effect.","related_findings":["D08-002"],"detected_at":"2026-02-19T13:40:00Z","reviewed_at":"2026-02-19T13:42:00Z"}
{"id":"SYST-2026-02-19-D08-004","domain":8,"domain_name":"Security Headers & CSP","check_id":"8.5","severity":"S3","effort":"E0","category":"security","title":"Referrer-Policy set to strict-origin could be stricter","description":"firebase.json sets Referrer-Policy: strict-origin which sends the origin on cross-origin requests. For a recovery community app handling sensitive data, strict-origin-when-cross-origin or no-referrer would provide stronger privacy protection by not leaking the origin to external services.","file":"firebase.json","line":49,"evidence":"firebase.json:49 — Referrer-Policy: strict-origin","suggested_fix":"Change to Referrer-Policy: strict-origin-when-cross-origin (preserves path info for same-origin, origin-only for cross-origin) or no-referrer for maximum privacy.","status":"accepted","suggestion_text":"Accept at S3. Current policy is adequate but could be stricter for a privacy-sensitive recovery app.","counter_argument":"strict-origin is already a good default. no-referrer breaks analytics and Sentry error context. The origin alone (sonash.app) doesn't leak sensitive information.","related_findings":[],"detected_at":"2026-02-19T13:40:00Z","reviewed_at":"2026-02-19T13:42:00Z"}
