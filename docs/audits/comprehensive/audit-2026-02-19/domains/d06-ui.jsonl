{"id":"COMP-2026-02-19-D06-001","domain":6,"domain_name":"UI Components & Accessibility","check_id":"6.1","severity":"S1","effort":"E2","category":"code-quality","title":"Single root ErrorBoundary — no granular error boundaries in page sections","description":"Only one ErrorBoundary exists in app/layout.tsx wrapping all children. No route-specific error.tsx, loading.tsx, or not-found.tsx files exist. No component-level error boundaries around Today tab, Journal feed, Growth cards, Admin tables, or Resource pages. A runtime error in any deeply nested component collapses the entire page.","file":"app/layout.tsx","line":92,"evidence":["Only boundary: <ErrorBoundary>{children}</ErrorBoundary> in layout.tsx:92","grep -r ErrorBoundary components/ returns 0 usages inside feature components","No error.tsx, loading.tsx, or not-found.tsx files in any app/ route"],"confidence":"HIGH","recommendation":"Add granular ErrorBoundary wrappers around major page sections and add Next.js error.tsx/loading.tsx files to each route.","verification_steps":{"first_pass":{"method":"code_search","evidence_collected":["app/layout.tsx:92 — single ErrorBoundary","0 error.tsx files found in app/","0 loading.tsx files found in app/"]},"second_pass":{"method":"contextual_review","confirmed":true},"tool_confirmation":{"tool":"NONE","result":"confirmed — only 1 ErrorBoundary usage in entire codebase","reference":"app/layout.tsx:92"}},"suggested_fix":"Add error.tsx and loading.tsx to each app route. Wrap major page sections with component-level error boundaries.","status":"accepted","suggestion_text":"Accept at S1. Any runtime error crashes entire app. High user impact.","counter_argument":"Root boundary prevents white screen of death. Granular boundaries are an enhancement.","related_findings":[],"detected_at":"2026-02-19T12:30:00Z"}
{"id":"COMP-2026-02-19-D06-002","domain":6,"domain_name":"UI Components & Accessibility","check_id":"6.2","severity":"S1","effort":"E1","category":"code-quality","title":"any type on Firestore DocumentSnapshot in today-page.tsx:533","description":"handleSnapshotUpdate callback uses (docSnap: any) bypassing TypeScript type safety. All subsequent property accesses are untyped.","file":"components/notebook/pages/today-page.tsx","line":533,"evidence":["(docSnap: any, isMounted: boolean) => { — line 533","All docSnap.exists(), docSnap.data() calls are untyped"],"confidence":"HIGH","recommendation":"Type as DocumentSnapshot<DocumentData> from firebase/firestore.","verification_steps":{"first_pass":{"method":"code_search","evidence_collected":["components/notebook/pages/today-page.tsx:533 — docSnap: any"]},"second_pass":{"method":"contextual_review","confirmed":true},"tool_confirmation":{"tool":"NONE","result":"confirmed — 1 any type in component parameter","reference":"components/notebook/pages/today-page.tsx:533"}},"suggested_fix":"Change (docSnap: any) to (docSnap: DocumentSnapshot<DocumentData>).","status":"accepted","suggestion_text":"Accept at S1. Type safety bypass on a critical data path.","counter_argument":"Zod validation happens server-side. Client type mismatch is caught at runtime.","related_findings":[],"detected_at":"2026-02-19T12:30:00Z"}
{"id":"COMP-2026-02-19-D06-003","domain":6,"domain_name":"UI Components & Accessibility","check_id":"6.3","severity":"S1","effort":"E2","category":"security","title":"Direct client-side Firestore write in auth-context.tsx — bypasses Cloud Functions","description":"AuthProvider directly calls updateDoc() on the users collection to set lastActive timestamp on every auth state change. This bypasses Cloud Functions middleware, server-side validation, and requires the client to hold direct write permissions.","file":"components/providers/auth-context.tsx","line":100,"evidence":["import { doc, updateDoc, serverTimestamp } from 'firebase/firestore'","await updateDoc(doc(db, 'users', currentUser.uid), { lastActive: serverTimestamp() })"],"confidence":"HIGH","recommendation":"Move lastActive update to a Cloud Function triggered via onAuthStateChanged or a callable function.","verification_steps":{"first_pass":{"method":"code_search","evidence_collected":["components/providers/auth-context.tsx:100 — updateDoc call"]},"second_pass":{"method":"contextual_review","confirmed":true},"tool_confirmation":{"tool":"NONE","result":"confirmed — direct Firestore write from client component","reference":"components/providers/auth-context.tsx:100"}},"suggested_fix":"Replace direct updateDoc with a Cloud Function call.","status":"accepted","suggestion_text":"Accept at S1. Direct client writes bypass server-side security layers.","counter_argument":"Firestore rules allow the write. The security wrapper isn't needed for a simple timestamp update.","related_findings":["DEBT-0849"],"detected_at":"2026-02-19T12:30:00Z"}
{"id":"COMP-2026-02-19-D06-004","domain":6,"domain_name":"UI Components & Accessibility","check_id":"6.4","severity":"S2","effort":"E1","category":"code-quality","title":"Console.log/error debug statements in production component today-page.tsx","description":"4 console.log/error calls in today-page.tsx guarded by NODE_ENV===development. Inconsistent with codebase logger usage. Comment confirms these are debug scaffolding.","file":"components/notebook/pages/today-page.tsx","line":639,"evidence":["console.log('Attempting to save:', saveData) — line 639","console.error('Save failed:', error) — line 665","Comment: '// DEBUG: Log what we're about to save'"],"recommendation":"Replace with logger.debug/logger.error calls.","suggested_fix":"Replace console.log/error with logger service calls.","status":"accepted","suggestion_text":"Accept at S2. Inconsistent logging pattern.","counter_argument":"Guarded by NODE_ENV check. Won't appear in production.","related_findings":[],"detected_at":"2026-02-19T12:30:00Z"}
{"id":"COMP-2026-02-19-D06-005","domain":6,"domain_name":"UI Components & Accessibility","check_id":"6.5","severity":"S2","effort":"E1","category":"code-quality","title":"useEffect async fetch without cleanup — memory leak in today-page.tsx and DailySloganWidget","description":"fetchWeeklyStats useEffect (line 740) and DailySloganWidget.tsx have no AbortController or isMounted guard. If component unmounts during async fetch, setState executes on unmounted component. DailySloganWidget also has setLoading(false) unreachable on error path — permanent spinner on fetch failure.","file":"components/notebook/pages/today-page.tsx","line":740,"evidence":["useEffect with async loadWeeklyStats — no cleanup return","DailySloganWidget.tsx:37-40 — setLoading(false) unreachable on error"],"recommendation":"Add AbortController or isMounted flag to all async useEffect operations.","suggested_fix":"Add cleanup function returning isMounted=false guard.","status":"accepted","suggestion_text":"Accept at S2. Memory leak risk and permanent loading state on error.","counter_argument":"React 18+ handles most unmount warnings gracefully.","related_findings":[],"detected_at":"2026-02-19T12:30:00Z"}
{"id":"COMP-2026-02-19-D06-006","domain":6,"domain_name":"UI Components & Accessibility","check_id":"6.6","severity":"S2","effort":"E1","category":"performance","title":"Firestore onSnapshot listener churns on every keystroke — journalEntry in dependency array","description":"today-page.tsx:605 lists journalEntry state in the onSnapshot useEffect dependency array. Every keystroke tears down and re-subscribes the real-time listener. journalEntry is not used inside the listener setup — added only for ESLint exhaustive-deps.","file":"components/notebook/pages/today-page.tsx","line":605,"evidence":["[referenceDate, user, journalEntry, handleSnapshotUpdate] — line 605","Comment: 'journalEntry added for exhaustive-deps'"],"recommendation":"Remove journalEntry from dependency array. Use useRef for collision detection instead.","suggested_fix":"Remove journalEntry from deps, use ref-based approach.","status":"accepted","suggestion_text":"Accept at S2. Excessive Firestore connection churn on user input.","counter_argument":"Firestore SDK deduplicates identical listeners internally.","related_findings":[],"detected_at":"2026-02-19T12:30:00Z"}
{"id":"COMP-2026-02-19-D06-007","domain":6,"domain_name":"UI Components & Accessibility","check_id":"6.7","severity":"S2","effort":"E1","category":"code-quality","title":"Hardcoded magic numbers and placeholder content in meeting-countdown.tsx","description":"Production widget embeds hardcoded 7 PM meeting time, 24*60*60*1000 magic number, and fake 'Evening AA - Downtown' meeting name as real UI.","file":"components/widgets/meeting-countdown.tsx","line":19,"evidence":["today7PM.setHours(19, 0, 0, 0) — hardcoded 7 PM","'Evening AA - Downtown' — fake placeholder in production UI"],"recommendation":"Extract to configuration. Use real meeting data from Firestore.","suggested_fix":"Replace hardcoded values with data from meetings collection.","status":"accepted","suggestion_text":"Accept at S2. Fake data displayed as real content confuses users.","counter_argument":"Widget may be a demo/prototype component.","related_findings":[],"detected_at":"2026-02-19T12:30:00Z"}
{"id":"COMP-2026-02-19-D06-008","domain":6,"domain_name":"UI Components & Accessibility","check_id":"6.8","severity":"S2","effort":"E1","category":"code-quality","title":"Hardcoded external URLs duplicated across 5 files","description":"External URLs (AA daily reflections, NA meditations, Google Maps directions template) are hardcoded directly in JSX without centralized constants. Google Maps template duplicated in 3 files.","file":"components/notebook/pages/today-page.tsx","line":903,"evidence":["AA/NA URLs in today-page.tsx:903,911","Google Maps template duplicated in meeting-map.tsx:141, meeting-details-dialog.tsx:98, resources-page.tsx:492"],"recommendation":"Extract URLs to a constants/urls.ts file.","suggested_fix":"Create centralized URL constants module.","status":"accepted","suggestion_text":"Accept at S2. URL changes require code deployments and multi-file edits.","counter_argument":"URLs rarely change. Abstraction adds indirection.","related_findings":[],"detected_at":"2026-02-19T12:30:00Z"}
{"id":"COMP-2026-02-19-D06-009","domain":6,"domain_name":"UI Components & Accessibility","check_id":"6.9","severity":"S3","effort":"E0","category":"code-quality","title":"Missing or unstable key props in map renders","description":"SpotCheckCard.tsx:207 renders array without key props. quick-actions-fab.tsx:77 uses array index as key.","file":"components/growth/SpotCheckCard.tsx","line":207,"evidence":["['Selfish','Dishonest',...].map((abs) => <label>{abs}</label>) — no key","actions.map((action, index) => <button key={index}>) — unstable key"],"suggested_fix":"Use unique string values as keys for inline arrays. Use action.id for dynamic lists.","status":"accepted","suggestion_text":"Accept at S3. Minor React reconciliation issue.","counter_argument":"Static arrays with stable order. Index keys are acceptable here.","related_findings":[],"detected_at":"2026-02-19T12:30:00Z"}
