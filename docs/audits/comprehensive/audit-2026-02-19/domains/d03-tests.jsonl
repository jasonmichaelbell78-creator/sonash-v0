{"id":"COMP-2026-02-19-D03-001","domain":3,"domain_name":"Test Suite","check_id":"3.4","severity":"S1","effort":"E3","category":"testing","title":"Cloud Functions have zero test coverage — 5000+ lines of server code untested","description":"functions/src/ contains 9 TypeScript files (index.ts ~486 lines, admin.ts ~3100 lines, scheduled.ts, security-logger.ts, etc.) with no corresponding test files. This is the highest-risk untested code: auth, data mutations, admin operations, soft-delete, migration.","file":"functions/src/","line":0,"evidence":"Glob functions/src/**/*.test.ts: 0 files. Test runner output shows 294 tests across 20 test files, ALL in tests/ directory (client-side code only).","suggested_fix":"Start with unit tests for validation logic in functions/src/schemas.ts and security-wrapper.ts. Integration tests require Firebase emulator setup.","status":"accepted","suggestion_text":"Accept at S1. Cloud Functions handle auth, data mutations, and admin operations with no test coverage. This is the highest-risk untested code in the project.","counter_argument":"Integration testing Cloud Functions requires Firebase emulator setup (E3 effort). Unit testing the validation/business logic portions is a practical first step (E2).","related_findings":[],"detected_at":"2026-02-19T01:50:00Z"}
{"id":"COMP-2026-02-19-D03-002","domain":3,"domain_name":"Test Suite","check_id":"3.7","severity":"S3","effort":"E0","category":"testing","title":"1 skipped test without linked issue — integration test for Cloud Function","description":"Test 'saves merged daily log calls Cloud Function' is skipped with comment 'Requires Firebase Cloud Functions - integration test'. No linked issue tracking when this will be addressed.","file":"tests/firestore-service.test.ts","line":149,"evidence":"﹣ saves merged daily log calls Cloud Function (1.3638ms) # Requires Firebase Cloud Functions - integration test","suggested_fix":"Create a tracking issue for Cloud Functions integration test setup, reference it in the skip comment.","status":"accepted","suggestion_text":"Accept at S3. Single skip with clear reason. Low priority but should link to an issue.","counter_argument":"The skip reason is documented inline. Creating an issue adds overhead for a known gap.","related_findings":["COMP-2026-02-19-D03-001"],"detected_at":"2026-02-19T01:50:00Z"}
{"id":"COMP-2026-02-19-D03-003","domain":3,"domain_name":"Test Suite","check_id":"3.2","severity":"S2","effort":"E2","category":"testing","title":"No coverage configuration or thresholds — coverage is not measured","description":"No vitest.config.ts file exists (tests use Node.js native test runner via tsconfig.test.json + tsc). No coverage tooling is configured. Cannot determine what percentage of code is tested.","file":"package.json","line":0,"evidence":"vitest.config.ts does not exist. Test command: 'node --test dist-tests/tests/**/*.test.js'. No coverage flags or c8/v8 coverage config.","suggested_fix":"Add c8 for coverage: 'c8 node --test dist-tests/tests/**/*.test.js'. Set threshold at 50% minimum.","status":"accepted","suggestion_text":"Accept at S2. Without coverage measurement, we can't know what's tested. The 20 test files likely cover a small fraction of the codebase.","counter_argument":"Coverage metrics can be misleading. The existing 294 tests cover critical paths (auth, validation, error handling). Adding coverage tooling is useful but not urgent.","related_findings":["COMP-2026-02-19-D03-001"],"detected_at":"2026-02-19T01:50:00Z"}
{"id":"COMP-2026-02-19-D03-004","domain":3,"domain_name":"Test Suite","check_id":"3.5","severity":"S2","effort":"E2","category":"testing","title":"Security utilities partially tested — secure-caller tested, account-linking not","description":"secure-caller.ts has tests (secure-caller.test.ts, firestore-validation.test.ts). However, account-linking.ts (handles anonymous-to-auth migration) has no corresponding tests despite being a critical security path.","file":"lib/firebase/account-linking.ts","line":0,"evidence":"tests/secure-caller.test.ts exists. tests/security/firestore-validation.test.ts exists. No test file for account-linking.ts.","suggested_fix":"Create tests/security/account-linking.test.ts covering: successful link, data preservation, error states, race conditions.","status":"accepted","suggestion_text":"Accept at S2. Account linking handles data migration between anonymous and authenticated accounts — a critical path that should be tested.","counter_argument":"Account linking relies heavily on Firebase Auth APIs which are hard to mock. Manual testing may be more effective for this feature.","related_findings":["COMP-2026-02-19-D03-001"],"detected_at":"2026-02-19T01:50:00Z"}
