{"category":"process","title":"Pattern compliance runs twice on PRs (CI + main)","fingerprint":"process::ci.yml::pattern-compliance-duplication","severity":"S2","effort":"E1","confidence":90,"files":[".github/workflows/ci.yml:58-75"],"why_it_matters":"Adds 10-30s to main branch CI for redundant check. PR already validated changed files, full check on merge is intentional for baseline visibility but costly.","suggested_fix":"Document this intentional duplication in comment, or add fast-path if previous PR check passed recently (cache PR check results in GitHub Actions cache).","acceptance_tests":["Verify comment added explaining why both checks exist","OR verify cache implementation speeds up main check by >50%"]}
{"category":"process","title":"Documentation check always non-blocking in CI","fingerprint":"process::ci.yml::docs-check-non-blocking","severity":"S3","effort":"E1","confidence":70,"files":[".github/workflows/ci.yml:77-80"],"why_it_matters":"Documentation violations never block CI due to continue-on-error. Templates/stubs have expected issues but active docs could degrade.","suggested_fix":"Exclude template files in check-docs-light.js (match _TEMPLATE.md pattern), remove continue-on-error for active docs.","acceptance_tests":["Template files excluded from check","continue-on-error removed from CI step","Verify active doc violations now block CI"]}
{"category":"process","title":"Build job requires full test suite for doc-only PRs","fingerprint":"process::ci.yml::build-job-unnecessary-deps","severity":"S2","effort":"E2","confidence":70,"files":[".github/workflows/ci.yml:133-136"],"why_it_matters":"Doc-only PRs must wait for full test suite before build job runs. Build may not even be needed for doc changes, wastes CI time.","suggested_fix":"Add conditional needs based on changed files (tj-actions/changed-files output), or skip build job entirely if only markdown files changed.","acceptance_tests":["Doc-only PR skips build job OR build starts immediately without test wait","Verify code PRs still require tests before build"]}
{"category":"security","title":"Firebase credentials written to disk in deployment","fingerprint":"security::deploy-firebase.yml::credentials-disk-write","severity":"S1","effort":"E1","confidence":90,"files":[".github/workflows/deploy-firebase.yml:56-65"],"why_it_matters":"Service account credentials written to $HOME/gcloud-key.json creates opportunity for leakage if runner compromised. Disk write not necessary with stdin support.","suggested_fix":"Use stdin: echo \"$FIREBASE_SERVICE_ACCOUNT\" | gcloud auth activate-service-account --key-file=- OR migrate to GitHub OIDC federation (no static credentials).","acceptance_tests":["No gcloud-key.json file created during deployment","gcloud auth succeeds via stdin","Verify deployment still works"],"verification_steps":{"first_pass":{"method":"code_search","evidence_collected":["See files array for affected locations"]},"second_pass":{"method":"manual_verification","confirmed":true,"notes":"Confirmed during audit review"},"tool_confirmation":{"tool":"NONE","reference":"No automated tool confirmation available"}}}
{"category":"process","title":"Function deletion with force flag lacks validation","fingerprint":"process::deploy-firebase.yml::function-deletion-unvalidated","severity":"S2","effort":"E2","confidence":70,"files":[".github/workflows/deploy-firebase.yml:67-74"],"why_it_matters":"Hardcoded function deletion list could delete wrong functions if list becomes stale. --force bypasses confirmation, no safeguard.","suggested_fix":"Generate deletion list dynamically: query deployed functions, diff with functions/src/*.ts exports, only delete functions not in source. OR use explicit allowlist file that must be manually updated.","acceptance_tests":["Deletion list generated from source code diff","Verify only stale functions deleted","Manual allowlist file exists and is checked"]}
{"category":"process","title":"Review thresholds very high after Session #85 adjustment","fingerprint":"process::check-review-needed.js::high-thresholds","severity":"S3","effort":"E2","confidence":50,"files":["scripts/check-review-needed.js:58-94"],"why_it_matters":"Thresholds increased 3x (commits: 75 was 25, files: 40 was 15) to reduce noise. Risk is missing gradual quality degradation over many small changes.","suggested_fix":"Add trend analysis: track violations over time (store in .github/quality-metrics.json), trigger review if violations increasing >20% even if below threshold.","acceptance_tests":["Trend tracking implemented with 5+ session history","Review triggered when trend shows degradation","Verify threshold still prevents false positive noise"]}
{"category":"documentation","title":"Archive docs excluded but could have link rot","fingerprint":"documentation::docs-lint.yml::archives-never-checked","severity":"S2","effort":"E1","confidence":70,"files":[".github/workflows/docs-lint.yml:77-80"],"why_it_matters":"Archive docs never checked for broken links/outdated info. Old docs could mislead future developers referencing history.","suggested_fix":"Add quarterly scheduled workflow (cron: 0 9 1 */3 *) to run relaxed check on archives (broken links only), or add 'Archived on DATE - may contain outdated info' headers.","acceptance_tests":["Quarterly workflow runs on archives","OR archive headers added to all archived docs"]}
{"category":"process","title":"Backlog enforcement job now obsolete after TDMS migration","fingerprint":"process::backlog-enforcement.yml::legacy-file-check","severity":"S2","effort":"E2","confidence":90,"files":[".github/workflows/backlog-enforcement.yml:32-43"],"why_it_matters":"Entire job is no-op since AUDIT_FINDINGS_BACKLOG.md archived. Job should query MASTER_DEBT.jsonl instead for actual backlog health.","suggested_fix":"Refactor job to run node scripts/debt/generate-metrics.js, parse output, enforce thresholds (S0 count > 0 = fail, total > 25 = fail). Remove legacy file check.","acceptance_tests":["Job queries MASTER_DEBT.jsonl via generate-metrics.js","S0 items block CI","Total items > threshold blocks CI"]}
{"category":"process","title":"Security patterns job only checks changed files in PRs","fingerprint":"process::backlog-enforcement.yml::limited-pr-security-scan","severity":"S3","effort":"E2","confidence":70,"files":[".github/workflows/backlog-enforcement.yml:122-154"],"why_it_matters":"Weekly run checks all files, PR run only changed files. Gradual degradation in unchanged files won't be caught until weekly run.","suggested_fix":"Sample 10-20% of unchanged files in PR runs (random selection seeded by PR number for reproducibility), flag if violations found.","acceptance_tests":["PR run samples unchanged files","Unchanged file violation detected in PR before weekly run","Verify performance impact acceptable (<30s added)"]}
{"category":"performance","title":"No caching for SonarCloud analysis","fingerprint":"performance::sonarcloud.yml::no-analysis-cache","severity":"S3","effort":"E1","confidence":70,"files":[".github/workflows/sonarcloud.yml:26-34"],"why_it_matters":"SonarCloud re-analyzes entire codebase every run. No caching of scanner intermediate artifacts.","suggested_fix":"Enable SonarCloud incremental mode (sonar.pullrequest.provider=GitHub, sonar.pullrequest.github.repository) OR cache .scannerwork/ directory between runs with actions/cache.","acceptance_tests":["SonarCloud scan time reduced >30% on unchanged code PRs","Incremental mode enabled OR cache hit logs visible"]}
{"category":"security","title":"Script injection vulnerability in resolve-debt workflow","fingerprint":"security::resolve-debt.yml::command-interpolation","severity":"S2","effort":"E1","confidence":70,"files":[".github/workflows/resolve-debt.yml:62-68"],"why_it_matters":"While PR body sanitized in extraction, outputs still interpolated in shell. If extraction has bug, arbitrary commands could execute.","suggested_fix":"Pass debt_ids via environment variable instead of command line: env: DEBT_IDS: ${{ steps.extract.outputs.debt_ids }}, read in script with process.env.DEBT_IDS.","acceptance_tests":["debt_ids passed via env var not command line","Verify script still parses IDs correctly","Test with malicious input (DEBT-123; rm -rf /) confirms no execution"]}
{"category":"process","title":"Tests run for some config changes but not all","fingerprint":"process::pre-commit::incomplete-config-test-trigger","severity":"S1","effort":"E0","confidence":90,"files":[".husky/pre-commit:54"],"why_it_matters":"Tests run for package.json and lockfiles but not eslint.config.mjs, firebase.json, firestore.rules - all can break builds. Config change not detected = broken main.","suggested_fix":"Add to risky config pattern: eslint.config.mjs, firebase.json, firestore.rules, storage.rules, *.config.mjs, *.config.ts. Full pattern: ^(package\\\\.json|.*lock\\\\.(json|yaml)|tsconfig.*\\\\.json|.*\\\\.config\\\\.(js|mjs|ts)|firebase\\\\.json|.*\\\\.rules|\\\\.husky/|\\\\.github/)","acceptance_tests":["Modify eslint.config.mjs → tests run","Modify firebase.json → tests run","Modify firestore.rules → tests run","Verify doc-only commits still skip tests"],"verification_steps":{"first_pass":{"method":"code_search","evidence_collected":["See files array for affected locations"]},"second_pass":{"method":"manual_verification","confirmed":true,"notes":"Confirmed during audit review"},"tool_confirmation":{"tool":"NONE","reference":"No automated tool confirmation available"}}}
{"category":"performance","title":"Pattern compliance runs on every commit without caching","fingerprint":"performance::pre-commit::pattern-check-no-cache","severity":"S2","effort":"E2","confidence":70,"files":[".husky/pre-commit:34-42"],"why_it_matters":"Pattern check scans all critical files every commit (~2-5s). For commits touching 1-2 files, scans entire unchanged codebase.","suggested_fix":"Implement file content hash caching in check-pattern-compliance.js: hash = SHA256(file content), cache[file][hash] = results. Only re-check if hash changed. Store cache in .git/hooks/pattern-cache.json.","acceptance_tests":["Cache file created on first run","Second commit with no pattern file changes completes <1s","Cache invalidated when file content changes"]}
{"category":"process","title":"Doc-only commit detection has false positives","fingerprint":"process::pre-commit::doc-only-jsonl-misclassification","severity":"S1","effort":"E0","confidence":90,"files":[".husky/pre-commit:71"],"why_it_matters":"JSONL treated as docs, but FALSE_POSITIVES.jsonl and MASTER_DEBT.jsonl are critical data. Changes should trigger tests. Bug risk: change TDMS schema without test run.","suggested_fix":"Exclude critical JSONL from doc-only pattern. Change grep -Ev to exclude: (?<!FALSE_POSITIVES)(?<!MASTER_DEBT)\\\\.jsonl$ OR explicitly list safe patterns: docs/.*\\\\.jsonl$ instead of .*\\\\.jsonl$","acceptance_tests":["Modify MASTER_DEBT.jsonl → tests run","Modify FALSE_POSITIVES.jsonl → tests run","Modify docs/reviews/audit.jsonl → tests still skipped (safe doc)"],"verification_steps":{"first_pass":{"method":"code_search","evidence_collected":["See files array for affected locations"]},"second_pass":{"method":"manual_verification","confirmed":true,"notes":"Confirmed during audit review"},"tool_confirmation":{"tool":"NONE","reference":"No automated tool confirmation available"}}}
{"category":"performance","title":"CANON validation scans all files when one review JSONL changes","fingerprint":"performance::pre-commit::canon-validation-overkill","severity":"S3","effort":"E1","confidence":70,"files":[".husky/pre-commit:95-103"],"why_it_matters":"Validates entire CANON corpus when any review JSONL changes. For 50+ review files, validates all when changing one (~1-2s waste).","suggested_fix":"Pass changed file list to validate-canon-schema.js: if [ -n \"$STAGED_CANON_FILES\" ]; then while read file; do node scripts/validate-canon-schema.js \"$file\"; done <<< \"$STAGED_CANON_FILES\"; fi","acceptance_tests":["Only changed JSONL file validated","Validation time <0.5s for single file change","Multi-file change still validates all changed files"]}
{"category":"process","title":"Cross-document dependency check override not implemented","fingerprint":"process::pre-commit::crossdoc-skip-not-working","severity":"S1","effort":"E0","confidence":90,"files":[".husky/pre-commit:119-131"],"why_it_matters":"Override SKIP_CROSS_DOC_CHECK=1 documented in error message but not implemented. Developers try override, it fails, confusion ensues.","suggested_fix":"Add wrapper: if [ -z \"$SKIP_CROSS_DOC_CHECK\" ]; then [existing check code] else echo \"  ⏭️ Skipping cross-doc check (SKIP_CROSS_DOC_CHECK set)\"; fi","acceptance_tests":["SKIP_CROSS_DOC_CHECK=1 git commit succeeds with cross-doc violations","Without override, violations block commit","Skip message logged when override used"],"verification_steps":{"first_pass":{"method":"code_search","evidence_collected":["See files array for affected locations"]},"second_pass":{"method":"manual_verification","confirmed":true,"notes":"Confirmed during audit review"},"tool_confirmation":{"tool":"NONE","reference":"No automated tool confirmation available"}}}
{"category":"process","title":"Doc index check doesn't account for renames intelligently","fingerprint":"process::pre-commit::doc-index-rename-false-positive","severity":"S3","effort":"E2","confidence":50,"files":[".husky/pre-commit:137-153"],"why_it_matters":"--diff-filter=ADM includes renames. Rename within same directory may not need index update (path slug unchanged), but triggers error.","suggested_fix":"Use git diff --name-status to detect renames (R100), check if old and new paths have same directory/slug, skip index check if same-directory rename: [[ \"$old_dir\" == \"$new_dir\" ]] && continue","acceptance_tests":["Rename doc within same directory → index check skipped","Rename to different directory → index check required","Add new doc → index check required as before"]}
{"category":"performance","title":"Pattern compliance runs again in pre-push after pre-commit","fingerprint":"performance::pre-push::duplicate-pattern-check","severity":"S2","effort":"E2","confidence":70,"files":[".husky/pre-push:25-35"],"why_it_matters":"Same patterns:check runs in pre-commit and pre-push. If pre-commit passed <5min ago, files unchanged, pre-push re-scan is wasted work (~2-5s).","suggested_fix":"Add timestamp cache in .git/hooks/pattern-cache.json: {\"last_run\": timestamp, \"git_head\": SHA}. In pre-push, if cache exists && last_run < 5min ago && git_head == current HEAD, skip. Otherwise run and update cache.","acceptance_tests":["Pre-push skips pattern check if pre-commit ran recently","Pre-push runs check if >5min since pre-commit","Cache invalidated if HEAD changed (rebase, amend)"]}
{"category":"process","title":"Security check skips deleted files in pre-push","fingerprint":"process::pre-push::security-skip-deleted-files","severity":"S3","effort":"E0","confidence":70,"files":[".husky/pre-push:44-78"],"why_it_matters":"[ -f \"$file\" ] || continue skips deleted files, but deleted files should be reviewed (removing security-sensitive code still needs audit).","suggested_fix":"Remove [ -f \"$file\" ] || continue line. Let security-check.js handle non-existent files gracefully (check git show HEAD:$file for pre-deletion content if needed).","acceptance_tests":["Delete file with hardcoded secret → security check runs on old content","Delete safe file → no false positive","Verify performance acceptable for typical deletes"]}
{"category":"performance","title":"npm audit runs on every push even for doc-only changes","fingerprint":"performance::pre-push::unconditional-npm-audit","severity":"S2","effort":"E1","confidence":70,"files":[".husky/pre-push:92-118"],"why_it_matters":"Audit runs unconditionally (~3-8s network call) even if no dependencies changed. Doc-only commits shouldn't need audit.","suggested_fix":"Only run if package-lock.json committed since last push: if git diff --name-only @{u}...HEAD | grep -q package-lock.json; then [run audit] else echo \"  ⏭️ No dependency changes, skipping audit\"; fi","acceptance_tests":["package-lock.json change → audit runs","No dependency change → audit skipped","First push to branch (no upstream) → audit runs (safe default)"]}
{"category":"security","title":"Trigger override logging silently fails with || true","fingerprint":"security::pre-push::silent-logging-failure","severity":"S1","effort":"E0","confidence":90,"files":[".husky/pre-push:123-126"],"why_it_matters":"|| true means if log-override.js fails (disk full, permission error), hook succeeds anyway. Override invisible to audit trail, defeats accountability.","suggested_fix":"Remove || true. If logging fails, that's a real problem: if ! node scripts/log-override.js --check=triggers --reason=\"${SKIP_REASON:-No reason}\" 2>&1; then echo \"  ❌ Failed to log override\"; exit 1; fi","acceptance_tests":["Simulate log-override.js failure (chmod 000 on log file) → hook fails","Normal override → logged successfully","Log file readable and contains override entry"],"verification_steps":{"first_pass":{"method":"code_search","evidence_collected":["See files array for affected locations"]},"second_pass":{"method":"manual_verification","confirmed":true,"notes":"Confirmed during audit review"},"tool_confirmation":{"tool":"NONE","reference":"No automated tool confirmation available"}}}
{"category":"process","title":"Some npm scripts have duplicate names with different flags","fingerprint":"process::package.json::confusing-script-names","severity":"S3","effort":"E0","confidence":50,"files":["package.json:31-32"],"why_it_matters":"learning:analyze and learning:detailed call same script with different flags. Not obvious from name what difference is without reading code.","suggested_fix":"Rename for clarity: learning:summary (default), learning:full (--detailed flag), learning:dashboard (--format dashboard). Makes purpose clear at glance.","acceptance_tests":["Script names updated in package.json","Documentation updated if scripts referenced","Verify new names more intuitive for new developers"]}
{"category":"process","title":"Missing npm script for hook recovery/reinstall","fingerprint":"process::package.json::no-hooks-reinstall","severity":"S3","effort":"E0","confidence":70,"files":["package.json:62"],"why_it_matters":"hooks:test and hooks:health exist but no easy way to reinstall hooks after corruption or permission issues. Developers must know husky commands.","suggested_fix":"Add script: \"hooks:reinstall\": \"husky install && chmod +x .husky/* && echo '✅ Hooks reinstalled'\". Provides one-command recovery.","acceptance_tests":["npm run hooks:reinstall succeeds","Hooks executable after reinstall","Works when .husky/ directory partially corrupted"]}
{"category":"process","title":"Scripts don't validate required files exist before running","fingerprint":"process::package.json::no-file-validation","severity":"S2","effort":"E1","confidence":70,"files":["package.json:42","scripts/debt/generate-metrics.js"],"why_it_matters":"npm run tdms:metrics fails with cryptic error if MASTER_DEBT.jsonl missing. No helpful message, confusing for new developers.","suggested_fix":"Add validation to generate-metrics.js: if (!fs.existsSync(DEBT_FILE)) { console.error('❌ MASTER_DEBT.jsonl not found. Initialize TDMS first: node scripts/debt/init.js'); process.exit(1); }","acceptance_tests":["Run script with missing file → clear error message","Error includes suggested fix command","Script still works when file exists"]}
{"category":"process","title":"Test build happens on every test run (slow for TDD)","fingerprint":"process::package.json::test-rebuild-always","severity":"S2","effort":"E1","confidence":70,"files":["package.json:10-11"],"why_it_matters":"npm test always runs test:build (tsc + tsc-alias). For TDD with small changes, full rebuild wastes time (~3-5s).","suggested_fix":"Add scripts: test:watch (tsc --watch on tsconfig.test.json), test:run (just node --test without build). Developer runs test:watch in separate terminal, then npm run test:run for rapid iteration.","acceptance_tests":["test:watch starts and recompiles on file change","test:run executes tests without rebuild","TDD cycle time reduced from ~10s to ~2s"]}
{"category":"process","title":"No integration test suite for critical flows","fingerprint":"process::tests::no-integration-tests","severity":"S3","effort":"E3","confidence":70,"files":["dist-tests/tests/"],"why_it_matters":"Only unit tests exist. No end-to-end or integration tests for critical flows (auth, journal CRUD, data sync). Integration bugs only caught in production.","suggested_fix":"Add tests/integration/ with playwright or vitest integration mode. Test: user login → create journal entry → verify in Firestore → logout. Start with 3-5 critical paths.","acceptance_tests":["Integration test directory created","3-5 critical flows have integration tests","Tests run in CI (new job after unit tests)"]}
{"category":"process","title":"Coverage thresholds not enforced in test:coverage","fingerprint":"process::package.json::no-coverage-threshold","severity":"S2","effort":"E0","confidence":90,"files":["package.json:12-13"],"why_it_matters":"Coverage report generated but no minimum threshold. Coverage can degrade silently over time as new code added without tests.","suggested_fix":"Add c8 flags: c8 --check-coverage --lines 70 --functions 70 --branches 70 --statements 70 [rest of command]. Blocks if coverage below threshold.","acceptance_tests":["Coverage below threshold → npm run test:coverage fails","Coverage above threshold → passes","CI enforces coverage threshold"]}
{"category":"process","title":"No source maps for production (debugging difficulty)","fingerprint":"process::next.config.mjs::no-source-maps","severity":"S3","effort":"E1","confidence":70,"files":["next.config.mjs:12-19"],"why_it_matters":"productionBrowserSourceMaps not enabled. Sentry error stack traces show minified code, making debugging hard. Trade-off: +bundle size vs debuggability.","suggested_fix":"Add productionBrowserSourceMaps: true to nextConfig. Monitor bundle size impact. Consider uploading source maps to Sentry only (not public).","acceptance_tests":["Source maps generated in production build","Sentry error shows original TypeScript line numbers","Verify bundle size increase acceptable (<10%)"]}
{"category":"process","title":"Functions predeploy doesn't validate schema changes","fingerprint":"process::firebase.json::no-function-schema-validation","severity":"S2","effort":"E2","confidence":70,"files":["firebase.json:50-52"],"why_it_matters":"Build happens but no validation that functions match Cloud Functions interface. Function could be invalid but deploy succeeds, breaks at runtime.","suggested_fix":"Add predeploy script: functions/scripts/validate-exports.js that checks each export is valid Cloud Function (onCall, onRequest, onSchedule). Parse functions/src/*.ts, validate signatures.","acceptance_tests":["Invalid function export → predeploy fails with clear error","Valid functions → predeploy succeeds","Catches common mistakes (missing async, wrong return type)"]}
{"category":"process","title":"No staging environment configuration","fingerprint":"process::firebase.json::no-staging-env","severity":"S3","effort":"E2","confidence":70,"files":["firebase.json"],"why_it_matters":"Single production config. No way to test deployments in staging before production. Risky changes go straight to prod.","suggested_fix":"Create firebase.staging.json with projectId: sonash-app-staging. Add npm script: deploy:staging. Document staging environment setup in DEVELOPMENT.md.","acceptance_tests":["firebase.staging.json created with separate project","deploy:staging script deploys to staging project","Staging environment accessible for testing"]}
{"category":"process","title":"Functions directory has separate eslint config but CI doesn't lint it","fingerprint":"process::ci.yml::functions-not-linted","severity":"S1","effort":"E1","confidence":90,"files":[".github/workflows/ci.yml:27-28","eslint.config.mjs:27"],"why_it_matters":"Root eslint ignores functions/, functions has own config, but CI never runs functions linting. Function code quality not validated.","suggested_fix":"Add CI step after main lint: - name: Lint Cloud Functions, run: npm --prefix functions run lint (requires adding \"lint\": \"eslint src/\" to functions/package.json)","acceptance_tests":["Functions linting runs in CI","Function ESLint violation blocks CI","Root and functions linting both enforced"],"verification_steps":{"first_pass":{"method":"code_search","evidence_collected":["See files array for affected locations"]},"second_pass":{"method":"manual_verification","confirmed":true,"notes":"Confirmed during audit review"},"tool_confirmation":{"tool":"NONE","reference":"No automated tool confirmation available"}}}
{"category":"process","title":"Prettier config not in repository","fingerprint":"process::prettier::no-config-file","severity":"S3","effort":"E0","confidence":50,"files":[".(root)"],"why_it_matters":"No .prettierrc or prettier.config.js found. Prettier using defaults, but team may have preferences. Config should be explicit and versioned.","suggested_fix":"Create .prettierrc.json: {\"semi\": true, \"trailingComma\": \"es5\", \"tabWidth\": 2, \"printWidth\": 100, \"singleQuote\": false, \"arrowParens\": \"always\"}. Commit to repo.","acceptance_tests":[".prettierrc.json created and committed","npm run format uses config","Verify no formatting changes if defaults already match"]}
{"category":"process","title":"Pattern compliance exclude list is manually maintained","fingerprint":"process::check-pattern-compliance.js::manual-exclude-list","severity":"S2","effort":"E2","confidence":70,"files":["scripts/check-pattern-compliance.js:45-80"],"why_it_matters":"30+ manual entries in GLOBAL_EXCLUDE. Fragile, requires updates for each new script. Easy to forget.","suggested_fix":"Automated detection: if file in scripts/migration/ OR scripts/legacy/ OR has // LEGACY_SCRIPT comment in first 5 lines, auto-exclude. Reduces manual maintenance.","acceptance_tests":["Scripts in scripts/legacy/ auto-excluded","// LEGACY_SCRIPT comment in script → auto-excluded","Remove manual entries for files with markers"]}
{"category":"process","title":"No baseline file for grandfathered pattern violations","fingerprint":"process::check-pattern-compliance.js::no-baseline","severity":"S3","effort":"E2","confidence":70,"files":["scripts/check-pattern-compliance.js"],"why_it_matters":"Old code with violations must be manually excluded. No way to accept existing violations but block new ones. Hard to track progress.","suggested_fix":"Generate patterns-baseline.json: {\"file.js\": [{pattern: \"exit-code-capture\", line: 42}]}. Check only flags new violations or changes to flagged lines. Allows gradual cleanup.","acceptance_tests":["patterns-baseline.json generated from current violations","New violation in clean file → blocked","Change to line with baseline violation → blocked","Unchanged baseline violation → allowed"]}
{"category":"security","title":"Security check doesn't scan cloud functions","fingerprint":"security::security-check.js::no-functions-scan","severity":"S2","effort":"E2","confidence":70,"files":["scripts/security-check.js"],"why_it_matters":"Frontend and scripts scanned, but functions/src/*.ts may have auth bypass, secret leakage, SQL injection. Backend security not validated.","suggested_fix":"Extend security-check.js to scan functions/src/ with backend patterns: check for admin.auth().verifyIdToken() in Cloud Functions, detect leaked secrets, check for unsafe SQL in queries.","acceptance_tests":["Functions scanned by security-check.js","Backend-specific patterns detected (auth bypass, secrets)","Pre-push runs security check on functions/"]}
{"category":"documentation","title":"Doc header check only runs on new docs (not modified)","fingerprint":"documentation::pre-commit::headers-new-only","severity":"S3","effort":"E0","confidence":70,"files":[".husky/pre-commit:158-167"],"why_it_matters":"--diff-filter=A only checks added files. Modified docs could have headers removed or made stale. Version/Last Updated could be wrong.","suggested_fix":"Change to --diff-filter=AM (added and modified). Existing docs must update Last Updated on modification.","acceptance_tests":["Modify doc without updating Last Updated → blocked","Add new doc without headers → blocked","Modify doc with header update → passes"]}
{"category":"process","title":"Documentation index generation not automated","fingerprint":"process::docs::manual-index-generation","severity":"S2","effort":"E2","confidence":70,"files":["package.json:18",".husky/pre-commit:137-153"],"why_it_matters":"Developer must manually run npm run docs:index and stage result. Hook checks if staged but doesn't auto-generate. Easy to forget.","suggested_fix":"Add PostToolUse Write hook for .md files: if .md file written, auto-run docs:index, notify user index regenerated. OR add to pre-commit with auto-staging (run docs:index, git add DOCUMENTATION_INDEX.md).","acceptance_tests":["Write .md file → index auto-regenerated","Index changes auto-staged in git","Pre-commit index check becomes redundant (always current)"]}
{"category":"process","title":"TDMS intake doesn't validate duplicate fingerprints","fingerprint":"process::intake-audit.js::no-fingerprint-dedup","severity":"S2","effort":"E1","confidence":70,"files":["scripts/debt/intake-audit.js"],"why_it_matters":"If same finding appears in multiple audits with same fingerprint, TDMS may create duplicate DEBT-XXXX entries. Backlog bloat, confusion.","suggested_fix":"Add fingerprint dedup check in intake-audit.js: before creating new entry, search existing MASTER_DEBT.jsonl for matching fingerprint. If exists && not RESOLVED, skip or update existing.","acceptance_tests":["Ingest same finding twice → only one DEBT-XXXX created","Second ingest updates existing entry or logs 'already tracked'","Verify no duplicate fingerprints in MASTER_DEBT.jsonl"]}
{"category":"process","title":"Technical debt views staleness check is non-blocking","fingerprint":"process::ci.yml::stale-views-non-blocking","severity":"S3","effort":"E1","confidence":50,"files":[".github/workflows/ci.yml:103-109"],"why_it_matters":"Stale views cause confusion (roadmap shows old data) but don't block CI. Developers may not notice views out of sync.","suggested_fix":"After initial migration period (1-2 months), remove continue-on-error to make blocking. OR add to pre-commit: if MASTER_DEBT.jsonl modified, auto-run generate-views.js and stage changes.","acceptance_tests":["Modify MASTER_DEBT.jsonl without regenerating views → CI fails","Views auto-regenerated on MASTER_DEBT.jsonl change","OR pre-commit auto-generates and stages views"]}
{"category":"performance","title":"Pre-commit total time 15-30s for code changes","fingerprint":"performance::pre-commit::total-time-slow","severity":"S2","effort":"E3","confidence":70,"files":[".husky/pre-commit"],"why_it_matters":"Total pre-commit time 15-30s for code changes impacts developer flow. Ideal is <10s. Multiple optimization opportunities compound.","suggested_fix":"Implement multiple optimizations: (1) Pattern check caching -2s, (2) Incremental CANON validation -1s, (3) Parallel checks where possible -5-10s. Requires refactoring hook to use background jobs.","acceptance_tests":["Pre-commit time reduced to <10s for typical code change","All checks still run (no functionality lost)","Measure before/after with time git commit"]}
{"category":"performance","title":"Pre-push total time 15-40s with redundant checks","fingerprint":"performance::pre-push::total-time-redundant","severity":"S2","effort":"E2","confidence":70,"files":[".husky/pre-push"],"why_it_matters":"Pre-push runs pattern check and type check that may have just run in pre-commit. For sequential commits, wastes time.","suggested_fix":"Implement caching across hooks: .git/hooks/check-cache.json stores {check: timestamp, git_head: SHA}. Skip pre-push check if pre-commit ran same check <5min ago on same HEAD.","acceptance_tests":["Commit then immediate push → pre-push skips redundant checks","Wait >5min → pre-push runs all checks","Amend commit → pre-push runs all checks (HEAD changed)"]}
{"category":"documentation","title":"No README in scripts/debt/ or scripts/lib/ directories","fingerprint":"documentation::scripts::missing-readmes","severity":"S3","effort":"E1","confidence":50,"files":["scripts/debt/","scripts/lib/"],"why_it_matters":"Key directories lack README explaining purpose, entry points, common operations. New developers must read code to understand.","suggested_fix":"Add scripts/debt/README.md: Explain TDMS scripts, common workflows (intake, resolve, metrics), file descriptions. Add scripts/lib/README.md: Explain security-helpers.js, sanitize-error.js, when to use each.","acceptance_tests":["READMEs created in both directories","READMEs document purpose and key files","Link from main DEVELOPMENT.md to these READMEs"]}
{"category":"process","title":"Lint-staged config only formats, doesn't enforce other checks","fingerprint":"process::package.json::lint-staged-limited","severity":"S3","effort":"E1","confidence":50,"files":["package.json:71-73"],"why_it_matters":"lint-staged only runs prettier --write. Could also run ESLint --fix, validate imports, etc. Misses opportunity for auto-fixing.","suggested_fix":"Extend lint-staged config: {\"*.{js,jsx,ts,tsx}\": [\"eslint --fix\", \"prettier --write\"], \"*.{json,css,md}\": [\"prettier --write\"]}. Auto-fixes more issues.","acceptance_tests":["ESLint auto-fixable issues fixed on commit","Prettier and ESLint both run on staged files","Verify no conflicts between tools"]}
{"category":"process","title":"No monitoring/alerting for CI workflow failures","fingerprint":"process::github-actions::no-failure-alerts","severity":"S2","effort":"E2","confidence":70,"files":[".github/workflows/"],"why_it_matters":"CI failures only visible in GitHub UI. No Slack/email alerts for broken main branch. Could go unnoticed for hours.","suggested_fix":"Add failure notification step to critical workflows (ci.yml, deploy-firebase.yml): uses: 8398a7/action-slack@v3 with webhook for #engineering channel. Only notify on main branch failures.","acceptance_tests":["Main branch CI failure → Slack alert sent","PR failure → no alert (expected)","Alert includes workflow name, commit SHA, error summary"]}
{"category":"security","title":"GitHub Actions secrets not rotated regularly","fingerprint":"security::github-secrets::no-rotation","severity":"S1","effort":"E1","confidence":70,"files":["Settings → Secrets"],"why_it_matters":"FIREBASE_SERVICE_ACCOUNT and other secrets likely created once, never rotated. If compromised, long window of exposure.","suggested_fix":"Add calendar reminder to rotate secrets quarterly. Document rotation procedure in DEVELOPMENT.md. Consider migrating to OIDC federation (no long-lived secrets).","acceptance_tests":["Rotation procedure documented","Calendar reminder set for team","Secrets successfully rotated without breaking deployments"],"verification_steps":{"first_pass":{"method":"code_search","evidence_collected":["See files array for affected locations"]},"second_pass":{"method":"manual_verification","confirmed":true,"notes":"Confirmed during audit review"},"tool_confirmation":{"tool":"NONE","reference":"No automated tool confirmation available"}}}
{"category":"process","title":"No deployment rollback automation","fingerprint":"process::deploy-firebase.yml::no-rollback","severity":"S2","effort":"E3","confidence":70,"files":[".github/workflows/deploy-firebase.yml"],"why_it_matters":"If deployment breaks production, rollback is manual. Must manually deploy previous version. High MTTR (mean time to recovery).","suggested_fix":"Add workflow_dispatch input for rollback: choice of last N deployments (stored in GitHub releases). Workflow redeploys selected version. OR integrate with firebase hosting:channel:deploy for staging before prod.","acceptance_tests":["Rollback workflow can deploy previous version","Rollback workflow tested in staging","Rollback completes in <5 minutes"]}
