{"category":"code-quality","title":"TodayPage Component Critical - N+1 Queries, 940+ Lines, 15+ Hooks","fingerprint":"code-quality::components/notebook/pages/today-page.tsx::COMP-001","severity":"S1","effort":"E2","confidence":90,"files":["components/notebook/pages/today-page.tsx:1","components/notebook/pages/today-page.tsx:507","components/notebook/pages/today-page.tsx:727","components/notebook/pages/today-page.tsx:744"],"why_it_matters":"TodayPage is 940+ lines with explicit 'any' types, 80-line debug logging block, N+1 query pattern, 15+ useState hooks causing excessive re-renders. Critical user-facing component with no tests.","suggested_fix":"Split into sub-components (WeeklyStatsDisplay, MoodCheckIn, JournalForm), extract debug to utility, fix N+1 with limit() query, add React.memo to children.","acceptance_tests":["Component split into 4+ focused sub-components","N+1 query fixed with limit()","Debug logging extracted to separate utility","React DevTools shows isolated re-renders"],"domains":["code-quality","performance","refactoring"],"verification_steps":{"first_pass":{"method":"code_search","evidence_collected":["Found 940+ lines via wc -l"]},"second_pass":{"method":"contextual_review","confirmed":true,"notes":"Verified 15+ useState hooks"},"tool_confirmation":{"tool":"NONE","reference":"Manual verification"}}}
{"category":"security","title":"App Check Disabled + No Offline Support = Security & UX Gap","fingerprint":"security::functions/src/index.ts::COMP-002","severity":"S1","effort":"E1","confidence":90,"files":["functions/src/index.ts:84","lib/firebase.ts","components/status/offline-indicator.tsx"],"why_it_matters":"App Check temporarily disabled across all Cloud Functions (bot protection removed). Meanwhile, offline indicator shows 'changes will sync' but no sync mechanism exists - misleading users.","suggested_fix":"1. Re-enable App Check with tracking mechanism for throttle. 2. Fix offline indicator message to 'some features unavailable'. 3. Implement IndexedDB persistence.","acceptance_tests":["App Check re-enabled or tracked for re-enablement","Offline message accurate","Firebase persistence enabled"],"domains":["security","engineering-productivity"],"verification_steps":{"first_pass":{"method":"code_search","evidence_collected":["Found requireAppCheck: false"]},"second_pass":{"method":"contextual_review","confirmed":true,"notes":"Confirmed App Check disabled"},"tool_confirmation":{"tool":"NONE","reference":"Manual verification"}}}
{"category":"engineering-productivity","title":"Firebase IndexedDB Persistence Not Enabled - Critical Offline Gap","fingerprint":"engineering-productivity::lib/firebase.ts::COMP-003","severity":"S1","effort":"E0","confidence":100,"files":["lib/firebase.ts"],"why_it_matters":"Without enableIndexedDbPersistence(), Firestore queries fail immediately offline. Recovery app users in meetings (basements, poor signal) cannot view any data. Single line fix with massive impact.","suggested_fix":"Add enableIndexedDbPersistence(db) after getFirestore() call. Handle multi-tab and unsupported browser errors gracefully.","acceptance_tests":["App loads previously fetched data when offline","IndexedDB contains Firestore cache","Multi-tab scenario handled gracefully"],"domains":["engineering-productivity"],"verification_steps":{"first_pass":{"method":"code_search","evidence_collected":["No enableIndexedDbPersistence found in codebase"]},"second_pass":{"method":"contextual_review","confirmed":true,"notes":"Confirmed persistence not enabled"},"tool_confirmation":{"tool":"NONE","reference":"Manual verification"}}}
{"category":"engineering-productivity","title":"No Service Worker - App Cannot Load Offline At All","fingerprint":"engineering-productivity::public/sw.js::COMP-004","severity":"S1","effort":"E2","confidence":95,"files":["public/","next.config.mjs"],"why_it_matters":"Without a service worker, app shows blank page/error when offline even with Firebase persistence. PWA manifest exists but incomplete without SW.","suggested_fix":"Implement service worker using next-pwa or workbox-webpack-plugin. Cache app shell, static assets, and API responses.","acceptance_tests":["App loads cached shell when offline","Service worker registered and active","Network-first with cache fallback for APIs"],"domains":["engineering-productivity"],"verification_steps":{"first_pass":{"method":"code_search","evidence_collected":["No sw.js found in public/"]},"second_pass":{"method":"contextual_review","confirmed":true,"notes":"Confirmed no service worker"},"tool_confirmation":{"tool":"NONE","reference":"Manual verification"}}}
{"category":"engineering-productivity","title":"No Offline Write Queue - Journal Entries Lost Forever","fingerprint":"engineering-productivity::lib/firestore-service.ts::COMP-005","severity":"S1","effort":"E3","confidence":95,"files":["lib/firestore-service.ts","hooks/use-journal.ts","components/status/offline-indicator.tsx"],"why_it_matters":"Journal entries made offline are lost forever. Recovery app users trust 'changes will sync' message but it's false. Critical data loss for users in meetings.","suggested_fix":"Implement IndexedDB-based write queue. Store pending writes with timestamp, sync on reconnection with conflict resolution.","acceptance_tests":["Journal entries saved to IndexedDB when offline","Pending writes shown in UI","Writes sync automatically on reconnection"],"domains":["engineering-productivity"],"verification_steps":{"first_pass":{"method":"code_search","evidence_collected":["No offline queue implementation found"]},"second_pass":{"method":"contextual_review","confirmed":true,"notes":"Confirmed no offline write queue"},"tool_confirmation":{"tool":"NONE","reference":"Manual verification"}}}
{"category":"refactoring","title":"Cloud Functions Index File God Object (811 Lines)","fingerprint":"refactoring::functions/src/index.ts::COMP-006","severity":"S1","effort":"E2","confidence":90,"files":["functions/src/index.ts:1"],"why_it_matters":"Main Cloud Functions index contains multiple function exports plus all admin/scheduled re-exports. 811 lines violates Single Responsibility Principle.","suggested_fix":"Split into domain-based modules: journal/, inventory/, migration/. Keep index.ts as thin re-export layer only.","acceptance_tests":["Split into 3-4 domain modules","Each module under 300 lines","All functions deploy successfully"],"domains":["refactoring"],"verification_steps":{"first_pass":{"method":"code_search","evidence_collected":["wc -l shows 811 lines"]},"second_pass":{"method":"contextual_review","confirmed":true,"notes":"Confirmed god object pattern"},"tool_confirmation":{"tool":"NONE","reference":"Manual verification"}}}
{"category":"refactoring","title":"Admin Functions File Exceeds Complexity (800+ Lines, 21 Operations)","fingerprint":"refactoring::functions/src/admin.ts::COMP-007","severity":"S1","effort":"E2","confidence":70,"files":["functions/src/admin.ts:1"],"why_it_matters":"Admin functions file contains 21+ distinct operations with security checks, validation, and Firestore operations all mixed together.","suggested_fix":"Split into feature-based modules: admin/users.ts, admin/content.ts, admin/system.ts, admin/utilities.ts.","acceptance_tests":["Split into 4 feature modules","Each module under 400 lines","Admin panel works without modification"],"domains":["refactoring"],"verification_steps":{"first_pass":{"method":"code_search","evidence_collected":["Found 21+ async functions"]},"second_pass":{"method":"manual_verification","confirmed":true,"notes":"Confirmed via dual-pass review"},"tool_confirmation":{"tool":"NONE","reference":"Manual verification only"}}}
{"category":"documentation","title":"Comprehensive Audit Reports Missing Standard Structure","fingerprint":"documentation::docs/audits/comprehensive/audit-code-report.md::COMP-008","severity":"S1","effort":"E1","confidence":90,"files":["docs/audits/comprehensive/audit-code-report.md","docs/audits/comprehensive/audit-performance-report.md","docs/audits/comprehensive/audit-refactoring-report.md","docs/audits/comprehensive/audit-security-report.md"],"why_it_matters":"Reports missing Version History and Purpose sections, violating Tier 2 documentation requirements. Hard to maintain and may drift.","suggested_fix":"Add standard Tier 2 headers: Purpose section, Last Updated date, Version History table, AI Instructions section.","acceptance_tests":["All 4 audit reports pass docs:check","Each has Version History table","Each has Purpose section"],"domains":["documentation"],"verification_steps":{"first_pass":{"method":"code_search","evidence_collected":["Missing Version History"]},"second_pass":{"method":"manual_verification","confirmed":true,"notes":"Confirmed during audit"},"tool_confirmation":{"tool":"NONE","reference":"No automated tool"}}}
{"category":"documentation","title":"Broken Link to FALSE_POSITIVES.jsonl in Agent Policy","fingerprint":"documentation::docs/agent_docs/SKILL_AGENT_POLICY.md::COMP-009","severity":"S1","effort":"E0","confidence":90,"files":["docs/agent_docs/SKILL_AGENT_POLICY.md:312"],"why_it_matters":"Broken link confuses readers and indicates outdated documentation. Referenced file does not exist.","suggested_fix":"Create docs/audits/FALSE_POSITIVES.jsonl or update/remove the reference in SKILL_AGENT_POLICY.md.","acceptance_tests":["docs:check reports no broken link at line 312","Referenced file exists OR link removed"],"domains":["documentation"],"verification_steps":{"first_pass":{"method":"code_search","evidence_collected":["Link target not found"]},"second_pass":{"method":"manual_verification","confirmed":true,"notes":"Confirmed broken link"},"tool_confirmation":{"tool":"NONE","reference":"No automated tool"}}}
{"category":"documentation","title":"Missing CONTRIBUTING.md at Root Level","fingerprint":"documentation::CONTRIBUTING.md::COMP-010","severity":"S1","effort":"E2","confidence":90,"files":["CONTRIBUTING.md"],"why_it_matters":"Standard open-source convention for onboarding contributors. README.md references contribution guidelines that don't exist.","suggested_fix":"Create CONTRIBUTING.md with: Getting Started, Development Setup, Code Style, PR Process, Code Review, Testing Requirements.","acceptance_tests":["CONTRIBUTING.md exists at root","Includes development setup","README.md links work"],"domains":["documentation"],"verification_steps":{"first_pass":{"method":"code_search","evidence_collected":["File not found"]},"second_pass":{"method":"manual_verification","confirmed":true,"notes":"Confirmed missing"},"tool_confirmation":{"tool":"NONE","reference":"No automated tool"}}}
{"category":"code-quality","title":"Explicit 'any' Type in Production Callback","fingerprint":"code-quality::components/notebook/pages/today-page.tsx::COMP-011","severity":"S1","effort":"E0","confidence":90,"files":["components/notebook/pages/today-page.tsx:507"],"why_it_matters":"handleSnapshotUpdate callback uses 'any' type for docSnap parameter, bypassing TypeScript safety in critical Firestore data handling.","suggested_fix":"Replace with DocumentSnapshot type: import { DocumentSnapshot } from 'firebase/firestore';","acceptance_tests":["No @typescript-eslint/no-explicit-any violation","TypeScript strict mode enforced"],"domains":["code-quality"],"verification_steps":{"first_pass":{"method":"code_search","evidence_collected":["Found : any at line 507"]},"second_pass":{"method":"contextual_review","confirmed":true,"notes":"Confirmed any type usage"},"tool_confirmation":{"tool":"eslint","reference":"npm run lint shows violation"}}}
{"category":"code-quality","title":"Multiple 'any' Types in Test Mock Setup (10+ instances)","fingerprint":"code-quality::tests/firestore-service.test.ts::COMP-012","severity":"S1","effort":"E1","confidence":90,"files":["tests/firestore-service.test.ts:18"],"why_it_matters":"Test file has 10+ 'any' types in mock setup, reducing test reliability. Mock objects should have explicit interfaces.","suggested_fix":"Create typed mock interfaces matching Firestore SDK types instead of using 'any'.","acceptance_tests":["File-level ESLint disable removed","Typed mock interfaces created"],"domains":["code-quality"],"verification_steps":{"first_pass":{"method":"code_search","evidence_collected":["Found eslint-disable at line 1"]},"second_pass":{"method":"manual_verification","confirmed":true,"notes":"Confirmed 10+ any types"},"tool_confirmation":{"tool":"NONE","reference":"Manual verification only"}}}
{"category":"security","title":"Firebase Credentials Written to Disk in Deployment","fingerprint":"security::deploy-firebase.yml::COMP-013","severity":"S1","effort":"E1","confidence":90,"files":[".github/workflows/deploy-firebase.yml:56-65"],"why_it_matters":"Service account credentials written to $HOME/gcloud-key.json creates leakage opportunity if runner compromised.","suggested_fix":"Use stdin: echo \"$FIREBASE_SERVICE_ACCOUNT\" | gcloud auth activate-service-account --key-file=- OR migrate to GitHub OIDC.","acceptance_tests":["No gcloud-key.json file created","gcloud auth succeeds via stdin","Deployment still works"],"domains":["security","process"],"verification_steps":{"first_pass":{"method":"code_search","evidence_collected":["Found echo to gcloud-key.json"]},"second_pass":{"method":"manual_verification","confirmed":true,"notes":"Confirmed disk write"},"tool_confirmation":{"tool":"NONE","reference":"Manual verification only"}}}
{"category":"process","title":"Tests Not Run for Config Changes (eslint, firebase.json, rules)","fingerprint":"process::.husky/pre-commit::COMP-014","severity":"S1","effort":"E0","confidence":90,"files":[".husky/pre-commit:54"],"why_it_matters":"Tests run for package.json but not eslint.config.mjs, firebase.json, firestore.rules. Config changes can break builds.","suggested_fix":"Add to risky config pattern: eslint.config.mjs, firebase.json, *.rules, *.config.mjs, *.config.ts","acceptance_tests":["Modify eslint.config.mjs → tests run","Modify firebase.json → tests run","Modify firestore.rules → tests run"],"domains":["process"],"verification_steps":{"first_pass":{"method":"code_search","evidence_collected":["Pattern doesn't include config files"]},"second_pass":{"method":"manual_verification","confirmed":true,"notes":"Confirmed missing patterns"},"tool_confirmation":{"tool":"NONE","reference":"Manual verification only"}}}
{"category":"process","title":"Doc-Only Commit Detection Misclassifies Critical JSONL","fingerprint":"process::.husky/pre-commit::COMP-015","severity":"S1","effort":"E0","confidence":90,"files":[".husky/pre-commit:71"],"why_it_matters":"JSONL treated as docs, but MASTER_DEBT.jsonl and FALSE_POSITIVES.jsonl are critical data. Changes should trigger tests.","suggested_fix":"Exclude critical JSONL from doc-only pattern. Only allow docs/*.jsonl to skip tests.","acceptance_tests":["Modify MASTER_DEBT.jsonl → tests run","Modify FALSE_POSITIVES.jsonl → tests run","Modify docs/reviews/audit.jsonl → tests skipped"],"domains":["process"],"verification_steps":{"first_pass":{"method":"code_search","evidence_collected":["JSONL in doc-only pattern"]},"second_pass":{"method":"manual_verification","confirmed":true,"notes":"Confirmed misclassification"},"tool_confirmation":{"tool":"NONE","reference":"Manual verification only"}}}
{"category":"process","title":"Cross-Document Override SKIP_CROSS_DOC_CHECK Not Implemented","fingerprint":"process::.husky/pre-commit::COMP-016","severity":"S1","effort":"E0","confidence":90,"files":[".husky/pre-commit:119-131"],"why_it_matters":"Override documented in error message but not implemented. Developers try it, fails, confusion ensues.","suggested_fix":"Add wrapper: if [ -z \"$SKIP_CROSS_DOC_CHECK\" ]; then [check] else echo 'Skipping'; fi","acceptance_tests":["SKIP_CROSS_DOC_CHECK=1 git commit succeeds","Without override, violations block"],"domains":["process"],"verification_steps":{"first_pass":{"method":"code_search","evidence_collected":["Override referenced but not checked"]},"second_pass":{"method":"manual_verification","confirmed":true,"notes":"Confirmed not implemented"},"tool_confirmation":{"tool":"NONE","reference":"Manual verification only"}}}
{"category":"security","title":"Trigger Override Logging Silently Fails with || true","fingerprint":"security::.husky/pre-push::COMP-017","severity":"S1","effort":"E0","confidence":90,"files":[".husky/pre-push:123-126"],"why_it_matters":"|| true means if log-override.js fails, hook succeeds anyway. Override invisible to audit trail.","suggested_fix":"Remove || true. If logging fails, that's a real problem - should block.","acceptance_tests":["Simulate log failure → hook fails","Normal override → logged successfully"],"domains":["security","process"],"verification_steps":{"first_pass":{"method":"code_search","evidence_collected":["Found || true on logging call"]},"second_pass":{"method":"manual_verification","confirmed":true,"notes":"Confirmed silent failure"},"tool_confirmation":{"tool":"NONE","reference":"Manual verification only"}}}
{"category":"process","title":"Functions Directory Not Linted in CI","fingerprint":"process::.github/workflows/ci.yml::COMP-018","severity":"S1","effort":"E1","confidence":90,"files":[".github/workflows/ci.yml:27-28","eslint.config.mjs:27"],"why_it_matters":"Root eslint ignores functions/, functions has own config, but CI never runs functions linting. Backend code quality not validated.","suggested_fix":"Add CI step: npm --prefix functions run lint (add \"lint\" script to functions/package.json)","acceptance_tests":["Functions linting runs in CI","Function ESLint violation blocks CI"],"domains":["process"],"verification_steps":{"first_pass":{"method":"code_search","evidence_collected":["No functions lint step in CI"]},"second_pass":{"method":"manual_verification","confirmed":true,"notes":"Confirmed not linted"},"tool_confirmation":{"tool":"NONE","reference":"Manual verification only"}}}
{"category":"security","title":"GitHub Actions Secrets Not Rotated Regularly","fingerprint":"security::GitHub_Settings::COMP-019","severity":"S1","effort":"E1","confidence":70,"files":["Settings → Secrets"],"why_it_matters":"FIREBASE_SERVICE_ACCOUNT and other secrets likely never rotated. If compromised, long window of exposure.","suggested_fix":"Add calendar reminder for quarterly rotation. Document procedure. Consider OIDC federation.","acceptance_tests":["Rotation procedure documented","Calendar reminder set","Secrets rotated without breaking deployments"],"domains":["security","process"],"verification_steps":{"first_pass":{"method":"code_search","evidence_collected":["No rotation procedure found"]},"second_pass":{"method":"manual_verification","confirmed":true,"notes":"Confirmed no rotation"},"tool_confirmation":{"tool":"NONE","reference":"Manual verification only"}}}
{"category":"performance","title":"MoodSparkline Redundant Fetch Duplicates Journal Data","fingerprint":"performance::components/notebook/visualizations/mood-sparkline.tsx::COMP-020","severity":"S1","effort":"E1","confidence":90,"files":["components/notebook/visualizations/mood-sparkline.tsx:18"],"why_it_matters":"MoodSparkline fetches history independently but same data already fetched by useJournal hook. Causes duplicate Firestore reads.","suggested_fix":"Pass mood data as props from parent which already has it via useJournal.","acceptance_tests":["Network tab shows only one history request","Data passed via props not fetched again"],"domains":["performance","refactoring"],"verification_steps":{"first_pass":{"method":"code_search","evidence_collected":["Found separate getHistory call"]},"second_pass":{"method":"contextual_review","confirmed":true,"notes":"Confirmed redundant fetch"},"tool_confirmation":{"tool":"NONE","reference":"Manual verification only"}}}
{"category":"security","title":"Missing Content-Security-Policy Header","fingerprint":"security::firebase.json::COMP-021","severity":"S2","effort":"E1","confidence":90,"files":["firebase.json:30"],"why_it_matters":"Hosting config has excellent security headers but lacks CSP. CSP is critical defense against XSS attacks.","suggested_fix":"Add CSP header with appropriate directives for Next.js app.","acceptance_tests":["CSP header present in response","No CSP violations in console"]}
{"category":"security","title":"Script Injection Vulnerability in resolve-debt Workflow","fingerprint":"security::.github/workflows/resolve-debt.yml::COMP-022","severity":"S2","effort":"E1","confidence":70,"files":[".github/workflows/resolve-debt.yml:62-68"],"why_it_matters":"Outputs interpolated in shell could execute arbitrary commands if extraction has bug.","suggested_fix":"Pass debt_ids via environment variable instead of command line.","acceptance_tests":["debt_ids passed via env var","Test with malicious input confirms no execution"]}
{"category":"process","title":"Backlog Enforcement Job Obsolete After TDMS Migration","fingerprint":"process::.github/workflows/backlog-enforcement.yml::COMP-023","severity":"S2","effort":"E2","confidence":90,"files":[".github/workflows/backlog-enforcement.yml:32-43"],"why_it_matters":"Entire job is no-op since AUDIT_FINDINGS_BACKLOG.md archived. Should query MASTER_DEBT.jsonl instead.","suggested_fix":"Refactor to run generate-metrics.js and enforce thresholds (S0 > 0 = fail).","acceptance_tests":["Job queries MASTER_DEBT.jsonl","S0 items block CI"]}
{"category":"security","title":"Security Check Doesn't Scan Cloud Functions","fingerprint":"security::scripts/security-check.js::COMP-024","severity":"S2","effort":"E2","confidence":70,"files":["scripts/security-check.js"],"why_it_matters":"Frontend scanned but functions/src/*.ts may have auth bypass, secret leakage. Backend security not validated.","suggested_fix":"Extend security-check.js to scan functions/src/ with backend-specific patterns.","acceptance_tests":["Functions scanned by security-check","Backend patterns detected"]}
{"category":"performance","title":"Large ResourcesPage Not Code-Split (960 lines, ~50KB)","fingerprint":"performance::components/notebook/pages/resources-page.tsx::COMP-025","severity":"S2","effort":"E1","confidence":70,"files":["components/notebook/pages/resources-page.tsx:1"],"why_it_matters":"ResourcesPage is 960 lines and not dynamically imported. Adds ~50KB to bundle for all users.","suggested_fix":"Use dynamic import: const ResourcesPage = dynamic(() => import('./pages/resources-page'))","acceptance_tests":["ResourcesPage lazy loaded","Bundle analyzer shows code split"]}
{"category":"refactoring","title":"useJournal Hook Has 7 Responsibilities (438 lines)","fingerprint":"refactoring::hooks/use-journal.ts::COMP-026","severity":"S2","effort":"E1","confidence":90,"files":["hooks/use-journal.ts:1"],"why_it_matters":"Hook manages: subscription, grouping, add, delete, search text, tags, XSS sanitization. Too many responsibilities.","suggested_fix":"Split into focused modules: use-journal-subscription.ts, entry-processing.ts, entry-metadata.ts, use-journal-mutations.ts.","acceptance_tests":["Split into 4 focused modules","useJournal composes extracted modules"]}
{"category":"documentation","title":"Archive Docs Never Checked for Link Rot","fingerprint":"documentation::.github/workflows/docs-lint.yml::COMP-027","severity":"S2","effort":"E1","confidence":70,"files":[".github/workflows/docs-lint.yml:77-80"],"why_it_matters":"Archive docs never checked for broken links. Old docs could mislead developers.","suggested_fix":"Add quarterly scheduled workflow for archives, or add 'Archived - may contain outdated info' headers.","acceptance_tests":["Quarterly workflow runs OR archive headers added"]}
{"category":"process","title":"Function Deletion with Force Flag Lacks Validation","fingerprint":"process::.github/workflows/deploy-firebase.yml::COMP-028","severity":"S2","effort":"E2","confidence":70,"files":[".github/workflows/deploy-firebase.yml:67-74"],"why_it_matters":"Hardcoded function deletion list could delete wrong functions if stale. --force bypasses confirmation.","suggested_fix":"Generate deletion list dynamically from source diff, or use explicit allowlist file.","acceptance_tests":["Deletion list from source diff","Only stale functions deleted"]}
{"category":"process","title":"Pre-Commit Total Time 15-30s - Developer Friction","fingerprint":"process::.husky/pre-commit::COMP-029","severity":"S2","effort":"E3","confidence":70,"files":[".husky/pre-commit"],"why_it_matters":"15-30s pre-commit impacts developer flow. Ideal is <10s. Multiple optimization opportunities.","suggested_fix":"Implement caching, incremental validation, parallel checks where possible.","acceptance_tests":["Pre-commit <10s for typical changes","All checks still run"]}
{"category":"performance","title":"Pre-Push Redundant Checks (15-40s)","fingerprint":"performance::.husky/pre-push::COMP-030","severity":"S2","effort":"E2","confidence":70,"files":[".husky/pre-push"],"why_it_matters":"Pre-push runs pattern and type checks that may have just run in pre-commit. Sequential commits waste time.","suggested_fix":"Implement caching across hooks. Skip if same check ran <5min ago on same HEAD.","acceptance_tests":["Commit then push → redundant checks skipped","Wait >5min → checks run"]}
