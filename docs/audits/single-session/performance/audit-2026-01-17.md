# Performance Audit - 2026-01-17

> **Last Updated:** 2026-01-27

## Purpose

This document provides a single-session performance audit covering bundle size,
rendering performance, data fetching patterns, memory management, and Core Web
Vitals considerations.

---

## Baselines

| Metric                | Value                         |
| --------------------- | ----------------------------- |
| Build time            | 4.6s (Turbopack)              |
| Bundle size           | 3.5 MB (.next/static)         |
| Largest chunk         | 628 KB                        |
| Client components     | 101 ('use client' directives) |
| Server components     | 0 ('use server' directives)   |
| useEffect hooks       | 98                            |
| Real-time listeners   | 7 (onSnapshot)                |
| Dynamic imports       | 6                             |
| useMemo usages        | 11                            |
| useCallback usages    | 10                            |
| React.memo usages     | 0                             |
| Next.js Image imports | 5                             |

### Chunk Size Distribution

| Size   | File                |
| ------ | ------------------- |
| 628 KB | 25e90c7d3f46d83b.js |
| 356 KB | 5203bce13be9b2ac.js |
| 280 KB | fefdd736f10b1356.js |
| 220 KB | 8884070c04073c10.js |
| 188 KB | 2976f4f2cadb4483.js |

## Findings Summary

| Severity | Count | Affected Metric             | Confidence  |
| -------- | ----- | --------------------------- | ----------- |
| S0       | 0     | -                           | -           |
| S1       | 2     | bundle, render              | HIGH        |
| S2       | 8     | bundle, render, memory, LCP | HIGH/MEDIUM |
| S3       | 2     | bundle, render, LCP         | HIGH/MEDIUM |

**Total: 12 findings**

## Top 5 Optimization Opportunities

1. **[components/notebook/pages/today-page.tsx:1]** - Large monolithic component
   (1117 lines) without code splitting (S1/E2) - Est. 15-20% bundle
   improvement - TOOL_VALIDATED
2. **[components/admin/users-tab.tsx:84]** - No React.memo on 924-line admin
   list with complex state (S1/E1) - Est. 20-30% render improvement -
   DUAL_PASS_CONFIRMED
3. **[.next/static/chunks]** - 628KB largest chunk indicates code splitting
   opportunity (S2/E1) - Est. 10-15% bundle improvement - TOOL_VALIDATED
4. **[components]** - 30+ inline onClick arrow functions (S2/E1) - Est. 5-10%
   render improvement - MANUAL_ONLY
5. **[components]** - 28 components with inline style objects (S2/E1) - Est.
   3-5% render improvement - TOOL_VALIDATED

## False Positives Filtered

- 0 findings excluded (no matches in FALSE_POSITIVES.jsonl)

Note: FP-010 (bundle size warnings under thresholds) not applicable - findings
are about patterns, not size thresholds.

## Category Breakdown

### 1. Bundle Size & Loading (4 findings)

| ID       | Severity | File                | Issue                                           |
| -------- | -------- | ------------------- | ----------------------------------------------- |
| PERF-001 | S1       | today-page.tsx:1    | 1117-line component without code splitting      |
| PERF-006 | S2       | .next/static/chunks | 628KB largest chunk                             |
| PERF-010 | S3       | components          | Only 6 dynamic imports vs 101 client components |
| PERF-012 | S3       | next.config.mjs:14  | Image optimization disabled                     |

### 2. Rendering Performance (6 findings)

| ID       | Severity | File               | Issue                                               |
| -------- | -------- | ------------------ | --------------------------------------------------- |
| PERF-002 | S1       | users-tab.tsx:84   | No React.memo on 924-line admin list                |
| PERF-003 | S2       | today-page.tsx:396 | 12 debug console.log statements                     |
| PERF-004 | S2       | components         | 30+ inline onClick arrow functions                  |
| PERF-005 | S2       | components         | 28 components with inline style objects             |
| PERF-007 | S2       | components         | 20+ uses of key={index} in lists                    |
| PERF-011 | S3       | components         | Inconsistent useMemo/useCallback without React.memo |

### 3. Data Fetching & Caching (1 finding)

| ID       | Severity | File            | Issue                                     |
| -------- | -------- | --------------- | ----------------------------------------- |
| PERF-009 | S2       | meetings.ts:129 | Deprecated getAllMeetings() without limit |

### 4. Memory Management (1 finding)

| ID       | Severity | File                     | Issue                                |
| -------- | -------- | ------------------------ | ------------------------------------ |
| PERF-008 | S2       | meeting-countdown.tsx:41 | setInterval without visibility check |

### 5. Core Web Vitals (0 direct findings)

- PERF-012 affects LCP via image optimization
- No new CWV-specific issues beyond prior CANON audit

## Cross-Reference with CANON-PERF

Several findings align with prior multi-AI audit (CANON-PERF.jsonl):

| This Audit | CANON Finding   | Status                                         |
| ---------- | --------------- | ---------------------------------------------- |
| PERF-012   | CANON-0047      | Still unresolved (image optimization disabled) |
| PERF-002   | CANON-0053      | Still unresolved (no React.memo usage)         |
| PERF-001   | CANON-0048/0049 | Related (TodayPage complexity)                 |
| PERF-009   | CANON-0059      | Still unresolved (query limits)                |

## Quick Wins (E0-E1)

1. **PERF-003**: Remove/replace 12 debug console.log statements (~30 min)
2. **PERF-007**: Replace key={index} with stable IDs (~1 hour)
3. **PERF-008**: Add visibility check to countdown intervals (~30 min)
4. **PERF-002**: Add React.memo to UserListItem extract (~2 hours)
5. **PERF-004**: Convert critical onClick handlers to useCallback (~2 hours)

**Estimated Quick Win Time**: ~6 hours for top 5 quick wins

## Recommendations

### Immediate (This Sprint)

1. **Add React.memo to list components** - 0 usages currently, significant
   impact on journal/admin lists
2. **Remove debug console.log** - 12 statements in today-page.tsx alone (also
   flagged in CODE-002)
3. **Add visibility checks to intervals** - Pattern already exists in codebase

### Short-term (Next Sprint)

4. **Split TodayPage** - 1117 lines is too large for maintainability and
   performance
5. **Run bundle analyzer** - Identify what's in 628KB chunk
6. **Add more dynamic imports** - Only 6 currently vs 101 client components

### Medium-term

7. **Enable image optimization** - CANON-0047 flagged this as S1
8. **Add loading.tsx files** - CANON-0062 noted missing route-level loading UI

## Comparison with Prior Audit (2026-01-08)

| Metric            | 2026-01-08 | 2026-01-17 | Change       |
| ----------------- | ---------- | ---------- | ------------ |
| Client components | 88-94      | 101        | +7-13        |
| React.memo usages | 0          | 0          | No change    |
| Dynamic imports   | ~6         | 6          | No change    |
| Largest chunk     | N/A        | 628 KB     | New baseline |

Key observations:

- Client component count increased (more features added)
- React.memo still not adopted (CANON-0053 unresolved)
- Dynamic import count stable (no new optimizations)

---

## Audit Metadata

| Field                    | Value                                         |
| ------------------------ | --------------------------------------------- |
| Date                     | 2026-01-17                                    |
| Auditor                  | Claude Code (claude-opus-4-5-20251101)        |
| Scope                    | app/, components/, lib/, hooks/, .next/static |
| Duration                 | Single session                                |
| Commits Since Last Audit | 353                                           |
| Files Changed            | 248                                           |
| Prior Audit              | 2026-01-08 (Multi-AI, 20 canonical findings)  |

---

## Version History

| Version | Date       | Changes         |
| ------- | ---------- | --------------- |
| 1.0     | 2026-01-17 | Initial version |
