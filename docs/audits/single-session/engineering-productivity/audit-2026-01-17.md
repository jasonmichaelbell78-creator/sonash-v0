# Engineering Productivity Audit - 2026-01-17

**Focus Areas:** Golden Path & DX, Debugging Ergonomics, Offline Support

## Baselines

| Metric                     | Value       |
| -------------------------- | ----------- |
| npm scripts                | 42          |
| logger.\* calls            | 394         |
| console.log calls          | 3111        |
| Structured logging ratio   | 1:8 (poor)  |
| localStorage usages        | 144         |
| IndexedDB usage (app code) | 0           |
| Service worker             | None        |
| Correlation ID support     | None        |
| Offline write queue        | None        |
| Firebase persistence       | Not enabled |

### Prior Audit Status (2026-01-13)

| EFF ID  | Issue                     | Status                   |
| ------- | ------------------------- | ------------------------ |
| EFF-001 | dev:offline script        | **STILL OPEN**           |
| EFF-003 | doctor.js script          | **STILL OPEN**           |
| EFF-004 | Logger Sentry integration | **FIXED**                |
| EFF-005 | CI npm caching            | **FIXED** (cache: "npm") |
| EFF-006 | Correlation IDs           | **STILL OPEN**           |
| EFF-010 | Offline queue             | **STILL OPEN**           |

## Findings Summary

| Severity | Count | Category                                   | Confidence |
| -------- | ----- | ------------------------------------------ | ---------- |
| S0       | 0     | -                                          | -          |
| S1       | 3     | Debugging (1), Offline (2)                 | HIGH       |
| S2       | 4     | GoldenPath (2), Debugging (1), Offline (1) | HIGH       |
| S3       | 3     | GoldenPath (1), Debugging (1), Offline (1) | MEDIUM     |

**Total: 10 findings (0 S0, 3 S1, 4 S2, 3 S3)**

## Category Breakdown

### 1. Golden Path & Developer Experience (3 findings)

| ID       | Severity | Issue                             | ROI    |
| -------- | -------- | --------------------------------- | ------ |
| EFFP-001 | S2       | No `npm run dev:offline` script   | HIGH   |
| EFFP-002 | S2       | No `scripts/doctor.js` validation | HIGH   |
| EFFP-003 | S3       | No single `npm run setup` command | MEDIUM |

**Current Golden Path:**

```
Setup:  git clone → npm install → cd functions && npm install → copy .env → firebase login
Dev:    npm run dev (online only, or 2 terminals for emulators)
Test:   npm test
Deploy: git push (CI handles deploy)
```

**Target Golden Path:**

```
Setup:  npm run setup (one command)
Dev:    npm run dev:offline (with emulators)
Test:   npm test
Deploy: git push
Verify: npm run smoke (missing)
```

### 2. Debugging Ergonomics (3 findings)

| ID       | Severity | Issue                             | Impact                        |
| -------- | -------- | --------------------------------- | ----------------------------- |
| EFFP-004 | S1       | No correlation IDs                | Cannot trace user journey     |
| EFFP-005 | S2       | 8:1 console.log to logger ratio   | Unstructured, unredacted logs |
| EFFP-006 | S3       | Generic "Please try again" errors | Poor user guidance            |

**Key Insight:** Logger is integrated with Sentry (fixed since 2026-01-13), but
the app doesn't generate correlation IDs to trace requests from frontend to
Cloud Functions.

### 3. Offline Support (4 findings)

| ID       | Severity | Issue                            | Impact                 |
| -------- | -------- | -------------------------------- | ---------------------- |
| EFFP-007 | S1       | No offline write queue           | **DATA LOSS**          |
| EFFP-008 | S1       | Firebase persistence not enabled | No offline reads       |
| EFFP-009 | S2       | No service worker                | App won't load offline |
| EFFP-010 | S3       | OfflineIndicator is passive      | No sync visibility     |

**Key Insight:** This is a recovery support app where users may have spotty
connectivity. Offline support is CRITICAL but currently non-existent. Writes
fail immediately, reads are memory-only.

## Cross-Reference with Prior Audit (2026-01-13)

| This Audit | 2026-01-13 Finding | Status              |
| ---------- | ------------------ | ------------------- |
| EFFP-001   | EFF-001            | Still open (4 days) |
| EFFP-002   | EFF-003            | Still open (4 days) |
| EFFP-004   | EFF-006            | Still open (4 days) |
| EFFP-007   | EFF-010            | Still open (4 days) |

**4 of 10 findings are carryover from prior audit** - these need prioritization.

## Quick Wins (E0-E1)

1. **EFFP-001**: Add `dev:offline` script (~30 min)
2. **EFFP-003**: Add `setup` script (~30 min)
3. **EFFP-008**: Enable Firebase persistence (~1 hour) - **HIGH IMPACT**
4. **EFFP-002**: Create `doctor.js` (~1 hour)
5. **EFFP-006**: Improve error messages (~2 hours)

**Estimated Quick Win Time**: ~5 hours for high-impact improvements

## Recommendations

### Immediate (This Week) - HIGH ROI

1. **EFFP-008**: Enable Firebase IndexedDB persistence
   - One line of code, huge impact for offline reads
   - `enableIndexedDbPersistence(db)`

2. **EFFP-001**: Add `dev:offline` script
   - Enables consistent offline testing
   - `npm install -D concurrently`

3. **EFFP-002**: Create `doctor.js`
   - Prevents setup issues
   - Check Node, Firebase CLI, env vars

### Short-term (Next Sprint)

4. **EFFP-004**: Add correlation IDs
   - Generate UUID on client
   - Pass to Cloud Functions
   - Include in logger context

5. **EFFP-009**: Add service worker
   - Use next-pwa or workbox
   - Cache app shell

### Medium-term (Requires Design)

6. **EFFP-007**: Implement offline write queue
   - IndexedDB-based queue
   - Sync on reconnection
   - Conflict resolution strategy

7. **EFFP-010**: Enhance OfflineIndicator
   - Show pending writes
   - Manual sync button
   - Depends on EFFP-007

## Positive Findings

- **Sentry integration works** - logger.error sends to Sentry with context
- **CI caching enabled** - npm cache shared between jobs
- **OfflineIndicator component exists** - foundation for better UX
- **Structured logger exists** - just needs more adoption
- **DEVELOPMENT.md is comprehensive** - good documentation baseline

## Comparison with 2026-01-13 Audit

| Metric               | 2026-01-13 | 2026-01-17 | Change             |
| -------------------- | ---------- | ---------- | ------------------ |
| EFF findings         | 12         | 10         | -2 (2 fixed)       |
| S1 findings          | 2          | 3          | +1 (offline focus) |
| Quick wins completed | 0          | 2          | +2 (Logger+CI)     |
| Offline support      | None       | None       | No change          |

Key observations:

- Logger Sentry integration fixed (EFF-004)
- CI caching added (EFF-005)
- Offline support remains the critical gap
- Golden path scripts still missing

---

## Audit Metadata

| Field       | Value                                                  |
| ----------- | ------------------------------------------------------ |
| Date        | 2026-01-17                                             |
| Auditor     | Claude Code (claude-opus-4-5-20251101)                 |
| Scope       | Golden Path, Debugging Ergonomics, Offline Support     |
| Duration    | Single session (one-off)                               |
| Focus       | Engineering Productivity gaps from 2026-01-13 analysis |
| Prior Audit | 2026-01-13 (12 EFF findings)                           |

## Template Integration Notes

This audit validates the template updates made today:

- **Process Audit**: Added "Golden Path & DX" category (EFFP-001, EFFP-002,
  EFFP-003)
- **Code Audit**: Has "Debugging Ergonomics" category (EFFP-004, EFFP-005,
  EFFP-006)
- **Performance Audit**: Added "Offline Support" category (EFFP-007, EFFP-008,
  EFFP-009, EFFP-010)

Future audits in these categories will cover engineering productivity concerns
automatically.
