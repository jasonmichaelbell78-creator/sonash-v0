{"category":"process","title":"Inconsistent: Mixed CommonJS and ESM module systems","fingerprint":"process::scripts::module-system-mix","severity":"S3","effort":"E1","confidence":"HIGH","files":["scripts/append-hook-warning.js:1","scripts/seed-commit-log.js:1","scripts/debt/generate-metrics.js:1","scripts/debt/sync-sonarcloud.js:1","scripts/check-agent-compliance.js:1","scripts/archive-doc.js:1","scripts/ai-review.js:1"],"why_it_matters":"Mixing CommonJS (require) and ESM (import) makes codebase harder to maintain and can cause confusion about module resolution. Standardizing on one approach improves consistency and reduces cognitive load.","suggested_fix":"Standardize on ESM (import/export) for all new scripts. Create migration plan for remaining CommonJS scripts. ESM is the modern standard and provides better static analysis.","acceptance_tests":["All scripts in scripts/ directory use ESM syntax","No new scripts use require() unless justified","Migration plan documented for legacy CommonJS scripts"],"file":"scripts/append-hook-warning.js","line":1,"description":"Mixing CommonJS (require) and ESM (import) makes codebase harder to maintain and can cause confusion about module resolution. Standardizing on one approach improves consistency and reduces cognitive load.","recommendation":"Standardize on ESM (import/export) for all new scripts. Create migration plan for remaining CommonJS scripts. ESM is the modern standard and provides better static analysis.","id":"process::scripts::module-system-mix"}
{"category":"process","title":"Inconsistent: node: prefix usage in imports","fingerprint":"process::scripts::node-prefix-inconsistency","severity":"S3","effort":"E1","confidence":"HIGH","files":["scripts/validate-audit.js:18","scripts/ai-review.js:15","scripts/debt/generate-metrics.js:20","scripts/debt/sync-sonarcloud.js:29"],"why_it_matters":"Some scripts use 'node:fs' prefix for built-in modules, others use 'fs', and some use aliases like 'node_fs'. This inconsistency makes code reviews harder and creates unnecessary variation in import style.","suggested_fix":"Standardize on using 'node:' prefix for all Node.js built-in modules (node:fs, node:path, etc.) without aliases. This is the modern Node.js convention and makes built-in modules explicit.","acceptance_tests":["All scripts consistently use 'node:' prefix for built-in modules","No aliased imports like 'node_fs' unless necessary","ESLint rule enforces node: prefix usage"],"file":"scripts/validate-audit.js","line":18,"description":"Some scripts use 'node:fs' prefix for built-in modules, others use 'fs', and some use aliases like 'node_fs'. This inconsistency makes code reviews harder and creates unnecessary variation in import style.","recommendation":"Standardize on using 'node:' prefix for all Node.js built-in modules (node:fs, node:path, etc.) without aliases. This is the modern Node.js convention and makes built-in modules explicit.","id":"process::scripts::node-prefix-inconsistency"}
{"category":"process","title":"Inconsistent: Emoji usage in console output","fingerprint":"process::scripts::emoji-consistency","severity":"S3","effort":"E1","confidence":"MEDIUM","files":["scripts/seed-commit-log.js:105","scripts/dedupe-quotes.ts:248","scripts/check-agent-compliance.js:156","scripts/archive-doc.js:576"],"why_it_matters":"Most scripts use emojis for visual feedback (‚úÖ, ‚ùå, ‚ö†Ô∏è) but some don't, creating inconsistent UX across automation tools. Users expect consistent output formatting.","suggested_fix":"Establish emoji usage standard: use emojis for all user-facing scripts (‚úÖ success, ‚ùå error, ‚ö†Ô∏è warning, üìä info). Create shared constants file for emoji mappings to ensure consistency.","acceptance_tests":["All user-facing scripts use standard emoji set","Shared emoji constants file exists and is used","CI/non-interactive contexts can disable emojis via flag"],"file":"scripts/seed-commit-log.js","line":105,"description":"Most scripts use emojis for visual feedback (‚úÖ, ‚ùå, ‚ö†Ô∏è) but some don't, creating inconsistent UX across automation tools. Users expect consistent output formatting.","recommendation":"Establish emoji usage standard: use emojis for all user-facing scripts (‚úÖ success, ‚ùå error, ‚ö†Ô∏è warning, üìä info). Create shared constants file for emoji mappings to ensure consistency.","id":"process::scripts::emoji-consistency"}
{"category":"process","title":"Inconsistent: Exit code handling patterns","fingerprint":"process::scripts::exit-code-patterns","severity":"S3","effort":"E1","confidence":"HIGH","files":["scripts/check-agent-compliance.js:192","scripts/check-backlog-health.js:256","scripts/security-check.js:441","scripts/validate-audit.js:974"],"why_it_matters":"Scripts use different patterns for setting exit codes: some use process.exit() directly, others use process.exitCode assignment. This inconsistency makes error handling patterns harder to learn and maintain.","suggested_fix":"Standardize on process.exitCode assignment pattern (not direct process.exit()) to allow cleanup handlers to run. Reserve process.exit() for truly fatal errors only. Document pattern in CONTRIBUTING.md.","acceptance_tests":["All scripts use process.exitCode for normal termination","process.exit() only used for fatal unrecoverable errors","Scripts allow cleanup handlers (SIGINT, SIGTERM) to execute"],"file":"scripts/check-agent-compliance.js","line":192,"description":"Scripts use different patterns for setting exit codes: some use process.exit() directly, others use process.exitCode assignment. This inconsistency makes error handling patterns harder to learn and maintain.","recommendation":"Standardize on process.exitCode assignment pattern (not direct process.exit()) to allow cleanup handlers to run. Reserve process.exit() for truly fatal errors only. Document pattern in CONTRIBUTING.md.","id":"process::scripts::exit-code-patterns"}
{"category":"process","title":"Inconsistent: Verbose/debug logging approaches","fingerprint":"process::scripts::verbose-logging","severity":"S3","effort":"E2","confidence":"MEDIUM","files":["scripts/archive-doc.js:72","scripts/debt/generate-metrics.js:30","scripts/validate-audit.js:1"],"why_it_matters":"Some scripts have verbose() helper functions for debug output, others don't, leading to inconsistent debug capabilities. Makes troubleshooting harder when scripts don't expose internal state consistently.","suggested_fix":"Create shared logging utility (scripts/lib/logger.js) with consistent verbose/debug/info/warn/error methods. All scripts should import and use this utility for standardized output levels.","acceptance_tests":["Shared logging utility exists in scripts/lib/","All scripts use shared logger instead of raw console.*","Logger supports --verbose and --quiet flags consistently"],"file":"scripts/archive-doc.js","line":72,"description":"Some scripts have verbose() helper functions for debug output, others don't, leading to inconsistent debug capabilities. Makes troubleshooting harder when scripts don't expose internal state consistently.","recommendation":"Create shared logging utility (scripts/lib/logger.js) with consistent verbose/debug/info/warn/error methods. All scripts should import and use this utility for standardized output levels.","id":"process::scripts::verbose-logging"}
{"category":"process","title":"Inconsistent: Error message formatting","fingerprint":"process::scripts::error-message-format","severity":"S3","effort":"E1","confidence":"MEDIUM","files":["scripts/check-agent-compliance.js:163","scripts/check-backlog-health.js:103","scripts/security-check.js:415","scripts/validate-audit.js:753"],"why_it_matters":"Error messages use different formats: some use boxed separators (===, ---), some use simple prefixes. This creates inconsistent UX and makes it harder to parse errors programmatically.","suggested_fix":"Standardize error message format: [SCRIPT_NAME] LEVEL: message. Use consistent separator styles (=== for major sections, --- for subsections). Create error formatting utility function.","acceptance_tests":["All error messages follow standard format","Consistent use of separators across scripts","Error messages easily parseable by CI tools"],"file":"scripts/check-agent-compliance.js","line":163,"description":"Error messages use different formats: some use boxed separators (===, ---), some use simple prefixes. This creates inconsistent UX and makes it harder to parse errors programmatically.","recommendation":"Standardize error message format: [SCRIPT_NAME] LEVEL: message. Use consistent separator styles (=== for major sections, --- for subsections). Create error formatting utility function.","id":"process::scripts::error-message-format"}
{"category":"process","title":"Inconsistent: Command line argument parsing","fingerprint":"process::scripts::arg-parsing","severity":"S3","effort":"E2","confidence":"HIGH","files":["scripts/check-agent-compliance.js:29","scripts/archive-doc.js:52","scripts/debt/sync-sonarcloud.js:124"],"why_it_matters":"Scripts parse command line arguments differently: some use simple includes() checks, others have custom parseArgs() functions, creating inconsistent CLI interfaces and duplicated parsing logic.","suggested_fix":"Adopt a standard CLI parsing library (e.g., commander.js or yargs) for all scripts with complex arguments. For simple flags, use consistent pattern. Create shared argument parsing utilities.","acceptance_tests":["All scripts with 3+ arguments use standard CLI library","Simple flag-only scripts use consistent includes() pattern","Help text (--help) consistently formatted across scripts"],"file":"scripts/check-agent-compliance.js","line":29,"description":"Scripts parse command line arguments differently: some use simple includes() checks, others have custom parseArgs() functions, creating inconsistent CLI interfaces and duplicated parsing logic.","recommendation":"Adopt a standard CLI parsing library (e.g., commander.js or yargs) for all scripts with complex arguments. For simple flags, use consistent pattern. Create shared argument parsing utilities.","id":"process::scripts::arg-parsing"}
{"category":"process","title":"Inconsistent: File path validation and sanitization","fingerprint":"process::scripts::path-validation","severity":"S2","effort":"E2","confidence":"HIGH","files":["scripts/archive-doc.js:83","scripts/validate-audit.js:162","scripts/security-check.js:285"],"why_it_matters":"Path validation and sanitization logic is duplicated across scripts with slightly different implementations, risking security vulnerabilities if one implementation is weaker. Validation should be centralized.","suggested_fix":"Create shared path validation utilities in scripts/lib/validate-paths.js. Implement validatePathWithinRepo(), sanitizePath(), isSafeFilePath() once and reuse. Add comprehensive tests.","acceptance_tests":["Shared path validation utilities exist and are well-tested","All scripts use shared validation functions","Security team has reviewed centralized validation logic"],"file":"scripts/archive-doc.js","line":83,"description":"Path validation and sanitization logic is duplicated across scripts with slightly different implementations, risking security vulnerabilities if one implementation is weaker. Validation should be centralized.","recommendation":"Create shared path validation utilities in scripts/lib/validate-paths.js. Implement validatePathWithinRepo(), sanitizePath(), isSafeFilePath() once and reuse. Add comprehensive tests.","id":"process::scripts::path-validation"}
{"category":"process","title":"Inconsistent: Error sanitization approaches","fingerprint":"process::scripts::error-sanitization","severity":"S2","effort":"E1","confidence":"HIGH","files":["scripts/archive-doc.js:41","scripts/migrate-addresses.ts:14","scripts/debt/generate-metrics.js:49"],"why_it_matters":"Some scripts import sanitizeError utility, others inline error sanitization, and some don't sanitize at all. This creates security risk of exposing sensitive paths or tokens in error messages.","suggested_fix":"Ensure all scripts use shared sanitizeError() utility from scripts/lib/sanitize-error.js. Add ESLint rule to catch raw error.message usage. Document sanitization requirement in CONTRIBUTING.md.","acceptance_tests":["All scripts import and use sanitizeError() utility","No raw error.message in console.error() calls","ESLint catches unsanitized error output"],"file":"scripts/archive-doc.js","line":41,"description":"Some scripts import sanitizeError utility, others inline error sanitization, and some don't sanitize at all. This creates security risk of exposing sensitive paths or tokens in error messages.","recommendation":"Ensure all scripts use shared sanitizeError() utility from scripts/lib/sanitize-error.js. Add ESLint rule to catch raw error.message usage. Document sanitization requirement in CONTRIBUTING.md.","id":"process::scripts::error-sanitization"}
