{"id": "DUP-001", "locations": ["scripts/lib/sanitize-error.js", "scripts/lib/security-helpers.js", "scripts/lib/validate-paths.js"], "type": "duplicate_function", "description": "sanitizeError() function implemented identically in 3 files with same patterns (path regex, credential masking, redaction)", "severity": "S2", "recommendation": "extract to shared lib - consolidate into scripts/lib/sanitize-error.js as source of truth"}
{"id": "DUP-002", "locations": [".claude/hooks/auto-save-context.js", ".claude/hooks/track-agent-invocation.js", ".claude/hooks/check-mcp-servers.js"], "type": "duplicate_function", "description": "loadJson() and readState() helper functions with identical try/catch patterns for JSON.parse(readFileSync()) across multiple hooks", "severity": "S2", "recommendation": "extract to shared hooks/lib/file-helpers.js for reuse"}
{"id": "DUP-003", "locations": [".claude/hooks/auto-save-context.js", ".claude/hooks/track-agent-invocation.js", ".claude/hooks/session-start.js"], "type": "similar_logic", "description": "Path containment validation using path.relative() + startsWith/regex checks repeated 3+ times with identical logic patterns", "severity": "S2", "recommendation": "extract validatePathContainment() to shared hooks/lib/path-helpers.js"}
{"id": "DUP-004", "locations": ["scripts/debt/validate-schema.js", "scripts/debt/intake-audit.js", "scripts/debt/extract-audits.js"], "type": "duplicate_function", "description": "Identical validation logic for VALID_CATEGORIES, VALID_SEVERITIES, VALID_TYPES, VALID_STATUSES, VALID_EFFORTS across 3 debt scripts", "severity": "S2", "recommendation": "consolidate schema definitions into scripts/debt/lib/schema.js"}
{"id": "DUP-005", "locations": ["scripts/check-document-sync.js", "scripts/check-docs-light.js"], "type": "similar_logic", "description": "Markdown link pattern detection and validation logic with bounded regex [([^]]{1,200})]([^)]{1,500}) in both files", "severity": "S3", "recommendation": "extract to scripts/lib/markdown-validation.js"}
{"id": "DUP-006", "locations": ["scripts/debt/intake-audit.js", "scripts/debt/extract-audits.js", "scripts/debt/normalize-all.js"], "type": "copy_paste", "description": "normalizeFilePath() function with identical Windows backslash handling and drive letter preservation logic", "severity": "S2", "recommendation": "consolidate into scripts/debt/lib/path-helpers.js"}
{"id": "DUP-007", "locations": ["scripts/lib/security-helpers.js", "scripts/lib/validate-paths.js"], "type": "copy_paste", "description": "sanitizeFilesystemError() logic for path redaction ([HOME], [DRIVE], [TMP]) repeated with minor variations", "severity": "S2", "recommendation": "use unified implementation from sanitize-error.js"}
{"id": "DUP-008", "locations": [".claude/hooks/auto-save-context.js", ".claude/hooks/track-agent-invocation.js"], "type": "duplicate_function", "description": "writeState() and saveJson() atomic write pattern using temp files + rename across hooks", "severity": "S2", "recommendation": "extract to hooks/lib/file-helpers.js as atomic write utility"}
{"id": "DUP-009", "locations": ["scripts/debt/intake-audit.js", "scripts/debt/extract-audits.js"], "type": "duplicate_function", "description": "getSourceId() and ID field extraction logic (trying multiple field names) in audit processing", "severity": "S3", "recommendation": "consolidate into scripts/debt/lib/id-helpers.js"}
{"id": "DUP-010", "locations": ["scripts/check-pattern-compliance.js", "scripts/pattern-check.js", ".claude/hooks/pattern-check.js"], "type": "duplicate_function", "description": "Global regex compile with state reset pattern (pattern.lastIndex = 0) before exec() loops appears 15+ times across codebase", "severity": "S1", "recommendation": "create scripts/lib/regex-helpers.js with safeRegexExec() wrapper"}
{"id": "DUP-011", "locations": [".claude/hooks/check-edit-requirements.js", ".claude/hooks/check-write-requirements.js"], "type": "similar_logic", "description": "Identical project directory validation and path.relative() containment check patterns", "severity": "S2", "recommendation": "extract validateProjectPath() to hooks/lib/path-helpers.js"}
{"id": "DUP-012", "locations": ["scripts/lib/security-helpers.js", "scripts/lib/validate-paths.js", ".claude/hooks/check-mcp-servers.js"], "type": "copy_paste", "description": "Path traversal prevention regex /^..(?:[\\\\/]|$)/ implemented identically in 3+ locations", "severity": "S1", "recommendation": "define once in scripts/lib/constants.js as PATH_TRAVERSAL_PATTERN"}
{"id": "DUP-013", "locations": ["scripts/debt/intake-audit.js", "scripts/debt/validate-schema.js", "scripts/debt/check-phase-status.js"], "type": "duplicate_function", "description": "ensureValid() and validation helper with identical pattern to filter values against VALID_* sets", "severity": "S2", "recommendation": "consolidate into scripts/debt/lib/validation-helpers.js"}
{"id": "DUP-014", "locations": [".claude/hooks/auto-save-context.js", ".claude/hooks/track-agent-invocation.js", ".claude/hooks/audit-s0s1-validator.js"], "type": "copy_paste", "description": "Session state file reading from .claude/hooks/.session-state.json with identical try/catch blocks", "severity": "S2", "recommendation": "extract getSessionState() to hooks/lib/session-helpers.js"}
{"id": "DUP-015", "locations": ["scripts/check-docs-light.js", "scripts/check-document-sync.js", "scripts/validate-audit.js"], "type": "similar_logic", "description": "Date parsing and staleness checking with identical logic for >90 days threshold", "severity": "S3", "recommendation": "extract checkStaleness() to scripts/lib/date-helpers.js"}
{"id": "DUP-016", "locations": ["scripts/debt/extract-audits.js", "scripts/debt/extract-reviews.js", "scripts/debt/extract-sonarcloud.js"], "type": "duplicate_function", "description": "normalizeCategory() and normalizeEffort() mapping functions with identical category/effort maps", "severity": "S2", "recommendation": "consolidate into scripts/debt/lib/normalization.js"}
{"id": "DUP-017", "locations": [".claude/hooks/auto-save-context.js", ".claude/hooks/check-mcp-servers.js"], "type": "copy_paste", "description": "Output truncation and sanitization logic (substring(0, maxLen) + '...') repeated identically", "severity": "S3", "recommendation": "extract truncateOutput() to scripts/lib/output-helpers.js"}
{"id": "DUP-018", "locations": ["scripts/lib/security-helpers.js", "scripts/lib/validate-paths.js", "scripts/check-docs-light.js"], "type": "copy_paste", "description": "Platform-specific path normalization for Windows (backslash to forward slash) and relative path checks", "severity": "S2", "recommendation": "create scripts/lib/path-normalization.js with normalizePathForComparison()"}
{"id": "DUP-019", "locations": ["scripts/debt/intake-audit.js", "scripts/debt/intake-manual.js", "scripts/debt/intake-pr-deferred.js"], "type": "duplicate_function", "description": "Content hash generation for deduplication using crypto.createHash with identical file path normalization", "severity": "S2", "recommendation": "consolidate into scripts/debt/lib/hash-helpers.js as generateContentHash()"}
{"id": "DUP-020", "locations": [".claude/hooks/alerts-reminder.js", ".claude/hooks/auto-save-context.js", ".claude/hooks/generate-pending-alerts.js"], "type": "copy_paste", "description": "JSON alert parsing with identical try/catch + fallback empty array pattern across 3+ alert hooks", "severity": "S3", "recommendation": "extract loadAlerts() to hooks/lib/alert-helpers.js"}
