{"id":"CODE-001","category":"Testing","severity":"S1","effort":"E1","confidence":"HIGH","verified":"TOOL_VALIDATED","file":"tests/scripts/check-docs-light.test.ts","line":199,"title":"5 failing tests in check-docs-light.test.ts","description":"5 tests failing in check-docs-light.test.ts: 'checks for required sections', 'validates internal links', 'checks Last Updated date', 'exits 0 when no errors found', 'exits 1 when errors found'. Tests appear to have issues with extractJSON parsing or script behavior changes.","recommendation":"Debug the check-docs-light.js script and update tests to match current behavior. Tests expect JSON output but may not be parsing correctly.","evidence":["npm test output: 5 failing tests","AssertionError: actual=1, expected=0 in 'exits 0 when no errors found'","AssertionError: actual=0, expected=1 in 'exits 1 when errors found'"],"cross_ref":"tests"}
{"id":"CODE-002","category":"Hygiene","severity":"S2","effort":"E1","confidence":"HIGH","verified":"MANUAL_ONLY","file":"components/notebook/pages/today-page.tsx","line":396,"title":"Debug console.log statements in production code","description":"12 console.log/error statements in today-page.tsx used for debugging. While wrapped in NODE_ENV checks, these add noise and should use structured logging.","recommendation":"Replace debug console statements with the project's logger utility (lib/logger.ts) which provides structured logging and Sentry integration.","evidence":["console.log(\"ðŸ’¾ Attempting to save:\", saveData) at line 396","console.log(\"ðŸ“Š Weekly Stats Debug:\", ...) at lines 511, 524, 529, 532, 545, 562, 584","console.error(\"âŒ Save failed with error:\", error) at line 422"],"cross_ref":"MANUAL_ONLY"}
{"id":"CODE-003","category":"Framework","severity":"S2","effort":"E2","confidence":"MEDIUM","verified":"TOOL_VALIDATED","file":"functions/src/admin.ts","line":1726,"title":"High cognitive complexity in adminSetUserPrivilege","description":"SonarCloud reports cognitive complexity of 16 (threshold 15) for adminSetUserPrivilege function. Function handles privilege validation, security logging, and Firestore operations.","recommendation":"Extract privilege type validation into a separate helper function to reduce cognitive load.","evidence":["SonarCloud rule typescript:S3776","Cognitive Complexity from 16 to the 15 allowed"],"cross_ref":"eslint"}
{"id":"CODE-004","category":"Framework","severity":"S1","effort":"E2","confidence":"HIGH","verified":"TOOL_VALIDATED","file":"functions/src/admin.ts","line":1835,"title":"Very high cognitive complexity in adminListUsers","description":"SonarCloud reports cognitive complexity of 34 (threshold 15) for adminListUsers function. Function handles pagination, cursor validation, sorting, and data transformation.","recommendation":"Break down into smaller functions: extractCursorValue(), buildUserQuery(), transformUserResults(). Each handles one concern.","evidence":["SonarCloud rule typescript:S3776","Cognitive Complexity from 34 to the 15 allowed","Function spans 75+ lines with nested conditionals"],"cross_ref":"eslint"}
{"id":"CODE-005","category":"Framework","severity":"S2","effort":"E2","confidence":"HIGH","verified":"TOOL_VALIDATED","file":"components/admin/users-tab.tsx","line":84,"title":"High cognitive complexity in UsersTab component","description":"SonarCloud reports cognitive complexity of 27 (threshold 15) for UsersTab function. Component manages pagination, search, detail drawer, editing, and privilege state.","recommendation":"Extract sub-components: UserSearchSection, UserDetailDrawer, PrivilegeEditor. Use custom hooks for state management.","evidence":["SonarCloud rule typescript:S3776","Cognitive Complexity from 27 to the 15 allowed","924 total lines in file"],"cross_ref":"eslint"}
{"id":"CODE-006","category":"Framework","severity":"S3","effort":"E0","confidence":"HIGH","verified":"TOOL_VALIDATED","file":"components/admin/logs-tab.tsx","line":287,"title":"void operator usage flagged by SonarCloud","description":"SonarCloud flags 'void refresh(() => active)' as code smell. The void operator is used to explicitly discard the Promise return value.","recommendation":"This is intentional to handle async functions in event handlers. Consider adding a comment explaining the pattern or using .catch() for explicit error handling.","evidence":["SonarCloud rule typescript:S3735","void refresh(() => active) at line 287","void refresh() at line 334"],"cross_ref":"eslint"}
{"id":"CODE-007","category":"Debugging","severity":"S2","effort":"E2","confidence":"MEDIUM","verified":"MANUAL_ONLY","file":"lib/logger.ts","line":1,"title":"No correlation/request ID tracing","description":"Logger does not include correlation IDs or request tracing. Frontend-to-backend requests cannot be traced through logs.","recommendation":"Add correlation ID generation in frontend, pass through Cloud Function calls, and include in all log entries for end-to-end tracing.","evidence":["grep for 'correlation.?id' returned no matches in lib/ or functions/","Logger captures context but no unique request identifier"],"cross_ref":"MANUAL_ONLY"}
{"id":"CODE-008","category":"Types","severity":"S3","effort":"E0","confidence":"HIGH","verified":"MANUAL_ONLY","file":"components/notebook/pages/resources-page.tsx","line":444,"title":"@ts-expect-error suppression for type mismatch","description":"TypeScript error suppressed with @ts-expect-error comment. The setGenderFilter expects specific union type but receives broader string.","recommendation":"Cast the option value explicitly or narrow the type at the call site rather than suppressing the error.","evidence":["// @ts-expect-error - option is \"All\" | \"Men\" | \"Women\" which are valid values for setGenderFilter"],"cross_ref":"typescript"}
{"id":"CODE-009","category":"Hygiene","severity":"S3","effort":"E0","confidence":"MEDIUM","verified":"MANUAL_ONLY","file":"lib/database/firestore-adapter.ts","line":51,"title":"TODO comment for unimplemented feature","description":"TODO comment indicates FirestoreService doesn't support configurable limits yet.","recommendation":"Either implement configurable limits in FirestoreService or track as technical debt in TECHNICAL_DEBT.md.","evidence":["// TODO: Pass limit to FirestoreService when it supports configurable limits"],"cross_ref":"MANUAL_ONLY"}
{"id":"CODE-010","category":"Hygiene","severity":"S3","effort":"E0","confidence":"MEDIUM","verified":"MANUAL_ONLY","file":"components/notebook/features/quick-actions-fab.tsx","line":12,"title":"TODO comment for user preferences feature","description":"TODO comment for making action buttons customizable by user.","recommendation":"Track in ROADMAP.md or TECHNICAL_DEBT.md if this is a planned feature.","evidence":["// TODO: Make action buttons customizable by user (save preferences to profile/localStorage)"],"cross_ref":"MANUAL_ONLY"}
{"id":"CODE-011","category":"Framework","severity":"S3","effort":"E1","confidence":"MEDIUM","verified":"TOOL_VALIDATED","file":"functions/src/jobs.ts","line":620,"title":"Useless assignment to hasMore variable","description":"SonarCloud reports useless assignment to variable 'hasMore'. Variable is assigned but may not be used after.","recommendation":"Remove the assignment or verify hasMore is actually used in the return value or subsequent logic.","evidence":["SonarCloud rule typescript:S1854","Remove this useless assignment to variable \"hasMore\""],"cross_ref":"eslint"}
{"id":"CODE-012","category":"Framework","severity":"S2","effort":"E1","confidence":"HIGH","verified":"TOOL_VALIDATED","file":"components/admin/admin-tabs.tsx","line":64,"title":"Nested component definition","description":"SonarCloud flags component definition inside parent component. This causes unnecessary re-renders and breaks React optimization.","recommendation":"Move the inner component outside the parent and pass data as props.","evidence":["SonarCloud rule typescript:S6478","Move this component definition out of the parent component"],"cross_ref":"eslint"}
{"id":"CODE-013","category":"Framework","severity":"S3","effort":"E1","confidence":"HIGH","verified":"TOOL_VALIDATED","file":"components/admin/logs-tab.tsx","line":481,"title":"Nested ternary operator","description":"SonarCloud flags nested ternary operation which reduces readability.","recommendation":"Extract to a helper function or use if/else statements for clarity.","evidence":["SonarCloud rule typescript:S3358","Extract this nested ternary operation into an independent statement"],"cross_ref":"eslint"}
{"id":"CODE-014","category":"Framework","severity":"S3","effort":"E1","confidence":"HIGH","verified":"TOOL_VALIDATED","file":"functions/src/admin.ts","line":1388,"title":"Nested template literals (6 occurrences)","description":"SonarCloud flags nested template literals at lines 1388-1393. These reduce code readability.","recommendation":"Extract nested expressions to variables before interpolation.","evidence":["SonarCloud rule typescript:S4624","Refactor this code to not use nested template literals","Lines 1388-1393 all flagged"],"cross_ref":"eslint"}
