{"category":"ai-optimization","title":"session-begin SKILL.md reads ROADMAP.md (3164 lines) in full at every session start","fingerprint":"ai-optimization::.claude/skills/session-begin/SKILL.md::full-roadmap-read","severity":"S2","effort":"E1","confidence":92,"files":[".claude/skills/session-begin/SKILL.md","ROADMAP.md"],"why_it_matters":"ROADMAP.md is 3164 lines. Reading it fully at session start consumes ~4K tokens of context window. Session-begin only needs the Active Sprint section (typically <100 lines). This happens every session, so cumulative token waste is significant.","suggested_fix":"Change session-begin Step 1 and Step 3 to read only the Active Sprint section of ROADMAP.md using offset/limit parameters (e.g., Read with limit:100 from the Active Sprint header). Add a grep-first pattern to find the section offset dynamically.","acceptance_tests":["session-begin reads ROADMAP.md with offset/limit targeting Active Sprint section","Full ROADMAP.md is NOT loaded into context at session start","Active Sprint status is still correctly displayed to user"]}
{"category":"ai-optimization","title":"session-begin instructs reading CODE_PATTERNS.md (600 lines) at startup via Section 6","fingerprint":"ai-optimization::.claude/skills/session-begin/SKILL.md::code-patterns-startup-read","severity":"S3","effort":"E1","confidence":85,"files":[".claude/skills/session-begin/SKILL.md","docs/agent_docs/CODE_PATTERNS.md"],"why_it_matters":"Section 6 of session-begin instructs scanning CODE_PATTERNS.md Quick Reference section. The instruction to 'scan claude.md Section 4 and CODE_PATTERNS.md Quick Reference section' can lead to a full 600-line read when only the Quick Reference (~50 lines) is needed. This is Tier 2 content loaded at Tier 1 time.","suggested_fix":"Make Section 6 explicit: 'Read CODE_PATTERNS.md lines 1-60 only (Quick Reference section)' or add a grep command to find the Quick Reference offset. Remove from always-load and move to on-demand when actually writing code.","acceptance_tests":["CODE_PATTERNS.md is not fully loaded at session start","Quick Reference section is available when code writing begins","Full CODE_PATTERNS.md is only loaded when investigating specific patterns"]}
{"category":"ai-optimization","title":"session-begin reads Technical Debt INDEX.md + AI_WORKFLOW.md + DOCUMENT_DEPENDENCIES.md as mandatory","fingerprint":"ai-optimization::.claude/skills/session-begin/SKILL.md::excessive-mandatory-reads","severity":"S2","effort":"E1","confidence":88,"files":[".claude/skills/session-begin/SKILL.md"],"why_it_matters":"Session-begin Steps 8, 9, and implicit references load INDEX.md (152 lines), DOCUMENT_DEPENDENCIES.md (423 lines), and trigger crossdoc:check which reads multiple files. These reads are mandatory every session but are only actionable when there are actual issues. Combined with ROADMAP (3164) and SESSION_CONTEXT (224), the mandatory startup read set exceeds 4000 lines.","suggested_fix":"Make Steps 8 and 9 conditional: only read INDEX.md if TDMS metrics show S0 items (already checked by session-start.js hook), only run crossdoc:check if docs were modified since last session (check via git diff). Move from 'mandatory every session' to 'mandatory when relevant'.","acceptance_tests":["Steps 8-9 are conditional on relevant changes","Total mandatory startup reads are under 500 lines when no issues detected","crossdoc:check only runs when doc files changed since last session"]}
{"category":"ai-optimization","title":"session-start.js hook outputs ~50 lines of checklist text injected into context","fingerprint":"ai-optimization::.claude/hooks/session-start.js::checklist-stdout-bloat","severity":"S2","effort":"E1","confidence":90,"files":[".claude/hooks/session-start.js"],"why_it_matters":"Lines 482-505 of session-start.js output a 25-line SESSION CHECKLIST and Tips section to stdout, which gets injected into Claude's context. This duplicates information already in session-begin SKILL.md (which Claude reads anyway when /session-begin is invoked). The hook also outputs environment info, pattern check results, consolidation status, and TDMS metrics totaling ~50 lines of stdout context injection per session.","suggested_fix":"Move the SESSION CHECKLIST output (lines 482-505) from stdout to stderr so it's visible to the user but not injected into Claude's context. Keep only actionable warnings (failed checks, S0 items) on stdout. The SKILL.md already contains the full checklist.","acceptance_tests":["SESSION CHECKLIST text is on stderr not stdout","Only warnings and actionable items go to stdout","Total stdout from session-start.js is under 10 lines when no issues"]}
{"category":"ai-optimization","title":"compact-restore.js injects full recovery context (~30 lines) even when handoff is stale","fingerprint":"ai-optimization::.claude/hooks/compact-restore.js::stale-handoff-injection","severity":"S3","effort":"E1","confidence":78,"files":[".claude/hooks/compact-restore.js"],"why_it_matters":"compact-restore.js always outputs the full recovery block to stdout (lines 122-155, ~30 lines) regardless of how old the handoff data is. If handoff.json is hours or days old (from a previous session), it injects irrelevant recovery context. There is no staleness check beyond displaying the age.","suggested_fix":"Add a staleness threshold (e.g., 60 minutes). If handoff.json is older than threshold, output a 1-line summary to stdout ('Stale handoff found (Xh ago) - run /session-begin for fresh context') instead of the full recovery block. Keep full output only for recent compactions.","acceptance_tests":["Handoff data older than 60 minutes produces a 1-line summary on stdout","Recent compaction (under 60 min) still gets full recovery context","Stale handoff notification directs to /session-begin"]}
{"category":"ai-optimization","title":"pr-review SKILL.md is 840 lines loaded entirely when skill is invoked","fingerprint":"ai-optimization::.claude/skills/pr-review/SKILL.md::oversized-skill-file","severity":"S2","effort":"E2","confidence":85,"files":[".claude/skills/pr-review/SKILL.md"],"why_it_matters":"At 840 lines, pr-review is one of the largest skill files. It includes detailed examples, anti-patterns, agent selection matrices, and error handling that consume ~10K tokens. Much of this (Steps 6.5 TDMS integration, Step 7.5 health check, future enhancements) is rarely needed in a single invocation.","suggested_fix":"Split pr-review SKILL.md into a core protocol (~300 lines covering Steps 0-5) and a reference section in a separate file (pr-review/REFERENCE.md) covering Steps 6-9, TDMS integration, and examples. The core file instructs to read REFERENCE.md only when reaching those steps.","acceptance_tests":["pr-review SKILL.md core is under 400 lines","Reference sections are in a separate file loaded on-demand","Full PR review workflow still functions correctly"]}
{"category":"ai-optimization","title":"audit-comprehensive SKILL.md is 854 lines loaded entirely for every comprehensive audit","fingerprint":"ai-optimization::.claude/skills/audit-comprehensive/SKILL.md::oversized-skill-file","severity":"S2","effort":"E2","confidence":82,"files":[".claude/skills/audit-comprehensive/SKILL.md"],"why_it_matters":"At 854 lines, audit-comprehensive is the largest skill file. It includes detailed stage instructions, recovery matrices, triage formulas, and version history. The recovery section (lines 716-752) and triage section (lines 559-654) are only needed in specific circumstances, not on every invocation.","suggested_fix":"Extract the Recovery section and Triage & Roadmap Integration section into separate reference files. The main SKILL.md should reference them with 'If context compacts, read audit-comprehensive/RECOVERY.md' and 'After TDMS intake, read audit-comprehensive/TRIAGE.md'.","acceptance_tests":["audit-comprehensive SKILL.md is under 500 lines","Recovery instructions are loaded only when resuming from compaction","Triage instructions are loaded only after audit completion"]}
{"category":"ai-optimization","title":"10 PostToolUse hooks fire on every Write operation creating cumulative latency","fingerprint":"ai-optimization::.claude/settings.json::write-hook-overload","severity":"S2","effort":"E2","confidence":88,"files":[".claude/settings.json"],"why_it_matters":"Every Write tool invocation triggers 10 PostToolUse hooks sequentially: check-requirements, audit-s0s1-validator, pattern-check, component-size-check, firestore-write-block, test-mocking-validator, app-check-validator, typescript-strict-check, repository-pattern-check, agent-trigger-enforcer. Most of these produce 'ok' (no context injection) but each adds ~50-100ms latency. For sessions with 50+ writes, this adds 25-50 seconds of cumulative delay.","suggested_fix":"Consolidate domain-specific validators (firestore-write-block, test-mocking-validator, app-check-validator, typescript-strict-check, repository-pattern-check) into a single check-code-patterns.js hook that does file-path-based routing internally. This reduces 10 process spawns to 4-5 per Write. Each duplicate hook also has its own path parsing and security validation boilerplate.","acceptance_tests":["Write operations trigger 5 or fewer PostToolUse hooks","All validation checks still run (consolidated, not removed)","Average per-Write hook latency is under 300ms"]}
{"category":"ai-optimization","title":"Edit and MultiEdit hook lists are identical 9-hook copies of Write hooks","fingerprint":"ai-optimization::.claude/settings.json::duplicated-hook-lists","severity":"S3","effort":"E1","confidence":95,"files":[".claude/settings.json"],"why_it_matters":"The Edit and MultiEdit PostToolUse hook arrays (settings.json lines 114-210) are near-exact copies of the Write hooks (minus audit-s0s1-validator). This triplicates configuration maintenance. When a hook is added or removed, all three sections must be updated. The settings.json file is 293 lines, with ~180 lines being duplicated hook definitions.","suggested_fix":"Use a single matcher pattern like '^(?i)(write|edit|multiedit)$' for the shared hooks, and keep Write-only hooks (audit-s0s1-validator) in a separate Write-specific entry. This reduces settings.json by ~120 lines and eliminates sync drift risk.","acceptance_tests":["settings.json has one shared hook block for write/edit/multiedit","Write-only hooks have a separate entry","Total settings.json is under 180 lines"]}
{"category":"ai-optimization","title":"alerts-reminder.js injects context-consuming messages on every UserPromptSubmit","fingerprint":"ai-optimization::.claude/hooks/alerts-reminder.js::context-injection-every-prompt","severity":"S2","effort":"E1","confidence":85,"files":[".claude/hooks/alerts-reminder.js"],"why_it_matters":"alerts-reminder.js runs on every UserPromptSubmit and outputs to stdout (console.log) which injects into Claude's context. When alerts exist and context threshold is exceeded, it injects 3-4 lines per user message. Over a session with 30+ user messages, this adds ~100 lines of repeated 'ALERTS: N pending' and 'CONTEXT: N files read' text to the conversation context.","suggested_fix":"Add a cooldown mechanism: only inject context-consuming alert text once per 10 minutes (or once per session). Use a state file to track last injection time. Subsequent prompts within the cooldown should output to stderr (user-visible) instead of stdout (context-consuming).","acceptance_tests":["Alert text is injected to stdout at most once per 10 minutes","Subsequent reminders go to stderr","Total context injection from alerts-reminder is under 5 lines per session"]}
{"category":"ai-optimization","title":"analyze-user-request.js high-confidence matches inject directive into context on every match","fingerprint":"ai-optimization::.claude/hooks/analyze-user-request.js::directive-context-injection","severity":"S3","effort":"E1","confidence":80,"files":[".claude/hooks/analyze-user-request.js"],"why_it_matters":"When analyze-user-request.js matches a high-confidence pattern (e.g., any mention of 'bug', 'broken', 'css', 'tailwind'), it injects a PRE-TASK directive to stdout. This happens on every matching UserPromptSubmit. In a debugging session, every message mentioning 'bug' reinjects 'PRE-TASK: MUST use systematic-debugging skill FIRST' consuming context tokens. The agent-trigger-enforcer already tracks this per-session.","suggested_fix":"Add session-level deduplication: track which directives have been emitted this session (via state file). Only inject to stdout on first occurrence per directive type. Subsequent matches should go to stderr or be suppressed entirely.","acceptance_tests":["Each PRE-TASK directive type is injected to stdout at most once per session","Subsequent matches of same pattern go to stderr","State file tracks emitted directives per session"]}
{"category":"ai-optimization","title":"session-begin SKILL.md is 361 lines with redundant duplicate-detection and cross-session validation sections","fingerprint":"ai-optimization::.claude/skills/session-begin/SKILL.md::skill-bloat","severity":"S3","effort":"E1","confidence":82,"files":[".claude/skills/session-begin/SKILL.md"],"why_it_matters":"session-begin SKILL.md at 361 lines is loaded into context every session start. Sections 0b (Cross-Session Validation, lines 71-95) and 1b (Session Gap Detection, lines 144-166) describe functionality that is already automated by hooks (session-start.js and check-session-gaps.js). The SKILL repeats explanations of systems that run automatically, consuming ~60 lines of context for information the agent does not need to act on.","suggested_fix":"Remove sections 0b and 1b from SKILL.md since these are handled by hooks automatically. Replace with a 2-line note: 'Cross-session validation and gap detection run automatically via hooks. Check hook output above for any warnings.' This saves ~60 lines of context per session.","acceptance_tests":["session-begin SKILL.md is under 300 lines","Automated hook sections are replaced with brief references","Cross-session validation still functions via hooks"]}
{"category":"ai-optimization","title":"3 hooks on every Read operation add latency without context benefit for most reads","fingerprint":"ai-optimization::.claude/settings.json::read-hook-overhead","severity":"S3","effort":"E1","confidence":80,"files":[".claude/settings.json",".claude/hooks/large-context-warning.js",".claude/hooks/auto-save-context.js",".claude/hooks/compaction-handoff.js"],"why_it_matters":"Every Read tool invocation triggers 3 PostToolUse hooks: large-context-warning.js, auto-save-context.js, and compaction-handoff.js. Each spawns a Node.js process, reads state files, and checks thresholds. For the first 15-20 reads in a session (before any threshold is hit), all 3 hooks do nothing but return 'ok'. In a typical session with 30+ reads, the first 15 reads each spawn 3 unnecessary processes.","suggested_fix":"Consolidate the 3 Read hooks into a single context-monitor.js hook that handles all tracking, warnings, auto-save, and handoff preparation in one process spawn. This reduces per-Read overhead from 3 process spawns to 1, and shares state file reads.","acceptance_tests":["Read operations trigger 1 PostToolUse hook instead of 3","All context tracking, warnings, and handoff features still work","Per-Read hook latency is under 100ms"]}
{"category":"ai-optimization","title":"code-reviewer SKILL.md contains generic boilerplate not specific to this project","fingerprint":"ai-optimization::.claude/skills/code-reviewer/SKILL.md::generic-boilerplate","severity":"S3","effort":"E1","confidence":78,"files":[".claude/skills/code-reviewer/SKILL.md"],"why_it_matters":"code-reviewer SKILL.md is 313 lines, of which ~150 lines (sections: Tech Stack, Development Workflow, Common Commands, Troubleshooting) are generic boilerplate mentioning Python, Docker, Kubernetes, PostgreSQL, Flutter, etc. that are not part of this project's stack. This wastes ~2K tokens of context with irrelevant information every time the code-reviewer skill is invoked.","suggested_fix":"Remove generic boilerplate sections (Tech Stack generic list, Development Workflow generic setup, Common Commands generic docker/k8s, Troubleshooting generic). Keep only the SoNash-specific Script Checklist (lines 188-204) and the project-relevant review guidance. Target: under 200 lines.","acceptance_tests":["code-reviewer SKILL.md is under 200 lines","No references to technologies not in this project (Docker, K8s, PostgreSQL, Flutter)","SoNash-specific Script Checklist is preserved"]}
