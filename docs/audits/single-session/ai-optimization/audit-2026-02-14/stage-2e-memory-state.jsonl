{"category":"ai-optimization","title":"commit-log.jsonl has no rotation/size-cap logic (39KB, append-only)","fingerprint":"ai-optimization::.claude/state/commit-log.jsonl::no-rotation","severity":"S2","effort":"E1","confidence":95,"files":[".claude/state/commit-log.jsonl",".claude/hooks/commit-tracker.js"],"why_it_matters":"commit-log.jsonl is append-only with no rotation, archival, or size-cap logic. At 39KB after ~10 days of use, it will grow unbounded over months. STATE_SCHEMA.md explicitly notes 'Append-only. No automatic cleanup.' The handoff.json pre-compaction save embeds the FULL commitLog array (currently 15+ entries with filesList arrays), amplifying the bloat.","suggested_fix":"Add rotation logic to commit-tracker.js: when line count exceeds 500, archive older entries to commit-log.archive.jsonl and truncate to most recent 200. Alternatively, add a prune step to session-end that keeps only the last 30 days of entries.","acceptance_tests":["commit-log.jsonl stays under 200 lines after rotation runs","Archived entries are preserved in commit-log.archive.jsonl","session-begin gap detection still works after rotation"]}
{"category":"ai-optimization","title":"handoff.json embeds full commitLog array (25KB, unbounded growth)","fingerprint":"ai-optimization::.claude/state/handoff.json::embedded-commit-log","severity":"S2","effort":"E1","confidence":95,"files":[".claude/state/handoff.json",".claude/hooks/pre-compaction-save.js"],"why_it_matters":"handoff.json is 25KB, with the commitLog array consuming most of that space. Each commit entry includes a filesList array of up to 30 paths. pre-compaction-save.js copies the entire commit-log.jsonl into handoff.json on every compaction. This duplicates data and makes handoff.json grow proportionally to total commit history.","suggested_fix":"In pre-compaction-save.js, limit commitLog to the last 15 entries (most recent session's commits). The full history remains in commit-log.jsonl for gap detection. compact-restore.js only needs recent context, not full history.","acceptance_tests":["handoff.json commitLog array contains at most 15 entries","handoff.json file size stays under 10KB","compact-restore.js still provides useful recovery context"]}
{"category":"ai-optimization","title":"reviews.jsonl has no rotation (19KB, 30+ entries, threshold is 50)","fingerprint":"ai-optimization::.claude/state/reviews.jsonl::no-rotation","severity":"S3","effort":"E1","confidence":90,"files":[".claude/state/reviews.jsonl",".claude/STATE_SCHEMA.md"],"why_it_matters":"STATE_SCHEMA.md recommends 'Archive recommended at >50 entries' but no code implements this archival. Currently at ~30 entries (19KB). Each entry contains patterns and learnings arrays. At current review velocity (~10/session), the 50-entry threshold will be hit within 2 sessions.","suggested_fix":"Add rotation logic to the consolidation script or session-end: when reviews.jsonl exceeds 50 lines, archive entries older than consolidation.lastConsolidatedReview to reviews.archive.jsonl.","acceptance_tests":["reviews.jsonl stays under 50 entries after archival runs","Archived reviews are preserved in reviews.archive.jsonl","consolidation.json threshold tracking still works"]}
{"category":"ai-optimization","title":"warned-files.json grows unbounded (4KB, 48 entries, no expiry)","fingerprint":"ai-optimization::.claude/state/warned-files.json::no-expiry","severity":"S3","effort":"E1","confidence":85,"files":[".claude/state/warned-files.json","scripts/check-pattern-compliance.js"],"why_it_matters":"warned-files.json tracks file::pattern combos that have been warned. Entries accumulate indefinitely with no expiry or cleanup. Currently 48 entries at 4KB. As more files are scanned and patterns added, this will grow linearly. Old entries for deleted files or resolved patterns waste space and could cause false graduation to blocking.","suggested_fix":"Add expiry logic to check-pattern-compliance.js: remove entries older than 30 days or where the referenced file no longer exists. Run cleanup at the start of each pattern check.","acceptance_tests":["Entries older than 30 days are removed on next pattern check run","Entries referencing deleted files are pruned","warned-files.json size stabilizes over time"]}
{"category":"ai-optimization","title":"task-audit-template-overhaul.state.json is stale (7 days, all steps pending)","fingerprint":"ai-optimization::.claude/state/task-audit-template-overhaul.state.json::stale-task","severity":"S3","effort":"E0","confidence":95,"files":[".claude/state/task-audit-template-overhaul.state.json"],"why_it_matters":"This task state file was last updated 2026-02-07, all 6 steps show 'pending' status, yet the audit template overhaul was completed (commit 360f714 on 2026-02-07). The session-end cleanup only removes task state files if no tasks are in_progress, but this file has status 'planned' (not 'in_progress'), so it persists. The handoff.json also embeds this stale state in taskStates, wasting space.","suggested_fix":"Delete the stale file manually now. Fix session-end cleanup logic to also remove task files with status 'planned' that are older than 7 days, or where all steps are 'pending' and lastUpdated is >3 days old.","acceptance_tests":["task-audit-template-overhaul.state.json is deleted","session-end cleanup handles 'planned' status files with age-based expiry","handoff.json no longer embeds stale taskStates"]}
{"category":"ai-optimization","title":"override-log.jsonl has no rotation or size cap","fingerprint":"ai-optimization::.claude/override-log.jsonl::no-rotation","severity":"S3","effort":"E1","confidence":85,"files":[".claude/override-log.jsonl","scripts/log-override.js"],"why_it_matters":"override-log.jsonl is append-only with no rotation logic. Currently small (5 entries) but will grow unbounded over time. Unlike commit-log.jsonl which at least has documentation noting the gap, override-log.jsonl has no size management mentioned anywhere.","suggested_fix":"Add rotation in log-override.js: when entries exceed 100, archive older entries. Alternatively, add to session-end cleanup to prune entries older than 90 days.","acceptance_tests":["override-log.jsonl stays under 100 entries after rotation","Old entries are archived, not deleted","log-override.js --list still works after rotation"]}
{"category":"ai-optimization","title":"agent-invocations.jsonl has no rotation or size cap","fingerprint":"ai-optimization::.claude/state/agent-invocations.jsonl::no-rotation","severity":"S3","effort":"E1","confidence":85,"files":[".claude/state/agent-invocations.jsonl",".claude/hooks/track-agent-invocation.js"],"why_it_matters":"agent-invocations.jsonl is append-only with no cleanup logic. Currently tiny (1 entry, 123 bytes) but designed to log every agent invocation. With increased agent usage, this will accumulate rapidly. No rotation, archival, or session-based cleanup exists.","suggested_fix":"Add size-cap logic to track-agent-invocation.js: if file exceeds 200 lines, truncate to most recent 100. Or add to session-end cleanup.","acceptance_tests":["agent-invocations.jsonl stays under 200 lines","Truncation preserves most recent entries","alerts/run-alerts.js still reads the file correctly after truncation"]}
{"category":"ai-optimization","title":"velocity-log.jsonl has malformed sprint field data","fingerprint":"ai-optimization::.claude/state/velocity-log.jsonl::malformed-sprint","severity":"S2","effort":"E1","confidence":100,"files":[".claude/state/velocity-log.jsonl","scripts/velocity/track-session.js"],"why_it_matters":"All 5 entries in velocity-log.jsonl have a malformed sprint field containing what appears to be a full markdown table row instead of a sprint name (e.g., 'M1 - Foundation** | Complete | 100% | Foundation | P0 | - |'). The regex parsing in track-session.js is capturing too much from ROADMAP.md. This corrupts velocity analytics and trend calculations.","suggested_fix":"Fix the sprint extraction regex in track-session.js to capture only the sprint name (e.g., 'M1 - Foundation'). Retroactively fix existing entries or delete and re-seed the file.","acceptance_tests":["New velocity-log entries have clean sprint names like 'M1 - Foundation'","Sprint field contains no markdown table syntax","Existing malformed entries are corrected or the file is re-seeded"]}
{"category":"ai-optimization","title":".claude/tmp-alerts.json persists across sessions (temp file not cleaned up)","fingerprint":"ai-optimization::.claude/tmp-alerts.json::persistent-temp","severity":"S3","effort":"E0","confidence":90,"files":[".claude/tmp-alerts.json",".claude/skills/alerts/scripts/run-alerts.js"],"why_it_matters":"tmp-alerts.json is an untracked temporary file that persists across sessions. It appears in git status as untracked. session-end cleanup does not remove it. Temp files should be cleaned up after use or on session start.","suggested_fix":"Add cleanup of .claude/tmp-*.json to session-end step 6 or session-start.js. The alerts script should use a proper temp directory or clean up after itself.","acceptance_tests":["No .claude/tmp-*.json files persist after session-end runs","session-start.js cleans up stale temp files from previous sessions"]}
{"category":"ai-optimization","title":"session-end does not clean .session-agents.json or .agent-trigger-state.json","fingerprint":"ai-optimization::.claude/skills/session-end/SKILL.md::missing-ephemeral-cleanup","severity":"S3","effort":"E0","confidence":90,"files":[".claude/skills/session-end/SKILL.md",".claude/hooks/.session-state.json"],"why_it_matters":"session-end step 4 reads .session-agents.json and .agent-trigger-state.json for compliance review but never deletes them. Step 6 only removes pending-reviews.json and conditionally handoff.json. These ephemeral state files should be cleaned up at session end to prevent stale data from affecting the next session's agent tracking.","suggested_fix":"Add rm -f commands in session-end step 6 for .claude/hooks/.session-agents.json and .claude/hooks/.agent-trigger-state.json after the compliance review is complete.","acceptance_tests":[".session-agents.json is deleted after session-end step 6",".agent-trigger-state.json is deleted after session-end step 6","Next session starts with clean agent tracking state"]}
{"category":"ai-optimization","title":"MEMORY.md is within size limits but contains completed/stale entries","fingerprint":"ai-optimization::MEMORY.md::stale-entries","severity":"S3","effort":"E0","confidence":80,"files":["C:\\Users\\jason\\.claude\\projects\\C--Users-jason-Workspace-dev-projects-sonash-v0\\memory\\MEMORY.md"],"why_it_matters":"MEMORY.md contains entries marked as 'COMPLETE' (Multi-AI Audit Skill Evaluation) that no longer need to occupy memory space. The 'eval wrappers removed' note is historical context that could be archived. At ~55 lines the file is well within the 200-line limit, but proactive cleanup prevents accumulation. The currentDate entry (2026-02-14) also needs manual updating.","suggested_fix":"Remove the completed Multi-AI Audit Skill Evaluation section. The currentDate field should be set automatically rather than manually maintained.","acceptance_tests":["MEMORY.md no longer contains sections marked COMPLETE","Line count stays well under 200 lines","No stale date references"]}
{"category":"ai-optimization","title":".session-state.json shows 166 begins vs 16 ends (10:1 ratio)","fingerprint":"ai-optimization::.claude/hooks/.session-state.json::begin-end-imbalance","severity":"S2","effort":"E1","confidence":90,"files":[".claude/hooks/.session-state.json",".claude/skills/session-end/SKILL.md"],"why_it_matters":"The session state shows 166 session begins but only 16 session ends, a 10:1 ratio. This means ~90% of sessions end without running session-end, which means state cleanup (step 6) almost never runs. All the cleanup issues identified in this audit are compounded by the fact that session-end is rarely executed. State files accumulate because the cleanup mechanism is practically never triggered.","suggested_fix":"Add lightweight automatic cleanup to session-start.js that runs the critical cleanup steps (remove stale temp files, prune old task states, check JSONL sizes). This ensures cleanup happens even when session-end is skipped. Consider adding a session-start alert when begin/end ratio exceeds 5:1.","acceptance_tests":["session-start.js performs basic state hygiene on startup","Stale temp files are removed at session start","JSONL file sizes are checked and warned if oversized at session start"]}
