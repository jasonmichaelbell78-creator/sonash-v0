{"category":"ai-optimization","title":"session-start.js outputs 40+ decorative console.log lines with emoji per session","fingerprint":"ai-optimization::.claude/hooks/session-start.js::verbose-decorative-output","severity":"S2","effort":"E1","confidence":85,"files":[".claude/hooks/session-start.js"],"why_it_matters":"~50-100 tokens per session consumed by decorative borders, emoji, and redundant status messages in SessionStart hook output; this adds up across 5+ sessions/day","suggested_fix":"Consolidate to a single summary table output; move verbose details behind --verbose flag; remove emoji decorations","acceptance_tests":["SessionStart output under 20 lines default","--verbose shows full output","Token cost per session reduced"]}
{"category":"ai-optimization","title":"Multi-line regex with greedy \\[\\s\\S\\]*? quantifier in auto-save-context.js","fingerprint":"ai-optimization::.claude/hooks/auto-save-context.js::greedy-multiline-regex","severity":"S2","effort":"E1","confidence":80,"files":[".claude/hooks/auto-save-context.js"],"why_it_matters":"Line 126 uses [\\s\\S]*? for multi-line markdown section matching â€” potential ReDoS on crafted input; should use line-by-line parsing per two-strikes rule","suggested_fix":"Replace regex with line-split parsing: split on \\n, find section start, scan until next ## or ---","acceptance_tests":["No [\\s\\S]*? patterns in hook","Section parsing still works correctly","FIX_TEMPLATES Template 21 pattern applied"]}
{"category":"ai-optimization","title":"JSONL line counting pattern repeated 5x without abstraction","fingerprint":"ai-optimization::scripts::duplicated-jsonl-line-count","severity":"S3","effort":"E0","confidence":85,"files":[".claude/hooks/session-start.js"],"why_it_matters":".trim().split('\\n').filter(Boolean).length pattern repeated 5 times across hooks/scripts; a shared helper would reduce duplication and ensure consistent behavior","suggested_fix":"Extract to scripts/lib/count-jsonl-lines.js helper and import in all 5 locations","acceptance_tests":["Helper function exists","All 5 call sites use the helper","npm run patterns:check passes"]}
{"category":"ai-optimization","title":"String concatenation for file paths instead of path.join","fingerprint":"ai-optimization::scripts/archive-doc.js::string-path-concat","severity":"S3","effort":"E0","confidence":75,"files":["scripts/archive-doc.js"],"why_it_matters":"Using filePath + '.tmp' and filePath + '.bak' instead of path operations; while unlikely to break on consistent OS, violates cross-platform safety patterns","suggested_fix":"Replace with path-based operations or template literals with documented intent","acceptance_tests":["No string concatenation for path construction","path.join used for temp file paths"]}
{"category":"ai-optimization","title":"Fragile markdown field parsing regex repeated across 3+ scripts","fingerprint":"ai-optimization::scripts::duplicated-markdown-field-regex","severity":"S2","effort":"E1","confidence":80,"files":[".claude/hooks/commit-tracker.js",".claude/hooks/auto-save-context.js"],"why_it_matters":"Patterns like /Current Session Count(er)?.*:(\\d+)/i appear in 3+ scripts with slight variations; fragile to markdown formatting changes and duplicated maintenance burden","suggested_fix":"Extract to scripts/lib/parse-markdown-field.js with parseMarkdownField(content, fieldName) helper","acceptance_tests":["Shared helper exists","All call sites use the helper","Markdown field parsing consistent across scripts"]}
{"category":"ai-optimization","title":"Hooks output decorative error messages instead of machine-readable format","fingerprint":"ai-optimization::.claude/hooks::decorative-error-output","severity":"S3","effort":"E2","confidence":70,"files":[".claude/hooks/auto-save-context.js",".claude/hooks/commit-tracker.js",".claude/hooks/large-context-warning.js"],"why_it_matters":"Hook console.error blocks use 5-12 line decorative formatting with borders and emoji for errors that are only machine-consumed; wastes tokens in conversation context","suggested_fix":"Use structured JSON stderr output for hook errors; reserve decorative output for user-facing messages only","acceptance_tests":["Hook errors output as single-line JSON to stderr","No multi-line decorative error blocks in hooks"]}
{"category":"ai-optimization","title":"Unused fields in commit-log.jsonl state file","fingerprint":"ai-optimization::.claude/state/commit-log.jsonl::unused-fields","severity":"S3","effort":"E0","confidence":70,"files":[".claude/state/commit-log.jsonl",".claude/hooks/commit-tracker.js"],"why_it_matters":"authorDate and author fields in commit-log.jsonl entries are often null or unused by any consumer script; removing could reduce file size by 15-20%","suggested_fix":"Remove unused fields from commit-tracker.js output; verify no script reads these fields","acceptance_tests":["No authorDate/author fields in new commit-log entries","No script references these fields","File size reduced"]}
