{"id":"REF-001","category":"GodObject","severity":"S1","effort":"E2","confidence":"HIGH","verified":"DUAL_PASS_CONFIRMED","file":"components/notebook/pages/today-page.tsx","line":1,"title":"TodayPage god component (1117 lines, 14 useState, 10 useEffect, 24 imports)","description":"TodayPage mixes 5+ responsibilities: persistence, realtime sync, analytics, UI state, localStorage recovery. Highest LOC in codebase with 14 useState hooks and 10 useEffect hooks creating complex state interdependencies.","metrics":{"lines":1117,"useState":14,"useEffect":10,"imports":24,"responsibilities":5},"recommendation":"Split into hooks: useDailyLogState, useDailyLogRealtime, useWeeklyStats. Move Firestore queries to service layer. Target <400 lines per component.","evidence":["wc -l shows 1117 lines","grep useState shows 14 usages","grep useEffect shows 10 usages","grep import shows 24 imports"],"cross_ref":"CANON-0072"}
{"id":"REF-002","category":"GodObject","severity":"S1","effort":"E2","confidence":"HIGH","verified":"DUAL_PASS_CONFIRMED","file":"components/admin/users-tab.tsx","line":1,"title":"UsersTab god component (924 lines, 21 useState, 3 useEffect)","description":"Admin users component with 924 lines, 21 useState hooks for managing search, pagination, drawer, editing states. Too many responsibilities in single component making it hard to maintain and test.","metrics":{"lines":924,"useState":21,"useEffect":3,"interfaces":5},"recommendation":"Extract UserListItem, UserSearchBar, UserDetailDrawer as separate components. Create useUserSearch and useUserDetail hooks.","evidence":["wc -l shows 924 lines","grep useState shows 21 usages","5 interfaces defined in file"],"cross_ref":"MANUAL_ONLY"}
{"id":"REF-003","category":"GodObject","severity":"S2","effort":"E2","confidence":"HIGH","verified":"TOOL_VALIDATED","file":"components/growth/Step1WorksheetCard.tsx","line":1,"title":"Step1WorksheetCard large component (845 lines) with nested conditionals","description":"Complex growth worksheet with 845 lines, large initialData object (34 fields), and deeply nested switch statements for question rendering.","metrics":{"lines":845,"dataFields":34,"constants":4},"recommendation":"Extract FormSection, QuestionBlock as separate components. Move FORM_SECTIONS constant to separate config file.","evidence":["wc -l shows 845 lines","34 fields in initialData object","switch with multiple cases for question types"],"cross_ref":"MANUAL_ONLY"}
{"id":"REF-004","category":"GodObject","severity":"S2","effort":"E2","confidence":"HIGH","verified":"TOOL_VALIDATED","file":"components/notebook/pages/resources-page.tsx","line":1,"title":"ResourcesPage large component (728 lines) mixing meetings and sober homes","description":"Resources page handles two separate resource types (meetings, sober homes) with distinct data fetching, filtering, and display logic in single component.","metrics":{"lines":728,"responsibilities":3},"recommendation":"Extract MeetingsSection and SoberHomesSection as separate components. Create useResourceFilters hook for shared filter state.","evidence":["wc -l shows 728 lines","Two distinct resource types with separate logic","Dynamic import for MeetingMap"],"cross_ref":"MANUAL_ONLY"}
{"id":"REF-005","category":"Duplication","severity":"S1","effort":"E1","confidence":"HIGH","verified":"TOOL_VALIDATED","file":"lib/db/quotes.ts","line":44,"title":"Time-of-day rotation logic duplicated in quotes.ts and slogans.ts (80+ lines)","description":"getTimeOfDay() and getQuoteForNow()/getSloganForNow() contain identical complex rotation algorithms (time windows + day-of-year seed) duplicated between two files. Bug fixes must be applied twice.","metrics":{"duplicatedLines":80,"files":2},"recommendation":"Extract to lib/utils/content-rotation.ts with generic getTimeOfDay() and getRotatingContentForNow<T>() functions.","evidence":["quotes.ts:44-48 getTimeOfDay identical to slogans.ts:64-68","quotes.ts:58-95 getQuoteForNow pattern matches slogans.ts:78-115"],"cross_ref":"CANON-0065"}
{"id":"REF-006","category":"Duplication","severity":"S2","effort":"E1","confidence":"HIGH","verified":"TOOL_VALIDATED","file":"hooks/use-journal.ts","line":281,"title":"reCAPTCHA token fetch pattern repeated 5x across codebase","description":"Same getRecaptchaToken() boilerplate repeated in firestore-service.ts (3x) and use-journal.ts (2x). Easy to forget when adding new Cloud Function calls.","metrics":{"instances":5,"files":3},"recommendation":"Create callSecureFunction wrapper in lib/utils/callable-errors.ts that auto-injects reCAPTCHA token.","evidence":["lib/firestore-service.ts:126-144 saveDailyLog reCAPTCHA","lib/firestore-service.ts:376-391 saveNotebookJournalEntry reCAPTCHA","hooks/use-journal.ts:281-299 addEntry reCAPTCHA"],"cross_ref":"CANON-0076"}
{"id":"REF-007","category":"Duplication","severity":"S2","effort":"E2","confidence":"MEDIUM","verified":"TOOL_VALIDATED","file":"components/growth/SpotCheckCard.tsx","line":24,"title":"Growth card dialog/save pattern duplicated across 4 components","description":"isOpen/isSaving/handleSave state management pattern repeated in SpotCheckCard, GratitudeCard, NightReviewCard, Step1WorksheetCard.","metrics":{"instances":4,"boilerplateLines":20},"recommendation":"Extract useGrowthCardDialog(saveConfig) hook that manages isOpen, isSaving, and provides handleSave.","evidence":["SpotCheckCard.tsx:24-88 isOpen/isSaving/handleSave","GratitudeCard.tsx:28-99 same pattern","NightReviewCard.tsx:75-165 same pattern","Step1WorksheetCard.tsx:455-650 same pattern"],"cross_ref":"CANON-0079"}
{"id":"REF-008","category":"Architecture","severity":"S1","effort":"E2","confidence":"HIGH","verified":"TOOL_VALIDATED","file":"hooks/use-journal.ts","line":31,"title":"Direct Firebase SDK usage in 22+ files bypasses service layer","description":"Components and hooks import directly from firebase/firestore (collection, doc, onSnapshot, getDocs) instead of using service layer. SDK changes would require touching 22+ files.","metrics":{"directImports":22,"affectedFiles":10},"recommendation":"Route all Firebase access through lib/firestore-service.ts or dedicated services. Components should only import from services.","evidence":["hooks/use-journal.ts:31-36 imports collection, query, orderBy, onSnapshot","components/notebook/pages/today-page.tsx:309 dynamic import firebase/firestore","components/admin/admin-crud-table.tsx:47-54 direct collection/getDocs"],"cross_ref":"CANON-0075"}
{"id":"REF-009","category":"Architecture","severity":"S2","effort":"E2","confidence":"MEDIUM","verified":"MANUAL_ONLY","file":"lib/firestore-service.ts","line":365,"title":"Deprecated saveNotebookJournalEntry still used in 6+ UI components","description":"saveNotebookJournalEntry marked DEPRECATED but still used in GratitudeCard, SpotCheckCard, NightReviewCard, Step1WorksheetCard, today-page. Creates dual write paths with inconsistent metadata.","metrics":{"usages":6,"deprecatedLines":92},"recommendation":"Migrate callers to useJournal.addEntry. Remove deprecated method.","evidence":["lib/firestore-service.ts:365-457 saveNotebookJournalEntry (DEPRECATED comment)","grep saveNotebookJournalEntry found 6+ component usages"],"cross_ref":"CANON-0070"}
{"id":"REF-010","category":"TechDebt","severity":"S3","effort":"E0","confidence":"HIGH","verified":"TOOL_VALIDATED","file":"lib/firestore-service.ts","line":200,"title":"CloudFunctionError interface defined twice in same file","description":"CloudFunctionError interface is defined at both line 200-203 and line 423-426 in firestore-service.ts. Unnecessary duplication within same file.","metrics":{"duplicateDefinitions":2},"recommendation":"Define once at module level or extract to lib/types/errors.ts","evidence":["lib/firestore-service.ts:200-203 interface CloudFunctionError","lib/firestore-service.ts:423-426 interface CloudFunctionError"],"cross_ref":"CANON-0087"}
{"id":"REF-011","category":"TechDebt","severity":"S3","effort":"E0","confidence":"HIGH","verified":"TOOL_VALIDATED","file":"components/notebook/features/quick-actions-fab.tsx","line":12,"title":"2 tracked TODO markers in codebase","description":"Found 2 TODO/FIXME markers: quick-actions-fab.tsx:12 (customizable action buttons) and firestore-adapter.ts:51 (configurable limits).","metrics":{"todoCount":2},"recommendation":"Convert to GitHub issues or resolve. TODOs without tracking risk being forgotten.","evidence":["quick-actions-fab.tsx:12 TODO: Make action buttons customizable","firestore-adapter.ts:51 TODO: Pass limit to FirestoreService"],"cross_ref":"MANUAL_ONLY"}
{"id":"REF-012","category":"TechDebt","severity":"S3","effort":"E1","confidence":"HIGH","verified":"TOOL_VALIDATED","file":"lib/logger.ts","line":86,"title":"4 linter suppressions in codebase (ts-ignore, ts-expect-error, eslint-disable)","description":"Found 4 linter suppressions: logger.ts:86 (eslint-disable no-control-regex), resources-page.tsx:444 (ts-expect-error), admin/page.tsx:47 (eslint-disable react-hooks), use-geolocation.ts:171 (eslint-disable exhaustive-deps).","metrics":{"suppressions":4},"recommendation":"Review each suppression for possible removal or proper typing solution.","evidence":["lib/logger.ts:86 eslint-disable-next-line no-control-regex","components/notebook/pages/resources-page.tsx:444 @ts-expect-error","app/admin/page.tsx:47 eslint-disable react-hooks/set-state-in-effect","hooks/use-geolocation.ts:171 eslint-disable-line react-hooks/exhaustive-deps"],"cross_ref":"MANUAL_ONLY"}
